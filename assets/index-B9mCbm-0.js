(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))l(f);new MutationObserver(f=>{for(const v of f)if(v.type==="childList")for(const y of v.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&l(y)}).observe(document,{childList:!0,subtree:!0});function i(f){const v={};return f.integrity&&(v.integrity=f.integrity),f.referrerPolicy&&(v.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?v.credentials="include":f.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function l(f){if(f.ep)return;f.ep=!0;const v=i(f);fetch(f.href,v)}})();function Q0(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function qE(c){if(Object.prototype.hasOwnProperty.call(c,"__esModule"))return c;var e=c.default;if(typeof e=="function"){var i=function l(){var f=!1;try{f=this instanceof l}catch{}return f?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(c).forEach(function(l){var f=Object.getOwnPropertyDescriptor(c,l);Object.defineProperty(i,l,f.get?f:{enumerable:!0,get:function(){return c[l]}})}),i}var Nv={exports:{}},vg={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ix;function GE(){if(ix)return vg;ix=1;var c=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(l,f,v){var y=null;if(v!==void 0&&(y=""+v),f.key!==void 0&&(y=""+f.key),"key"in f){v={};for(var h in f)h!=="key"&&(v[h]=f[h])}else v=f;return f=v.ref,{$$typeof:c,type:l,key:y,ref:f!==void 0?f:null,props:v}}return vg.Fragment=e,vg.jsx=i,vg.jsxs=i,vg}var rx;function HE(){return rx||(rx=1,Nv.exports=GE()),Nv.exports}var ht=HE(),Bv={exports:{}},Nn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sx;function ZE(){if(sx)return Nn;sx=1;var c=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),v=Symbol.for("react.consumer"),y=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),O=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),K=Symbol.iterator;function ee(De){return De===null||typeof De!="object"?null:(De=K&&De[K]||De["@@iterator"],typeof De=="function"?De:null)}var Y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ve=Object.assign,Ce={};function Ee(De,ut,Ot){this.props=De,this.context=ut,this.refs=Ce,this.updater=Ot||Y}Ee.prototype.isReactComponent={},Ee.prototype.setState=function(De,ut){if(typeof De!="object"&&typeof De!="function"&&De!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,De,ut,"setState")},Ee.prototype.forceUpdate=function(De){this.updater.enqueueForceUpdate(this,De,"forceUpdate")};function Je(){}Je.prototype=Ee.prototype;function je(De,ut,Ot){this.props=De,this.context=ut,this.refs=Ce,this.updater=Ot||Y}var He=je.prototype=new Je;He.constructor=je,ve(He,Ee.prototype),He.isPureReactComponent=!0;var gt=Array.isArray,St={H:null,A:null,T:null,S:null,V:null},Pt=Object.prototype.hasOwnProperty;function Se(De,ut,Ot,Mt,qt,An){return Ot=An.ref,{$$typeof:c,type:De,key:ut,ref:Ot!==void 0?Ot:null,props:An}}function pe(De,ut){return Se(De.type,ut,void 0,void 0,void 0,De.props)}function ye(De){return typeof De=="object"&&De!==null&&De.$$typeof===c}function Oe(De){var ut={"=":"=0",":":"=2"};return"$"+De.replace(/[=:]/g,function(Ot){return ut[Ot]})}var Me=/\/+/g;function Ve(De,ut){return typeof De=="object"&&De!==null&&De.key!=null?Oe(""+De.key):ut.toString(36)}function Te(){}function dn(De){switch(De.status){case"fulfilled":return De.value;case"rejected":throw De.reason;default:switch(typeof De.status=="string"?De.then(Te,Te):(De.status="pending",De.then(function(ut){De.status==="pending"&&(De.status="fulfilled",De.value=ut)},function(ut){De.status==="pending"&&(De.status="rejected",De.reason=ut)})),De.status){case"fulfilled":return De.value;case"rejected":throw De.reason}}throw De}function In(De,ut,Ot,Mt,qt){var An=typeof De;(An==="undefined"||An==="boolean")&&(De=null);var Ht=!1;if(De===null)Ht=!0;else switch(An){case"bigint":case"string":case"number":Ht=!0;break;case"object":switch(De.$$typeof){case c:case e:Ht=!0;break;case V:return Ht=De._init,In(Ht(De._payload),ut,Ot,Mt,qt)}}if(Ht)return qt=qt(De),Ht=Mt===""?"."+Ve(De,0):Mt,gt(qt)?(Ot="",Ht!=null&&(Ot=Ht.replace(Me,"$&/")+"/"),In(qt,ut,Ot,"",function(ar){return ar})):qt!=null&&(ye(qt)&&(qt=pe(qt,Ot+(qt.key==null||De&&De.key===qt.key?"":(""+qt.key).replace(Me,"$&/")+"/")+Ht)),ut.push(qt)),1;Ht=0;var Ji=Mt===""?".":Mt+":";if(gt(De))for(var On=0;On<De.length;On++)Mt=De[On],An=Ji+Ve(Mt,On),Ht+=In(Mt,ut,Ot,An,qt);else if(On=ee(De),typeof On=="function")for(De=On.call(De),On=0;!(Mt=De.next()).done;)Mt=Mt.value,An=Ji+Ve(Mt,On++),Ht+=In(Mt,ut,Ot,An,qt);else if(An==="object"){if(typeof De.then=="function")return In(dn(De),ut,Ot,Mt,qt);throw ut=String(De),Error("Objects are not valid as a React child (found: "+(ut==="[object Object]"?"object with keys {"+Object.keys(De).join(", ")+"}":ut)+"). If you meant to render a collection of children, use an array instead.")}return Ht}function st(De,ut,Ot){if(De==null)return De;var Mt=[],qt=0;return In(De,Mt,"","",function(An){return ut.call(Ot,An,qt++)}),Mt}function kt(De){if(De._status===-1){var ut=De._result;ut=ut(),ut.then(function(Ot){(De._status===0||De._status===-1)&&(De._status=1,De._result=Ot)},function(Ot){(De._status===0||De._status===-1)&&(De._status=2,De._result=Ot)}),De._status===-1&&(De._status=0,De._result=ut)}if(De._status===1)return De._result.default;throw De._result}var Zt=typeof reportError=="function"?reportError:function(De){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ut=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof De=="object"&&De!==null&&typeof De.message=="string"?String(De.message):String(De),error:De});if(!window.dispatchEvent(ut))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",De);return}console.error(De)};function Wt(){}return Nn.Children={map:st,forEach:function(De,ut,Ot){st(De,function(){ut.apply(this,arguments)},Ot)},count:function(De){var ut=0;return st(De,function(){ut++}),ut},toArray:function(De){return st(De,function(ut){return ut})||[]},only:function(De){if(!ye(De))throw Error("React.Children.only expected to receive a single React element child.");return De}},Nn.Component=Ee,Nn.Fragment=i,Nn.Profiler=f,Nn.PureComponent=je,Nn.StrictMode=l,Nn.Suspense=M,Nn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=St,Nn.__COMPILER_RUNTIME={__proto__:null,c:function(De){return St.H.useMemoCache(De)}},Nn.cache=function(De){return function(){return De.apply(null,arguments)}},Nn.cloneElement=function(De,ut,Ot){if(De==null)throw Error("The argument must be a React element, but you passed "+De+".");var Mt=ve({},De.props),qt=De.key,An=void 0;if(ut!=null)for(Ht in ut.ref!==void 0&&(An=void 0),ut.key!==void 0&&(qt=""+ut.key),ut)!Pt.call(ut,Ht)||Ht==="key"||Ht==="__self"||Ht==="__source"||Ht==="ref"&&ut.ref===void 0||(Mt[Ht]=ut[Ht]);var Ht=arguments.length-2;if(Ht===1)Mt.children=Ot;else if(1<Ht){for(var Ji=Array(Ht),On=0;On<Ht;On++)Ji[On]=arguments[On+2];Mt.children=Ji}return Se(De.type,qt,void 0,void 0,An,Mt)},Nn.createContext=function(De){return De={$$typeof:y,_currentValue:De,_currentValue2:De,_threadCount:0,Provider:null,Consumer:null},De.Provider=De,De.Consumer={$$typeof:v,_context:De},De},Nn.createElement=function(De,ut,Ot){var Mt,qt={},An=null;if(ut!=null)for(Mt in ut.key!==void 0&&(An=""+ut.key),ut)Pt.call(ut,Mt)&&Mt!=="key"&&Mt!=="__self"&&Mt!=="__source"&&(qt[Mt]=ut[Mt]);var Ht=arguments.length-2;if(Ht===1)qt.children=Ot;else if(1<Ht){for(var Ji=Array(Ht),On=0;On<Ht;On++)Ji[On]=arguments[On+2];qt.children=Ji}if(De&&De.defaultProps)for(Mt in Ht=De.defaultProps,Ht)qt[Mt]===void 0&&(qt[Mt]=Ht[Mt]);return Se(De,An,void 0,void 0,null,qt)},Nn.createRef=function(){return{current:null}},Nn.forwardRef=function(De){return{$$typeof:h,render:De}},Nn.isValidElement=ye,Nn.lazy=function(De){return{$$typeof:V,_payload:{_status:-1,_result:De},_init:kt}},Nn.memo=function(De,ut){return{$$typeof:O,type:De,compare:ut===void 0?null:ut}},Nn.startTransition=function(De){var ut=St.T,Ot={};St.T=Ot;try{var Mt=De(),qt=St.S;qt!==null&&qt(Ot,Mt),typeof Mt=="object"&&Mt!==null&&typeof Mt.then=="function"&&Mt.then(Wt,Zt)}catch(An){Zt(An)}finally{St.T=ut}},Nn.unstable_useCacheRefresh=function(){return St.H.useCacheRefresh()},Nn.use=function(De){return St.H.use(De)},Nn.useActionState=function(De,ut,Ot){return St.H.useActionState(De,ut,Ot)},Nn.useCallback=function(De,ut){return St.H.useCallback(De,ut)},Nn.useContext=function(De){return St.H.useContext(De)},Nn.useDebugValue=function(){},Nn.useDeferredValue=function(De,ut){return St.H.useDeferredValue(De,ut)},Nn.useEffect=function(De,ut,Ot){var Mt=St.H;if(typeof Ot=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Mt.useEffect(De,ut)},Nn.useId=function(){return St.H.useId()},Nn.useImperativeHandle=function(De,ut,Ot){return St.H.useImperativeHandle(De,ut,Ot)},Nn.useInsertionEffect=function(De,ut){return St.H.useInsertionEffect(De,ut)},Nn.useLayoutEffect=function(De,ut){return St.H.useLayoutEffect(De,ut)},Nn.useMemo=function(De,ut){return St.H.useMemo(De,ut)},Nn.useOptimistic=function(De,ut){return St.H.useOptimistic(De,ut)},Nn.useReducer=function(De,ut,Ot){return St.H.useReducer(De,ut,Ot)},Nn.useRef=function(De){return St.H.useRef(De)},Nn.useState=function(De){return St.H.useState(De)},Nn.useSyncExternalStore=function(De,ut,Ot){return St.H.useSyncExternalStore(De,ut,Ot)},Nn.useTransition=function(){return St.H.useTransition()},Nn.version="19.1.1",Nn}var ax;function J0(){return ax||(ax=1,Bv.exports=ZE()),Bv.exports}var rt=J0();const Df=Q0(rt);var Vv={exports:{}},bg={},jv={exports:{}},Uv={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ox;function WE(){return ox||(ox=1,(function(c){function e(st,kt){var Zt=st.length;st.push(kt);e:for(;0<Zt;){var Wt=Zt-1>>>1,De=st[Wt];if(0<f(De,kt))st[Wt]=kt,st[Zt]=De,Zt=Wt;else break e}}function i(st){return st.length===0?null:st[0]}function l(st){if(st.length===0)return null;var kt=st[0],Zt=st.pop();if(Zt!==kt){st[0]=Zt;e:for(var Wt=0,De=st.length,ut=De>>>1;Wt<ut;){var Ot=2*(Wt+1)-1,Mt=st[Ot],qt=Ot+1,An=st[qt];if(0>f(Mt,Zt))qt<De&&0>f(An,Mt)?(st[Wt]=An,st[qt]=Zt,Wt=qt):(st[Wt]=Mt,st[Ot]=Zt,Wt=Ot);else if(qt<De&&0>f(An,Zt))st[Wt]=An,st[qt]=Zt,Wt=qt;else break e}}return kt}function f(st,kt){var Zt=st.sortIndex-kt.sortIndex;return Zt!==0?Zt:st.id-kt.id}if(c.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var v=performance;c.unstable_now=function(){return v.now()}}else{var y=Date,h=y.now();c.unstable_now=function(){return y.now()-h}}var M=[],O=[],V=1,K=null,ee=3,Y=!1,ve=!1,Ce=!1,Ee=!1,Je=typeof setTimeout=="function"?setTimeout:null,je=typeof clearTimeout=="function"?clearTimeout:null,He=typeof setImmediate<"u"?setImmediate:null;function gt(st){for(var kt=i(O);kt!==null;){if(kt.callback===null)l(O);else if(kt.startTime<=st)l(O),kt.sortIndex=kt.expirationTime,e(M,kt);else break;kt=i(O)}}function St(st){if(Ce=!1,gt(st),!ve)if(i(M)!==null)ve=!0,Pt||(Pt=!0,Ve());else{var kt=i(O);kt!==null&&In(St,kt.startTime-st)}}var Pt=!1,Se=-1,pe=5,ye=-1;function Oe(){return Ee?!0:!(c.unstable_now()-ye<pe)}function Me(){if(Ee=!1,Pt){var st=c.unstable_now();ye=st;var kt=!0;try{e:{ve=!1,Ce&&(Ce=!1,je(Se),Se=-1),Y=!0;var Zt=ee;try{t:{for(gt(st),K=i(M);K!==null&&!(K.expirationTime>st&&Oe());){var Wt=K.callback;if(typeof Wt=="function"){K.callback=null,ee=K.priorityLevel;var De=Wt(K.expirationTime<=st);if(st=c.unstable_now(),typeof De=="function"){K.callback=De,gt(st),kt=!0;break t}K===i(M)&&l(M),gt(st)}else l(M);K=i(M)}if(K!==null)kt=!0;else{var ut=i(O);ut!==null&&In(St,ut.startTime-st),kt=!1}}break e}finally{K=null,ee=Zt,Y=!1}kt=void 0}}finally{kt?Ve():Pt=!1}}}var Ve;if(typeof He=="function")Ve=function(){He(Me)};else if(typeof MessageChannel<"u"){var Te=new MessageChannel,dn=Te.port2;Te.port1.onmessage=Me,Ve=function(){dn.postMessage(null)}}else Ve=function(){Je(Me,0)};function In(st,kt){Se=Je(function(){st(c.unstable_now())},kt)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(st){st.callback=null},c.unstable_forceFrameRate=function(st){0>st||125<st?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):pe=0<st?Math.floor(1e3/st):5},c.unstable_getCurrentPriorityLevel=function(){return ee},c.unstable_next=function(st){switch(ee){case 1:case 2:case 3:var kt=3;break;default:kt=ee}var Zt=ee;ee=kt;try{return st()}finally{ee=Zt}},c.unstable_requestPaint=function(){Ee=!0},c.unstable_runWithPriority=function(st,kt){switch(st){case 1:case 2:case 3:case 4:case 5:break;default:st=3}var Zt=ee;ee=st;try{return kt()}finally{ee=Zt}},c.unstable_scheduleCallback=function(st,kt,Zt){var Wt=c.unstable_now();switch(typeof Zt=="object"&&Zt!==null?(Zt=Zt.delay,Zt=typeof Zt=="number"&&0<Zt?Wt+Zt:Wt):Zt=Wt,st){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=Zt+De,st={id:V++,callback:kt,priorityLevel:st,startTime:Zt,expirationTime:De,sortIndex:-1},Zt>Wt?(st.sortIndex=Zt,e(O,st),i(M)===null&&st===i(O)&&(Ce?(je(Se),Se=-1):Ce=!0,In(St,Zt-Wt))):(st.sortIndex=De,e(M,st),ve||Y||(ve=!0,Pt||(Pt=!0,Ve()))),st},c.unstable_shouldYield=Oe,c.unstable_wrapCallback=function(st){var kt=ee;return function(){var Zt=ee;ee=kt;try{return st.apply(this,arguments)}finally{ee=Zt}}}})(Uv)),Uv}var lx;function KE(){return lx||(lx=1,jv.exports=WE()),jv.exports}var Fv={exports:{}},ka={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cx;function XE(){if(cx)return ka;cx=1;var c=J0();function e(M){var O="https://react.dev/errors/"+M;if(1<arguments.length){O+="?args[]="+encodeURIComponent(arguments[1]);for(var V=2;V<arguments.length;V++)O+="&args[]="+encodeURIComponent(arguments[V])}return"Minified React error #"+M+"; visit "+O+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var l={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},f=Symbol.for("react.portal");function v(M,O,V){var K=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:f,key:K==null?null:""+K,children:M,containerInfo:O,implementation:V}}var y=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(M,O){if(M==="font")return"";if(typeof O=="string")return O==="use-credentials"?O:""}return ka.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,ka.createPortal=function(M,O){var V=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!O||O.nodeType!==1&&O.nodeType!==9&&O.nodeType!==11)throw Error(e(299));return v(M,O,null,V)},ka.flushSync=function(M){var O=y.T,V=l.p;try{if(y.T=null,l.p=2,M)return M()}finally{y.T=O,l.p=V,l.d.f()}},ka.preconnect=function(M,O){typeof M=="string"&&(O?(O=O.crossOrigin,O=typeof O=="string"?O==="use-credentials"?O:"":void 0):O=null,l.d.C(M,O))},ka.prefetchDNS=function(M){typeof M=="string"&&l.d.D(M)},ka.preinit=function(M,O){if(typeof M=="string"&&O&&typeof O.as=="string"){var V=O.as,K=h(V,O.crossOrigin),ee=typeof O.integrity=="string"?O.integrity:void 0,Y=typeof O.fetchPriority=="string"?O.fetchPriority:void 0;V==="style"?l.d.S(M,typeof O.precedence=="string"?O.precedence:void 0,{crossOrigin:K,integrity:ee,fetchPriority:Y}):V==="script"&&l.d.X(M,{crossOrigin:K,integrity:ee,fetchPriority:Y,nonce:typeof O.nonce=="string"?O.nonce:void 0})}},ka.preinitModule=function(M,O){if(typeof M=="string")if(typeof O=="object"&&O!==null){if(O.as==null||O.as==="script"){var V=h(O.as,O.crossOrigin);l.d.M(M,{crossOrigin:V,integrity:typeof O.integrity=="string"?O.integrity:void 0,nonce:typeof O.nonce=="string"?O.nonce:void 0})}}else O==null&&l.d.M(M)},ka.preload=function(M,O){if(typeof M=="string"&&typeof O=="object"&&O!==null&&typeof O.as=="string"){var V=O.as,K=h(V,O.crossOrigin);l.d.L(M,V,{crossOrigin:K,integrity:typeof O.integrity=="string"?O.integrity:void 0,nonce:typeof O.nonce=="string"?O.nonce:void 0,type:typeof O.type=="string"?O.type:void 0,fetchPriority:typeof O.fetchPriority=="string"?O.fetchPriority:void 0,referrerPolicy:typeof O.referrerPolicy=="string"?O.referrerPolicy:void 0,imageSrcSet:typeof O.imageSrcSet=="string"?O.imageSrcSet:void 0,imageSizes:typeof O.imageSizes=="string"?O.imageSizes:void 0,media:typeof O.media=="string"?O.media:void 0})}},ka.preloadModule=function(M,O){if(typeof M=="string")if(O){var V=h(O.as,O.crossOrigin);l.d.m(M,{as:typeof O.as=="string"&&O.as!=="script"?O.as:void 0,crossOrigin:V,integrity:typeof O.integrity=="string"?O.integrity:void 0})}else l.d.m(M)},ka.requestFormReset=function(M){l.d.r(M)},ka.unstable_batchedUpdates=function(M,O){return M(O)},ka.useFormState=function(M,O,V){return y.H.useFormState(M,O,V)},ka.useFormStatus=function(){return y.H.useHostTransitionStatus()},ka.version="19.1.1",ka}var ux;function YE(){if(ux)return Fv.exports;ux=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(e){console.error(e)}}return c(),Fv.exports=XE(),Fv.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hx;function QE(){if(hx)return bg;hx=1;var c=KE(),e=J0(),i=YE();function l(r){var u="https://react.dev/errors/"+r;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)u+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+r+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function v(r){var u=r,m=r;if(r.alternate)for(;u.return;)u=u.return;else{r=u;do u=r,(u.flags&4098)!==0&&(m=u.return),r=u.return;while(r)}return u.tag===3?m:null}function y(r){if(r.tag===13){var u=r.memoizedState;if(u===null&&(r=r.alternate,r!==null&&(u=r.memoizedState)),u!==null)return u.dehydrated}return null}function h(r){if(v(r)!==r)throw Error(l(188))}function M(r){var u=r.alternate;if(!u){if(u=v(r),u===null)throw Error(l(188));return u!==r?null:r}for(var m=r,x=u;;){var C=m.return;if(C===null)break;var z=C.alternate;if(z===null){if(x=C.return,x!==null){m=x;continue}break}if(C.child===z.child){for(z=C.child;z;){if(z===m)return h(C),r;if(z===x)return h(C),u;z=z.sibling}throw Error(l(188))}if(m.return!==x.return)m=C,x=z;else{for(var H=!1,ie=C.child;ie;){if(ie===m){H=!0,m=C,x=z;break}if(ie===x){H=!0,x=C,m=z;break}ie=ie.sibling}if(!H){for(ie=z.child;ie;){if(ie===m){H=!0,m=z,x=C;break}if(ie===x){H=!0,x=z,m=C;break}ie=ie.sibling}if(!H)throw Error(l(189))}}if(m.alternate!==x)throw Error(l(190))}if(m.tag!==3)throw Error(l(188));return m.stateNode.current===m?r:u}function O(r){var u=r.tag;if(u===5||u===26||u===27||u===6)return r;for(r=r.child;r!==null;){if(u=O(r),u!==null)return u;r=r.sibling}return null}var V=Object.assign,K=Symbol.for("react.element"),ee=Symbol.for("react.transitional.element"),Y=Symbol.for("react.portal"),ve=Symbol.for("react.fragment"),Ce=Symbol.for("react.strict_mode"),Ee=Symbol.for("react.profiler"),Je=Symbol.for("react.provider"),je=Symbol.for("react.consumer"),He=Symbol.for("react.context"),gt=Symbol.for("react.forward_ref"),St=Symbol.for("react.suspense"),Pt=Symbol.for("react.suspense_list"),Se=Symbol.for("react.memo"),pe=Symbol.for("react.lazy"),ye=Symbol.for("react.activity"),Oe=Symbol.for("react.memo_cache_sentinel"),Me=Symbol.iterator;function Ve(r){return r===null||typeof r!="object"?null:(r=Me&&r[Me]||r["@@iterator"],typeof r=="function"?r:null)}var Te=Symbol.for("react.client.reference");function dn(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===Te?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case ve:return"Fragment";case Ee:return"Profiler";case Ce:return"StrictMode";case St:return"Suspense";case Pt:return"SuspenseList";case ye:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Y:return"Portal";case He:return(r.displayName||"Context")+".Provider";case je:return(r._context.displayName||"Context")+".Consumer";case gt:var u=r.render;return r=r.displayName,r||(r=u.displayName||u.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Se:return u=r.displayName||null,u!==null?u:dn(r.type)||"Memo";case pe:u=r._payload,r=r._init;try{return dn(r(u))}catch{}}return null}var In=Array.isArray,st=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,kt=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Zt={pending:!1,data:null,method:null,action:null},Wt=[],De=-1;function ut(r){return{current:r}}function Ot(r){0>De||(r.current=Wt[De],Wt[De]=null,De--)}function Mt(r,u){De++,Wt[De]=r.current,r.current=u}var qt=ut(null),An=ut(null),Ht=ut(null),Ji=ut(null);function On(r,u){switch(Mt(Ht,u),Mt(An,r),Mt(qt,null),u.nodeType){case 9:case 11:r=(r=u.documentElement)&&(r=r.namespaceURI)?th(r):0;break;default:if(r=u.tagName,u=u.namespaceURI)u=th(u),r=Yh(u,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Ot(qt),Mt(qt,r)}function ar(){Ot(qt),Ot(An),Ot(Ht)}function uo(r){r.memoizedState!==null&&Mt(Ji,r);var u=qt.current,m=Yh(u,r.type);u!==m&&(Mt(An,r),Mt(qt,m))}function Na(r){An.current===r&&(Ot(qt),Ot(An)),Ji.current===r&&(Ot(Ji),j._currentValue=Zt)}var zr=Object.prototype.hasOwnProperty,hi=c.unstable_scheduleCallback,Pi=c.unstable_cancelCallback,Xs=c.unstable_shouldYield,Ls=c.unstable_requestPaint,br=c.unstable_now,Ys=c.unstable_getCurrentPriorityLevel,di=c.unstable_ImmediatePriority,Wi=c.unstable_UserBlockingPriority,Yr=c.unstable_NormalPriority,ho=c.unstable_LowPriority,xa=c.unstable_IdlePriority,Bo=c.log,Ns=c.unstable_setDisableYieldValue,gs=null,Ki=null;function qr(r){if(typeof Bo=="function"&&Ns(r),Ki&&typeof Ki.setStrictMode=="function")try{Ki.setStrictMode(gs,r)}catch{}}var Pe=Math.clz32?Math.clz32:re,J=Math.log,Q=Math.LN2;function re(r){return r>>>=0,r===0?32:31-(J(r)/Q|0)|0}var me=256,xe=4194304;function ke(r){var u=r&42;if(u!==0)return u;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Fe(r,u,m){var x=r.pendingLanes;if(x===0)return 0;var C=0,z=r.suspendedLanes,H=r.pingedLanes;r=r.warmLanes;var ie=x&134217727;return ie!==0?(x=ie&~z,x!==0?C=ke(x):(H&=ie,H!==0?C=ke(H):m||(m=ie&~r,m!==0&&(C=ke(m))))):(ie=x&~z,ie!==0?C=ke(ie):H!==0?C=ke(H):m||(m=x&~r,m!==0&&(C=ke(m)))),C===0?0:u!==0&&u!==C&&(u&z)===0&&(z=C&-C,m=u&-u,z>=m||z===32&&(m&4194048)!==0)?u:C}function Le(r,u){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&u)===0}function nt(r,u){switch(r){case 1:case 2:case 4:case 8:case 64:return u+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mt(){var r=me;return me<<=1,(me&4194048)===0&&(me=256),r}function ot(){var r=xe;return xe<<=1,(xe&62914560)===0&&(xe=4194304),r}function zt(r){for(var u=[],m=0;31>m;m++)u.push(r);return u}function Re(r,u){r.pendingLanes|=u,u!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function nn(r,u,m,x,C,z){var H=r.pendingLanes;r.pendingLanes=m,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=m,r.entangledLanes&=m,r.errorRecoveryDisabledLanes&=m,r.shellSuspendCounter=0;var ie=r.entanglements,we=r.expirationTimes,Ke=r.hiddenUpdates;for(m=H&~m;0<m;){var ct=31-Pe(m),pt=1<<ct;ie[ct]=0,we[ct]=-1;var Qe=Ke[ct];if(Qe!==null)for(Ke[ct]=null,ct=0;ct<Qe.length;ct++){var it=Qe[ct];it!==null&&(it.lane&=-536870913)}m&=~pt}x!==0&&_n(r,x,0),z!==0&&C===0&&r.tag!==0&&(r.suspendedLanes|=z&~(H&~u))}function _n(r,u,m){r.pendingLanes|=u,r.suspendedLanes&=~u;var x=31-Pe(u);r.entangledLanes|=u,r.entanglements[x]=r.entanglements[x]|1073741824|m&4194090}function Nt(r,u){var m=r.entangledLanes|=u;for(r=r.entanglements;m;){var x=31-Pe(m),C=1<<x;C&u|r[x]&u&&(r[x]|=u),m&=~C}}function cn(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Yn(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function vi(){var r=kt.p;return r!==0?r:(r=window.event,r===void 0?32:Ct(r.type))}function or(r,u){var m=kt.p;try{return kt.p=r,u()}finally{kt.p=m}}var ei=Math.random().toString(36).slice(2),Kt="__reactFiber$"+ei,rn="__reactProps$"+ei,fi="__reactContainer$"+ei,yt="__reactEvents$"+ei,er="__reactListeners$"+ei,Ni="__reactHandles$"+ei,Lr="__reactResources$"+ei,Qs="__reactMarker$"+ei;function It(r){delete r[Kt],delete r[rn],delete r[yt],delete r[er],delete r[Ni]}function un(r){var u=r[Kt];if(u)return u;for(var m=r.parentNode;m;){if(u=m[fi]||m[Kt]){if(m=u.alternate,u.child!==null||m!==null&&m.child!==null)for(r=mg(r);r!==null;){if(m=r[Kt])return m;r=mg(r)}return u}r=m,m=r.parentNode}return null}function sn(r){if(r=r[Kt]||r[fi]){var u=r.tag;if(u===5||u===6||u===13||u===26||u===27||u===3)return r}return null}function $i(r){var u=r.tag;if(u===5||u===26||u===27||u===6)return r.stateNode;throw Error(l(33))}function Bs(r){var u=r[Lr];return u||(u=r[Lr]={hoistableStyles:new Map,hoistableScripts:new Map}),u}function pi(r){r[Qs]=!0}var pn=new Set,fo={};function Gr(r,u){Js(r,u),Js(r+"Capture",u)}function Js(r,u){for(fo[r]=u,r=0;r<u.length;r++)pn.add(u[r])}var Qr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),_s={},bi={};function Cc(r){return zr.call(bi,r)?!0:zr.call(_s,r)?!1:Qr.test(r)?bi[r]=!0:(_s[r]=!0,!1)}function xr(r,u,m){if(Cc(u))if(m===null)r.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":r.removeAttribute(u);return;case"boolean":var x=u.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){r.removeAttribute(u);return}}r.setAttribute(u,""+m)}}function qn(r,u,m){if(m===null)r.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(u);return}r.setAttribute(u,""+m)}}function ea(r,u,m,x){if(x===null)r.removeAttribute(m);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(m);return}r.setAttributeNS(u,m,""+x)}}var Ba,fl;function Jr(r){if(Ba===void 0)try{throw Error()}catch(m){var u=m.stack.trim().match(/\n( *(at )?)/);Ba=u&&u[1]||"",fl=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ba+r+fl}var ta=!1;function pl(r,u){if(!r||ta)return"";ta=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(u){var pt=function(){throw Error()};if(Object.defineProperty(pt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(pt,[])}catch(it){var Qe=it}Reflect.construct(r,[],pt)}else{try{pt.call()}catch(it){Qe=it}r.call(pt.prototype)}}else{try{throw Error()}catch(it){Qe=it}(pt=r())&&typeof pt.catch=="function"&&pt.catch(function(){})}}catch(it){if(it&&Qe&&typeof it.stack=="string")return[it.stack,Qe.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var C=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");C&&C.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var z=x.DetermineComponentFrameRoot(),H=z[0],ie=z[1];if(H&&ie){var we=H.split(`
`),Ke=ie.split(`
`);for(C=x=0;x<we.length&&!we[x].includes("DetermineComponentFrameRoot");)x++;for(;C<Ke.length&&!Ke[C].includes("DetermineComponentFrameRoot");)C++;if(x===we.length||C===Ke.length)for(x=we.length-1,C=Ke.length-1;1<=x&&0<=C&&we[x]!==Ke[C];)C--;for(;1<=x&&0<=C;x--,C--)if(we[x]!==Ke[C]){if(x!==1||C!==1)do if(x--,C--,0>C||we[x]!==Ke[C]){var ct=`
`+we[x].replace(" at new "," at ");return r.displayName&&ct.includes("<anonymous>")&&(ct=ct.replace("<anonymous>",r.displayName)),ct}while(1<=x&&0<=C);break}}}finally{ta=!1,Error.prepareStackTrace=m}return(m=r?r.displayName||r.name:"")?Jr(m):""}function mh(r){switch(r.tag){case 26:case 27:case 5:return Jr(r.type);case 16:return Jr("Lazy");case 13:return Jr("Suspense");case 19:return Jr("SuspenseList");case 0:case 15:return pl(r.type,!1);case 11:return pl(r.type.render,!1);case 1:return pl(r.type,!0);case 31:return Jr("Activity");default:return""}}function wa(r){try{var u="";do u+=mh(r),r=r.return;while(r);return u}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}function mi(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Vo(r){var u=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function Ul(r){var u=Vo(r)?"checked":"value",m=Object.getOwnPropertyDescriptor(r.constructor.prototype,u),x=""+r[u];if(!r.hasOwnProperty(u)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var C=m.get,z=m.set;return Object.defineProperty(r,u,{configurable:!0,get:function(){return C.call(this)},set:function(H){x=""+H,z.call(this,H)}}),Object.defineProperty(r,u,{enumerable:m.enumerable}),{getValue:function(){return x},setValue:function(H){x=""+H},stopTracking:function(){r._valueTracker=null,delete r[u]}}}}function ml(r){r._valueTracker||(r._valueTracker=Ul(r))}function gi(r){if(!r)return!1;var u=r._valueTracker;if(!u)return!0;var m=u.getValue(),x="";return r&&(x=Vo(r)?r.checked?"true":"false":r.value),r=x,r!==m?(u.setValue(r),!0):!1}function Va(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Ta=/[\n"\\]/g;function wr(r){return r.replace(Ta,function(u){return"\\"+u.charCodeAt(0).toString(16)+" "})}function Fl(r,u,m,x,C,z,H,ie){r.name="",H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?r.type=H:r.removeAttribute("type"),u!=null?H==="number"?(u===0&&r.value===""||r.value!=u)&&(r.value=""+mi(u)):r.value!==""+mi(u)&&(r.value=""+mi(u)):H!=="submit"&&H!=="reset"||r.removeAttribute("value"),u!=null?$l(r,H,mi(u)):m!=null?$l(r,H,mi(m)):x!=null&&r.removeAttribute("value"),C==null&&z!=null&&(r.defaultChecked=!!z),C!=null&&(r.checked=C&&typeof C!="function"&&typeof C!="symbol"),ie!=null&&typeof ie!="function"&&typeof ie!="symbol"&&typeof ie!="boolean"?r.name=""+mi(ie):r.removeAttribute("name")}function po(r,u,m,x,C,z,H,ie){if(z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(r.type=z),u!=null||m!=null){if(!(z!=="submit"&&z!=="reset"||u!=null))return;m=m!=null?""+mi(m):"",u=u!=null?""+mi(u):m,ie||u===r.value||(r.value=u),r.defaultValue=u}x=x??C,x=typeof x!="function"&&typeof x!="symbol"&&!!x,r.checked=ie?r.checked:!!x,r.defaultChecked=!!x,H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"&&(r.name=H)}function $l(r,u,m){u==="number"&&Va(r.ownerDocument)===r||r.defaultValue===""+m||(r.defaultValue=""+m)}function mo(r,u,m,x){if(r=r.options,u){u={};for(var C=0;C<m.length;C++)u["$"+m[C]]=!0;for(m=0;m<r.length;m++)C=u.hasOwnProperty("$"+r[m].value),r[m].selected!==C&&(r[m].selected=C),C&&x&&(r[m].defaultSelected=!0)}else{for(m=""+mi(m),u=null,C=0;C<r.length;C++){if(r[C].value===m){r[C].selected=!0,x&&(r[C].defaultSelected=!0);return}u!==null||r[C].disabled||(u=r[C])}u!==null&&(u.selected=!0)}}function gh(r,u,m){if(u!=null&&(u=""+mi(u),u!==r.value&&(r.value=u),m==null)){r.defaultValue!==u&&(r.defaultValue=u);return}r.defaultValue=m!=null?""+mi(m):""}function jo(r,u,m,x){if(u==null){if(x!=null){if(m!=null)throw Error(l(92));if(In(x)){if(1<x.length)throw Error(l(93));x=x[0]}m=x}m==null&&(m=""),u=m}m=mi(u),r.defaultValue=m,x=r.textContent,x===m&&x!==""&&x!==null&&(r.value=x)}function es(r,u){if(u){var m=r.firstChild;if(m&&m===r.lastChild&&m.nodeType===3){m.nodeValue=u;return}}r.textContent=u}var Ar=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function xn(r,u,m){var x=u.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?x?r.setProperty(u,""):u==="float"?r.cssFloat="":r[u]="":x?r.setProperty(u,m):typeof m!="number"||m===0||Ar.has(u)?u==="float"?r.cssFloat=m:r[u]=(""+m).trim():r[u]=m+"px"}function ja(r,u,m){if(u!=null&&typeof u!="object")throw Error(l(62));if(r=r.style,m!=null){for(var x in m)!m.hasOwnProperty(x)||u!=null&&u.hasOwnProperty(x)||(x.indexOf("--")===0?r.setProperty(x,""):x==="float"?r.cssFloat="":r[x]="");for(var C in u)x=u[C],u.hasOwnProperty(C)&&m[C]!==x&&xn(r,C,x)}else for(var z in u)u.hasOwnProperty(z)&&xn(r,z,u[z])}function na(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sa=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),go=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function on(r){return go.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var Ua=null;function gl(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Fa=null,si=null;function lr(r){var u=sn(r);if(u&&(r=u.stateNode)){var m=r[rn]||null;e:switch(r=u.stateNode,u.type){case"input":if(Fl(r,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),u=m.name,m.type==="radio"&&u!=null){for(m=r;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+wr(""+u)+'"][type="radio"]'),u=0;u<m.length;u++){var x=m[u];if(x!==r&&x.form===r.form){var C=x[rn]||null;if(!C)throw Error(l(90));Fl(x,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name)}}for(u=0;u<m.length;u++)x=m[u],x.form===r.form&&gi(x)}break e;case"textarea":gh(r,m.value,m.defaultValue);break e;case"select":u=m.value,u!=null&&mo(r,!!m.multiple,u,!1)}}}var cr=!1;function Ri(r,u,m){if(cr)return r(u,m);cr=!0;try{var x=r(u);return x}finally{if(cr=!1,(Fa!==null||si!==null)&&(uf(),Fa&&(u=Fa,r=si,si=Fa=null,lr(u),r)))for(u=0;u<r.length;u++)lr(r[u])}}function Vn(r,u){var m=r.stateNode;if(m===null)return null;var x=m[rn]||null;if(x===null)return null;m=x[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(r=r.type,x=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!x;break e;default:r=!1}if(r)return null;if(m&&typeof m!="function")throw Error(l(231,u,typeof m));return m}var ts=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xi=!1;if(ts)try{var Tr={};Object.defineProperty(Tr,"passive",{get:function(){Xi=!0}}),window.addEventListener("test",Tr,Tr),window.removeEventListener("test",Tr,Tr)}catch{Xi=!1}var xi=null,ln=null,Ea=null;function Qt(){if(Ea)return Ea;var r,u=ln,m=u.length,x,C="value"in xi?xi.value:xi.textContent,z=C.length;for(r=0;r<m&&u[r]===C[r];r++);var H=m-r;for(x=1;x<=H&&u[m-x]===C[z-x];x++);return Ea=C.slice(r,1<x?1-x:void 0)}function an(r){var u=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&u===13&&(r=13)):r=u,r===10&&(r=13),32<=r||r===13?r:0}function ys(){return!0}function Cn(){return!1}function Qn(r){function u(m,x,C,z,H){this._reactName=m,this._targetInst=C,this.type=x,this.nativeEvent=z,this.target=H,this.currentTarget=null;for(var ie in r)r.hasOwnProperty(ie)&&(m=r[ie],this[ie]=m?m(z):z[ie]);return this.isDefaultPrevented=(z.defaultPrevented!=null?z.defaultPrevented:z.returnValue===!1)?ys:Cn,this.isPropagationStopped=Cn,this}return V(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=ys)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=ys)},persist:function(){},isPersistent:ys}),u}var Bi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ns=Qn(Bi),_o=V({},Bi,{view:0,detail:0}),Uo=Qn(_o),$a,qa,ia,yo=V({},_o,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wo,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ia&&(ia&&r.type==="mousemove"?($a=r.screenX-ia.screenX,qa=r.screenY-ia.screenY):qa=$a=0,ia=r),$a)},movementY:function(r){return"movementY"in r?r.movementY:qa}}),vo=Qn(yo),ra=V({},yo,{dataTransfer:0}),ur=Qn(ra),Aa=V({},_o,{relatedTarget:0}),bo=Qn(Aa),xo=V({},Bi,{animationName:0,elapsedTime:0,pseudoElement:0}),Mi=Qn(xo),Pc=V({},Bi,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),_l=Qn(Pc),yl=V({},Bi,{data:0}),Tu=Qn(yl),Fo={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sa(r){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(r):(r=vl[r])?!!u[r]:!1}function wo(){return sa}var bl=V({},_o,{key:function(r){if(r.key){var u=Fo[r.key]||r.key;if(u!=="Unidentified")return u}return r.type==="keypress"?(r=an(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Vi[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wo,charCode:function(r){return r.type==="keypress"?an(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?an(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),To=Qn(bl),ti=V({},yo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rc=Qn(ti),ql=V({},_o,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wo}),xl=Qn(ql),I=V({},Bi,{propertyName:0,elapsedTime:0,pseudoElement:0}),U=Qn(I),G=V({},yo,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),le=Qn(G),We=V({},Bi,{newState:0,oldState:0}),tt=Qn(We),Rt=[9,13,27,32],yn=ts&&"CompositionEvent"in window,jn=null;ts&&"documentMode"in document&&(jn=document.documentMode);var ai=ts&&"TextEvent"in window&&!jn,qi=ts&&(!yn||jn&&8<jn&&11>=jn),Hr=" ",Vs=!1;function Ga(r,u){switch(r){case"keyup":return Rt.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function js(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ha=!1;function Za(r,u){switch(r){case"compositionend":return js(u);case"keypress":return u.which!==32?null:(Vs=!0,Hr);case"textInput":return r=u.data,r===Hr&&Vs?null:r;default:return null}}function Zf(r,u){if(Ha)return r==="compositionend"||!yn&&Ga(r,u)?(r=Qt(),Ea=ln=xi=null,Ha=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return qi&&u.locale!=="ko"?null:u.data;default:return null}}var Cd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wf(r){var u=r&&r.nodeName&&r.nodeName.toLowerCase();return u==="input"?!!Cd[r.type]:u==="textarea"}function Pd(r,u,m,x){Fa?si?si.push(x):si=[x]:Fa=x,u=vp(u,"onChange"),0<u.length&&(m=new ns("onChange","change",null,m,x),r.push({event:m,listeners:u}))}var Gl=null,Mc=null;function _h(r){ag(r,0)}function Su(r){var u=$i(r);if(gi(u))return r}function Rd(r,u){if(r==="change")return u}var wl=!1;if(ts){var Eu;if(ts){var Au="oninput"in document;if(!Au){var kc=document.createElement("div");kc.setAttribute("oninput","return;"),Au=typeof kc.oninput=="function"}Eu=Au}else Eu=!1;wl=Eu&&(!document.documentMode||9<document.documentMode)}function Kf(){Gl&&(Gl.detachEvent("onpropertychange",Dc),Mc=Gl=null)}function Dc(r){if(r.propertyName==="value"&&Su(Mc)){var u=[];Pd(u,Mc,r,gl(r)),Ri(_h,u)}}function Xf(r,u,m){r==="focusin"?(Kf(),Gl=u,Mc=m,Gl.attachEvent("onpropertychange",Dc)):r==="focusout"&&Kf()}function _m(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Su(Mc)}function Yf(r,u){if(r==="click")return Su(u)}function Qf(r,u){if(r==="input"||r==="change")return Su(u)}function Md(r,u){return r===u&&(r!==0||1/r===1/u)||r!==r&&u!==u}var vs=typeof Object.is=="function"?Object.is:Md;function Oc(r,u){if(vs(r,u))return!0;if(typeof r!="object"||r===null||typeof u!="object"||u===null)return!1;var m=Object.keys(r),x=Object.keys(u);if(m.length!==x.length)return!1;for(x=0;x<m.length;x++){var C=m[x];if(!zr.call(u,C)||!vs(r[C],u[C]))return!1}return!0}function Iu(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function So(r,u){var m=Iu(r);r=0;for(var x;m;){if(m.nodeType===3){if(x=r+m.textContent.length,r<=u&&x>=u)return{node:m,offset:u-r};r=x}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=Iu(m)}}function Un(r,u){return r&&u?r===u?!0:r&&r.nodeType===3?!1:u&&u.nodeType===3?Un(r,u.parentNode):"contains"in r?r.contains(u):r.compareDocumentPosition?!!(r.compareDocumentPosition(u)&16):!1:!1}function yh(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var u=Va(r.document);u instanceof r.HTMLIFrameElement;){try{var m=typeof u.contentWindow.location.href=="string"}catch{m=!1}if(m)r=u.contentWindow;else break;u=Va(r.document)}return u}function Cu(r){var u=r&&r.nodeName&&r.nodeName.toLowerCase();return u&&(u==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||u==="textarea"||r.contentEditable==="true")}var Jf=ts&&"documentMode"in document&&11>=document.documentMode,Tl=null,$o=null,Hl=null,kd=!1;function ep(r,u,m){var x=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;kd||Tl==null||Tl!==Va(x)||(x=Tl,"selectionStart"in x&&Cu(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),Hl&&Oc(Hl,x)||(Hl=x,x=vp($o,"onSelect"),0<x.length&&(u=new ns("onSelect","select",null,u,m),r.push({event:u,listeners:x}),u.target=Tl)))}function Zl(r,u){var m={};return m[r.toLowerCase()]=u.toLowerCase(),m["Webkit"+r]="webkit"+u,m["Moz"+r]="moz"+u,m}var zc={animationend:Zl("Animation","AnimationEnd"),animationiteration:Zl("Animation","AnimationIteration"),animationstart:Zl("Animation","AnimationStart"),transitionrun:Zl("Transition","TransitionRun"),transitionstart:Zl("Transition","TransitionStart"),transitioncancel:Zl("Transition","TransitionCancel"),transitionend:Zl("Transition","TransitionEnd")},vh={},tp={};ts&&(tp=document.createElement("div").style,"AnimationEvent"in window||(delete zc.animationend.animation,delete zc.animationiteration.animation,delete zc.animationstart.animation),"TransitionEvent"in window||delete zc.transitionend.transition);function Sl(r){if(vh[r])return vh[r];if(!zc[r])return r;var u=zc[r],m;for(m in u)if(u.hasOwnProperty(m)&&m in tp)return vh[r]=u[m];return r}var Pu=Sl("animationend"),Ru=Sl("animationiteration"),Mu=Sl("animationstart"),Dd=Sl("transitionrun"),Wl=Sl("transitionstart"),ku=Sl("transitioncancel"),Kl=Sl("transitionend"),aa=new Map,bh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");bh.push("scrollEnd");function Ia(r,u){aa.set(r,u),Gr(u,[r])}var xh=new WeakMap;function Nr(r,u){if(typeof r=="object"&&r!==null){var m=xh.get(r);return m!==void 0?m:(u={value:r,source:u,stack:wa(u)},xh.set(r,u),u)}return{value:r,source:u,stack:wa(u)}}var bs=[],qo=0,Xl=0;function Yl(){for(var r=qo,u=Xl=qo=0;u<r;){var m=bs[u];bs[u++]=null;var x=bs[u];bs[u++]=null;var C=bs[u];bs[u++]=null;var z=bs[u];if(bs[u++]=null,x!==null&&C!==null){var H=x.pending;H===null?C.next=C:(C.next=H.next,H.next=C),x.pending=C}z!==0&&Od(m,C,z)}}function Du(r,u,m,x){bs[qo++]=r,bs[qo++]=u,bs[qo++]=m,bs[qo++]=x,Xl|=x,r.lanes|=x,r=r.alternate,r!==null&&(r.lanes|=x)}function El(r,u,m,x){return Du(r,u,m,x),Lc(r)}function oa(r,u){return Du(r,null,null,u),Lc(r)}function Od(r,u,m){r.lanes|=m;var x=r.alternate;x!==null&&(x.lanes|=m);for(var C=!1,z=r.return;z!==null;)z.childLanes|=m,x=z.alternate,x!==null&&(x.childLanes|=m),z.tag===22&&(r=z.stateNode,r===null||r._visibility&1||(C=!0)),r=z,z=z.return;return r.tag===3?(z=r.stateNode,C&&u!==null&&(C=31-Pe(m),r=z.hiddenUpdates,x=r[C],x===null?r[C]=[u]:x.push(u),u.lane=m|536870912),z):null}function Lc(r){if(50<cf)throw cf=0,Fm=null,Error(l(185));for(var u=r.return;u!==null;)r=u,u=r.return;return r.tag===3?r.stateNode:null}var wn={};function Ou(r,u,m,x){this.tag=r,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function la(r,u,m,x){return new Ou(r,u,m,x)}function wh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function is(r,u){var m=r.alternate;return m===null?(m=la(r.tag,u,r.key,r.mode),m.elementType=r.elementType,m.type=r.type,m.stateNode=r.stateNode,m.alternate=r,r.alternate=m):(m.pendingProps=u,m.type=r.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=r.flags&65011712,m.childLanes=r.childLanes,m.lanes=r.lanes,m.child=r.child,m.memoizedProps=r.memoizedProps,m.memoizedState=r.memoizedState,m.updateQueue=r.updateQueue,u=r.dependencies,m.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},m.sibling=r.sibling,m.index=r.index,m.ref=r.ref,m.refCleanup=r.refCleanup,m}function zd(r,u){r.flags&=65011714;var m=r.alternate;return m===null?(r.childLanes=0,r.lanes=u,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=m.childLanes,r.lanes=m.lanes,r.child=m.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=m.memoizedProps,r.memoizedState=m.memoizedState,r.updateQueue=m.updateQueue,r.type=m.type,u=m.dependencies,r.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),r}function Th(r,u,m,x,C,z){var H=0;if(x=r,typeof r=="function")wh(r)&&(H=1);else if(typeof r=="string")H=n(r,m,qt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case ye:return r=la(31,m,u,C),r.elementType=ye,r.lanes=z,r;case ve:return Al(m.children,C,z,u);case Ce:H=8,C|=24;break;case Ee:return r=la(12,m,u,C|2),r.elementType=Ee,r.lanes=z,r;case St:return r=la(13,m,u,C),r.elementType=St,r.lanes=z,r;case Pt:return r=la(19,m,u,C),r.elementType=Pt,r.lanes=z,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Je:case He:H=10;break e;case je:H=9;break e;case gt:H=11;break e;case Se:H=14;break e;case pe:H=16,x=null;break e}H=29,m=Error(l(130,r===null?"null":typeof r,"")),x=null}return u=la(H,m,u,C),u.elementType=r,u.type=x,u.lanes=z,u}function Al(r,u,m,x){return r=la(7,r,x,u),r.lanes=m,r}function Ld(r,u,m){return r=la(6,r,null,u),r.lanes=m,r}function zu(r,u,m){return u=la(4,r.children!==null?r.children:[],r.key,u),u.lanes=m,u.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},u}var Go=[],Eo=0,Il=null,Nc=0,ca=[],rs=0,Wa=null,ua=1,xs="";function Ka(r,u){Go[Eo++]=Nc,Go[Eo++]=Il,Il=r,Nc=u}function Sh(r,u,m){ca[rs++]=ua,ca[rs++]=xs,ca[rs++]=Wa,Wa=r;var x=ua;r=xs;var C=32-Pe(x)-1;x&=~(1<<C),m+=1;var z=32-Pe(u)+C;if(30<z){var H=C-C%5;z=(x&(1<<H)-1).toString(32),x>>=H,C-=H,ua=1<<32-Pe(u)+C|m<<C|x,xs=z+r}else ua=1<<z|m<<C|x,xs=r}function Ho(r){r.return!==null&&(Ka(r,1),Sh(r,1,0))}function Lu(r){for(;r===Il;)Il=Go[--Eo],Go[Eo]=null,Nc=Go[--Eo],Go[Eo]=null;for(;r===Wa;)Wa=ca[--rs],ca[rs]=null,xs=ca[--rs],ca[rs]=null,ua=ca[--rs],ca[rs]=null}var Ir=null,ji=null,Hn=!1,Cl=null,Xa=!1,Bc=Error(l(519));function Zo(r){var u=Error(l(418,""));throw Pl(Nr(u,r)),Bc}function Nd(r){var u=r.stateNode,m=r.type,x=r.memoizedProps;switch(u[Kt]=r,u[rn]=x,m){case"dialog":$n("cancel",u),$n("close",u);break;case"iframe":case"object":case"embed":$n("load",u);break;case"video":case"audio":for(m=0;m<Xh.length;m++)$n(Xh[m],u);break;case"source":$n("error",u);break;case"img":case"image":case"link":$n("error",u),$n("load",u);break;case"details":$n("toggle",u);break;case"input":$n("invalid",u),po(u,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0),ml(u);break;case"select":$n("invalid",u);break;case"textarea":$n("invalid",u),jo(u,x.value,x.defaultValue,x.children),ml(u)}m=x.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||u.textContent===""+m||x.suppressHydrationWarning===!0||hg(u.textContent,m)?(x.popover!=null&&($n("beforetoggle",u),$n("toggle",u)),x.onScroll!=null&&$n("scroll",u),x.onScrollEnd!=null&&$n("scrollend",u),x.onClick!=null&&(u.onclick=_f),u=!0):u=!1,u||Zo(r)}function Eh(r){for(Ir=r.return;Ir;)switch(Ir.tag){case 5:case 13:Xa=!1;return;case 27:case 3:Xa=!0;return;default:Ir=Ir.return}}function oi(r){if(r!==Ir)return!1;if(!Hn)return Eh(r),Hn=!0,!1;var u=r.tag,m;if((m=u!==3&&u!==27)&&((m=u===5)&&(m=r.type,m=!(m!=="form"&&m!=="button")||yc(r.type,r.memoizedProps)),m=!m),m&&ji&&Zo(r),Eh(r),u===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(l(317));e:{for(r=r.nextSibling,u=0;r;){if(r.nodeType===8)if(m=r.data,m==="/$"){if(u===0){ji=Oo(r.nextSibling);break e}u--}else m!=="$"&&m!=="$!"&&m!=="$?"||u++;r=r.nextSibling}ji=null}}else u===27?(u=ji,vc(r.type)?(r=Qh,Qh=null,ji=r):ji=u):ji=Ir?Oo(r.stateNode.nextSibling):null;return!0}function Ya(){ji=Ir=null,Hn=!1}function Us(){var r=Cl;return r!==null&&(da===null?da=r:da.push.apply(da,r),Cl=null),r}function Pl(r){Cl===null?Cl=[r]:Cl.push(r)}var Vc=ut(null),Wo=null,ws=null;function Fs(r,u,m){Mt(Vc,u._currentValue),u._currentValue=m}function ha(r){r._currentValue=Vc.current,Ot(Vc)}function Nu(r,u,m){for(;r!==null;){var x=r.alternate;if((r.childLanes&u)!==u?(r.childLanes|=u,x!==null&&(x.childLanes|=u)):x!==null&&(x.childLanes&u)!==u&&(x.childLanes|=u),r===m)break;r=r.return}}function Ah(r,u,m,x){var C=r.child;for(C!==null&&(C.return=r);C!==null;){var z=C.dependencies;if(z!==null){var H=C.child;z=z.firstContext;e:for(;z!==null;){var ie=z;z=C;for(var we=0;we<u.length;we++)if(ie.context===u[we]){z.lanes|=m,ie=z.alternate,ie!==null&&(ie.lanes|=m),Nu(z.return,m,r),x||(H=null);break e}z=ie.next}}else if(C.tag===18){if(H=C.return,H===null)throw Error(l(341));H.lanes|=m,z=H.alternate,z!==null&&(z.lanes|=m),Nu(H,m,r),H=null}else H=C.child;if(H!==null)H.return=C;else for(H=C;H!==null;){if(H===r){H=null;break}if(C=H.sibling,C!==null){C.return=H.return,H=C;break}H=H.return}C=H}}function jc(r,u,m,x){r=null;for(var C=u,z=!1;C!==null;){if(!z){if((C.flags&524288)!==0)z=!0;else if((C.flags&262144)!==0)break}if(C.tag===10){var H=C.alternate;if(H===null)throw Error(l(387));if(H=H.memoizedProps,H!==null){var ie=C.type;vs(C.pendingProps.value,H.value)||(r!==null?r.push(ie):r=[ie])}}else if(C===Ji.current){if(H=C.alternate,H===null)throw Error(l(387));H.memoizedState.memoizedState!==C.memoizedState.memoizedState&&(r!==null?r.push(j):r=[j])}C=C.return}r!==null&&Ah(u,r,m,x),u.flags|=262144}function Bu(r){for(r=r.firstContext;r!==null;){if(!vs(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Rl(r){Wo=r,ws=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function hr(r){return Ts(Wo,r)}function $s(r,u){return Wo===null&&Rl(r),Ts(r,u)}function Ts(r,u){var m=u._currentValue;if(u={context:u,memoizedValue:m,next:null},ws===null){if(r===null)throw Error(l(308));ws=u,r.dependencies={lanes:0,firstContext:u},r.flags|=524288}else ws=ws.next=u;return m}var Uc=typeof AbortController<"u"?AbortController:function(){var r=[],u=this.signal={aborted:!1,addEventListener:function(m,x){r.push(x)}};this.abort=function(){u.aborted=!0,r.forEach(function(m){return m()})}},Bd=c.unstable_scheduleCallback,np=c.unstable_NormalPriority,Sr={$$typeof:He,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ml(){return{controller:new Uc,data:new Map,refCount:0}}function Ql(r){r.refCount--,r.refCount===0&&Bd(np,function(){r.controller.abort()})}var kl=null,Fc=0,Ko=0,Zr=null;function Ss(r,u){if(kl===null){var m=kl=[];Fc=0,Ko=pf(),Zr={status:"pending",value:void 0,then:function(x){m.push(x)}}}return Fc++,u.then(Vd,Vd),u}function Vd(){if(--Fc===0&&kl!==null){Zr!==null&&(Zr.status="fulfilled");var r=kl;kl=null,Ko=0,Zr=null;for(var u=0;u<r.length;u++)(0,r[u])()}}function Qa(r,u){var m=[],x={status:"pending",value:null,reason:null,then:function(C){m.push(C)}};return r.then(function(){x.status="fulfilled",x.value=u;for(var C=0;C<m.length;C++)(0,m[C])(u)},function(C){for(x.status="rejected",x.reason=C,C=0;C<m.length;C++)(0,m[C])(void 0)}),x}var Jl=st.S;st.S=function(r,u){typeof u=="object"&&u!==null&&typeof u.then=="function"&&Ss(r,u),Jl!==null&&Jl(r,u)};var Ja=ut(null);function jd(){var r=Ja.current;return r!==null?r:Oi.pooledCache}function Ih(r,u){u===null?Mt(Ja,Ja.current):Mt(Ja,u.pool)}function Vu(){var r=jd();return r===null?null:{parent:Sr._currentValue,pool:r}}var $c=Error(l(460)),Dl=Error(l(474)),Es=Error(l(542)),Dt={then:function(){}};function Ch(r){return r=r.status,r==="fulfilled"||r==="rejected"}function ec(){}function Ph(r,u,m){switch(m=r[m],m===void 0?r.push(u):m!==u&&(u.then(ec,ec),u=m),u.status){case"fulfilled":return u.value;case"rejected":throw r=u.reason,Rh(r),r;default:if(typeof u.status=="string")u.then(ec,ec);else{if(r=Oi,r!==null&&100<r.shellSuspendCounter)throw Error(l(482));r=u,r.status="pending",r.then(function(x){if(u.status==="pending"){var C=u;C.status="fulfilled",C.value=x}},function(x){if(u.status==="pending"){var C=u;C.status="rejected",C.reason=x}})}switch(u.status){case"fulfilled":return u.value;case"rejected":throw r=u.reason,Rh(r),r}throw eo=u,$c}}var eo=null;function tc(){if(eo===null)throw Error(l(459));var r=eo;return eo=null,r}function Rh(r){if(r===$c||r===Es)throw Error(l(483))}var vn=!1;function ju(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Mh(r,u){r=r.updateQueue,u.updateQueue===r&&(u.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Ao(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Xo(r,u,m){var x=r.updateQueue;if(x===null)return null;if(x=x.shared,(Si&2)!==0){var C=x.pending;return C===null?u.next=u:(u.next=C.next,C.next=u),x.pending=u,u=Lc(r),Od(r,null,m),u}return Du(r,x,u,m),Lc(r)}function qc(r,u,m){if(u=u.updateQueue,u!==null&&(u=u.shared,(m&4194048)!==0)){var x=u.lanes;x&=r.pendingLanes,m|=x,u.lanes=m,Nt(r,m)}}function kh(r,u){var m=r.updateQueue,x=r.alternate;if(x!==null&&(x=x.updateQueue,m===x)){var C=null,z=null;if(m=m.firstBaseUpdate,m!==null){do{var H={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};z===null?C=z=H:z=z.next=H,m=m.next}while(m!==null);z===null?C=z=u:z=z.next=u}else C=z=u;m={baseState:x.baseState,firstBaseUpdate:C,lastBaseUpdate:z,shared:x.shared,callbacks:x.callbacks},r.updateQueue=m;return}r=m.lastBaseUpdate,r===null?m.firstBaseUpdate=u:r.next=u,m.lastBaseUpdate=u}var Uu=!1;function nc(){if(Uu){var r=Zr;if(r!==null)throw r}}function Gc(r,u,m,x){Uu=!1;var C=r.updateQueue;vn=!1;var z=C.firstBaseUpdate,H=C.lastBaseUpdate,ie=C.shared.pending;if(ie!==null){C.shared.pending=null;var we=ie,Ke=we.next;we.next=null,H===null?z=Ke:H.next=Ke,H=we;var ct=r.alternate;ct!==null&&(ct=ct.updateQueue,ie=ct.lastBaseUpdate,ie!==H&&(ie===null?ct.firstBaseUpdate=Ke:ie.next=Ke,ct.lastBaseUpdate=we))}if(z!==null){var pt=C.baseState;H=0,ct=Ke=we=null,ie=z;do{var Qe=ie.lane&-536870913,it=Qe!==ie.lane;if(it?(Gn&Qe)===Qe:(x&Qe)===Qe){Qe!==0&&Qe===Ko&&(Uu=!0),ct!==null&&(ct=ct.next={lane:0,tag:ie.tag,payload:ie.payload,callback:null,next:null});e:{var bn=r,hn=ie;Qe=u;var Ci=m;switch(hn.tag){case 1:if(bn=hn.payload,typeof bn=="function"){pt=bn.call(Ci,pt,Qe);break e}pt=bn;break e;case 3:bn.flags=bn.flags&-65537|128;case 0:if(bn=hn.payload,Qe=typeof bn=="function"?bn.call(Ci,pt,Qe):bn,Qe==null)break e;pt=V({},pt,Qe);break e;case 2:vn=!0}}Qe=ie.callback,Qe!==null&&(r.flags|=64,it&&(r.flags|=8192),it=C.callbacks,it===null?C.callbacks=[Qe]:it.push(Qe))}else it={lane:Qe,tag:ie.tag,payload:ie.payload,callback:ie.callback,next:null},ct===null?(Ke=ct=it,we=pt):ct=ct.next=it,H|=Qe;if(ie=ie.next,ie===null){if(ie=C.shared.pending,ie===null)break;it=ie,ie=it.next,it.next=null,C.lastBaseUpdate=it,C.shared.pending=null}}while(!0);ct===null&&(we=pt),C.baseState=we,C.firstBaseUpdate=Ke,C.lastBaseUpdate=ct,z===null&&(C.shared.lanes=0),fc|=H,r.lanes=H,r.memoizedState=pt}}function Dh(r,u){if(typeof r!="function")throw Error(l(191,r));r.call(u)}function Ud(r,u){var m=r.callbacks;if(m!==null)for(r.callbacks=null,r=0;r<m.length;r++)Dh(m[r],u)}var Yo=ut(null),to=ut(0);function Jn(r,u){r=dc,Mt(to,r),Mt(Yo,u),dc=r|u.baseLanes}function Fd(){Mt(to,dc),Mt(Yo,Yo.current)}function Hc(){dc=to.current,Ot(Yo),Ot(to)}var no=0,Pn=null,ni=null,dr=null,Oh=!1,As=!1,Io=!1,Lt=0,Ft=0,Qo=null,$d=0;function Gi(){throw Error(l(321))}function Br(r,u){if(u===null)return!1;for(var m=0;m<u.length&&m<r.length;m++)if(!vs(r[m],u[m]))return!1;return!0}function zh(r,u,m,x,C,z){return no=z,Pn=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,st.H=r===null||r.memoizedState===null?Co:Po,Io=!1,z=m(x,C),Io=!1,As&&(z=Ol(u,m,x,C)),Ca(r),z}function Ca(r){st.H=jr;var u=ni!==null&&ni.next!==null;if(no=0,dr=ni=Pn=null,Oh=!1,Ft=0,Qo=null,u)throw Error(l(300));r===null||pr||(r=r.dependencies,r!==null&&Bu(r)&&(pr=!0))}function Ol(r,u,m,x){Pn=r;var C=0;do{if(As&&(Qo=null),Ft=0,As=!1,25<=C)throw Error(l(301));if(C+=1,dr=ni=null,r.updateQueue!=null){var z=r.updateQueue;z.lastEffect=null,z.events=null,z.stores=null,z.memoCache!=null&&(z.memoCache.index=0)}st.H=Nl,z=u(m,x)}while(As);return z}function Zc(){var r=st.H,u=r.useState()[0];return u=typeof u.then=="function"?ic(u):u,r=r.useState()[0],(ni!==null?ni.memoizedState:null)!==r&&(Pn.flags|=1024),u}function wi(){var r=Lt!==0;return Lt=0,r}function Hi(r,u,m){u.updateQueue=r.updateQueue,u.flags&=-2053,r.lanes&=~m}function Wc(r){if(Oh){for(r=r.memoizedState;r!==null;){var u=r.queue;u!==null&&(u.pending=null),r=r.next}Oh=!1}no=0,dr=ni=Pn=null,As=!1,Ft=Lt=0,Qo=null}function Vr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dr===null?Pn.memoizedState=dr=r:dr=dr.next=r,dr}function ki(){if(ni===null){var r=Pn.alternate;r=r!==null?r.memoizedState:null}else r=ni.next;var u=dr===null?Pn.memoizedState:dr.next;if(u!==null)dr=u,ni=r;else{if(r===null)throw Pn.alternate===null?Error(l(467)):Error(l(310));ni=r,r={memoizedState:ni.memoizedState,baseState:ni.baseState,baseQueue:ni.baseQueue,queue:ni.queue,next:null},dr===null?Pn.memoizedState=dr=r:dr=dr.next=r}return dr}function Jo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ic(r){var u=Ft;return Ft+=1,Qo===null&&(Qo=[]),r=Ph(Qo,r,u),u=Pn,(dr===null?u.memoizedState:dr.next)===null&&(u=u.alternate,st.H=u===null||u.memoizedState===null?Co:Po),r}function rc(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return ic(r);if(r.$$typeof===He)return hr(r)}throw Error(l(438,String(r)))}function io(r){var u=null,m=Pn.updateQueue;if(m!==null&&(u=m.memoCache),u==null){var x=Pn.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(u={data:x.data.map(function(C){return C.slice()}),index:0})))}if(u==null&&(u={data:[],index:0}),m===null&&(m=Jo(),Pn.updateQueue=m),m.memoCache=u,m=u.data[u.index],m===void 0)for(m=u.data[u.index]=Array(r),x=0;x<r;x++)m[x]=Oe;return u.index++,m}function ro(r,u){return typeof u=="function"?u(r):u}function Kc(r){var u=ki();return Xc(u,ni,r)}function Xc(r,u,m){var x=r.queue;if(x===null)throw Error(l(311));x.lastRenderedReducer=m;var C=r.baseQueue,z=x.pending;if(z!==null){if(C!==null){var H=C.next;C.next=z.next,z.next=H}u.baseQueue=C=z,x.pending=null}if(z=r.baseState,C===null)r.memoizedState=z;else{u=C.next;var ie=H=null,we=null,Ke=u,ct=!1;do{var pt=Ke.lane&-536870913;if(pt!==Ke.lane?(Gn&pt)===pt:(no&pt)===pt){var Qe=Ke.revertLane;if(Qe===0)we!==null&&(we=we.next={lane:0,revertLane:0,action:Ke.action,hasEagerState:Ke.hasEagerState,eagerState:Ke.eagerState,next:null}),pt===Ko&&(ct=!0);else if((no&Qe)===Qe){Ke=Ke.next,Qe===Ko&&(ct=!0);continue}else pt={lane:0,revertLane:Ke.revertLane,action:Ke.action,hasEagerState:Ke.hasEagerState,eagerState:Ke.eagerState,next:null},we===null?(ie=we=pt,H=z):we=we.next=pt,Pn.lanes|=Qe,fc|=Qe;pt=Ke.action,Io&&m(z,pt),z=Ke.hasEagerState?Ke.eagerState:m(z,pt)}else Qe={lane:pt,revertLane:Ke.revertLane,action:Ke.action,hasEagerState:Ke.hasEagerState,eagerState:Ke.eagerState,next:null},we===null?(ie=we=Qe,H=z):we=we.next=Qe,Pn.lanes|=pt,fc|=pt;Ke=Ke.next}while(Ke!==null&&Ke!==u);if(we===null?H=z:we.next=ie,!vs(z,r.memoizedState)&&(pr=!0,ct&&(m=Zr,m!==null)))throw m;r.memoizedState=z,r.baseState=H,r.baseQueue=we,x.lastRenderedState=z}return C===null&&(x.lanes=0),[r.memoizedState,x.dispatch]}function Fu(r){var u=ki(),m=u.queue;if(m===null)throw Error(l(311));m.lastRenderedReducer=r;var x=m.dispatch,C=m.pending,z=u.memoizedState;if(C!==null){m.pending=null;var H=C=C.next;do z=r(z,H.action),H=H.next;while(H!==C);vs(z,u.memoizedState)||(pr=!0),u.memoizedState=z,u.baseQueue===null&&(u.baseState=z),m.lastRenderedState=z}return[z,x]}function b(r,u,m){var x=Pn,C=ki(),z=Hn;if(z){if(m===void 0)throw Error(l(407));m=m()}else m=u();var H=!vs((ni||C).memoizedState,m);H&&(C.memoizedState=m,pr=!0),C=C.queue;var ie=p.bind(null,x,C,r);if(ze(2048,8,ie,[r]),C.getSnapshot!==u||H||dr!==null&&dr.memoizedState.tag&1){if(x.flags|=2048,de(9,be(),o.bind(null,x,C,m,u),null),Oi===null)throw Error(l(349));z||(no&124)!==0||t(x,u,m)}return m}function t(r,u,m){r.flags|=16384,r={getSnapshot:u,value:m},u=Pn.updateQueue,u===null?(u=Jo(),Pn.updateQueue=u,u.stores=[r]):(m=u.stores,m===null?u.stores=[r]:m.push(r))}function o(r,u,m,x){u.value=m,u.getSnapshot=x,_(u)&&T(r)}function p(r,u,m){return m(function(){_(u)&&T(r)})}function _(r){var u=r.getSnapshot;r=r.value;try{var m=u();return!vs(r,m)}catch{return!0}}function T(r){var u=oa(r,2);u!==null&&fa(u,r,2)}function E(r){var u=Vr();if(typeof r=="function"){var m=r;if(r=m(),Io){qr(!0);try{m()}finally{qr(!1)}}}return u.memoizedState=u.baseState=r,u.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ro,lastRenderedState:r},u}function R(r,u,m,x){return r.baseState=m,Xc(r,ni,typeof x=="function"?x:ro)}function k(r,u,m,x,C){if(Ll(r))throw Error(l(485));if(r=u.action,r!==null){var z={payload:C,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(H){z.listeners.push(H)}};st.T!==null?m(!0):z.isTransition=!1,x(z),m=u.pending,m===null?(z.next=u.pending=z,L(u,z)):(z.next=m.next,u.pending=m.next=z)}}function L(r,u){var m=u.action,x=u.payload,C=r.state;if(u.isTransition){var z=st.T,H={};st.T=H;try{var ie=m(C,x),we=st.S;we!==null&&we(H,ie),B(r,u,ie)}catch(Ke){F(r,u,Ke)}finally{st.T=z}}else try{z=m(C,x),B(r,u,z)}catch(Ke){F(r,u,Ke)}}function B(r,u,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(x){$(r,u,x)},function(x){return F(r,u,x)}):$(r,u,m)}function $(r,u,m){u.status="fulfilled",u.value=m,Z(u),r.state=m,u=r.pending,u!==null&&(m=u.next,m===u?r.pending=null:(m=m.next,u.next=m,L(r,m)))}function F(r,u,m){var x=r.pending;if(r.pending=null,x!==null){x=x.next;do u.status="rejected",u.reason=m,Z(u),u=u.next;while(u!==x)}r.action=null}function Z(r){r=r.listeners;for(var u=0;u<r.length;u++)(0,r[u])()}function te(r,u){return u}function ae(r,u){if(Hn){var m=Oi.formState;if(m!==null){e:{var x=Pn;if(Hn){if(ji){t:{for(var C=ji,z=Xa;C.nodeType!==8;){if(!z){C=null;break t}if(C=Oo(C.nextSibling),C===null){C=null;break t}}z=C.data,C=z==="F!"||z==="F"?C:null}if(C){ji=Oo(C.nextSibling),x=C.data==="F!";break e}}Zo(x)}x=!1}x&&(u=m[0])}}return m=Vr(),m.memoizedState=m.baseState=u,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:te,lastRenderedState:u},m.queue=x,m=el.bind(null,Pn,x),x.dispatch=m,x=E(!1),z=tl.bind(null,Pn,!1,x.queue),x=Vr(),C={state:u,dispatch:null,action:r,pending:null},x.queue=C,m=k.bind(null,Pn,C,z,m),C.dispatch=m,x.memoizedState=r,[u,m,!1]}function oe(r){var u=ki();return ce(u,ni,r)}function ce(r,u,m){if(u=Xc(r,u,te)[0],r=Kc(ro)[0],typeof u=="object"&&u!==null&&typeof u.then=="function")try{var x=ic(u)}catch(H){throw H===$c?Es:H}else x=u;u=ki();var C=u.queue,z=C.dispatch;return m!==u.memoizedState&&(Pn.flags|=2048,de(9,be(),he.bind(null,C,m),null)),[x,z,r]}function he(r,u){r.action=u}function ge(r){var u=ki(),m=ni;if(m!==null)return ce(u,m,r);ki(),u=u.memoizedState,m=ki();var x=m.queue.dispatch;return m.memoizedState=r,[u,x,!1]}function de(r,u,m,x){return r={tag:r,create:m,deps:x,inst:u,next:null},u=Pn.updateQueue,u===null&&(u=Jo(),Pn.updateQueue=u),m=u.lastEffect,m===null?u.lastEffect=r.next=r:(x=m.next,m.next=r,r.next=x,u.lastEffect=r),r}function be(){return{destroy:void 0,resource:void 0}}function Ie(){return ki().memoizedState}function fe(r,u,m,x){var C=Vr();x=x===void 0?null:x,Pn.flags|=r,C.memoizedState=de(1|u,be(),m,x)}function ze(r,u,m,x){var C=ki();x=x===void 0?null:x;var z=C.memoizedState.inst;ni!==null&&x!==null&&Br(x,ni.memoizedState.deps)?C.memoizedState=de(u,z,m,x):(Pn.flags|=r,C.memoizedState=de(1|u,z,m,x))}function Xe(r,u){fe(8390656,8,r,u)}function $e(r,u){ze(2048,8,r,u)}function Ge(r,u){return ze(4,2,r,u)}function Ye(r,u){return ze(4,4,r,u)}function Et(r,u){if(typeof u=="function"){r=r();var m=u(r);return function(){typeof m=="function"?m():u(null)}}if(u!=null)return r=r(),u.current=r,function(){u.current=null}}function wt(r,u,m){m=m!=null?m.concat([r]):null,ze(4,4,Et.bind(null,u,r),m)}function lt(){}function Bt(r,u){var m=ki();u=u===void 0?null:u;var x=m.memoizedState;return u!==null&&Br(u,x[1])?x[0]:(m.memoizedState=[r,u],r)}function Tn(r,u){var m=ki();u=u===void 0?null:u;var x=m.memoizedState;if(u!==null&&Br(u,x[1]))return x[0];if(x=r(),Io){qr(!0);try{r()}finally{qr(!1)}}return m.memoizedState=[x,u],x}function Fn(r,u,m){return m===void 0||(no&1073741824)!==0?r.memoizedState=u:(r.memoizedState=m,r=Pr(),Pn.lanes|=r,fc|=r,m)}function Di(r,u,m,x){return vs(m,u)?m:Yo.current!==null?(r=Fn(r,m,x),vs(r,u)||(pr=!0),r):(no&42)===0?(pr=!0,r.memoizedState=m):(r=Pr(),Pn.lanes|=r,fc|=r,u)}function li(r,u,m,x,C){var z=kt.p;kt.p=z!==0&&8>z?z:8;var H=st.T,ie={};st.T=ie,tl(r,!1,u,m);try{var we=C(),Ke=st.S;if(Ke!==null&&Ke(ie,we),we!==null&&typeof we=="object"&&typeof we.then=="function"){var ct=Qa(we,x);Cs(r,u,ct,ks(r))}else Cs(r,u,x,ks(r))}catch(pt){Cs(r,u,{then:function(){},status:"rejected",reason:pt},ks())}finally{kt.p=z,st.T=H}}function ci(){}function Ti(r,u,m,x){if(r.tag!==5)throw Error(l(476));var C=_i(r).queue;li(r,C,u,Zt,m===null?ci:function(){return ui(r),m(x)})}function _i(r){var u=r.memoizedState;if(u!==null)return u;u={memoizedState:Zt,baseState:Zt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ro,lastRenderedState:Zt},next:null};var m={};return u.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ro,lastRenderedState:m},next:null},r.memoizedState=u,r=r.alternate,r!==null&&(r.memoizedState=u),u}function ui(r){var u=_i(r).next.queue;Cs(r,u,{},ks())}function Ln(){return hr(j)}function Er(){return ki().memoizedState}function fr(){return ki().memoizedState}function Is(r){for(var u=r.return;u!==null;){switch(u.tag){case 24:case 3:var m=ks();r=Ao(m);var x=Xo(u,r,m);x!==null&&(fa(x,u,m),qc(x,u,m)),u={cache:Ml()},r.payload=u;return}u=u.return}}function zl(r,u,m){var x=ks();m={lane:x,revertLane:0,action:m,hasEagerState:!1,eagerState:null,next:null},Ll(r)?$u(u,m):(m=El(r,u,m,x),m!==null&&(fa(m,r,x),nl(m,u,x)))}function el(r,u,m){var x=ks();Cs(r,u,m,x)}function Cs(r,u,m,x){var C={lane:x,revertLane:0,action:m,hasEagerState:!1,eagerState:null,next:null};if(Ll(r))$u(u,C);else{var z=r.alternate;if(r.lanes===0&&(z===null||z.lanes===0)&&(z=u.lastRenderedReducer,z!==null))try{var H=u.lastRenderedState,ie=z(H,m);if(C.hasEagerState=!0,C.eagerState=ie,vs(ie,H))return Du(r,u,C,0),Oi===null&&Yl(),!1}catch{}finally{}if(m=El(r,u,C,x),m!==null)return fa(m,r,x),nl(m,u,x),!0}return!1}function tl(r,u,m,x){if(x={lane:2,revertLane:pf(),action:x,hasEagerState:!1,eagerState:null,next:null},Ll(r)){if(u)throw Error(l(479))}else u=El(r,m,x,2),u!==null&&fa(u,r,2)}function Ll(r){var u=r.alternate;return r===Pn||u!==null&&u===Pn}function $u(r,u){As=Oh=!0;var m=r.pending;m===null?u.next=u:(u.next=m.next,m.next=u),r.pending=u}function nl(r,u,m){if((m&4194048)!==0){var x=u.lanes;x&=r.pendingLanes,m|=x,u.lanes=m,Nt(r,m)}}var jr={readContext:hr,use:rc,useCallback:Gi,useContext:Gi,useEffect:Gi,useImperativeHandle:Gi,useLayoutEffect:Gi,useInsertionEffect:Gi,useMemo:Gi,useReducer:Gi,useRef:Gi,useState:Gi,useDebugValue:Gi,useDeferredValue:Gi,useTransition:Gi,useSyncExternalStore:Gi,useId:Gi,useHostTransitionStatus:Gi,useFormState:Gi,useActionState:Gi,useOptimistic:Gi,useMemoCache:Gi,useCacheRefresh:Gi},Co={readContext:hr,use:rc,useCallback:function(r,u){return Vr().memoizedState=[r,u===void 0?null:u],r},useContext:hr,useEffect:Xe,useImperativeHandle:function(r,u,m){m=m!=null?m.concat([r]):null,fe(4194308,4,Et.bind(null,u,r),m)},useLayoutEffect:function(r,u){return fe(4194308,4,r,u)},useInsertionEffect:function(r,u){fe(4,2,r,u)},useMemo:function(r,u){var m=Vr();u=u===void 0?null:u;var x=r();if(Io){qr(!0);try{r()}finally{qr(!1)}}return m.memoizedState=[x,u],x},useReducer:function(r,u,m){var x=Vr();if(m!==void 0){var C=m(u);if(Io){qr(!0);try{m(u)}finally{qr(!1)}}}else C=u;return x.memoizedState=x.baseState=C,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:C},x.queue=r,r=r.dispatch=zl.bind(null,Pn,r),[x.memoizedState,r]},useRef:function(r){var u=Vr();return r={current:r},u.memoizedState=r},useState:function(r){r=E(r);var u=r.queue,m=el.bind(null,Pn,u);return u.dispatch=m,[r.memoizedState,m]},useDebugValue:lt,useDeferredValue:function(r,u){var m=Vr();return Fn(m,r,u)},useTransition:function(){var r=E(!1);return r=li.bind(null,Pn,r.queue,!0,!1),Vr().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,u,m){var x=Pn,C=Vr();if(Hn){if(m===void 0)throw Error(l(407));m=m()}else{if(m=u(),Oi===null)throw Error(l(349));(Gn&124)!==0||t(x,u,m)}C.memoizedState=m;var z={value:m,getSnapshot:u};return C.queue=z,Xe(p.bind(null,x,z,r),[r]),x.flags|=2048,de(9,be(),o.bind(null,x,z,m,u),null),m},useId:function(){var r=Vr(),u=Oi.identifierPrefix;if(Hn){var m=xs,x=ua;m=(x&~(1<<32-Pe(x)-1)).toString(32)+m,u=""+u+"R"+m,m=Lt++,0<m&&(u+="H"+m.toString(32)),u+=""}else m=$d++,u=""+u+"r"+m.toString(32)+"";return r.memoizedState=u},useHostTransitionStatus:Ln,useFormState:ae,useActionState:ae,useOptimistic:function(r){var u=Vr();u.memoizedState=u.baseState=r;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return u.queue=m,u=tl.bind(null,Pn,!0,m),m.dispatch=u,[r,u]},useMemoCache:io,useCacheRefresh:function(){return Vr().memoizedState=Is.bind(null,Pn)}},Po={readContext:hr,use:rc,useCallback:Bt,useContext:hr,useEffect:$e,useImperativeHandle:wt,useInsertionEffect:Ge,useLayoutEffect:Ye,useMemo:Tn,useReducer:Kc,useRef:Ie,useState:function(){return Kc(ro)},useDebugValue:lt,useDeferredValue:function(r,u){var m=ki();return Di(m,ni.memoizedState,r,u)},useTransition:function(){var r=Kc(ro)[0],u=ki().memoizedState;return[typeof r=="boolean"?r:ic(r),u]},useSyncExternalStore:b,useId:Er,useHostTransitionStatus:Ln,useFormState:oe,useActionState:oe,useOptimistic:function(r,u){var m=ki();return R(m,ni,r,u)},useMemoCache:io,useCacheRefresh:fr},Nl={readContext:hr,use:rc,useCallback:Bt,useContext:hr,useEffect:$e,useImperativeHandle:wt,useInsertionEffect:Ge,useLayoutEffect:Ye,useMemo:Tn,useReducer:Fu,useRef:Ie,useState:function(){return Fu(ro)},useDebugValue:lt,useDeferredValue:function(r,u){var m=ki();return ni===null?Fn(m,r,u):Di(m,ni.memoizedState,r,u)},useTransition:function(){var r=Fu(ro)[0],u=ki().memoizedState;return[typeof r=="boolean"?r:ic(r),u]},useSyncExternalStore:b,useId:Er,useHostTransitionStatus:Ln,useFormState:ge,useActionState:ge,useOptimistic:function(r,u){var m=ki();return ni!==null?R(m,ni,r,u):(m.baseState=r,[r,m.queue.dispatch])},useMemoCache:io,useCacheRefresh:fr},Zn=null,Ui=0;function ss(r){var u=Ui;return Ui+=1,Zn===null&&(Zn=[]),Ph(Zn,r,u)}function Yi(r,u){u=u.props.ref,r.ref=u!==void 0?u:null}function Lh(r,u){throw u.$$typeof===K?Error(l(525)):(r=Object.prototype.toString.call(u),Error(l(31,r==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":r)))}function Nh(r){var u=r._init;return u(r._payload)}function Yc(r){function u(Ue,Be){if(r){var qe=Ue.deletions;qe===null?(Ue.deletions=[Be],Ue.flags|=16):qe.push(Be)}}function m(Ue,Be){if(!r)return null;for(;Be!==null;)u(Ue,Be),Be=Be.sibling;return null}function x(Ue){for(var Be=new Map;Ue!==null;)Ue.key!==null?Be.set(Ue.key,Ue):Be.set(Ue.index,Ue),Ue=Ue.sibling;return Be}function C(Ue,Be){return Ue=is(Ue,Be),Ue.index=0,Ue.sibling=null,Ue}function z(Ue,Be,qe){return Ue.index=qe,r?(qe=Ue.alternate,qe!==null?(qe=qe.index,qe<Be?(Ue.flags|=67108866,Be):qe):(Ue.flags|=67108866,Be)):(Ue.flags|=1048576,Be)}function H(Ue){return r&&Ue.alternate===null&&(Ue.flags|=67108866),Ue}function ie(Ue,Be,qe,ft){return Be===null||Be.tag!==6?(Be=Ld(qe,Ue.mode,ft),Be.return=Ue,Be):(Be=C(Be,qe),Be.return=Ue,Be)}function we(Ue,Be,qe,ft){var Gt=qe.type;return Gt===ve?ct(Ue,Be,qe.props.children,ft,qe.key):Be!==null&&(Be.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===pe&&Nh(Gt)===Be.type)?(Be=C(Be,qe.props),Yi(Be,qe),Be.return=Ue,Be):(Be=Th(qe.type,qe.key,qe.props,null,Ue.mode,ft),Yi(Be,qe),Be.return=Ue,Be)}function Ke(Ue,Be,qe,ft){return Be===null||Be.tag!==4||Be.stateNode.containerInfo!==qe.containerInfo||Be.stateNode.implementation!==qe.implementation?(Be=zu(qe,Ue.mode,ft),Be.return=Ue,Be):(Be=C(Be,qe.children||[]),Be.return=Ue,Be)}function ct(Ue,Be,qe,ft,Gt){return Be===null||Be.tag!==7?(Be=Al(qe,Ue.mode,ft,Gt),Be.return=Ue,Be):(Be=C(Be,qe),Be.return=Ue,Be)}function pt(Ue,Be,qe){if(typeof Be=="string"&&Be!==""||typeof Be=="number"||typeof Be=="bigint")return Be=Ld(""+Be,Ue.mode,qe),Be.return=Ue,Be;if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case ee:return qe=Th(Be.type,Be.key,Be.props,null,Ue.mode,qe),Yi(qe,Be),qe.return=Ue,qe;case Y:return Be=zu(Be,Ue.mode,qe),Be.return=Ue,Be;case pe:var ft=Be._init;return Be=ft(Be._payload),pt(Ue,Be,qe)}if(In(Be)||Ve(Be))return Be=Al(Be,Ue.mode,qe,null),Be.return=Ue,Be;if(typeof Be.then=="function")return pt(Ue,ss(Be),qe);if(Be.$$typeof===He)return pt(Ue,$s(Ue,Be),qe);Lh(Ue,Be)}return null}function Qe(Ue,Be,qe,ft){var Gt=Be!==null?Be.key:null;if(typeof qe=="string"&&qe!==""||typeof qe=="number"||typeof qe=="bigint")return Gt!==null?null:ie(Ue,Be,""+qe,ft);if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case ee:return qe.key===Gt?we(Ue,Be,qe,ft):null;case Y:return qe.key===Gt?Ke(Ue,Be,qe,ft):null;case pe:return Gt=qe._init,qe=Gt(qe._payload),Qe(Ue,Be,qe,ft)}if(In(qe)||Ve(qe))return Gt!==null?null:ct(Ue,Be,qe,ft,null);if(typeof qe.then=="function")return Qe(Ue,Be,ss(qe),ft);if(qe.$$typeof===He)return Qe(Ue,Be,$s(Ue,qe),ft);Lh(Ue,qe)}return null}function it(Ue,Be,qe,ft,Gt){if(typeof ft=="string"&&ft!==""||typeof ft=="number"||typeof ft=="bigint")return Ue=Ue.get(qe)||null,ie(Be,Ue,""+ft,Gt);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case ee:return Ue=Ue.get(ft.key===null?qe:ft.key)||null,we(Be,Ue,ft,Gt);case Y:return Ue=Ue.get(ft.key===null?qe:ft.key)||null,Ke(Be,Ue,ft,Gt);case pe:var Bn=ft._init;return ft=Bn(ft._payload),it(Ue,Be,qe,ft,Gt)}if(In(ft)||Ve(ft))return Ue=Ue.get(qe)||null,ct(Be,Ue,ft,Gt,null);if(typeof ft.then=="function")return it(Ue,Be,qe,ss(ft),Gt);if(ft.$$typeof===He)return it(Ue,Be,qe,$s(Be,ft),Gt);Lh(Be,ft)}return null}function bn(Ue,Be,qe,ft){for(var Gt=null,Bn=null,tn=Be,mn=Be=0,us=null;tn!==null&&mn<qe.length;mn++){tn.index>mn?(us=tn,tn=null):us=tn.sibling;var ii=Qe(Ue,tn,qe[mn],ft);if(ii===null){tn===null&&(tn=us);break}r&&tn&&ii.alternate===null&&u(Ue,tn),Be=z(ii,Be,mn),Bn===null?Gt=ii:Bn.sibling=ii,Bn=ii,tn=us}if(mn===qe.length)return m(Ue,tn),Hn&&Ka(Ue,mn),Gt;if(tn===null){for(;mn<qe.length;mn++)tn=pt(Ue,qe[mn],ft),tn!==null&&(Be=z(tn,Be,mn),Bn===null?Gt=tn:Bn.sibling=tn,Bn=tn);return Hn&&Ka(Ue,mn),Gt}for(tn=x(tn);mn<qe.length;mn++)us=it(tn,Ue,mn,qe[mn],ft),us!==null&&(r&&us.alternate!==null&&tn.delete(us.key===null?mn:us.key),Be=z(us,Be,mn),Bn===null?Gt=us:Bn.sibling=us,Bn=us);return r&&tn.forEach(function(lu){return u(Ue,lu)}),Hn&&Ka(Ue,mn),Gt}function hn(Ue,Be,qe,ft){if(qe==null)throw Error(l(151));for(var Gt=null,Bn=null,tn=Be,mn=Be=0,us=null,ii=qe.next();tn!==null&&!ii.done;mn++,ii=qe.next()){tn.index>mn?(us=tn,tn=null):us=tn.sibling;var lu=Qe(Ue,tn,ii.value,ft);if(lu===null){tn===null&&(tn=us);break}r&&tn&&lu.alternate===null&&u(Ue,tn),Be=z(lu,Be,mn),Bn===null?Gt=lu:Bn.sibling=lu,Bn=lu,tn=us}if(ii.done)return m(Ue,tn),Hn&&Ka(Ue,mn),Gt;if(tn===null){for(;!ii.done;mn++,ii=qe.next())ii=pt(Ue,ii.value,ft),ii!==null&&(Be=z(ii,Be,mn),Bn===null?Gt=ii:Bn.sibling=ii,Bn=ii);return Hn&&Ka(Ue,mn),Gt}for(tn=x(tn);!ii.done;mn++,ii=qe.next())ii=it(tn,Ue,mn,ii.value,ft),ii!==null&&(r&&ii.alternate!==null&&tn.delete(ii.key===null?mn:ii.key),Be=z(ii,Be,mn),Bn===null?Gt=ii:Bn.sibling=ii,Bn=ii);return r&&tn.forEach(function(Lv){return u(Ue,Lv)}),Hn&&Ka(Ue,mn),Gt}function Ci(Ue,Be,qe,ft){if(typeof qe=="object"&&qe!==null&&qe.type===ve&&qe.key===null&&(qe=qe.props.children),typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case ee:e:{for(var Gt=qe.key;Be!==null;){if(Be.key===Gt){if(Gt=qe.type,Gt===ve){if(Be.tag===7){m(Ue,Be.sibling),ft=C(Be,qe.props.children),ft.return=Ue,Ue=ft;break e}}else if(Be.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===pe&&Nh(Gt)===Be.type){m(Ue,Be.sibling),ft=C(Be,qe.props),Yi(ft,qe),ft.return=Ue,Ue=ft;break e}m(Ue,Be);break}else u(Ue,Be);Be=Be.sibling}qe.type===ve?(ft=Al(qe.props.children,Ue.mode,ft,qe.key),ft.return=Ue,Ue=ft):(ft=Th(qe.type,qe.key,qe.props,null,Ue.mode,ft),Yi(ft,qe),ft.return=Ue,Ue=ft)}return H(Ue);case Y:e:{for(Gt=qe.key;Be!==null;){if(Be.key===Gt)if(Be.tag===4&&Be.stateNode.containerInfo===qe.containerInfo&&Be.stateNode.implementation===qe.implementation){m(Ue,Be.sibling),ft=C(Be,qe.children||[]),ft.return=Ue,Ue=ft;break e}else{m(Ue,Be);break}else u(Ue,Be);Be=Be.sibling}ft=zu(qe,Ue.mode,ft),ft.return=Ue,Ue=ft}return H(Ue);case pe:return Gt=qe._init,qe=Gt(qe._payload),Ci(Ue,Be,qe,ft)}if(In(qe))return bn(Ue,Be,qe,ft);if(Ve(qe)){if(Gt=Ve(qe),typeof Gt!="function")throw Error(l(150));return qe=Gt.call(qe),hn(Ue,Be,qe,ft)}if(typeof qe.then=="function")return Ci(Ue,Be,ss(qe),ft);if(qe.$$typeof===He)return Ci(Ue,Be,$s(Ue,qe),ft);Lh(Ue,qe)}return typeof qe=="string"&&qe!==""||typeof qe=="number"||typeof qe=="bigint"?(qe=""+qe,Be!==null&&Be.tag===6?(m(Ue,Be.sibling),ft=C(Be,qe),ft.return=Ue,Ue=ft):(m(Ue,Be),ft=Ld(qe,Ue.mode,ft),ft.return=Ue,Ue=ft),H(Ue)):m(Ue,Be)}return function(Ue,Be,qe,ft){try{Ui=0;var Gt=Ci(Ue,Be,qe,ft);return Zn=null,Gt}catch(tn){if(tn===$c||tn===Es)throw tn;var Bn=la(29,tn,null,Ue.mode);return Bn.lanes=ft,Bn.return=Ue,Bn}finally{}}}var so=Yc(!0),Ro=Yc(!1),tr=ut(null),Qi=null;function Mo(r){var u=r.alternate;Mt(nr,nr.current&1),Mt(tr,r),Qi===null&&(u===null||Yo.current!==null||u.memoizedState!==null)&&(Qi=r)}function il(r){if(r.tag===22){if(Mt(nr,nr.current),Mt(tr,r),Qi===null){var u=r.alternate;u!==null&&u.memoizedState!==null&&(Qi=r)}}else rl()}function rl(){Mt(nr,nr.current),Mt(tr,tr.current)}function Pa(r){Ot(tr),Qi===r&&(Qi=null),Ot(nr)}var nr=ut(0);function sc(r){for(var u=r;u!==null;){if(u.tag===13){var m=u.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||pg(m)))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===r)break;for(;u.sibling===null;){if(u.return===null||u.return===r)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}function ac(r,u,m,x){u=r.memoizedState,m=m(x,u),m=m==null?u:V({},u,m),r.memoizedState=m,r.lanes===0&&(r.updateQueue.baseState=m)}var oc={enqueueSetState:function(r,u,m){r=r._reactInternals;var x=ks(),C=Ao(x);C.payload=u,m!=null&&(C.callback=m),u=Xo(r,C,x),u!==null&&(fa(u,r,x),qc(u,r,x))},enqueueReplaceState:function(r,u,m){r=r._reactInternals;var x=ks(),C=Ao(x);C.tag=1,C.payload=u,m!=null&&(C.callback=m),u=Xo(r,C,x),u!==null&&(fa(u,r,x),qc(u,r,x))},enqueueForceUpdate:function(r,u){r=r._reactInternals;var m=ks(),x=Ao(m);x.tag=2,u!=null&&(x.callback=u),u=Xo(r,x,m),u!==null&&(fa(u,r,m),qc(u,r,m))}};function ym(r,u,m,x,C,z,H){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(x,z,H):u.prototype&&u.prototype.isPureReactComponent?!Oc(m,x)||!Oc(C,z):!0}function f_(r,u,m,x){r=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(m,x),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(m,x),u.state!==r&&oc.enqueueReplaceState(u,u.state,null)}function lc(r,u){var m=u;if("ref"in u){m={};for(var x in u)x!=="ref"&&(m[x]=u[x])}if(r=r.defaultProps){m===u&&(m=V({},m));for(var C in r)m[C]===void 0&&(m[C]=r[C])}return m}var qd=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var u=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(u))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function Gd(r){qd(r)}function vm(r){console.error(r)}function p_(r){qd(r)}function Bh(r,u){try{var m=r.onUncaughtError;m(u.value,{componentStack:u.stack})}catch(x){setTimeout(function(){throw x})}}function m_(r,u,m){try{var x=r.onCaughtError;x(m.value,{componentStack:m.stack,errorBoundary:u.tag===1?u.stateNode:null})}catch(C){setTimeout(function(){throw C})}}function Hd(r,u,m){return m=Ao(m),m.tag=3,m.payload={element:null},m.callback=function(){Bh(r,u)},m}function bm(r){return r=Ao(r),r.tag=3,r}function xm(r,u,m,x){var C=m.type.getDerivedStateFromError;if(typeof C=="function"){var z=x.value;r.payload=function(){return C(z)},r.callback=function(){m_(u,m,x)}}var H=m.stateNode;H!==null&&typeof H.componentDidCatch=="function"&&(r.callback=function(){m_(u,m,x),typeof C!="function"&&(Jc===null?Jc=new Set([this]):Jc.add(this));var ie=x.stack;this.componentDidCatch(x.value,{componentStack:ie!==null?ie:""})})}function Vh(r,u,m,x,C){if(m.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(u=m.alternate,u!==null&&jc(u,m,C,!0),m=tr.current,m!==null){switch(m.tag){case 13:return Qi===null?Zm():m.alternate===null&&Zi===0&&(Zi=3),m.flags&=-257,m.flags|=65536,m.lanes=C,x===Dt?m.flags|=16384:(u=m.updateQueue,u===null?m.updateQueue=new Set([x]):u.add(x),Ym(r,x,C)),!1;case 22:return m.flags|=65536,x===Dt?m.flags|=16384:(u=m.updateQueue,u===null?(u={transitions:null,markerInstances:null,retryQueue:new Set([x])},m.updateQueue=u):(m=u.retryQueue,m===null?u.retryQueue=new Set([x]):m.add(x)),Ym(r,x,C)),!1}throw Error(l(435,m.tag))}return Ym(r,x,C),Zm(),!1}if(Hn)return u=tr.current,u!==null?((u.flags&65536)===0&&(u.flags|=256),u.flags|=65536,u.lanes=C,x!==Bc&&(r=Error(l(422),{cause:x}),Pl(Nr(r,m)))):(x!==Bc&&(u=Error(l(423),{cause:x}),Pl(Nr(u,m))),r=r.current.alternate,r.flags|=65536,C&=-C,r.lanes|=C,x=Nr(x,m),C=Hd(r.stateNode,x,C),kh(r,C),Zi!==4&&(Zi=2)),!1;var z=Error(l(520),{cause:x});if(z=Nr(z,m),sf===null?sf=[z]:sf.push(z),Zi!==4&&(Zi=2),u===null)return!0;x=Nr(x,m),m=u;do{switch(m.tag){case 3:return m.flags|=65536,r=C&-C,m.lanes|=r,r=Hd(m.stateNode,x,r),kh(m,r),!1;case 1:if(u=m.type,z=m.stateNode,(m.flags&128)===0&&(typeof u.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(Jc===null||!Jc.has(z))))return m.flags|=65536,C&=-C,m.lanes|=C,C=bm(C),xm(C,r,m,x),kh(m,C),!1}m=m.return}while(m!==null);return!1}var g_=Error(l(461)),pr=!1;function Ur(r,u,m,x){u.child=r===null?Ro(u,null,m,x):so(u,r.child,m,x)}function Zd(r,u,m,x,C){m=m.render;var z=u.ref;if("ref"in x){var H={};for(var ie in x)ie!=="ref"&&(H[ie]=x[ie])}else H=x;return Rl(u),x=zh(r,u,m,H,z,C),ie=wi(),r!==null&&!pr?(Hi(r,u,C),sl(r,u,C)):(Hn&&ie&&Ho(u),u.flags|=1,Ur(r,u,x,C),u.child)}function __(r,u,m,x,C){if(r===null){var z=m.type;return typeof z=="function"&&!wh(z)&&z.defaultProps===void 0&&m.compare===null?(u.tag=15,u.type=z,y_(r,u,z,x,C)):(r=Th(m.type,null,x,u,u.mode,C),r.ref=u.ref,r.return=u,u.child=r)}if(z=r.child,!Am(r,C)){var H=z.memoizedProps;if(m=m.compare,m=m!==null?m:Oc,m(H,x)&&r.ref===u.ref)return sl(r,u,C)}return u.flags|=1,r=is(z,x),r.ref=u.ref,r.return=u,u.child=r}function y_(r,u,m,x,C){if(r!==null){var z=r.memoizedProps;if(Oc(z,x)&&r.ref===u.ref)if(pr=!1,u.pendingProps=x=z,Am(r,C))(r.flags&131072)!==0&&(pr=!0);else return u.lanes=r.lanes,sl(r,u,C)}return Kd(r,u,m,x,C)}function v_(r,u,m){var x=u.pendingProps,C=x.children,z=r!==null?r.memoizedState:null;if(x.mode==="hidden"){if((u.flags&128)!==0){if(x=z!==null?z.baseLanes|m:m,r!==null){for(C=u.child=r.child,z=0;C!==null;)z=z|C.lanes|C.childLanes,C=C.sibling;u.childLanes=z&~x}else u.childLanes=0,u.child=null;return b_(r,u,x,m)}if((m&536870912)!==0)u.memoizedState={baseLanes:0,cachePool:null},r!==null&&Ih(u,z!==null?z.cachePool:null),z!==null?Jn(u,z):Fd(),il(u);else return u.lanes=u.childLanes=536870912,b_(r,u,z!==null?z.baseLanes|m:m,m)}else z!==null?(Ih(u,z.cachePool),Jn(u,z),rl(),u.memoizedState=null):(r!==null&&Ih(u,null),Fd(),rl());return Ur(r,u,C,m),u.child}function b_(r,u,m,x){var C=jd();return C=C===null?null:{parent:Sr._currentValue,pool:C},u.memoizedState={baseLanes:m,cachePool:C},r!==null&&Ih(u,null),Fd(),il(u),r!==null&&jc(r,u,x,!0),null}function Wd(r,u){var m=u.ref;if(m===null)r!==null&&r.ref!==null&&(u.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(l(284));(r===null||r.ref!==m)&&(u.flags|=4194816)}}function Kd(r,u,m,x,C){return Rl(u),m=zh(r,u,m,x,void 0,C),x=wi(),r!==null&&!pr?(Hi(r,u,C),sl(r,u,C)):(Hn&&x&&Ho(u),u.flags|=1,Ur(r,u,m,C),u.child)}function wm(r,u,m,x,C,z){return Rl(u),u.updateQueue=null,m=Ol(u,x,m,C),Ca(r),x=wi(),r!==null&&!pr?(Hi(r,u,z),sl(r,u,z)):(Hn&&x&&Ho(u),u.flags|=1,Ur(r,u,m,z),u.child)}function Tm(r,u,m,x,C){if(Rl(u),u.stateNode===null){var z=wn,H=m.contextType;typeof H=="object"&&H!==null&&(z=hr(H)),z=new m(x,z),u.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,z.updater=oc,u.stateNode=z,z._reactInternals=u,z=u.stateNode,z.props=x,z.state=u.memoizedState,z.refs={},ju(u),H=m.contextType,z.context=typeof H=="object"&&H!==null?hr(H):wn,z.state=u.memoizedState,H=m.getDerivedStateFromProps,typeof H=="function"&&(ac(u,m,H,x),z.state=u.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(H=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),H!==z.state&&oc.enqueueReplaceState(z,z.state,null),Gc(u,x,z,C),nc(),z.state=u.memoizedState),typeof z.componentDidMount=="function"&&(u.flags|=4194308),x=!0}else if(r===null){z=u.stateNode;var ie=u.memoizedProps,we=lc(m,ie);z.props=we;var Ke=z.context,ct=m.contextType;H=wn,typeof ct=="object"&&ct!==null&&(H=hr(ct));var pt=m.getDerivedStateFromProps;ct=typeof pt=="function"||typeof z.getSnapshotBeforeUpdate=="function",ie=u.pendingProps!==ie,ct||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(ie||Ke!==H)&&f_(u,z,x,H),vn=!1;var Qe=u.memoizedState;z.state=Qe,Gc(u,x,z,C),nc(),Ke=u.memoizedState,ie||Qe!==Ke||vn?(typeof pt=="function"&&(ac(u,m,pt,x),Ke=u.memoizedState),(we=vn||ym(u,m,we,x,Qe,Ke,H))?(ct||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(u.flags|=4194308)):(typeof z.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=x,u.memoizedState=Ke),z.props=x,z.state=Ke,z.context=H,x=we):(typeof z.componentDidMount=="function"&&(u.flags|=4194308),x=!1)}else{z=u.stateNode,Mh(r,u),H=u.memoizedProps,ct=lc(m,H),z.props=ct,pt=u.pendingProps,Qe=z.context,Ke=m.contextType,we=wn,typeof Ke=="object"&&Ke!==null&&(we=hr(Ke)),ie=m.getDerivedStateFromProps,(Ke=typeof ie=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(H!==pt||Qe!==we)&&f_(u,z,x,we),vn=!1,Qe=u.memoizedState,z.state=Qe,Gc(u,x,z,C),nc();var it=u.memoizedState;H!==pt||Qe!==it||vn||r!==null&&r.dependencies!==null&&Bu(r.dependencies)?(typeof ie=="function"&&(ac(u,m,ie,x),it=u.memoizedState),(ct=vn||ym(u,m,ct,x,Qe,it,we)||r!==null&&r.dependencies!==null&&Bu(r.dependencies))?(Ke||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(x,it,we),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(x,it,we)),typeof z.componentDidUpdate=="function"&&(u.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof z.componentDidUpdate!="function"||H===r.memoizedProps&&Qe===r.memoizedState||(u.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||H===r.memoizedProps&&Qe===r.memoizedState||(u.flags|=1024),u.memoizedProps=x,u.memoizedState=it),z.props=x,z.state=it,z.context=we,x=ct):(typeof z.componentDidUpdate!="function"||H===r.memoizedProps&&Qe===r.memoizedState||(u.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||H===r.memoizedProps&&Qe===r.memoizedState||(u.flags|=1024),x=!1)}return z=x,Wd(r,u),x=(u.flags&128)!==0,z||x?(z=u.stateNode,m=x&&typeof m.getDerivedStateFromError!="function"?null:z.render(),u.flags|=1,r!==null&&x?(u.child=so(u,r.child,null,C),u.child=so(u,null,m,C)):Ur(r,u,m,C),u.memoizedState=z.state,r=u.child):r=sl(r,u,C),r}function x_(r,u,m,x){return Ya(),u.flags|=256,Ur(r,u,m,x),u.child}var Sm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ip(r){return{baseLanes:r,cachePool:Vu()}}function rp(r,u,m){return r=r!==null?r.childLanes&~m:0,u&&(r|=Do),r}function w_(r,u,m){var x=u.pendingProps,C=!1,z=(u.flags&128)!==0,H;if((H=z)||(H=r!==null&&r.memoizedState===null?!1:(nr.current&2)!==0),H&&(C=!0,u.flags&=-129),H=(u.flags&32)!==0,u.flags&=-33,r===null){if(Hn){if(C?Mo(u):rl(),Hn){var ie=ji,we;if(we=ie){e:{for(we=ie,ie=Xa;we.nodeType!==8;){if(!ie){ie=null;break e}if(we=Oo(we.nextSibling),we===null){ie=null;break e}}ie=we}ie!==null?(u.memoizedState={dehydrated:ie,treeContext:Wa!==null?{id:ua,overflow:xs}:null,retryLane:536870912,hydrationErrors:null},we=la(18,null,null,0),we.stateNode=ie,we.return=u,u.child=we,Ir=u,ji=null,we=!0):we=!1}we||Zo(u)}if(ie=u.memoizedState,ie!==null&&(ie=ie.dehydrated,ie!==null))return pg(ie)?u.lanes=32:u.lanes=536870912,null;Pa(u)}return ie=x.children,x=x.fallback,C?(rl(),C=u.mode,ie=Yd({mode:"hidden",children:ie},C),x=Al(x,C,m,null),ie.return=u,x.return=u,ie.sibling=x,u.child=ie,C=u.child,C.memoizedState=ip(m),C.childLanes=rp(r,H,m),u.memoizedState=Sm,x):(Mo(u),Xd(u,ie))}if(we=r.memoizedState,we!==null&&(ie=we.dehydrated,ie!==null)){if(z)u.flags&256?(Mo(u),u.flags&=-257,u=Qd(r,u,m)):u.memoizedState!==null?(rl(),u.child=r.child,u.flags|=128,u=null):(rl(),C=x.fallback,ie=u.mode,x=Yd({mode:"visible",children:x.children},ie),C=Al(C,ie,m,null),C.flags|=2,x.return=u,C.return=u,x.sibling=C,u.child=x,so(u,r.child,null,m),x=u.child,x.memoizedState=ip(m),x.childLanes=rp(r,H,m),u.memoizedState=Sm,u=C);else if(Mo(u),pg(ie)){if(H=ie.nextSibling&&ie.nextSibling.dataset,H)var Ke=H.dgst;H=Ke,x=Error(l(419)),x.stack="",x.digest=H,Pl({value:x,source:null,stack:null}),u=Qd(r,u,m)}else if(pr||jc(r,u,m,!1),H=(m&r.childLanes)!==0,pr||H){if(H=Oi,H!==null&&(x=m&-m,x=(x&42)!==0?1:cn(x),x=(x&(H.suspendedLanes|m))!==0?0:x,x!==0&&x!==we.retryLane))throw we.retryLane=x,oa(r,x),fa(H,r,x),g_;ie.data==="$?"||Zm(),u=Qd(r,u,m)}else ie.data==="$?"?(u.flags|=192,u.child=r.child,u=null):(r=we.treeContext,ji=Oo(ie.nextSibling),Ir=u,Hn=!0,Cl=null,Xa=!1,r!==null&&(ca[rs++]=ua,ca[rs++]=xs,ca[rs++]=Wa,ua=r.id,xs=r.overflow,Wa=u),u=Xd(u,x.children),u.flags|=4096);return u}return C?(rl(),C=x.fallback,ie=u.mode,we=r.child,Ke=we.sibling,x=is(we,{mode:"hidden",children:x.children}),x.subtreeFlags=we.subtreeFlags&65011712,Ke!==null?C=is(Ke,C):(C=Al(C,ie,m,null),C.flags|=2),C.return=u,x.return=u,x.sibling=C,u.child=x,x=C,C=u.child,ie=r.child.memoizedState,ie===null?ie=ip(m):(we=ie.cachePool,we!==null?(Ke=Sr._currentValue,we=we.parent!==Ke?{parent:Ke,pool:Ke}:we):we=Vu(),ie={baseLanes:ie.baseLanes|m,cachePool:we}),C.memoizedState=ie,C.childLanes=rp(r,H,m),u.memoizedState=Sm,x):(Mo(u),m=r.child,r=m.sibling,m=is(m,{mode:"visible",children:x.children}),m.return=u,m.sibling=null,r!==null&&(H=u.deletions,H===null?(u.deletions=[r],u.flags|=16):H.push(r)),u.child=m,u.memoizedState=null,m)}function Xd(r,u){return u=Yd({mode:"visible",children:u},r.mode),u.return=r,r.child=u}function Yd(r,u){return r=la(22,r,null,u),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function Qd(r,u,m){return so(u,r.child,null,m),r=Xd(u,u.pendingProps.children),r.flags|=2,u.memoizedState=null,r}function jh(r,u,m){r.lanes|=u;var x=r.alternate;x!==null&&(x.lanes|=u),Nu(r.return,u,m)}function Ps(r,u,m,x,C){var z=r.memoizedState;z===null?r.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:x,tail:m,tailMode:C}:(z.isBackwards=u,z.rendering=null,z.renderingStartTime=0,z.last=x,z.tail=m,z.tailMode=C)}function Em(r,u,m){var x=u.pendingProps,C=x.revealOrder,z=x.tail;if(Ur(r,u,x.children,m),x=nr.current,(x&2)!==0)x=x&1|2,u.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=u.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&jh(r,m,u);else if(r.tag===19)jh(r,m,u);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===u)break e;for(;r.sibling===null;){if(r.return===null||r.return===u)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}x&=1}switch(Mt(nr,x),C){case"forwards":for(m=u.child,C=null;m!==null;)r=m.alternate,r!==null&&sc(r)===null&&(C=m),m=m.sibling;m=C,m===null?(C=u.child,u.child=null):(C=m.sibling,m.sibling=null),Ps(u,!1,C,m,z);break;case"backwards":for(m=null,C=u.child,u.child=null;C!==null;){if(r=C.alternate,r!==null&&sc(r)===null){u.child=C;break}r=C.sibling,C.sibling=m,m=C,C=r}Ps(u,!0,m,null,z);break;case"together":Ps(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function sl(r,u,m){if(r!==null&&(u.dependencies=r.dependencies),fc|=u.lanes,(m&u.childLanes)===0)if(r!==null){if(jc(r,u,m,!1),(m&u.childLanes)===0)return null}else return null;if(r!==null&&u.child!==r.child)throw Error(l(153));if(u.child!==null){for(r=u.child,m=is(r,r.pendingProps),u.child=m,m.return=u;r.sibling!==null;)r=r.sibling,m=m.sibling=is(r,r.pendingProps),m.return=u;m.sibling=null}return u.child}function Am(r,u){return(r.lanes&u)!==0?!0:(r=r.dependencies,!!(r!==null&&Bu(r)))}function T_(r,u,m){switch(u.tag){case 3:On(u,u.stateNode.containerInfo),Fs(u,Sr,r.memoizedState.cache),Ya();break;case 27:case 5:uo(u);break;case 4:On(u,u.stateNode.containerInfo);break;case 10:Fs(u,u.type,u.memoizedProps.value);break;case 13:var x=u.memoizedState;if(x!==null)return x.dehydrated!==null?(Mo(u),u.flags|=128,null):(m&u.child.childLanes)!==0?w_(r,u,m):(Mo(u),r=sl(r,u,m),r!==null?r.sibling:null);Mo(u);break;case 19:var C=(r.flags&128)!==0;if(x=(m&u.childLanes)!==0,x||(jc(r,u,m,!1),x=(m&u.childLanes)!==0),C){if(x)return Em(r,u,m);u.flags|=128}if(C=u.memoizedState,C!==null&&(C.rendering=null,C.tail=null,C.lastEffect=null),Mt(nr,nr.current),x)break;return null;case 22:case 23:return u.lanes=0,v_(r,u,m);case 24:Fs(u,Sr,r.memoizedState.cache)}return sl(r,u,m)}function S_(r,u,m){if(r!==null)if(r.memoizedProps!==u.pendingProps)pr=!0;else{if(!Am(r,m)&&(u.flags&128)===0)return pr=!1,T_(r,u,m);pr=(r.flags&131072)!==0}else pr=!1,Hn&&(u.flags&1048576)!==0&&Sh(u,Nc,u.index);switch(u.lanes=0,u.tag){case 16:e:{r=u.pendingProps;var x=u.elementType,C=x._init;if(x=C(x._payload),u.type=x,typeof x=="function")wh(x)?(r=lc(x,r),u.tag=1,u=Tm(null,u,x,r,m)):(u.tag=0,u=Kd(null,u,x,r,m));else{if(x!=null){if(C=x.$$typeof,C===gt){u.tag=11,u=Zd(null,u,x,r,m);break e}else if(C===Se){u.tag=14,u=__(null,u,x,r,m);break e}}throw u=dn(x)||x,Error(l(306,u,""))}}return u;case 0:return Kd(r,u,u.type,u.pendingProps,m);case 1:return x=u.type,C=lc(x,u.pendingProps),Tm(r,u,x,C,m);case 3:e:{if(On(u,u.stateNode.containerInfo),r===null)throw Error(l(387));x=u.pendingProps;var z=u.memoizedState;C=z.element,Mh(r,u),Gc(u,x,null,m);var H=u.memoizedState;if(x=H.cache,Fs(u,Sr,x),x!==z.cache&&Ah(u,[Sr],m,!0),nc(),x=H.element,z.isDehydrated)if(z={element:x,isDehydrated:!1,cache:H.cache},u.updateQueue.baseState=z,u.memoizedState=z,u.flags&256){u=x_(r,u,x,m);break e}else if(x!==C){C=Nr(Error(l(424)),u),Pl(C),u=x_(r,u,x,m);break e}else{switch(r=u.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(ji=Oo(r.firstChild),Ir=u,Hn=!0,Cl=null,Xa=!0,m=Ro(u,null,x,m),u.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling}else{if(Ya(),x===C){u=sl(r,u,m);break e}Ur(r,u,x,m)}u=u.child}return u;case 26:return Wd(r,u),r===null?(m=Ep(u.type,null,u.pendingProps,null))?u.memoizedState=m:Hn||(m=u.type,r=u.pendingProps,x=qs(Ht.current).createElement(m),x[Kt]=u,x[rn]=r,Rr(x,m,r),pi(x),u.stateNode=x):u.memoizedState=Ep(u.type,r.memoizedProps,u.pendingProps,r.memoizedState),null;case 27:return uo(u),r===null&&Hn&&(x=u.stateNode=vf(u.type,u.pendingProps,Ht.current),Ir=u,Xa=!0,C=ji,vc(u.type)?(Qh=C,ji=Oo(x.firstChild)):ji=C),Ur(r,u,u.pendingProps.children,m),Wd(r,u),r===null&&(u.flags|=4194304),u.child;case 5:return r===null&&Hn&&((C=x=ji)&&(x=J_(x,u.type,u.pendingProps,Xa),x!==null?(u.stateNode=x,Ir=u,ji=Oo(x.firstChild),Xa=!1,C=!0):C=!1),C||Zo(u)),uo(u),C=u.type,z=u.pendingProps,H=r!==null?r.memoizedProps:null,x=z.children,yc(C,z)?x=null:H!==null&&yc(C,H)&&(u.flags|=32),u.memoizedState!==null&&(C=zh(r,u,Zc,null,null,m),j._currentValue=C),Wd(r,u),Ur(r,u,x,m),u.child;case 6:return r===null&&Hn&&((r=m=ji)&&(m=Dv(m,u.pendingProps,Xa),m!==null?(u.stateNode=m,Ir=u,ji=null,r=!0):r=!1),r||Zo(u)),null;case 13:return w_(r,u,m);case 4:return On(u,u.stateNode.containerInfo),x=u.pendingProps,r===null?u.child=so(u,null,x,m):Ur(r,u,x,m),u.child;case 11:return Zd(r,u,u.type,u.pendingProps,m);case 7:return Ur(r,u,u.pendingProps,m),u.child;case 8:return Ur(r,u,u.pendingProps.children,m),u.child;case 12:return Ur(r,u,u.pendingProps.children,m),u.child;case 10:return x=u.pendingProps,Fs(u,u.type,x.value),Ur(r,u,x.children,m),u.child;case 9:return C=u.type._context,x=u.pendingProps.children,Rl(u),C=hr(C),x=x(C),u.flags|=1,Ur(r,u,x,m),u.child;case 14:return __(r,u,u.type,u.pendingProps,m);case 15:return y_(r,u,u.type,u.pendingProps,m);case 19:return Em(r,u,m);case 31:return x=u.pendingProps,m=u.mode,x={mode:x.mode,children:x.children},r===null?(m=Yd(x,m),m.ref=u.ref,u.child=m,m.return=u,u=m):(m=is(r.child,x),m.ref=u.ref,u.child=m,m.return=u,u=m),u;case 22:return v_(r,u,m);case 24:return Rl(u),x=hr(Sr),r===null?(C=jd(),C===null&&(C=Oi,z=Ml(),C.pooledCache=z,z.refCount++,z!==null&&(C.pooledCacheLanes|=m),C=z),u.memoizedState={parent:x,cache:C},ju(u),Fs(u,Sr,C)):((r.lanes&m)!==0&&(Mh(r,u),Gc(u,null,null,m),nc()),C=r.memoizedState,z=u.memoizedState,C.parent!==x?(C={parent:x,cache:x},u.memoizedState=C,u.lanes===0&&(u.memoizedState=u.updateQueue.baseState=C),Fs(u,Sr,x)):(x=z.cache,Fs(u,Sr,x),x!==C.cache&&Ah(u,[Sr],m,!0))),Ur(r,u,u.pendingProps.children,m),u.child;case 29:throw u.pendingProps}throw Error(l(156,u.tag))}function cc(r){r.flags|=4}function Im(r,u){if(u.type!=="stylesheet"||(u.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!s(u)){if(u=tr.current,u!==null&&((Gn&4194048)===Gn?Qi!==null:(Gn&62914560)!==Gn&&(Gn&536870912)===0||u!==Qi))throw eo=Dt,Dl;r.flags|=8192}}function sp(r,u){u!==null&&(r.flags|=4),r.flags&16384&&(u=r.tag!==22?ot():536870912,r.lanes|=u,$h|=u)}function qu(r,u){if(!Hn)switch(r.tailMode){case"hidden":u=r.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?r.tail=null:m.sibling=null;break;case"collapsed":m=r.tail;for(var x=null;m!==null;)m.alternate!==null&&(x=m),m=m.sibling;x===null?u||r.tail===null?r.tail=null:r.tail.sibling=null:x.sibling=null}}function ir(r){var u=r.alternate!==null&&r.alternate.child===r.child,m=0,x=0;if(u)for(var C=r.child;C!==null;)m|=C.lanes|C.childLanes,x|=C.subtreeFlags&65011712,x|=C.flags&65011712,C.return=r,C=C.sibling;else for(C=r.child;C!==null;)m|=C.lanes|C.childLanes,x|=C.subtreeFlags,x|=C.flags,C.return=r,C=C.sibling;return r.subtreeFlags|=x,r.childLanes=m,u}function E_(r,u,m){var x=u.pendingProps;switch(Lu(u),u.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ir(u),null;case 1:return ir(u),null;case 3:return m=u.stateNode,x=null,r!==null&&(x=r.memoizedState.cache),u.memoizedState.cache!==x&&(u.flags|=2048),ha(Sr),ar(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(r===null||r.child===null)&&(oi(u)?cc(u):r===null||r.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,Us())),ir(u),null;case 26:return m=u.memoizedState,r===null?(cc(u),m!==null?(ir(u),Im(u,m)):(ir(u),u.flags&=-16777217)):m?m!==r.memoizedState?(cc(u),ir(u),Im(u,m)):(ir(u),u.flags&=-16777217):(r.memoizedProps!==x&&cc(u),ir(u),u.flags&=-16777217),null;case 27:Na(u),m=Ht.current;var C=u.type;if(r!==null&&u.stateNode!=null)r.memoizedProps!==x&&cc(u);else{if(!x){if(u.stateNode===null)throw Error(l(166));return ir(u),null}r=qt.current,oi(u)?Nd(u):(r=vf(C,x,m),u.stateNode=r,cc(u))}return ir(u),null;case 5:if(Na(u),m=u.type,r!==null&&u.stateNode!=null)r.memoizedProps!==x&&cc(u);else{if(!x){if(u.stateNode===null)throw Error(l(166));return ir(u),null}if(r=qt.current,oi(u))Nd(u);else{switch(C=qs(Ht.current),r){case 1:r=C.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:r=C.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":r=C.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":r=C.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":r=C.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof x.is=="string"?C.createElement("select",{is:x.is}):C.createElement("select"),x.multiple?r.multiple=!0:x.size&&(r.size=x.size);break;default:r=typeof x.is=="string"?C.createElement(m,{is:x.is}):C.createElement(m)}}r[Kt]=u,r[rn]=x;e:for(C=u.child;C!==null;){if(C.tag===5||C.tag===6)r.appendChild(C.stateNode);else if(C.tag!==4&&C.tag!==27&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===u)break e;for(;C.sibling===null;){if(C.return===null||C.return===u)break e;C=C.return}C.sibling.return=C.return,C=C.sibling}u.stateNode=r;e:switch(Rr(r,m,x),m){case"button":case"input":case"select":case"textarea":r=!!x.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&cc(u)}}return ir(u),u.flags&=-16777217,null;case 6:if(r&&u.stateNode!=null)r.memoizedProps!==x&&cc(u);else{if(typeof x!="string"&&u.stateNode===null)throw Error(l(166));if(r=Ht.current,oi(u)){if(r=u.stateNode,m=u.memoizedProps,x=null,C=Ir,C!==null)switch(C.tag){case 27:case 5:x=C.memoizedProps}r[Kt]=u,r=!!(r.nodeValue===m||x!==null&&x.suppressHydrationWarning===!0||hg(r.nodeValue,m)),r||Zo(u)}else r=qs(r).createTextNode(x),r[Kt]=u,u.stateNode=r}return ir(u),null;case 13:if(x=u.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(C=oi(u),x!==null&&x.dehydrated!==null){if(r===null){if(!C)throw Error(l(318));if(C=u.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(l(317));C[Kt]=u}else Ya(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;ir(u),C=!1}else C=Us(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=C),C=!0;if(!C)return u.flags&256?(Pa(u),u):(Pa(u),null)}if(Pa(u),(u.flags&128)!==0)return u.lanes=m,u;if(m=x!==null,r=r!==null&&r.memoizedState!==null,m){x=u.child,C=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(C=x.alternate.memoizedState.cachePool.pool);var z=null;x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(z=x.memoizedState.cachePool.pool),z!==C&&(x.flags|=2048)}return m!==r&&m&&(u.child.flags|=8192),sp(u,u.updateQueue),ir(u),null;case 4:return ar(),r===null&&lg(u.stateNode.containerInfo),ir(u),null;case 10:return ha(u.type),ir(u),null;case 19:if(Ot(nr),C=u.memoizedState,C===null)return ir(u),null;if(x=(u.flags&128)!==0,z=C.rendering,z===null)if(x)qu(C,!1);else{if(Zi!==0||r!==null&&(r.flags&128)!==0)for(r=u.child;r!==null;){if(z=sc(r),z!==null){for(u.flags|=128,qu(C,!1),r=z.updateQueue,u.updateQueue=r,sp(u,r),u.subtreeFlags=0,r=m,m=u.child;m!==null;)zd(m,r),m=m.sibling;return Mt(nr,nr.current&1|2),u.child}r=r.sibling}C.tail!==null&&br()>of&&(u.flags|=128,x=!0,qu(C,!1),u.lanes=4194304)}else{if(!x)if(r=sc(z),r!==null){if(u.flags|=128,x=!0,r=r.updateQueue,u.updateQueue=r,sp(u,r),qu(C,!0),C.tail===null&&C.tailMode==="hidden"&&!z.alternate&&!Hn)return ir(u),null}else 2*br()-C.renderingStartTime>of&&m!==536870912&&(u.flags|=128,x=!0,qu(C,!1),u.lanes=4194304);C.isBackwards?(z.sibling=u.child,u.child=z):(r=C.last,r!==null?r.sibling=z:u.child=z,C.last=z)}return C.tail!==null?(u=C.tail,C.rendering=u,C.tail=u.sibling,C.renderingStartTime=br(),u.sibling=null,r=nr.current,Mt(nr,x?r&1|2:r&1),u):(ir(u),null);case 22:case 23:return Pa(u),Hc(),x=u.memoizedState!==null,r!==null?r.memoizedState!==null!==x&&(u.flags|=8192):x&&(u.flags|=8192),x?(m&536870912)!==0&&(u.flags&128)===0&&(ir(u),u.subtreeFlags&6&&(u.flags|=8192)):ir(u),m=u.updateQueue,m!==null&&sp(u,m.retryQueue),m=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(m=r.memoizedState.cachePool.pool),x=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(x=u.memoizedState.cachePool.pool),x!==m&&(u.flags|=2048),r!==null&&Ot(Ja),null;case 24:return m=null,r!==null&&(m=r.memoizedState.cache),u.memoizedState.cache!==m&&(u.flags|=2048),ha(Sr),ir(u),null;case 25:return null;case 30:return null}throw Error(l(156,u.tag))}function Iv(r,u){switch(Lu(u),u.tag){case 1:return r=u.flags,r&65536?(u.flags=r&-65537|128,u):null;case 3:return ha(Sr),ar(),r=u.flags,(r&65536)!==0&&(r&128)===0?(u.flags=r&-65537|128,u):null;case 26:case 27:case 5:return Na(u),null;case 13:if(Pa(u),r=u.memoizedState,r!==null&&r.dehydrated!==null){if(u.alternate===null)throw Error(l(340));Ya()}return r=u.flags,r&65536?(u.flags=r&-65537|128,u):null;case 19:return Ot(nr),null;case 4:return ar(),null;case 10:return ha(u.type),null;case 22:case 23:return Pa(u),Hc(),r!==null&&Ot(Ja),r=u.flags,r&65536?(u.flags=r&-65537|128,u):null;case 24:return ha(Sr),null;case 25:return null;default:return null}}function A_(r,u){switch(Lu(u),u.tag){case 3:ha(Sr),ar();break;case 26:case 27:case 5:Na(u);break;case 4:ar();break;case 13:Pa(u);break;case 19:Ot(nr);break;case 10:ha(u.type);break;case 22:case 23:Pa(u),Hc(),r!==null&&Ot(Ja);break;case 24:ha(Sr)}}function Jd(r,u){try{var m=u.updateQueue,x=m!==null?m.lastEffect:null;if(x!==null){var C=x.next;m=C;do{if((m.tag&r)===r){x=void 0;var z=m.create,H=m.inst;x=z(),H.destroy=x}m=m.next}while(m!==C)}}catch(ie){zi(u,u.return,ie)}}function Bl(r,u,m){try{var x=u.updateQueue,C=x!==null?x.lastEffect:null;if(C!==null){var z=C.next;x=z;do{if((x.tag&r)===r){var H=x.inst,ie=H.destroy;if(ie!==void 0){H.destroy=void 0,C=u;var we=m,Ke=ie;try{Ke()}catch(ct){zi(C,we,ct)}}}x=x.next}while(x!==z)}}catch(ct){zi(u,u.return,ct)}}function ap(r){var u=r.updateQueue;if(u!==null){var m=r.stateNode;try{Ud(u,m)}catch(x){zi(r,r.return,x)}}}function Cm(r,u,m){m.props=lc(r.type,r.memoizedProps),m.state=r.memoizedState;try{m.componentWillUnmount()}catch(x){zi(r,u,x)}}function al(r,u){try{var m=r.ref;if(m!==null){switch(r.tag){case 26:case 27:case 5:var x=r.stateNode;break;case 30:x=r.stateNode;break;default:x=r.stateNode}typeof m=="function"?r.refCleanup=m(x):m.current=x}}catch(C){zi(r,u,C)}}function Ra(r,u){var m=r.ref,x=r.refCleanup;if(m!==null)if(typeof x=="function")try{x()}catch(C){zi(r,u,C)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(C){zi(r,u,C)}else m.current=null}function I_(r){var u=r.type,m=r.memoizedProps,x=r.stateNode;try{e:switch(u){case"button":case"input":case"select":case"textarea":m.autoFocus&&x.focus();break e;case"img":m.src?x.src=m.src:m.srcSet&&(x.srcset=m.srcSet)}}catch(C){zi(r,r.return,C)}}function Pm(r,u,m){try{var x=r.stateNode;W_(x,r.type,m,u),x[rn]=u}catch(C){zi(r,r.return,C)}}function C_(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&vc(r.type)||r.tag===4}function Rm(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||C_(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&vc(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Mm(r,u,m){var x=r.tag;if(x===5||x===6)r=r.stateNode,u?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(r,u):(u=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,u.appendChild(r),m=m._reactRootContainer,m!=null||u.onclick!==null||(u.onclick=_f));else if(x!==4&&(x===27&&vc(r.type)&&(m=r.stateNode,u=null),r=r.child,r!==null))for(Mm(r,u,m),r=r.sibling;r!==null;)Mm(r,u,m),r=r.sibling}function op(r,u,m){var x=r.tag;if(x===5||x===6)r=r.stateNode,u?m.insertBefore(r,u):m.appendChild(r);else if(x!==4&&(x===27&&vc(r.type)&&(m=r.stateNode),r=r.child,r!==null))for(op(r,u,m),r=r.sibling;r!==null;)op(r,u,m),r=r.sibling}function P_(r){var u=r.stateNode,m=r.memoizedProps;try{for(var x=r.type,C=u.attributes;C.length;)u.removeAttributeNode(C[0]);Rr(u,x,m),u[Kt]=r,u[rn]=m}catch(z){zi(r,r.return,z)}}var ol=!1,Cr=!1,lp=!1,Uh=typeof WeakSet=="function"?WeakSet:Set,as=null;function mr(r,u){if(r=r.containerInfo,yf=_e,r=yh(r),Cu(r)){if("selectionStart"in r)var m={start:r.selectionStart,end:r.selectionEnd};else e:{m=(m=r.ownerDocument)&&m.defaultView||window;var x=m.getSelection&&m.getSelection();if(x&&x.rangeCount!==0){m=x.anchorNode;var C=x.anchorOffset,z=x.focusNode;x=x.focusOffset;try{m.nodeType,z.nodeType}catch{m=null;break e}var H=0,ie=-1,we=-1,Ke=0,ct=0,pt=r,Qe=null;t:for(;;){for(var it;pt!==m||C!==0&&pt.nodeType!==3||(ie=H+C),pt!==z||x!==0&&pt.nodeType!==3||(we=H+x),pt.nodeType===3&&(H+=pt.nodeValue.length),(it=pt.firstChild)!==null;)Qe=pt,pt=it;for(;;){if(pt===r)break t;if(Qe===m&&++Ke===C&&(ie=H),Qe===z&&++ct===x&&(we=H),(it=pt.nextSibling)!==null)break;pt=Qe,Qe=pt.parentNode}pt=it}m=ie===-1||we===-1?null:{start:ie,end:we}}else m=null}m=m||{start:0,end:0}}else m=null;for(xp={focusedElem:r,selectionRange:m},_e=!1,as=u;as!==null;)if(u=as,r=u.child,(u.subtreeFlags&1024)!==0&&r!==null)r.return=u,as=r;else for(;as!==null;){switch(u=as,z=u.alternate,r=u.flags,u.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&z!==null){r=void 0,m=u,C=z.memoizedProps,z=z.memoizedState,x=m.stateNode;try{var bn=lc(m.type,C,m.elementType===m.type);r=x.getSnapshotBeforeUpdate(bn,z),x.__reactInternalSnapshotBeforeUpdate=r}catch(hn){zi(m,m.return,hn)}}break;case 3:if((r&1024)!==0){if(r=u.stateNode.containerInfo,m=r.nodeType,m===9)Tp(r);else if(m===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Tp(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(l(163))}if(r=u.sibling,r!==null){r.return=u.return,as=r;break}as=u.return}}function Gu(r,u,m){var x=m.flags;switch(m.tag){case 0:case 11:case 15:uc(r,m),x&4&&Jd(5,m);break;case 1:if(uc(r,m),x&4)if(r=m.stateNode,u===null)try{r.componentDidMount()}catch(H){zi(m,m.return,H)}else{var C=lc(m.type,u.memoizedProps);u=u.memoizedState;try{r.componentDidUpdate(C,u,r.__reactInternalSnapshotBeforeUpdate)}catch(H){zi(m,m.return,H)}}x&64&&ap(m),x&512&&al(m,m.return);break;case 3:if(uc(r,m),x&64&&(r=m.updateQueue,r!==null)){if(u=null,m.child!==null)switch(m.child.tag){case 27:case 5:u=m.child.stateNode;break;case 1:u=m.child.stateNode}try{Ud(r,u)}catch(H){zi(m,m.return,H)}}break;case 27:u===null&&x&4&&P_(m);case 26:case 5:uc(r,m),u===null&&x&4&&I_(m),x&512&&al(m,m.return);break;case 12:uc(r,m);break;case 13:uc(r,m),x&4&&Om(r,m),x&64&&(r=m.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(m=Jm.bind(null,m),ey(r,m))));break;case 22:if(x=m.memoizedState!==null||ol,!x){u=u!==null&&u.memoizedState!==null||Cr,C=ol;var z=Cr;ol=x,(Cr=u)&&!z?Qc(r,m,(m.subtreeFlags&8772)!==0):uc(r,m),ol=C,Cr=z}break;case 30:break;default:uc(r,m)}}function km(r){var u=r.alternate;u!==null&&(r.alternate=null,km(u)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(u=r.stateNode,u!==null&&It(u)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Fi=null,Rs=!1;function ao(r,u,m){for(m=m.child;m!==null;)Dm(r,u,m),m=m.sibling}function Dm(r,u,m){if(Ki&&typeof Ki.onCommitFiberUnmount=="function")try{Ki.onCommitFiberUnmount(gs,m)}catch{}switch(m.tag){case 26:Cr||Ra(m,u),ao(r,u,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:Cr||Ra(m,u);var x=Fi,C=Rs;vc(m.type)&&(Fi=m.stateNode,Rs=!1),ao(r,u,m),ru(m.stateNode),Fi=x,Rs=C;break;case 5:Cr||Ra(m,u);case 6:if(x=Fi,C=Rs,Fi=null,ao(r,u,m),Fi=x,Rs=C,Fi!==null)if(Rs)try{(Fi.nodeType===9?Fi.body:Fi.nodeName==="HTML"?Fi.ownerDocument.body:Fi).removeChild(m.stateNode)}catch(z){zi(m,u,z)}else try{Fi.removeChild(m.stateNode)}catch(z){zi(m,u,z)}break;case 18:Fi!==null&&(Rs?(r=Fi,fg(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,m.stateNode),_r(r)):fg(Fi,m.stateNode));break;case 4:x=Fi,C=Rs,Fi=m.stateNode.containerInfo,Rs=!0,ao(r,u,m),Fi=x,Rs=C;break;case 0:case 11:case 14:case 15:Cr||Bl(2,m,u),Cr||Bl(4,m,u),ao(r,u,m);break;case 1:Cr||(Ra(m,u),x=m.stateNode,typeof x.componentWillUnmount=="function"&&Cm(m,u,x)),ao(r,u,m);break;case 21:ao(r,u,m);break;case 22:Cr=(x=Cr)||m.memoizedState!==null,ao(r,u,m),Cr=x;break;default:ao(r,u,m)}}function Om(r,u){if(u.memoizedState===null&&(r=u.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{_r(r)}catch(m){zi(u,u.return,m)}}function ef(r){switch(r.tag){case 13:case 19:var u=r.stateNode;return u===null&&(u=r.stateNode=new Uh),u;case 22:return r=r.stateNode,u=r._retryCache,u===null&&(u=r._retryCache=new Uh),u;default:throw Error(l(435,r.tag))}}function tf(r,u){var m=ef(r);u.forEach(function(x){var C=eg.bind(null,r,x);m.has(x)||(m.add(x),x.then(C,C))})}function os(r,u){var m=u.deletions;if(m!==null)for(var x=0;x<m.length;x++){var C=m[x],z=r,H=u,ie=H;e:for(;ie!==null;){switch(ie.tag){case 27:if(vc(ie.type)){Fi=ie.stateNode,Rs=!1;break e}break;case 5:Fi=ie.stateNode,Rs=!1;break e;case 3:case 4:Fi=ie.stateNode.containerInfo,Rs=!0;break e}ie=ie.return}if(Fi===null)throw Error(l(160));Dm(z,H,C),Fi=null,Rs=!1,z=C.alternate,z!==null&&(z.return=null),C.return=null}if(u.subtreeFlags&13878)for(u=u.child;u!==null;)Hu(u,r),u=u.sibling}var Ma=null;function Hu(r,u){var m=r.alternate,x=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:os(u,r),Ms(r),x&4&&(Bl(3,r,r.return),Jd(3,r),Bl(5,r,r.return));break;case 1:os(u,r),Ms(r),x&512&&(Cr||m===null||Ra(m,m.return)),x&64&&ol&&(r=r.updateQueue,r!==null&&(x=r.callbacks,x!==null&&(m=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=m===null?x:m.concat(x))));break;case 26:var C=Ma;if(os(u,r),Ms(r),x&512&&(Cr||m===null||Ra(m,m.return)),x&4){var z=m!==null?m.memoizedState:null;if(x=r.memoizedState,m===null)if(x===null)if(r.stateNode===null){e:{x=r.type,m=r.memoizedProps,C=C.ownerDocument||C;t:switch(x){case"title":z=C.getElementsByTagName("title")[0],(!z||z[Qs]||z[Kt]||z.namespaceURI==="http://www.w3.org/2000/svg"||z.hasAttribute("itemprop"))&&(z=C.createElement(x),C.head.insertBefore(z,C.querySelector("head > title"))),Rr(z,x,m),z[Kt]=r,pi(z),x=z;break e;case"link":var H=ay("link","href",C).get(x+(m.href||""));if(H){for(var ie=0;ie<H.length;ie++)if(z=H[ie],z.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&z.getAttribute("rel")===(m.rel==null?null:m.rel)&&z.getAttribute("title")===(m.title==null?null:m.title)&&z.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){H.splice(ie,1);break t}}z=C.createElement(x),Rr(z,x,m),C.head.appendChild(z);break;case"meta":if(H=ay("meta","content",C).get(x+(m.content||""))){for(ie=0;ie<H.length;ie++)if(z=H[ie],z.getAttribute("content")===(m.content==null?null:""+m.content)&&z.getAttribute("name")===(m.name==null?null:m.name)&&z.getAttribute("property")===(m.property==null?null:m.property)&&z.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&z.getAttribute("charset")===(m.charSet==null?null:m.charSet)){H.splice(ie,1);break t}}z=C.createElement(x),Rr(z,x,m),C.head.appendChild(z);break;default:throw Error(l(468,x))}z[Kt]=r,pi(z),x=z}r.stateNode=x}else a(C,r.type,r.stateNode);else r.stateNode=bf(C,x,r.memoizedProps);else z!==x?(z===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):z.count--,x===null?a(C,r.type,r.stateNode):bf(C,x,r.memoizedProps)):x===null&&r.stateNode!==null&&Pm(r,r.memoizedProps,m.memoizedProps)}break;case 27:os(u,r),Ms(r),x&512&&(Cr||m===null||Ra(m,m.return)),m!==null&&x&4&&Pm(r,r.memoizedProps,m.memoizedProps);break;case 5:if(os(u,r),Ms(r),x&512&&(Cr||m===null||Ra(m,m.return)),r.flags&32){C=r.stateNode;try{es(C,"")}catch(it){zi(r,r.return,it)}}x&4&&r.stateNode!=null&&(C=r.memoizedProps,Pm(r,C,m!==null?m.memoizedProps:C)),x&1024&&(lp=!0);break;case 6:if(os(u,r),Ms(r),x&4){if(r.stateNode===null)throw Error(l(162));x=r.memoizedProps,m=r.stateNode;try{m.nodeValue=x}catch(it){zi(r,r.return,it)}}break;case 3:if(nd=null,C=Ma,Ma=Sp(u.containerInfo),os(u,r),Ma=C,Ms(r),x&4&&m!==null&&m.memoizedState.isDehydrated)try{_r(u.containerInfo)}catch(it){zi(r,r.return,it)}lp&&(lp=!1,R_(r));break;case 4:x=Ma,Ma=Sp(r.stateNode.containerInfo),os(u,r),Ms(r),Ma=x;break;case 12:os(u,r),Ms(r);break;case 13:os(u,r),Ms(r),r.child.flags&8192&&r.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(hp=br()),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,tf(r,x)));break;case 22:C=r.memoizedState!==null;var we=m!==null&&m.memoizedState!==null,Ke=ol,ct=Cr;if(ol=Ke||C,Cr=ct||we,os(u,r),Cr=ct,ol=Ke,Ms(r),x&8192)e:for(u=r.stateNode,u._visibility=C?u._visibility&-2:u._visibility|1,C&&(m===null||we||ol||Cr||oo(r)),m=null,u=r;;){if(u.tag===5||u.tag===26){if(m===null){we=m=u;try{if(z=we.stateNode,C)H=z.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none";else{ie=we.stateNode;var pt=we.memoizedProps.style,Qe=pt!=null&&pt.hasOwnProperty("display")?pt.display:null;ie.style.display=Qe==null||typeof Qe=="boolean"?"":(""+Qe).trim()}}catch(it){zi(we,we.return,it)}}}else if(u.tag===6){if(m===null){we=u;try{we.stateNode.nodeValue=C?"":we.memoizedProps}catch(it){zi(we,we.return,it)}}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===r)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===r)break e;for(;u.sibling===null;){if(u.return===null||u.return===r)break e;m===u&&(m=null),u=u.return}m===u&&(m=null),u.sibling.return=u.return,u=u.sibling}x&4&&(x=r.updateQueue,x!==null&&(m=x.retryQueue,m!==null&&(x.retryQueue=null,tf(r,m))));break;case 19:os(u,r),Ms(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,tf(r,x)));break;case 30:break;case 21:break;default:os(u,r),Ms(r)}}function Ms(r){var u=r.flags;if(u&2){try{for(var m,x=r.return;x!==null;){if(C_(x)){m=x;break}x=x.return}if(m==null)throw Error(l(160));switch(m.tag){case 27:var C=m.stateNode,z=Rm(r);op(r,z,C);break;case 5:var H=m.stateNode;m.flags&32&&(es(H,""),m.flags&=-33);var ie=Rm(r);op(r,ie,H);break;case 3:case 4:var we=m.stateNode.containerInfo,Ke=Rm(r);Mm(r,Ke,we);break;default:throw Error(l(161))}}catch(ct){zi(r,r.return,ct)}r.flags&=-3}u&4096&&(r.flags&=-4097)}function R_(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var u=r;R_(u),u.tag===5&&u.flags&1024&&u.stateNode.reset(),r=r.sibling}}function uc(r,u){if(u.subtreeFlags&8772)for(u=u.child;u!==null;)Gu(r,u.alternate,u),u=u.sibling}function oo(r){for(r=r.child;r!==null;){var u=r;switch(u.tag){case 0:case 11:case 14:case 15:Bl(4,u,u.return),oo(u);break;case 1:Ra(u,u.return);var m=u.stateNode;typeof m.componentWillUnmount=="function"&&Cm(u,u.return,m),oo(u);break;case 27:ru(u.stateNode);case 26:case 5:Ra(u,u.return),oo(u);break;case 22:u.memoizedState===null&&oo(u);break;case 30:oo(u);break;default:oo(u)}r=r.sibling}}function Qc(r,u,m){for(m=m&&(u.subtreeFlags&8772)!==0,u=u.child;u!==null;){var x=u.alternate,C=r,z=u,H=z.flags;switch(z.tag){case 0:case 11:case 15:Qc(C,z,m),Jd(4,z);break;case 1:if(Qc(C,z,m),x=z,C=x.stateNode,typeof C.componentDidMount=="function")try{C.componentDidMount()}catch(Ke){zi(x,x.return,Ke)}if(x=z,C=x.updateQueue,C!==null){var ie=x.stateNode;try{var we=C.shared.hiddenCallbacks;if(we!==null)for(C.shared.hiddenCallbacks=null,C=0;C<we.length;C++)Dh(we[C],ie)}catch(Ke){zi(x,x.return,Ke)}}m&&H&64&&ap(z),al(z,z.return);break;case 27:P_(z);case 26:case 5:Qc(C,z,m),m&&x===null&&H&4&&I_(z),al(z,z.return);break;case 12:Qc(C,z,m);break;case 13:Qc(C,z,m),m&&H&4&&Om(C,z);break;case 22:z.memoizedState===null&&Qc(C,z,m),al(z,z.return);break;case 30:break;default:Qc(C,z,m)}u=u.sibling}}function cp(r,u){var m=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(m=r.memoizedState.cachePool.pool),r=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(r=u.memoizedState.cachePool.pool),r!==m&&(r!=null&&r.refCount++,m!=null&&Ql(m))}function Zu(r,u){r=null,u.alternate!==null&&(r=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==r&&(u.refCount++,r!=null&&Ql(r))}function ko(r,u,m,x){if(u.subtreeFlags&10256)for(u=u.child;u!==null;)zm(r,u,m,x),u=u.sibling}function zm(r,u,m,x){var C=u.flags;switch(u.tag){case 0:case 11:case 15:ko(r,u,m,x),C&2048&&Jd(9,u);break;case 1:ko(r,u,m,x);break;case 3:ko(r,u,m,x),C&2048&&(r=null,u.alternate!==null&&(r=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==r&&(u.refCount++,r!=null&&Ql(r)));break;case 12:if(C&2048){ko(r,u,m,x),r=u.stateNode;try{var z=u.memoizedProps,H=z.id,ie=z.onPostCommit;typeof ie=="function"&&ie(H,u.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(we){zi(u,u.return,we)}}else ko(r,u,m,x);break;case 13:ko(r,u,m,x);break;case 23:break;case 22:z=u.stateNode,H=u.alternate,u.memoizedState!==null?z._visibility&2?ko(r,u,m,x):nf(r,u):z._visibility&2?ko(r,u,m,x):(z._visibility|=2,Wu(r,u,m,x,(u.subtreeFlags&10256)!==0)),C&2048&&cp(H,u);break;case 24:ko(r,u,m,x),C&2048&&Zu(u.alternate,u);break;default:ko(r,u,m,x)}}function Wu(r,u,m,x,C){for(C=C&&(u.subtreeFlags&10256)!==0,u=u.child;u!==null;){var z=r,H=u,ie=m,we=x,Ke=H.flags;switch(H.tag){case 0:case 11:case 15:Wu(z,H,ie,we,C),Jd(8,H);break;case 23:break;case 22:var ct=H.stateNode;H.memoizedState!==null?ct._visibility&2?Wu(z,H,ie,we,C):nf(z,H):(ct._visibility|=2,Wu(z,H,ie,we,C)),C&&Ke&2048&&cp(H.alternate,H);break;case 24:Wu(z,H,ie,we,C),C&&Ke&2048&&Zu(H.alternate,H);break;default:Wu(z,H,ie,we,C)}u=u.sibling}}function nf(r,u){if(u.subtreeFlags&10256)for(u=u.child;u!==null;){var m=r,x=u,C=x.flags;switch(x.tag){case 22:nf(m,x),C&2048&&cp(x.alternate,x);break;case 24:nf(m,x),C&2048&&Zu(x.alternate,x);break;default:nf(m,x)}u=u.sibling}}var rf=8192;function Fh(r){if(r.subtreeFlags&rf)for(r=r.child;r!==null;)M_(r),r=r.sibling}function M_(r){switch(r.tag){case 26:Fh(r),r.flags&rf&&r.memoizedState!==null&&w(Ma,r.memoizedState,r.memoizedProps);break;case 5:Fh(r);break;case 3:case 4:var u=Ma;Ma=Sp(r.stateNode.containerInfo),Fh(r),Ma=u;break;case 22:r.memoizedState===null&&(u=r.alternate,u!==null&&u.memoizedState!==null?(u=rf,rf=16777216,Fh(r),rf=u):Fh(r));break;default:Fh(r)}}function k_(r){var u=r.alternate;if(u!==null&&(r=u.child,r!==null)){u.child=null;do u=r.sibling,r.sibling=null,r=u;while(r!==null)}}function Vl(r){var u=r.deletions;if((r.flags&16)!==0){if(u!==null)for(var m=0;m<u.length;m++){var x=u[m];as=x,Lm(x,r)}k_(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)D_(r),r=r.sibling}function D_(r){switch(r.tag){case 0:case 11:case 15:Vl(r),r.flags&2048&&Bl(9,r,r.return);break;case 3:Vl(r);break;case 12:Vl(r);break;case 22:var u=r.stateNode;r.memoizedState!==null&&u._visibility&2&&(r.return===null||r.return.tag!==13)?(u._visibility&=-3,up(r)):Vl(r);break;default:Vl(r)}}function up(r){var u=r.deletions;if((r.flags&16)!==0){if(u!==null)for(var m=0;m<u.length;m++){var x=u[m];as=x,Lm(x,r)}k_(r)}for(r=r.child;r!==null;){switch(u=r,u.tag){case 0:case 11:case 15:Bl(8,u,u.return),up(u);break;case 22:m=u.stateNode,m._visibility&2&&(m._visibility&=-3,up(u));break;default:up(u)}r=r.sibling}}function Lm(r,u){for(;as!==null;){var m=as;switch(m.tag){case 0:case 11:case 15:Bl(8,m,u);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var x=m.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:Ql(m.memoizedState.cache)}if(x=m.child,x!==null)x.return=m,as=x;else e:for(m=r;as!==null;){x=as;var C=x.sibling,z=x.return;if(km(x),x===m){as=null;break e}if(C!==null){C.return=z,as=C;break e}as=z}}}var Cv={getCacheForType:function(r){var u=hr(Sr),m=u.data.get(r);return m===void 0&&(m=r(),u.data.set(r,m)),m}},O_=typeof WeakMap=="function"?WeakMap:Map,Si=0,Oi=null,zn=null,Gn=0,Ei=0,lo=null,hc=!1,Ku=!1,Nm=!1,dc=0,Zi=0,fc=0,Xu=0,Bm=0,Do=0,$h=0,sf=null,da=null,af=!1,hp=0,of=1/0,lf=null,Jc=null,Fr=0,eu=null,Yu=null,qh=0,Vm=0,jm=null,Um=null,cf=0,Fm=null;function ks(){if((Si&2)!==0&&Gn!==0)return Gn&-Gn;if(st.T!==null){var r=Ko;return r!==0?r:pf()}return vi()}function Pr(){Do===0&&(Do=(Gn&536870912)===0||Hn?mt():536870912);var r=tr.current;return r!==null&&(r.flags|=32),Do}function fa(r,u,m){(r===Oi&&(Ei===2||Ei===9)||r.cancelPendingCommit!==null)&&(Gh(r,0),co(r,Gn,Do,!1)),Re(r,m),((Si&2)===0||r!==Oi)&&(r===Oi&&((Si&2)===0&&(Xu|=m),Zi===4&&co(r,Gn,Do,!1)),ll(r))}function $m(r,u,m){if((Si&6)!==0)throw Error(l(327));var x=!m&&(u&124)===0&&(u&r.expiredLanes)===0||Le(r,u),C=x?Rv(r,u):Wm(r,u,!0),z=x;do{if(C===0){Ku&&!x&&co(r,u,0,!1);break}else{if(m=r.current.alternate,z&&!Gm(m)){C=Wm(r,u,!1),z=!1;continue}if(C===2){if(z=u,r.errorRecoveryDisabledLanes&z)var H=0;else H=r.pendingLanes&-536870913,H=H!==0?H:H&536870912?536870912:0;if(H!==0){u=H;e:{var ie=r;C=sf;var we=ie.current.memoizedState.isDehydrated;if(we&&(Gh(ie,H).flags|=256),H=Wm(ie,H,!1),H!==2){if(Nm&&!we){ie.errorRecoveryDisabledLanes|=z,Xu|=z,C=4;break e}z=da,da=C,z!==null&&(da===null?da=z:da.push.apply(da,z))}C=H}if(z=!1,C!==2)continue}}if(C===1){Gh(r,0),co(r,u,0,!0);break}e:{switch(x=r,z=C,z){case 0:case 1:throw Error(l(345));case 4:if((u&4194048)!==u)break;case 6:co(x,u,Do,!hc);break e;case 2:da=null;break;case 3:case 5:break;default:throw Error(l(329))}if((u&62914560)===u&&(C=hp+300-br(),10<C)){if(co(x,u,Do,!hc),Fe(x,0,!0)!==0)break e;x.timeoutHandle=dg(qm.bind(null,x,m,da,lf,af,u,Do,Xu,$h,hc,z,2,-0,0),C);break e}qm(x,m,da,lf,af,u,Do,Xu,$h,hc,z,0,-0,0)}}break}while(!0);ll(r)}function qm(r,u,m,x,C,z,H,ie,we,Ke,ct,pt,Qe,it){if(r.timeoutHandle=-1,pt=u.subtreeFlags,(pt&8192||(pt&16785408)===16785408)&&(d={stylesheets:null,count:0,unsuspend:g},M_(u),pt=S(),pt!==null)){r.cancelPendingCommit=pt(pc.bind(null,r,u,z,m,x,C,H,ie,we,ct,1,Qe,it)),co(r,z,H,!Ke);return}pc(r,u,z,m,x,C,H,ie,we)}function Gm(r){for(var u=r;;){var m=u.tag;if((m===0||m===11||m===15)&&u.flags&16384&&(m=u.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var x=0;x<m.length;x++){var C=m[x],z=C.getSnapshot;C=C.value;try{if(!vs(z(),C))return!1}catch{return!1}}if(m=u.child,u.subtreeFlags&16384&&m!==null)m.return=u,u=m;else{if(u===r)break;for(;u.sibling===null;){if(u.return===null||u.return===r)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function co(r,u,m,x){u&=~Bm,u&=~Xu,r.suspendedLanes|=u,r.pingedLanes&=~u,x&&(r.warmLanes|=u),x=r.expirationTimes;for(var C=u;0<C;){var z=31-Pe(C),H=1<<z;x[z]=-1,C&=~H}m!==0&&_n(r,m,u)}function uf(){return(Si&6)===0?(Kh(0),!1):!0}function Hm(){if(zn!==null){if(Ei===0)var r=zn.return;else r=zn,ws=Wo=null,Wc(r),Zn=null,Ui=0,r=zn;for(;r!==null;)A_(r.alternate,r),r=r.return;zn=null}}function Gh(r,u){var m=r.timeoutHandle;m!==-1&&(r.timeoutHandle=-1,X_(m)),m=r.cancelPendingCommit,m!==null&&(r.cancelPendingCommit=null,m()),Hm(),Oi=r,zn=m=is(r.current,null),Gn=u,Ei=0,lo=null,hc=!1,Ku=Le(r,u),Nm=!1,$h=Do=Bm=Xu=fc=Zi=0,da=sf=null,af=!1,(u&8)!==0&&(u|=u&32);var x=r.entangledLanes;if(x!==0)for(r=r.entanglements,x&=u;0<x;){var C=31-Pe(x),z=1<<C;u|=r[C],x&=~z}return dc=u,Yl(),m}function z_(r,u){Pn=null,st.H=jr,u===$c||u===Es?(u=tc(),Ei=3):u===Dl?(u=tc(),Ei=4):Ei=u===g_?8:u!==null&&typeof u=="object"&&typeof u.then=="function"?6:1,lo=u,zn===null&&(Zi=1,Bh(r,Nr(u,r.current)))}function L_(){var r=st.H;return st.H=jr,r===null?jr:r}function N_(){var r=st.A;return st.A=Cv,r}function Zm(){Zi=4,hc||(Gn&4194048)!==Gn&&tr.current!==null||(Ku=!0),(fc&134217727)===0&&(Xu&134217727)===0||Oi===null||co(Oi,Gn,Do,!1)}function Wm(r,u,m){var x=Si;Si|=2;var C=L_(),z=N_();(Oi!==r||Gn!==u)&&(lf=null,Gh(r,u)),u=!1;var H=Zi;e:do try{if(Ei!==0&&zn!==null){var ie=zn,we=lo;switch(Ei){case 8:Hm(),H=6;break e;case 3:case 2:case 9:case 6:tr.current===null&&(u=!0);var Ke=Ei;if(Ei=0,lo=null,Qu(r,ie,we,Ke),m&&Ku){H=0;break e}break;default:Ke=Ei,Ei=0,lo=null,Qu(r,ie,we,Ke)}}Pv(),H=Zi;break}catch(ct){z_(r,ct)}while(!0);return u&&r.shellSuspendCounter++,ws=Wo=null,Si=x,st.H=C,st.A=z,zn===null&&(Oi=null,Gn=0,Yl()),H}function Pv(){for(;zn!==null;)B_(zn)}function Rv(r,u){var m=Si;Si|=2;var x=L_(),C=N_();Oi!==r||Gn!==u?(lf=null,of=br()+500,Gh(r,u)):Ku=Le(r,u);e:do try{if(Ei!==0&&zn!==null){u=zn;var z=lo;t:switch(Ei){case 1:Ei=0,lo=null,Qu(r,u,z,1);break;case 2:case 9:if(Ch(z)){Ei=0,lo=null,V_(u);break}u=function(){Ei!==2&&Ei!==9||Oi!==r||(Ei=7),ll(r)},z.then(u,u);break e;case 3:Ei=7;break e;case 4:Ei=5;break e;case 7:Ch(z)?(Ei=0,lo=null,V_(u)):(Ei=0,lo=null,Qu(r,u,z,7));break;case 5:var H=null;switch(zn.tag){case 26:H=zn.memoizedState;case 5:case 27:var ie=zn;if(!H||s(H)){Ei=0,lo=null;var we=ie.sibling;if(we!==null)zn=we;else{var Ke=ie.return;Ke!==null?(zn=Ke,Hh(Ke)):zn=null}break t}}Ei=0,lo=null,Qu(r,u,z,5);break;case 6:Ei=0,lo=null,Qu(r,u,z,6);break;case 8:Hm(),Zi=6;break e;default:throw Error(l(462))}}Mv();break}catch(ct){z_(r,ct)}while(!0);return ws=Wo=null,st.H=x,st.A=C,Si=m,zn!==null?0:(Oi=null,Gn=0,Yl(),Zi)}function Mv(){for(;zn!==null&&!Xs();)B_(zn)}function B_(r){var u=S_(r.alternate,r,dc);r.memoizedProps=r.pendingProps,u===null?Hh(r):zn=u}function V_(r){var u=r,m=u.alternate;switch(u.tag){case 15:case 0:u=wm(m,u,u.pendingProps,u.type,void 0,Gn);break;case 11:u=wm(m,u,u.pendingProps,u.type.render,u.ref,Gn);break;case 5:Wc(u);default:A_(m,u),u=zn=zd(u,dc),u=S_(m,u,dc)}r.memoizedProps=r.pendingProps,u===null?Hh(r):zn=u}function Qu(r,u,m,x){ws=Wo=null,Wc(u),Zn=null,Ui=0;var C=u.return;try{if(Vh(r,C,u,m,Gn)){Zi=1,Bh(r,Nr(m,r.current)),zn=null;return}}catch(z){if(C!==null)throw zn=C,z;Zi=1,Bh(r,Nr(m,r.current)),zn=null;return}u.flags&32768?(Hn||x===1?r=!0:Ku||(Gn&536870912)!==0?r=!1:(hc=r=!0,(x===2||x===9||x===3||x===6)&&(x=tr.current,x!==null&&x.tag===13&&(x.flags|=16384))),Km(u,r)):Hh(u)}function Hh(r){var u=r;do{if((u.flags&32768)!==0){Km(u,hc);return}r=u.return;var m=E_(u.alternate,u,dc);if(m!==null){zn=m;return}if(u=u.sibling,u!==null){zn=u;return}zn=u=r}while(u!==null);Zi===0&&(Zi=5)}function Km(r,u){do{var m=Iv(r.alternate,r);if(m!==null){m.flags&=32767,zn=m;return}if(m=r.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!u&&(r=r.sibling,r!==null)){zn=r;return}zn=r=m}while(r!==null);Zi=6,zn=null}function pc(r,u,m,x,C,z,H,ie,we){r.cancelPendingCommit=null;do dp();while(Fr!==0);if((Si&6)!==0)throw Error(l(327));if(u!==null){if(u===r.current)throw Error(l(177));if(z=u.lanes|u.childLanes,z|=Xl,nn(r,m,z,H,ie,we),r===Oi&&(zn=Oi=null,Gn=0),Yu=u,eu=r,qh=m,Vm=z,jm=C,Um=x,(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,kv(Yr,function(){return j_(),null})):(r.callbackNode=null,r.callbackPriority=0),x=(u.flags&13878)!==0,(u.subtreeFlags&13878)!==0||x){x=st.T,st.T=null,C=kt.p,kt.p=2,H=Si,Si|=4;try{mr(r,u,m)}finally{Si=H,kt.p=C,st.T=x}}Fr=1,Zh(),Ju(),hf()}}function Zh(){if(Fr===1){Fr=0;var r=eu,u=Yu,m=(u.flags&13878)!==0;if((u.subtreeFlags&13878)!==0||m){m=st.T,st.T=null;var x=kt.p;kt.p=2;var C=Si;Si|=4;try{Hu(u,r);var z=xp,H=yh(r.containerInfo),ie=z.focusedElem,we=z.selectionRange;if(H!==ie&&ie&&ie.ownerDocument&&Un(ie.ownerDocument.documentElement,ie)){if(we!==null&&Cu(ie)){var Ke=we.start,ct=we.end;if(ct===void 0&&(ct=Ke),"selectionStart"in ie)ie.selectionStart=Ke,ie.selectionEnd=Math.min(ct,ie.value.length);else{var pt=ie.ownerDocument||document,Qe=pt&&pt.defaultView||window;if(Qe.getSelection){var it=Qe.getSelection(),bn=ie.textContent.length,hn=Math.min(we.start,bn),Ci=we.end===void 0?hn:Math.min(we.end,bn);!it.extend&&hn>Ci&&(H=Ci,Ci=hn,hn=H);var Ue=So(ie,hn),Be=So(ie,Ci);if(Ue&&Be&&(it.rangeCount!==1||it.anchorNode!==Ue.node||it.anchorOffset!==Ue.offset||it.focusNode!==Be.node||it.focusOffset!==Be.offset)){var qe=pt.createRange();qe.setStart(Ue.node,Ue.offset),it.removeAllRanges(),hn>Ci?(it.addRange(qe),it.extend(Be.node,Be.offset)):(qe.setEnd(Be.node,Be.offset),it.addRange(qe))}}}}for(pt=[],it=ie;it=it.parentNode;)it.nodeType===1&&pt.push({element:it,left:it.scrollLeft,top:it.scrollTop});for(typeof ie.focus=="function"&&ie.focus(),ie=0;ie<pt.length;ie++){var ft=pt[ie];ft.element.scrollLeft=ft.left,ft.element.scrollTop=ft.top}}_e=!!yf,xp=yf=null}finally{Si=C,kt.p=x,st.T=m}}r.current=u,Fr=2}}function Ju(){if(Fr===2){Fr=0;var r=eu,u=Yu,m=(u.flags&8772)!==0;if((u.subtreeFlags&8772)!==0||m){m=st.T,st.T=null;var x=kt.p;kt.p=2;var C=Si;Si|=4;try{Gu(r,u.alternate,u)}finally{Si=C,kt.p=x,st.T=m}}Fr=3}}function hf(){if(Fr===4||Fr===3){Fr=0,Ls();var r=eu,u=Yu,m=qh,x=Um;(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?Fr=5:(Fr=0,Yu=eu=null,df(r,r.pendingLanes));var C=r.pendingLanes;if(C===0&&(Jc=null),Yn(m),u=u.stateNode,Ki&&typeof Ki.onCommitFiberRoot=="function")try{Ki.onCommitFiberRoot(gs,u,void 0,(u.current.flags&128)===128)}catch{}if(x!==null){u=st.T,C=kt.p,kt.p=2,st.T=null;try{for(var z=r.onRecoverableError,H=0;H<x.length;H++){var ie=x[H];z(ie.value,{componentStack:ie.stack})}}finally{st.T=u,kt.p=C}}(qh&3)!==0&&dp(),ll(r),C=r.pendingLanes,(m&4194090)!==0&&(C&42)!==0?r===Fm?cf++:(cf=0,Fm=r):cf=0,Kh(0)}}function df(r,u){(r.pooledCacheLanes&=u)===0&&(u=r.pooledCache,u!=null&&(r.pooledCache=null,Ql(u)))}function dp(r){return Zh(),Ju(),hf(),j_()}function j_(){if(Fr!==5)return!1;var r=eu,u=Vm;Vm=0;var m=Yn(qh),x=st.T,C=kt.p;try{kt.p=32>m?32:m,st.T=null,m=jm,jm=null;var z=eu,H=qh;if(Fr=0,Yu=eu=null,qh=0,(Si&6)!==0)throw Error(l(331));var ie=Si;if(Si|=4,D_(z.current),zm(z,z.current,H,m),Si=ie,Kh(0,!1),Ki&&typeof Ki.onPostCommitFiberRoot=="function")try{Ki.onPostCommitFiberRoot(gs,z)}catch{}return!0}finally{kt.p=C,st.T=x,df(r,u)}}function Xm(r,u,m){u=Nr(m,u),u=Hd(r.stateNode,u,2),r=Xo(r,u,2),r!==null&&(Re(r,2),ll(r))}function zi(r,u,m){if(r.tag===3)Xm(r,r,m);else for(;u!==null;){if(u.tag===3){Xm(u,r,m);break}else if(u.tag===1){var x=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Jc===null||!Jc.has(x))){r=Nr(m,r),m=bm(2),x=Xo(u,m,2),x!==null&&(xm(m,x,u,r),Re(x,2),ll(x));break}}u=u.return}}function Ym(r,u,m){var x=r.pingCache;if(x===null){x=r.pingCache=new O_;var C=new Set;x.set(u,C)}else C=x.get(u),C===void 0&&(C=new Set,x.set(u,C));C.has(m)||(Nm=!0,C.add(m),r=U_.bind(null,r,u,m),u.then(r,r))}function U_(r,u,m){var x=r.pingCache;x!==null&&x.delete(u),r.pingedLanes|=r.suspendedLanes&m,r.warmLanes&=~m,Oi===r&&(Gn&m)===m&&(Zi===4||Zi===3&&(Gn&62914560)===Gn&&300>br()-hp?(Si&2)===0&&Gh(r,0):Bm|=m,$h===Gn&&($h=0)),ll(r)}function Qm(r,u){u===0&&(u=ot()),r=oa(r,u),r!==null&&(Re(r,u),ll(r))}function Jm(r){var u=r.memoizedState,m=0;u!==null&&(m=u.retryLane),Qm(r,m)}function eg(r,u){var m=0;switch(r.tag){case 13:var x=r.stateNode,C=r.memoizedState;C!==null&&(m=C.retryLane);break;case 19:x=r.stateNode;break;case 22:x=r.stateNode._retryCache;break;default:throw Error(l(314))}x!==null&&x.delete(u),Qm(r,m)}function kv(r,u){return hi(r,u)}var ff=null,Wh=null,tg=!1,fp=!1,ng=!1,eh=0;function ll(r){r!==Wh&&r.next===null&&(Wh===null?ff=Wh=r:Wh=Wh.next=r),fp=!0,tg||(tg=!0,mp())}function Kh(r,u){if(!ng&&fp){ng=!0;do for(var m=!1,x=ff;x!==null;){if(r!==0){var C=x.pendingLanes;if(C===0)var z=0;else{var H=x.suspendedLanes,ie=x.pingedLanes;z=(1<<31-Pe(42|r)+1)-1,z&=C&~(H&~ie),z=z&201326741?z&201326741|1:z?z|2:0}z!==0&&(m=!0,F_(x,z))}else z=Gn,z=Fe(x,x===Oi?z:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(z&3)===0||Le(x,z)||(m=!0,F_(x,z));x=x.next}while(m);ng=!1}}function mc(){gc()}function gc(){fp=tg=!1;var r=0;eh!==0&&(K_()&&(r=eh),eh=0);for(var u=br(),m=null,x=ff;x!==null;){var C=x.next,z=ig(x,u);z===0?(x.next=null,m===null?ff=C:m.next=C,C===null&&(Wh=m)):(m=x,(r!==0||(z&3)!==0)&&(fp=!0)),x=C}Kh(r)}function ig(r,u){for(var m=r.suspendedLanes,x=r.pingedLanes,C=r.expirationTimes,z=r.pendingLanes&-62914561;0<z;){var H=31-Pe(z),ie=1<<H,we=C[H];we===-1?((ie&m)===0||(ie&x)!==0)&&(C[H]=nt(ie,u)):we<=u&&(r.expiredLanes|=ie),z&=~ie}if(u=Oi,m=Gn,m=Fe(r,r===u?m:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x=r.callbackNode,m===0||r===u&&(Ei===2||Ei===9)||r.cancelPendingCommit!==null)return x!==null&&x!==null&&Pi(x),r.callbackNode=null,r.callbackPriority=0;if((m&3)===0||Le(r,m)){if(u=m&-m,u===r.callbackPriority)return u;switch(x!==null&&Pi(x),Yn(m)){case 2:case 8:m=Wi;break;case 32:m=Yr;break;case 268435456:m=xa;break;default:m=Yr}return x=pp.bind(null,r),m=hi(m,x),r.callbackPriority=u,r.callbackNode=m,u}return x!==null&&x!==null&&Pi(x),r.callbackPriority=2,r.callbackNode=null,2}function pp(r,u){if(Fr!==0&&Fr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var m=r.callbackNode;if(dp()&&r.callbackNode!==m)return null;var x=Gn;return x=Fe(r,r===Oi?x:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x===0?null:($m(r,x,u),ig(r,br()),r.callbackNode!=null&&r.callbackNode===m?pp.bind(null,r):null)}function F_(r,u){if(dp())return null;$m(r,u,!0)}function mp(){Q_(function(){(Si&6)!==0?hi(di,mc):gc()})}function pf(){return eh===0&&(eh=mt()),eh}function $_(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:on(""+r)}function gp(r,u){var m=u.ownerDocument.createElement("input");return m.name=u.name,m.value=u.value,r.id&&m.setAttribute("form",r.id),u.parentNode.insertBefore(m,u),r=new FormData(r),m.parentNode.removeChild(m),r}function rg(r,u,m,x,C){if(u==="submit"&&m&&m.stateNode===C){var z=$_((C[rn]||null).action),H=x.submitter;H&&(u=(u=H[rn]||null)?$_(u.formAction):H.getAttribute("formAction"),u!==null&&(z=u,H=null));var ie=new ns("action","action",null,x,C);r.push({event:ie,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(eh!==0){var we=H?gp(C,H):new FormData(C);Ti(m,{pending:!0,data:we,method:C.method,action:z},null,we)}}else typeof z=="function"&&(ie.preventDefault(),we=H?gp(C,H):new FormData(C),Ti(m,{pending:!0,data:we,method:C.method,action:z},z,we))},currentTarget:C}]})}}for(var tu=0;tu<bh.length;tu++){var _p=bh[tu],q_=_p.toLowerCase(),sg=_p[0].toUpperCase()+_p.slice(1);Ia(q_,"on"+sg)}Ia(Pu,"onAnimationEnd"),Ia(Ru,"onAnimationIteration"),Ia(Mu,"onAnimationStart"),Ia("dblclick","onDoubleClick"),Ia("focusin","onFocus"),Ia("focusout","onBlur"),Ia(Dd,"onTransitionRun"),Ia(Wl,"onTransitionStart"),Ia(ku,"onTransitionCancel"),Ia(Kl,"onTransitionEnd"),Js("onMouseEnter",["mouseout","mouseover"]),Js("onMouseLeave",["mouseout","mouseover"]),Js("onPointerEnter",["pointerout","pointerover"]),Js("onPointerLeave",["pointerout","pointerover"]),Gr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xh));function ag(r,u){u=(u&4)!==0;for(var m=0;m<r.length;m++){var x=r[m],C=x.event;x=x.listeners;e:{var z=void 0;if(u)for(var H=x.length-1;0<=H;H--){var ie=x[H],we=ie.instance,Ke=ie.currentTarget;if(ie=ie.listener,we!==z&&C.isPropagationStopped())break e;z=ie,C.currentTarget=Ke;try{z(C)}catch(ct){qd(ct)}C.currentTarget=null,z=we}else for(H=0;H<x.length;H++){if(ie=x[H],we=ie.instance,Ke=ie.currentTarget,ie=ie.listener,we!==z&&C.isPropagationStopped())break e;z=ie,C.currentTarget=Ke;try{z(C)}catch(ct){qd(ct)}C.currentTarget=null,z=we}}}}function $n(r,u){var m=u[yt];m===void 0&&(m=u[yt]=new Set);var x=r+"__bubble";m.has(x)||(G_(u,r,2,!1),m.add(x))}function og(r,u,m){var x=0;u&&(x|=4),G_(m,r,x,u)}var mf="_reactListening"+Math.random().toString(36).slice(2);function lg(r){if(!r[mf]){r[mf]=!0,pn.forEach(function(m){m!=="selectionchange"&&(yp.has(m)||og(m,!1,r),og(m,!0,r))});var u=r.nodeType===9?r:r.ownerDocument;u===null||u[mf]||(u[mf]=!0,og("selectionchange",!1,u))}}function G_(r,u,m,x){switch(Ct(u)){case 2:var C=Ae;break;case 8:C=Ze;break;default:C=et}m=C.bind(null,u,m,r),C=void 0,!Xi||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(C=!0),x?C!==void 0?r.addEventListener(u,m,{capture:!0,passive:C}):r.addEventListener(u,m,!0):C!==void 0?r.addEventListener(u,m,{passive:C}):r.addEventListener(u,m,!1)}function cg(r,u,m,x,C){var z=x;if((u&1)===0&&(u&2)===0&&x!==null)e:for(;;){if(x===null)return;var H=x.tag;if(H===3||H===4){var ie=x.stateNode.containerInfo;if(ie===C)break;if(H===4)for(H=x.return;H!==null;){var we=H.tag;if((we===3||we===4)&&H.stateNode.containerInfo===C)return;H=H.return}for(;ie!==null;){if(H=un(ie),H===null)return;if(we=H.tag,we===5||we===6||we===26||we===27){x=z=H;continue e}ie=ie.parentNode}}x=x.return}Ri(function(){var Ke=z,ct=gl(m),pt=[];e:{var Qe=aa.get(r);if(Qe!==void 0){var it=ns,bn=r;switch(r){case"keypress":if(an(m)===0)break e;case"keydown":case"keyup":it=To;break;case"focusin":bn="focus",it=bo;break;case"focusout":bn="blur",it=bo;break;case"beforeblur":case"afterblur":it=bo;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":it=vo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":it=ur;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":it=xl;break;case Pu:case Ru:case Mu:it=Mi;break;case Kl:it=U;break;case"scroll":case"scrollend":it=Uo;break;case"wheel":it=le;break;case"copy":case"cut":case"paste":it=_l;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":it=Rc;break;case"toggle":case"beforetoggle":it=tt}var hn=(u&4)!==0,Ci=!hn&&(r==="scroll"||r==="scrollend"),Ue=hn?Qe!==null?Qe+"Capture":null:Qe;hn=[];for(var Be=Ke,qe;Be!==null;){var ft=Be;if(qe=ft.stateNode,ft=ft.tag,ft!==5&&ft!==26&&ft!==27||qe===null||Ue===null||(ft=Vn(Be,Ue),ft!=null&&hn.push(gf(Be,ft,qe))),Ci)break;Be=Be.return}0<hn.length&&(Qe=new it(Qe,bn,null,m,ct),pt.push({event:Qe,listeners:hn}))}}if((u&7)===0){e:{if(Qe=r==="mouseover"||r==="pointerover",it=r==="mouseout"||r==="pointerout",Qe&&m!==Ua&&(bn=m.relatedTarget||m.fromElement)&&(un(bn)||bn[fi]))break e;if((it||Qe)&&(Qe=ct.window===ct?ct:(Qe=ct.ownerDocument)?Qe.defaultView||Qe.parentWindow:window,it?(bn=m.relatedTarget||m.toElement,it=Ke,bn=bn?un(bn):null,bn!==null&&(Ci=v(bn),hn=bn.tag,bn!==Ci||hn!==5&&hn!==27&&hn!==6)&&(bn=null)):(it=null,bn=Ke),it!==bn)){if(hn=vo,ft="onMouseLeave",Ue="onMouseEnter",Be="mouse",(r==="pointerout"||r==="pointerover")&&(hn=Rc,ft="onPointerLeave",Ue="onPointerEnter",Be="pointer"),Ci=it==null?Qe:$i(it),qe=bn==null?Qe:$i(bn),Qe=new hn(ft,Be+"leave",it,m,ct),Qe.target=Ci,Qe.relatedTarget=qe,ft=null,un(ct)===Ke&&(hn=new hn(Ue,Be+"enter",bn,m,ct),hn.target=qe,hn.relatedTarget=Ci,ft=hn),Ci=ft,it&&bn)t:{for(hn=it,Ue=bn,Be=0,qe=hn;qe;qe=nu(qe))Be++;for(qe=0,ft=Ue;ft;ft=nu(ft))qe++;for(;0<Be-qe;)hn=nu(hn),Be--;for(;0<qe-Be;)Ue=nu(Ue),qe--;for(;Be--;){if(hn===Ue||Ue!==null&&hn===Ue.alternate)break t;hn=nu(hn),Ue=nu(Ue)}hn=null}else hn=null;it!==null&&_c(pt,Qe,it,hn,!1),bn!==null&&Ci!==null&&_c(pt,Ci,bn,hn,!0)}}e:{if(Qe=Ke?$i(Ke):window,it=Qe.nodeName&&Qe.nodeName.toLowerCase(),it==="select"||it==="input"&&Qe.type==="file")var Gt=Rd;else if(Wf(Qe))if(wl)Gt=Qf;else{Gt=_m;var Bn=Xf}else it=Qe.nodeName,!it||it.toLowerCase()!=="input"||Qe.type!=="checkbox"&&Qe.type!=="radio"?Ke&&na(Ke.elementType)&&(Gt=Rd):Gt=Yf;if(Gt&&(Gt=Gt(r,Ke))){Pd(pt,Gt,m,ct);break e}Bn&&Bn(r,Qe,Ke),r==="focusout"&&Ke&&Qe.type==="number"&&Ke.memoizedProps.value!=null&&$l(Qe,"number",Qe.value)}switch(Bn=Ke?$i(Ke):window,r){case"focusin":(Wf(Bn)||Bn.contentEditable==="true")&&(Tl=Bn,$o=Ke,Hl=null);break;case"focusout":Hl=$o=Tl=null;break;case"mousedown":kd=!0;break;case"contextmenu":case"mouseup":case"dragend":kd=!1,ep(pt,m,ct);break;case"selectionchange":if(Jf)break;case"keydown":case"keyup":ep(pt,m,ct)}var tn;if(yn)e:{switch(r){case"compositionstart":var mn="onCompositionStart";break e;case"compositionend":mn="onCompositionEnd";break e;case"compositionupdate":mn="onCompositionUpdate";break e}mn=void 0}else Ha?Ga(r,m)&&(mn="onCompositionEnd"):r==="keydown"&&m.keyCode===229&&(mn="onCompositionStart");mn&&(qi&&m.locale!=="ko"&&(Ha||mn!=="onCompositionStart"?mn==="onCompositionEnd"&&Ha&&(tn=Qt()):(xi=ct,ln="value"in xi?xi.value:xi.textContent,Ha=!0)),Bn=vp(Ke,mn),0<Bn.length&&(mn=new Tu(mn,r,null,m,ct),pt.push({event:mn,listeners:Bn}),tn?mn.data=tn:(tn=js(m),tn!==null&&(mn.data=tn)))),(tn=ai?Za(r,m):Zf(r,m))&&(mn=vp(Ke,"onBeforeInput"),0<mn.length&&(Bn=new Tu("onBeforeInput","beforeinput",null,m,ct),pt.push({event:Bn,listeners:mn}),Bn.data=tn)),rg(pt,r,Ke,m,ct)}ag(pt,u)})}function gf(r,u,m){return{instance:r,listener:u,currentTarget:m}}function vp(r,u){for(var m=u+"Capture",x=[];r!==null;){var C=r,z=C.stateNode;if(C=C.tag,C!==5&&C!==26&&C!==27||z===null||(C=Vn(r,m),C!=null&&x.unshift(gf(r,C,z)),C=Vn(r,u),C!=null&&x.push(gf(r,C,z))),r.tag===3)return x;r=r.return}return[]}function nu(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function _c(r,u,m,x,C){for(var z=u._reactName,H=[];m!==null&&m!==x;){var ie=m,we=ie.alternate,Ke=ie.stateNode;if(ie=ie.tag,we!==null&&we===x)break;ie!==5&&ie!==26&&ie!==27||Ke===null||(we=Ke,C?(Ke=Vn(m,z),Ke!=null&&H.unshift(gf(m,Ke,we))):C||(Ke=Vn(m,z),Ke!=null&&H.push(gf(m,Ke,we)))),m=m.return}H.length!==0&&r.push({event:u,listeners:H})}var H_=/\r\n?/g,Z_=/\u0000|\uFFFD/g;function ug(r){return(typeof r=="string"?r:""+r).replace(H_,`
`).replace(Z_,"")}function hg(r,u){return u=ug(u),ug(r)===u}function _f(){}function yi(r,u,m,x,C,z){switch(m){case"children":typeof x=="string"?u==="body"||u==="textarea"&&x===""||es(r,x):(typeof x=="number"||typeof x=="bigint")&&u!=="body"&&es(r,""+x);break;case"className":qn(r,"class",x);break;case"tabIndex":qn(r,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":qn(r,m,x);break;case"style":ja(r,x,z);break;case"data":if(u!=="object"){qn(r,"data",x);break}case"src":case"href":if(x===""&&(u!=="a"||m!=="href")){r.removeAttribute(m);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(m);break}x=on(""+x),r.setAttribute(m,x);break;case"action":case"formAction":if(typeof x=="function"){r.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof z=="function"&&(m==="formAction"?(u!=="input"&&yi(r,u,"name",C.name,C,null),yi(r,u,"formEncType",C.formEncType,C,null),yi(r,u,"formMethod",C.formMethod,C,null),yi(r,u,"formTarget",C.formTarget,C,null)):(yi(r,u,"encType",C.encType,C,null),yi(r,u,"method",C.method,C,null),yi(r,u,"target",C.target,C,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(m);break}x=on(""+x),r.setAttribute(m,x);break;case"onClick":x!=null&&(r.onclick=_f);break;case"onScroll":x!=null&&$n("scroll",r);break;case"onScrollEnd":x!=null&&$n("scrollend",r);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(l(61));if(m=x.__html,m!=null){if(C.children!=null)throw Error(l(60));r.innerHTML=m}}break;case"multiple":r.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":r.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){r.removeAttribute("xlink:href");break}m=on(""+x),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(m,""+x):r.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(m,""):r.removeAttribute(m);break;case"capture":case"download":x===!0?r.setAttribute(m,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(m,x):r.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?r.setAttribute(m,x):r.removeAttribute(m);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?r.removeAttribute(m):r.setAttribute(m,x);break;case"popover":$n("beforetoggle",r),$n("toggle",r),xr(r,"popover",x);break;case"xlinkActuate":ea(r,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":ea(r,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":ea(r,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":ea(r,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":ea(r,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":ea(r,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":ea(r,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":ea(r,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":ea(r,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":xr(r,"is",x);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=Sa.get(m)||m,xr(r,m,x))}}function bp(r,u,m,x,C,z){switch(m){case"style":ja(r,x,z);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(l(61));if(m=x.__html,m!=null){if(C.children!=null)throw Error(l(60));r.innerHTML=m}}break;case"children":typeof x=="string"?es(r,x):(typeof x=="number"||typeof x=="bigint")&&es(r,""+x);break;case"onScroll":x!=null&&$n("scroll",r);break;case"onScrollEnd":x!=null&&$n("scrollend",r);break;case"onClick":x!=null&&(r.onclick=_f);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fo.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(C=m.endsWith("Capture"),u=m.slice(2,C?m.length-7:void 0),z=r[rn]||null,z=z!=null?z[m]:null,typeof z=="function"&&r.removeEventListener(u,z,C),typeof x=="function")){typeof z!="function"&&z!==null&&(m in r?r[m]=null:r.hasAttribute(m)&&r.removeAttribute(m)),r.addEventListener(u,x,C);break e}m in r?r[m]=x:x===!0?r.setAttribute(m,""):xr(r,m,x)}}}function Rr(r,u,m){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":$n("error",r),$n("load",r);var x=!1,C=!1,z;for(z in m)if(m.hasOwnProperty(z)){var H=m[z];if(H!=null)switch(z){case"src":x=!0;break;case"srcSet":C=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,u));default:yi(r,u,z,H,m,null)}}C&&yi(r,u,"srcSet",m.srcSet,m,null),x&&yi(r,u,"src",m.src,m,null);return;case"input":$n("invalid",r);var ie=z=H=C=null,we=null,Ke=null;for(x in m)if(m.hasOwnProperty(x)){var ct=m[x];if(ct!=null)switch(x){case"name":C=ct;break;case"type":H=ct;break;case"checked":we=ct;break;case"defaultChecked":Ke=ct;break;case"value":z=ct;break;case"defaultValue":ie=ct;break;case"children":case"dangerouslySetInnerHTML":if(ct!=null)throw Error(l(137,u));break;default:yi(r,u,x,ct,m,null)}}po(r,z,ie,we,Ke,H,C,!1),ml(r);return;case"select":$n("invalid",r),x=H=z=null;for(C in m)if(m.hasOwnProperty(C)&&(ie=m[C],ie!=null))switch(C){case"value":z=ie;break;case"defaultValue":H=ie;break;case"multiple":x=ie;default:yi(r,u,C,ie,m,null)}u=z,m=H,r.multiple=!!x,u!=null?mo(r,!!x,u,!1):m!=null&&mo(r,!!x,m,!0);return;case"textarea":$n("invalid",r),z=C=x=null;for(H in m)if(m.hasOwnProperty(H)&&(ie=m[H],ie!=null))switch(H){case"value":x=ie;break;case"defaultValue":C=ie;break;case"children":z=ie;break;case"dangerouslySetInnerHTML":if(ie!=null)throw Error(l(91));break;default:yi(r,u,H,ie,m,null)}jo(r,x,C,z),ml(r);return;case"option":for(we in m)if(m.hasOwnProperty(we)&&(x=m[we],x!=null))switch(we){case"selected":r.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:yi(r,u,we,x,m,null)}return;case"dialog":$n("beforetoggle",r),$n("toggle",r),$n("cancel",r),$n("close",r);break;case"iframe":case"object":$n("load",r);break;case"video":case"audio":for(x=0;x<Xh.length;x++)$n(Xh[x],r);break;case"image":$n("error",r),$n("load",r);break;case"details":$n("toggle",r);break;case"embed":case"source":case"link":$n("error",r),$n("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ke in m)if(m.hasOwnProperty(Ke)&&(x=m[Ke],x!=null))switch(Ke){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,u));default:yi(r,u,Ke,x,m,null)}return;default:if(na(u)){for(ct in m)m.hasOwnProperty(ct)&&(x=m[ct],x!==void 0&&bp(r,u,ct,x,m,void 0));return}}for(ie in m)m.hasOwnProperty(ie)&&(x=m[ie],x!=null&&yi(r,u,ie,x,m,null))}function W_(r,u,m,x){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var C=null,z=null,H=null,ie=null,we=null,Ke=null,ct=null;for(it in m){var pt=m[it];if(m.hasOwnProperty(it)&&pt!=null)switch(it){case"checked":break;case"value":break;case"defaultValue":we=pt;default:x.hasOwnProperty(it)||yi(r,u,it,null,x,pt)}}for(var Qe in x){var it=x[Qe];if(pt=m[Qe],x.hasOwnProperty(Qe)&&(it!=null||pt!=null))switch(Qe){case"type":z=it;break;case"name":C=it;break;case"checked":Ke=it;break;case"defaultChecked":ct=it;break;case"value":H=it;break;case"defaultValue":ie=it;break;case"children":case"dangerouslySetInnerHTML":if(it!=null)throw Error(l(137,u));break;default:it!==pt&&yi(r,u,Qe,it,x,pt)}}Fl(r,H,ie,we,Ke,ct,z,C);return;case"select":it=H=ie=Qe=null;for(z in m)if(we=m[z],m.hasOwnProperty(z)&&we!=null)switch(z){case"value":break;case"multiple":it=we;default:x.hasOwnProperty(z)||yi(r,u,z,null,x,we)}for(C in x)if(z=x[C],we=m[C],x.hasOwnProperty(C)&&(z!=null||we!=null))switch(C){case"value":Qe=z;break;case"defaultValue":ie=z;break;case"multiple":H=z;default:z!==we&&yi(r,u,C,z,x,we)}u=ie,m=H,x=it,Qe!=null?mo(r,!!m,Qe,!1):!!x!=!!m&&(u!=null?mo(r,!!m,u,!0):mo(r,!!m,m?[]:"",!1));return;case"textarea":it=Qe=null;for(ie in m)if(C=m[ie],m.hasOwnProperty(ie)&&C!=null&&!x.hasOwnProperty(ie))switch(ie){case"value":break;case"children":break;default:yi(r,u,ie,null,x,C)}for(H in x)if(C=x[H],z=m[H],x.hasOwnProperty(H)&&(C!=null||z!=null))switch(H){case"value":Qe=C;break;case"defaultValue":it=C;break;case"children":break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(l(91));break;default:C!==z&&yi(r,u,H,C,x,z)}gh(r,Qe,it);return;case"option":for(var bn in m)if(Qe=m[bn],m.hasOwnProperty(bn)&&Qe!=null&&!x.hasOwnProperty(bn))switch(bn){case"selected":r.selected=!1;break;default:yi(r,u,bn,null,x,Qe)}for(we in x)if(Qe=x[we],it=m[we],x.hasOwnProperty(we)&&Qe!==it&&(Qe!=null||it!=null))switch(we){case"selected":r.selected=Qe&&typeof Qe!="function"&&typeof Qe!="symbol";break;default:yi(r,u,we,Qe,x,it)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var hn in m)Qe=m[hn],m.hasOwnProperty(hn)&&Qe!=null&&!x.hasOwnProperty(hn)&&yi(r,u,hn,null,x,Qe);for(Ke in x)if(Qe=x[Ke],it=m[Ke],x.hasOwnProperty(Ke)&&Qe!==it&&(Qe!=null||it!=null))switch(Ke){case"children":case"dangerouslySetInnerHTML":if(Qe!=null)throw Error(l(137,u));break;default:yi(r,u,Ke,Qe,x,it)}return;default:if(na(u)){for(var Ci in m)Qe=m[Ci],m.hasOwnProperty(Ci)&&Qe!==void 0&&!x.hasOwnProperty(Ci)&&bp(r,u,Ci,void 0,x,Qe);for(ct in x)Qe=x[ct],it=m[ct],!x.hasOwnProperty(ct)||Qe===it||Qe===void 0&&it===void 0||bp(r,u,ct,Qe,x,it);return}}for(var Ue in m)Qe=m[Ue],m.hasOwnProperty(Ue)&&Qe!=null&&!x.hasOwnProperty(Ue)&&yi(r,u,Ue,null,x,Qe);for(pt in x)Qe=x[pt],it=m[pt],!x.hasOwnProperty(pt)||Qe===it||Qe==null&&it==null||yi(r,u,pt,Qe,x,it)}var yf=null,xp=null;function qs(r){return r.nodeType===9?r:r.ownerDocument}function th(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Yh(r,u){if(r===0)switch(u){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&u==="foreignObject"?0:r}function yc(r,u){return r==="textarea"||r==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.children=="bigint"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var wp=null;function K_(){var r=window.event;return r&&r.type==="popstate"?r===wp?!1:(wp=r,!0):(wp=null,!1)}var dg=typeof setTimeout=="function"?setTimeout:void 0,X_=typeof clearTimeout=="function"?clearTimeout:void 0,Y_=typeof Promise=="function"?Promise:void 0,Q_=typeof queueMicrotask=="function"?queueMicrotask:typeof Y_<"u"?function(r){return Y_.resolve(null).then(r).catch(iu)}:dg;function iu(r){setTimeout(function(){throw r})}function vc(r){return r==="head"}function fg(r,u){var m=u,x=0,C=0;do{var z=m.nextSibling;if(r.removeChild(m),z&&z.nodeType===8)if(m=z.data,m==="/$"){if(0<x&&8>x){m=x;var H=r.ownerDocument;if(m&1&&ru(H.documentElement),m&2&&ru(H.body),m&4)for(m=H.head,ru(m),H=m.firstChild;H;){var ie=H.nextSibling,we=H.nodeName;H[Qs]||we==="SCRIPT"||we==="STYLE"||we==="LINK"&&H.rel.toLowerCase()==="stylesheet"||m.removeChild(H),H=ie}}if(C===0){r.removeChild(z),_r(u);return}C--}else m==="$"||m==="$?"||m==="$!"?C++:x=m.charCodeAt(0)-48;else x=0;m=z}while(m);_r(u)}function Tp(r){var u=r.firstChild;for(u&&u.nodeType===10&&(u=u.nextSibling);u;){var m=u;switch(u=u.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":Tp(m),It(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}r.removeChild(m)}}function J_(r,u,m,x){for(;r.nodeType===1;){var C=m;if(r.nodeName.toLowerCase()!==u.toLowerCase()){if(!x&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(x){if(!r[Qs])switch(u){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(z=r.getAttribute("rel"),z==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(z!==C.rel||r.getAttribute("href")!==(C.href==null||C.href===""?null:C.href)||r.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin)||r.getAttribute("title")!==(C.title==null?null:C.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(z=r.getAttribute("src"),(z!==(C.src==null?null:C.src)||r.getAttribute("type")!==(C.type==null?null:C.type)||r.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin))&&z&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(u==="input"&&r.type==="hidden"){var z=C.name==null?null:""+C.name;if(C.type==="hidden"&&r.getAttribute("name")===z)return r}else return r;if(r=Oo(r.nextSibling),r===null)break}return null}function Dv(r,u,m){if(u==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!m||(r=Oo(r.nextSibling),r===null))return null;return r}function pg(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function ey(r,u){var m=r.ownerDocument;if(r.data!=="$?"||m.readyState==="complete")u();else{var x=function(){u(),m.removeEventListener("DOMContentLoaded",x)};m.addEventListener("DOMContentLoaded",x),r._reactRetry=x}}function Oo(r){for(;r!=null;r=r.nextSibling){var u=r.nodeType;if(u===1||u===3)break;if(u===8){if(u=r.data,u==="$"||u==="$!"||u==="$?"||u==="F!"||u==="F")break;if(u==="/$")return null}}return r}var Qh=null;function mg(r){r=r.previousSibling;for(var u=0;r;){if(r.nodeType===8){var m=r.data;if(m==="$"||m==="$!"||m==="$?"){if(u===0)return r;u--}else m==="/$"&&u++}r=r.previousSibling}return null}function vf(r,u,m){switch(u=qs(m),r){case"html":if(r=u.documentElement,!r)throw Error(l(452));return r;case"head":if(r=u.head,!r)throw Error(l(453));return r;case"body":if(r=u.body,!r)throw Error(l(454));return r;default:throw Error(l(451))}}function ru(r){for(var u=r.attributes;u.length;)r.removeAttributeNode(u[0]);It(r)}var pa=new Map,ty=new Set;function Sp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var bc=kt.d;kt.d={f:Jh,r:ls,D:ny,C:_g,L:Ov,m:iy,X:zv,S:ry,M:sy};function Jh(){var r=bc.f(),u=uf();return r||u}function ls(r){var u=sn(r);u!==null&&u.tag===5&&u.type==="form"?ui(u):bc.r(r)}var su=typeof document>"u"?null:document;function gg(r,u,m){var x=su;if(x&&typeof u=="string"&&u){var C=wr(u);C='link[rel="'+r+'"][href="'+C+'"]',typeof m=="string"&&(C+='[crossorigin="'+m+'"]'),ty.has(C)||(ty.add(C),r={rel:r,crossOrigin:m,href:u},x.querySelector(C)===null&&(u=x.createElement("link"),Rr(u,"link",r),pi(u),x.head.appendChild(u)))}}function ny(r){bc.D(r),gg("dns-prefetch",r,null)}function _g(r,u){bc.C(r,u),gg("preconnect",r,u)}function Ov(r,u,m){bc.L(r,u,m);var x=su;if(x&&r&&u){var C='link[rel="preload"][as="'+wr(u)+'"]';u==="image"&&m&&m.imageSrcSet?(C+='[imagesrcset="'+wr(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(C+='[imagesizes="'+wr(m.imageSizes)+'"]')):C+='[href="'+wr(r)+'"]';var z=C;switch(u){case"style":z=au(r);break;case"script":z=nh(r)}pa.has(z)||(r=V({rel:"preload",href:u==="image"&&m&&m.imageSrcSet?void 0:r,as:u},m),pa.set(z,r),x.querySelector(C)!==null||u==="style"&&x.querySelector(ed(z))||u==="script"&&x.querySelector(ih(z))||(u=x.createElement("link"),Rr(u,"link",r),pi(u),x.head.appendChild(u)))}}function iy(r,u){bc.m(r,u);var m=su;if(m&&r){var x=u&&typeof u.as=="string"?u.as:"script",C='link[rel="modulepreload"][as="'+wr(x)+'"][href="'+wr(r)+'"]',z=C;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":z=nh(r)}if(!pa.has(z)&&(r=V({rel:"modulepreload",href:r},u),pa.set(z,r),m.querySelector(C)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(ih(z)))return}x=m.createElement("link"),Rr(x,"link",r),pi(x),m.head.appendChild(x)}}}function ry(r,u,m){bc.S(r,u,m);var x=su;if(x&&r){var C=Bs(x).hoistableStyles,z=au(r);u=u||"default";var H=C.get(z);if(!H){var ie={loading:0,preload:null};if(H=x.querySelector(ed(z)))ie.loading=5;else{r=V({rel:"stylesheet",href:r,"data-precedence":u},m),(m=pa.get(z))&&xf(r,m);var we=H=x.createElement("link");pi(we),Rr(we,"link",r),we._p=new Promise(function(Ke,ct){we.onload=Ke,we.onerror=ct}),we.addEventListener("load",function(){ie.loading|=1}),we.addEventListener("error",function(){ie.loading|=2}),ie.loading|=4,ou(H,u,x)}H={type:"stylesheet",instance:H,count:1,state:ie},C.set(z,H)}}}function zv(r,u){bc.X(r,u);var m=su;if(m&&r){var x=Bs(m).hoistableScripts,C=nh(r),z=x.get(C);z||(z=m.querySelector(ih(C)),z||(r=V({src:r,async:!0},u),(u=pa.get(C))&&wf(r,u),z=m.createElement("script"),pi(z),Rr(z,"link",r),m.head.appendChild(z)),z={type:"script",instance:z,count:1,state:null},x.set(C,z))}}function sy(r,u){bc.M(r,u);var m=su;if(m&&r){var x=Bs(m).hoistableScripts,C=nh(r),z=x.get(C);z||(z=m.querySelector(ih(C)),z||(r=V({src:r,async:!0,type:"module"},u),(u=pa.get(C))&&wf(r,u),z=m.createElement("script"),pi(z),Rr(z,"link",r),m.head.appendChild(z)),z={type:"script",instance:z,count:1,state:null},x.set(C,z))}}function Ep(r,u,m,x){var C=(C=Ht.current)?Sp(C):null;if(!C)throw Error(l(446));switch(r){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(u=au(m.href),m=Bs(C).hoistableStyles,x=m.get(u),x||(x={type:"style",instance:null,count:0,state:null},m.set(u,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){r=au(m.href);var z=Bs(C).hoistableStyles,H=z.get(r);if(H||(C=C.ownerDocument||C,H={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},z.set(r,H),(z=C.querySelector(ed(r)))&&!z._p&&(H.instance=z,H.state.loading=5),pa.has(r)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},pa.set(r,m),z||yg(C,r,m,H.state))),u&&x===null)throw Error(l(528,""));return H}if(u&&x!==null)throw Error(l(529,""));return null;case"script":return u=m.async,m=m.src,typeof m=="string"&&u&&typeof u!="function"&&typeof u!="symbol"?(u=nh(m),m=Bs(C).hoistableScripts,x=m.get(u),x||(x={type:"script",instance:null,count:0,state:null},m.set(u,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,r))}}function au(r){return'href="'+wr(r)+'"'}function ed(r){return'link[rel="stylesheet"]['+r+"]"}function td(r){return V({},r,{"data-precedence":r.precedence,precedence:null})}function yg(r,u,m,x){r.querySelector('link[rel="preload"][as="style"]['+u+"]")?x.loading=1:(u=r.createElement("link"),x.preload=u,u.addEventListener("load",function(){return x.loading|=1}),u.addEventListener("error",function(){return x.loading|=2}),Rr(u,"link",m),pi(u),r.head.appendChild(u))}function nh(r){return'[src="'+wr(r)+'"]'}function ih(r){return"script[async]"+r}function bf(r,u,m){if(u.count++,u.instance===null)switch(u.type){case"style":var x=r.querySelector('style[data-href~="'+wr(m.href)+'"]');if(x)return u.instance=x,pi(x),x;var C=V({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return x=(r.ownerDocument||r).createElement("style"),pi(x),Rr(x,"style",C),ou(x,m.precedence,r),u.instance=x;case"stylesheet":C=au(m.href);var z=r.querySelector(ed(C));if(z)return u.state.loading|=4,u.instance=z,pi(z),z;x=td(m),(C=pa.get(C))&&xf(x,C),z=(r.ownerDocument||r).createElement("link"),pi(z);var H=z;return H._p=new Promise(function(ie,we){H.onload=ie,H.onerror=we}),Rr(z,"link",x),u.state.loading|=4,ou(z,m.precedence,r),u.instance=z;case"script":return z=nh(m.src),(C=r.querySelector(ih(z)))?(u.instance=C,pi(C),C):(x=m,(C=pa.get(z))&&(x=V({},m),wf(x,C)),r=r.ownerDocument||r,C=r.createElement("script"),pi(C),Rr(C,"link",x),r.head.appendChild(C),u.instance=C);case"void":return null;default:throw Error(l(443,u.type))}else u.type==="stylesheet"&&(u.state.loading&4)===0&&(x=u.instance,u.state.loading|=4,ou(x,m.precedence,r));return u.instance}function ou(r,u,m){for(var x=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),C=x.length?x[x.length-1]:null,z=C,H=0;H<x.length;H++){var ie=x[H];if(ie.dataset.precedence===u)z=ie;else if(z!==C)break}z?z.parentNode.insertBefore(r,z.nextSibling):(u=m.nodeType===9?m.head:m,u.insertBefore(r,u.firstChild))}function xf(r,u){r.crossOrigin==null&&(r.crossOrigin=u.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=u.referrerPolicy),r.title==null&&(r.title=u.title)}function wf(r,u){r.crossOrigin==null&&(r.crossOrigin=u.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=u.referrerPolicy),r.integrity==null&&(r.integrity=u.integrity)}var nd=null;function ay(r,u,m){if(nd===null){var x=new Map,C=nd=new Map;C.set(m,x)}else C=nd,x=C.get(m),x||(x=new Map,C.set(m,x));if(x.has(r))return x;for(x.set(r,null),m=m.getElementsByTagName(r),C=0;C<m.length;C++){var z=m[C];if(!(z[Qs]||z[Kt]||r==="link"&&z.getAttribute("rel")==="stylesheet")&&z.namespaceURI!=="http://www.w3.org/2000/svg"){var H=z.getAttribute(u)||"";H=r+H;var ie=x.get(H);ie?ie.push(z):x.set(H,[z])}}return x}function a(r,u,m){r=r.ownerDocument||r,r.head.insertBefore(m,u==="title"?r.querySelector("head > title"):null)}function n(r,u,m){if(m===1||u.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof u.precedence!="string"||typeof u.href!="string"||u.href==="")break;return!0;case"link":if(typeof u.rel!="string"||typeof u.href!="string"||u.href===""||u.onLoad||u.onError)break;switch(u.rel){case"stylesheet":return r=u.disabled,typeof u.precedence=="string"&&r==null;default:return!0}case"script":if(u.async&&typeof u.async!="function"&&typeof u.async!="symbol"&&!u.onLoad&&!u.onError&&u.src&&typeof u.src=="string")return!0}return!1}function s(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var d=null;function g(){}function w(r,u,m){if(d===null)throw Error(l(475));var x=d;if(u.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var C=au(m.href),z=r.querySelector(ed(C));if(z){r=z._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(x.count++,x=A.bind(x),r.then(x,x)),u.state.loading|=4,u.instance=z,pi(z);return}z=r.ownerDocument||r,m=td(m),(C=pa.get(C))&&xf(m,C),z=z.createElement("link"),pi(z);var H=z;H._p=new Promise(function(ie,we){H.onload=ie,H.onerror=we}),Rr(z,"link",m),u.instance=z}x.stylesheets===null&&(x.stylesheets=new Map),x.stylesheets.set(u,r),(r=u.state.preload)&&(u.state.loading&3)===0&&(x.count++,u=A.bind(x),r.addEventListener("load",u),r.addEventListener("error",u))}}function S(){if(d===null)throw Error(l(475));var r=d;return r.stylesheets&&r.count===0&&D(r,r.stylesheets),0<r.count?function(u){var m=setTimeout(function(){if(r.stylesheets&&D(r,r.stylesheets),r.unsuspend){var x=r.unsuspend;r.unsuspend=null,x()}},6e4);return r.unsuspend=u,function(){r.unsuspend=null,clearTimeout(m)}}:null}function A(){if(this.count--,this.count===0){if(this.stylesheets)D(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var P=null;function D(r,u){r.stylesheets=null,r.unsuspend!==null&&(r.count++,P=new Map,u.forEach(N,r),P=null,A.call(r))}function N(r,u){if(!(u.state.loading&4)){var m=P.get(r);if(m)var x=m.get(null);else{m=new Map,P.set(r,m);for(var C=r.querySelectorAll("link[data-precedence],style[data-precedence]"),z=0;z<C.length;z++){var H=C[z];(H.nodeName==="LINK"||H.getAttribute("media")!=="not all")&&(m.set(H.dataset.precedence,H),x=H)}x&&m.set(null,x)}C=u.instance,H=C.getAttribute("data-precedence"),z=m.get(H)||x,z===x&&m.set(null,C),m.set(H,C),this.count++,x=A.bind(this),C.addEventListener("load",x),C.addEventListener("error",x),z?z.parentNode.insertBefore(C,z.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(C,r.firstChild)),u.state.loading|=4}}var j={$$typeof:He,Provider:null,Consumer:null,_currentValue:Zt,_currentValue2:Zt,_threadCount:0};function q(r,u,m,x,C,z,H,ie){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=zt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zt(0),this.hiddenUpdates=zt(null),this.identifierPrefix=x,this.onUncaughtError=C,this.onCaughtError=z,this.onRecoverableError=H,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ie,this.incompleteTransitions=new Map}function W(r,u,m,x,C,z,H,ie,we,Ke,ct,pt){return r=new q(r,u,m,H,ie,we,Ke,pt),u=1,z===!0&&(u|=24),z=la(3,null,null,u),r.current=z,z.stateNode=r,u=Ml(),u.refCount++,r.pooledCache=u,u.refCount++,z.memoizedState={element:x,isDehydrated:m,cache:u},ju(z),r}function X(r){return r?(r=wn,r):wn}function ne(r,u,m,x,C,z){C=X(C),x.context===null?x.context=C:x.pendingContext=C,x=Ao(u),x.payload={element:m},z=z===void 0?null:z,z!==null&&(x.callback=z),m=Xo(r,x,u),m!==null&&(fa(m,r,u),qc(m,r,u))}function se(r,u){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var m=r.retryLane;r.retryLane=m!==0&&m<u?m:u}}function ue(r,u){se(r,u),(r=r.alternate)&&se(r,u)}function Ne(r){if(r.tag===13){var u=oa(r,67108864);u!==null&&fa(u,r,67108864),ue(r,67108864)}}var _e=!0;function Ae(r,u,m,x){var C=st.T;st.T=null;var z=kt.p;try{kt.p=2,et(r,u,m,x)}finally{kt.p=z,st.T=C}}function Ze(r,u,m,x){var C=st.T;st.T=null;var z=kt.p;try{kt.p=8,et(r,u,m,x)}finally{kt.p=z,st.T=C}}function et(r,u,m,x){if(_e){var C=dt(x);if(C===null)cg(r,u,x,At,m),Mn(r,x);else if(Mr(C,r,u,m,x))x.stopPropagation();else if(Mn(r,x),u&4&&-1<Vt.indexOf(r)){for(;C!==null;){var z=sn(C);if(z!==null)switch(z.tag){case 3:if(z=z.stateNode,z.current.memoizedState.isDehydrated){var H=ke(z.pendingLanes);if(H!==0){var ie=z;for(ie.pendingLanes|=2,ie.entangledLanes|=2;H;){var we=1<<31-Pe(H);ie.entanglements[1]|=we,H&=~we}ll(z),(Si&6)===0&&(of=br()+500,Kh(0))}}break;case 13:ie=oa(z,2),ie!==null&&fa(ie,z,2),uf(),ue(z,2)}if(z=dt(x),z===null&&cg(r,u,x,At,m),z===C)break;C=z}C!==null&&x.stopPropagation()}else cg(r,u,x,null,m)}}function dt(r){return r=gl(r),bt(r)}var At=null;function bt(r){if(At=null,r=un(r),r!==null){var u=v(r);if(u===null)r=null;else{var m=u.tag;if(m===13){if(r=y(u),r!==null)return r;r=null}else if(m===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;r=null}else u!==r&&(r=null)}}return At=r,null}function Ct(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ys()){case di:return 2;case Wi:return 8;case Yr:case ho:return 32;case xa:return 268435456;default:return 32}default:return 32}}var Ut=!1,xt=null,Tt=null,at=null,Xt=new Map,en=new Map,jt=[],Vt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Mn(r,u){switch(r){case"focusin":case"focusout":xt=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":at=null;break;case"pointerover":case"pointerout":Xt.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":en.delete(u.pointerId)}}function Ai(r,u,m,x,C,z){return r===null||r.nativeEvent!==z?(r={blockedOn:u,domEventName:m,eventSystemFlags:x,nativeEvent:z,targetContainers:[C]},u!==null&&(u=sn(u),u!==null&&Ne(u)),r):(r.eventSystemFlags|=x,u=r.targetContainers,C!==null&&u.indexOf(C)===-1&&u.push(C),r)}function Mr(r,u,m,x,C){switch(u){case"focusin":return xt=Ai(xt,r,u,m,x,C),!0;case"dragenter":return Tt=Ai(Tt,r,u,m,x,C),!0;case"mouseover":return at=Ai(at,r,u,m,x,C),!0;case"pointerover":var z=C.pointerId;return Xt.set(z,Ai(Xt.get(z)||null,r,u,m,x,C)),!0;case"gotpointercapture":return z=C.pointerId,en.set(z,Ai(en.get(z)||null,r,u,m,x,C)),!0}return!1}function Wr(r){var u=un(r.target);if(u!==null){var m=v(u);if(m!==null){if(u=m.tag,u===13){if(u=y(m),u!==null){r.blockedOn=u,or(r.priority,function(){if(m.tag===13){var x=ks();x=cn(x);var C=oa(m,x);C!==null&&fa(C,m,x),ue(m,x)}});return}}else if(u===3&&m.stateNode.current.memoizedState.isDehydrated){r.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Gs(r){if(r.blockedOn!==null)return!1;for(var u=r.targetContainers;0<u.length;){var m=dt(r.nativeEvent);if(m===null){m=r.nativeEvent;var x=new m.constructor(m.type,m);Ua=x,m.target.dispatchEvent(x),Ua=null}else return u=sn(m),u!==null&&Ne(u),r.blockedOn=m,!1;u.shift()}return!0}function Hs(r,u,m){Gs(r)&&m.delete(u)}function Kr(){Ut=!1,xt!==null&&Gs(xt)&&(xt=null),Tt!==null&&Gs(Tt)&&(Tt=null),at!==null&&Gs(at)&&(at=null),Xt.forEach(Hs),en.forEach(Hs)}function Ii(r,u){r.blockedOn===u&&(r.blockedOn=null,Ut||(Ut=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,Kr)))}var gr=null;function $r(r){gr!==r&&(gr=r,c.unstable_scheduleCallback(c.unstable_NormalPriority,function(){gr===r&&(gr=null);for(var u=0;u<r.length;u+=3){var m=r[u],x=r[u+1],C=r[u+2];if(typeof x!="function"){if(bt(x||m)===null)continue;break}var z=sn(m);z!==null&&(r.splice(u,3),u-=3,Ti(z,{pending:!0,data:C,method:m.method,action:x},x,C))}}))}function _r(r){function u(we){return Ii(we,r)}xt!==null&&Ii(xt,r),Tt!==null&&Ii(Tt,r),at!==null&&Ii(at,r),Xt.forEach(u),en.forEach(u);for(var m=0;m<jt.length;m++){var x=jt[m];x.blockedOn===r&&(x.blockedOn=null)}for(;0<jt.length&&(m=jt[0],m.blockedOn===null);)Wr(m),m.blockedOn===null&&jt.shift();if(m=(r.ownerDocument||r).$$reactFormReplay,m!=null)for(x=0;x<m.length;x+=3){var C=m[x],z=m[x+1],H=C[rn]||null;if(typeof z=="function")H||$r(m);else if(H){var ie=null;if(z&&z.hasAttribute("formAction")){if(C=z,H=z[rn]||null)ie=H.formAction;else if(bt(C)!==null)continue}else ie=H.action;typeof ie=="function"?m[x+1]=ie:(m.splice(x,3),x-=3),$r(m)}}}function cs(r){this._internalRoot=r}Zs.prototype.render=cs.prototype.render=function(r){var u=this._internalRoot;if(u===null)throw Error(l(409));var m=u.current,x=ks();ne(m,x,r,u,null,null)},Zs.prototype.unmount=cs.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var u=r.containerInfo;ne(r.current,2,null,r,null,null),uf(),u[fi]=null}};function Zs(r){this._internalRoot=r}Zs.prototype.unstable_scheduleHydration=function(r){if(r){var u=vi();r={blockedOn:null,target:r,priority:u};for(var m=0;m<jt.length&&u!==0&&u<jt[m].priority;m++);jt.splice(m,0,r),m===0&&Wr(r)}};var kr=e.version;if(kr!=="19.1.1")throw Error(l(527,kr,"19.1.1"));kt.findDOMNode=function(r){var u=r._reactInternals;if(u===void 0)throw typeof r.render=="function"?Error(l(188)):(r=Object.keys(r).join(","),Error(l(268,r)));return r=M(u),r=r!==null?O(r):null,r=r===null?null:r.stateNode,r};var ma={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:st,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rr.isDisabled&&rr.supportsFiber)try{gs=rr.inject(ma),Ki=rr}catch{}}return bg.createRoot=function(r,u){if(!f(r))throw Error(l(299));var m=!1,x="",C=Gd,z=vm,H=p_,ie=null;return u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(x=u.identifierPrefix),u.onUncaughtError!==void 0&&(C=u.onUncaughtError),u.onCaughtError!==void 0&&(z=u.onCaughtError),u.onRecoverableError!==void 0&&(H=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(ie=u.unstable_transitionCallbacks)),u=W(r,1,!1,null,null,m,x,C,z,H,ie,null),r[fi]=u.current,lg(r),new cs(u)},bg.hydrateRoot=function(r,u,m){if(!f(r))throw Error(l(299));var x=!1,C="",z=Gd,H=vm,ie=p_,we=null,Ke=null;return m!=null&&(m.unstable_strictMode===!0&&(x=!0),m.identifierPrefix!==void 0&&(C=m.identifierPrefix),m.onUncaughtError!==void 0&&(z=m.onUncaughtError),m.onCaughtError!==void 0&&(H=m.onCaughtError),m.onRecoverableError!==void 0&&(ie=m.onRecoverableError),m.unstable_transitionCallbacks!==void 0&&(we=m.unstable_transitionCallbacks),m.formState!==void 0&&(Ke=m.formState)),u=W(r,1,!0,u,m??null,x,C,z,H,ie,we,Ke),u.context=X(null),m=u.current,x=ks(),x=cn(x),C=Ao(x),C.callback=null,Xo(m,C,x),m=x,u.current.lanes=m,Re(u,m),ll(u),r[fi]=u.current,lg(r),new Zs(u)},bg.version="19.1.1",bg}var dx;function JE(){if(dx)return Vv.exports;dx=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(e){console.error(e)}}return c(),Vv.exports=QE(),Vv.exports}var e2=JE();/**
 * react-router v7.9.4
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var fx="popstate";function t2(c={}){function e(l,f){let{pathname:v,search:y,hash:h}=l.location;return d0("",{pathname:v,search:y,hash:h},f.state&&f.state.usr||null,f.state&&f.state.key||"default")}function i(l,f){return typeof f=="string"?f:Ng(f)}return i2(e,i,null,c)}function Dr(c,e){if(c===!1||c===null||typeof c>"u")throw new Error(e)}function yu(c,e){if(!c){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function n2(){return Math.random().toString(36).substring(2,10)}function px(c,e){return{usr:c.state,key:c.key,idx:e}}function d0(c,e,i=null,l){return{pathname:typeof c=="string"?c:c.pathname,search:"",hash:"",...typeof e=="string"?am(e):e,state:i,key:e&&e.key||l||n2()}}function Ng({pathname:c="/",search:e="",hash:i=""}){return e&&e!=="?"&&(c+=e.charAt(0)==="?"?e:"?"+e),i&&i!=="#"&&(c+=i.charAt(0)==="#"?i:"#"+i),c}function am(c){let e={};if(c){let i=c.indexOf("#");i>=0&&(e.hash=c.substring(i),c=c.substring(0,i));let l=c.indexOf("?");l>=0&&(e.search=c.substring(l),c=c.substring(0,l)),c&&(e.pathname=c)}return e}function i2(c,e,i,l={}){let{window:f=document.defaultView,v5Compat:v=!1}=l,y=f.history,h="POP",M=null,O=V();O==null&&(O=0,y.replaceState({...y.state,idx:O},""));function V(){return(y.state||{idx:null}).idx}function K(){h="POP";let Ee=V(),Je=Ee==null?null:Ee-O;O=Ee,M&&M({action:h,location:Ce.location,delta:Je})}function ee(Ee,Je){h="PUSH";let je=d0(Ce.location,Ee,Je);O=V()+1;let He=px(je,O),gt=Ce.createHref(je);try{y.pushState(He,"",gt)}catch(St){if(St instanceof DOMException&&St.name==="DataCloneError")throw St;f.location.assign(gt)}v&&M&&M({action:h,location:Ce.location,delta:1})}function Y(Ee,Je){h="REPLACE";let je=d0(Ce.location,Ee,Je);O=V();let He=px(je,O),gt=Ce.createHref(je);y.replaceState(He,"",gt),v&&M&&M({action:h,location:Ce.location,delta:0})}function ve(Ee){return r2(Ee)}let Ce={get action(){return h},get location(){return c(f,y)},listen(Ee){if(M)throw new Error("A history only accepts one active listener");return f.addEventListener(fx,K),M=Ee,()=>{f.removeEventListener(fx,K),M=null}},createHref(Ee){return e(f,Ee)},createURL:ve,encodeLocation(Ee){let Je=ve(Ee);return{pathname:Je.pathname,search:Je.search,hash:Je.hash}},push:ee,replace:Y,go(Ee){return y.go(Ee)}};return Ce}function r2(c,e=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Dr(i,"No window.location.(origin|href) available to create URL");let l=typeof c=="string"?c:Ng(c);return l=l.replace(/ $/,"%20"),!e&&l.startsWith("//")&&(l=i+l),new URL(l,i)}function E1(c,e,i="/"){return s2(c,e,i,!1)}function s2(c,e,i,l){let f=typeof e=="string"?am(e):e,v=lh(f.pathname||"/",i);if(v==null)return null;let y=A1(c);a2(y);let h=null;for(let M=0;h==null&&M<y.length;++M){let O=_2(v);h=m2(y[M],O,l)}return h}function A1(c,e=[],i=[],l="",f=!1){let v=(y,h,M=f,O)=>{let V={relativePath:O===void 0?y.path||"":O,caseSensitive:y.caseSensitive===!0,childrenIndex:h,route:y};if(V.relativePath.startsWith("/")){if(!V.relativePath.startsWith(l)&&M)return;Dr(V.relativePath.startsWith(l),`Absolute route path "${V.relativePath}" nested under path "${l}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),V.relativePath=V.relativePath.slice(l.length)}let K=oh([l,V.relativePath]),ee=i.concat(V);y.children&&y.children.length>0&&(Dr(y.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${K}".`),A1(y.children,e,ee,K,M)),!(y.path==null&&!y.index)&&e.push({path:K,score:f2(K,y.index),routesMeta:ee})};return c.forEach((y,h)=>{if(y.path===""||!y.path?.includes("?"))v(y,h);else for(let M of I1(y.path))v(y,h,!0,M)}),e}function I1(c){let e=c.split("/");if(e.length===0)return[];let[i,...l]=e,f=i.endsWith("?"),v=i.replace(/\?$/,"");if(l.length===0)return f?[v,""]:[v];let y=I1(l.join("/")),h=[];return h.push(...y.map(M=>M===""?v:[v,M].join("/"))),f&&h.push(...y),h.map(M=>c.startsWith("/")&&M===""?"/":M)}function a2(c){c.sort((e,i)=>e.score!==i.score?i.score-e.score:p2(e.routesMeta.map(l=>l.childrenIndex),i.routesMeta.map(l=>l.childrenIndex)))}var o2=/^:[\w-]+$/,l2=3,c2=2,u2=1,h2=10,d2=-2,mx=c=>c==="*";function f2(c,e){let i=c.split("/"),l=i.length;return i.some(mx)&&(l+=d2),e&&(l+=c2),i.filter(f=>!mx(f)).reduce((f,v)=>f+(o2.test(v)?l2:v===""?u2:h2),l)}function p2(c,e){return c.length===e.length&&c.slice(0,-1).every((l,f)=>l===e[f])?c[c.length-1]-e[e.length-1]:0}function m2(c,e,i=!1){let{routesMeta:l}=c,f={},v="/",y=[];for(let h=0;h<l.length;++h){let M=l[h],O=h===l.length-1,V=v==="/"?e:e.slice(v.length)||"/",K=Dy({path:M.relativePath,caseSensitive:M.caseSensitive,end:O},V),ee=M.route;if(!K&&O&&i&&!l[l.length-1].route.index&&(K=Dy({path:M.relativePath,caseSensitive:M.caseSensitive,end:!1},V)),!K)return null;Object.assign(f,K.params),y.push({params:f,pathname:oh([v,K.pathname]),pathnameBase:x2(oh([v,K.pathnameBase])),route:ee}),K.pathnameBase!=="/"&&(v=oh([v,K.pathnameBase]))}return y}function Dy(c,e){typeof c=="string"&&(c={path:c,caseSensitive:!1,end:!0});let[i,l]=g2(c.path,c.caseSensitive,c.end),f=e.match(i);if(!f)return null;let v=f[0],y=v.replace(/(.)\/+$/,"$1"),h=f.slice(1);return{params:l.reduce((O,{paramName:V,isOptional:K},ee)=>{if(V==="*"){let ve=h[ee]||"";y=v.slice(0,v.length-ve.length).replace(/(.)\/+$/,"$1")}const Y=h[ee];return K&&!Y?O[V]=void 0:O[V]=(Y||"").replace(/%2F/g,"/"),O},{}),pathname:v,pathnameBase:y,pattern:c}}function g2(c,e=!1,i=!0){yu(c==="*"||!c.endsWith("*")||c.endsWith("/*"),`Route path "${c}" will be treated as if it were "${c.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${c.replace(/\*$/,"/*")}".`);let l=[],f="^"+c.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(y,h,M)=>(l.push({paramName:h,isOptional:M!=null}),M?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return c.endsWith("*")?(l.push({paramName:"*"}),f+=c==="*"||c==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?f+="\\/*$":c!==""&&c!=="/"&&(f+="(?:(?=\\/|$))"),[new RegExp(f,e?void 0:"i"),l]}function _2(c){try{return c.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return yu(!1,`The URL path "${c}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),c}}function lh(c,e){if(e==="/")return c;if(!c.toLowerCase().startsWith(e.toLowerCase()))return null;let i=e.endsWith("/")?e.length-1:e.length,l=c.charAt(i);return l&&l!=="/"?null:c.slice(i)||"/"}function y2(c,e="/"){let{pathname:i,search:l="",hash:f=""}=typeof c=="string"?am(c):c;return{pathname:i?i.startsWith("/")?i:v2(i,e):e,search:w2(l),hash:T2(f)}}function v2(c,e){let i=e.replace(/\/+$/,"").split("/");return c.split("/").forEach(f=>{f===".."?i.length>1&&i.pop():f!=="."&&i.push(f)}),i.length>1?i.join("/"):"/"}function $v(c,e,i,l){return`Cannot include a '${c}' character in a manually specified \`to.${e}\` field [${JSON.stringify(l)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function b2(c){return c.filter((e,i)=>i===0||e.route.path&&e.route.path.length>0)}function C1(c){let e=b2(c);return e.map((i,l)=>l===e.length-1?i.pathname:i.pathnameBase)}function P1(c,e,i,l=!1){let f;typeof c=="string"?f=am(c):(f={...c},Dr(!f.pathname||!f.pathname.includes("?"),$v("?","pathname","search",f)),Dr(!f.pathname||!f.pathname.includes("#"),$v("#","pathname","hash",f)),Dr(!f.search||!f.search.includes("#"),$v("#","search","hash",f)));let v=c===""||f.pathname==="",y=v?"/":f.pathname,h;if(y==null)h=i;else{let K=e.length-1;if(!l&&y.startsWith("..")){let ee=y.split("/");for(;ee[0]==="..";)ee.shift(),K-=1;f.pathname=ee.join("/")}h=K>=0?e[K]:"/"}let M=y2(f,h),O=y&&y!=="/"&&y.endsWith("/"),V=(v||y===".")&&i.endsWith("/");return!M.pathname.endsWith("/")&&(O||V)&&(M.pathname+="/"),M}var oh=c=>c.join("/").replace(/\/\/+/g,"/"),x2=c=>c.replace(/\/+$/,"").replace(/^\/*/,"/"),w2=c=>!c||c==="?"?"":c.startsWith("?")?c:"?"+c,T2=c=>!c||c==="#"?"":c.startsWith("#")?c:"#"+c;function S2(c){return c!=null&&typeof c.status=="number"&&typeof c.statusText=="string"&&typeof c.internal=="boolean"&&"data"in c}var R1=["POST","PUT","PATCH","DELETE"];new Set(R1);var E2=["GET",...R1];new Set(E2);var om=rt.createContext(null);om.displayName="DataRouter";var rv=rt.createContext(null);rv.displayName="DataRouterState";rt.createContext(!1);var M1=rt.createContext({isTransitioning:!1});M1.displayName="ViewTransition";var A2=rt.createContext(new Map);A2.displayName="Fetchers";var I2=rt.createContext(null);I2.displayName="Await";var xu=rt.createContext(null);xu.displayName="Navigation";var Xg=rt.createContext(null);Xg.displayName="Location";var wu=rt.createContext({outlet:null,matches:[],isDataRoute:!1});wu.displayName="Route";var eb=rt.createContext(null);eb.displayName="RouteError";function C2(c,{relative:e}={}){Dr(Yg(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:l}=rt.useContext(xu),{hash:f,pathname:v,search:y}=Qg(c,{relative:e}),h=v;return i!=="/"&&(h=v==="/"?i:oh([i,v])),l.createHref({pathname:h,search:y,hash:f})}function Yg(){return rt.useContext(Xg)!=null}function $f(){return Dr(Yg(),"useLocation() may be used only in the context of a <Router> component."),rt.useContext(Xg).location}var k1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function D1(c){rt.useContext(xu).static||rt.useLayoutEffect(c)}function P2(){let{isDataRoute:c}=rt.useContext(wu);return c?q2():R2()}function R2(){Dr(Yg(),"useNavigate() may be used only in the context of a <Router> component.");let c=rt.useContext(om),{basename:e,navigator:i}=rt.useContext(xu),{matches:l}=rt.useContext(wu),{pathname:f}=$f(),v=JSON.stringify(C1(l)),y=rt.useRef(!1);return D1(()=>{y.current=!0}),rt.useCallback((M,O={})=>{if(yu(y.current,k1),!y.current)return;if(typeof M=="number"){i.go(M);return}let V=P1(M,JSON.parse(v),f,O.relative==="path");c==null&&e!=="/"&&(V.pathname=V.pathname==="/"?e:oh([e,V.pathname])),(O.replace?i.replace:i.push)(V,O.state,O)},[e,i,v,f,c])}var O1=rt.createContext(null);function M2(){return rt.useContext(O1)}function k2(c){let e=rt.useContext(wu).outlet;return rt.useMemo(()=>e&&rt.createElement(O1.Provider,{value:c},e),[e,c])}function Qg(c,{relative:e}={}){let{matches:i}=rt.useContext(wu),{pathname:l}=$f(),f=JSON.stringify(C1(i));return rt.useMemo(()=>P1(c,JSON.parse(f),l,e==="path"),[c,f,l,e])}function D2(c,e){return z1(c,e)}function z1(c,e,i,l,f){Dr(Yg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:v}=rt.useContext(xu),{matches:y}=rt.useContext(wu),h=y[y.length-1],M=h?h.params:{},O=h?h.pathname:"/",V=h?h.pathnameBase:"/",K=h&&h.route;{let je=K&&K.path||"";L1(O,!K||je.endsWith("*")||je.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${O}" (under <Route path="${je}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${je}"> to <Route path="${je==="/"?"*":`${je}/*`}">.`)}let ee=$f(),Y;if(e){let je=typeof e=="string"?am(e):e;Dr(V==="/"||je.pathname?.startsWith(V),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${V}" but pathname "${je.pathname}" was given in the \`location\` prop.`),Y=je}else Y=ee;let ve=Y.pathname||"/",Ce=ve;if(V!=="/"){let je=V.replace(/^\//,"").split("/");Ce="/"+ve.replace(/^\//,"").split("/").slice(je.length).join("/")}let Ee=E1(c,{pathname:Ce});yu(K||Ee!=null,`No routes matched location "${Y.pathname}${Y.search}${Y.hash}" `),yu(Ee==null||Ee[Ee.length-1].route.element!==void 0||Ee[Ee.length-1].route.Component!==void 0||Ee[Ee.length-1].route.lazy!==void 0,`Matched leaf route at location "${Y.pathname}${Y.search}${Y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Je=B2(Ee&&Ee.map(je=>Object.assign({},je,{params:Object.assign({},M,je.params),pathname:oh([V,v.encodeLocation?v.encodeLocation(je.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:je.pathname]),pathnameBase:je.pathnameBase==="/"?V:oh([V,v.encodeLocation?v.encodeLocation(je.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:je.pathnameBase])})),y,i,l,f);return e&&Je?rt.createElement(Xg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Y},navigationType:"POP"}},Je):Je}function O2(){let c=$2(),e=S2(c)?`${c.status} ${c.statusText}`:c instanceof Error?c.message:JSON.stringify(c),i=c instanceof Error?c.stack:null,l="rgba(200,200,200, 0.5)",f={padding:"0.5rem",backgroundColor:l},v={padding:"2px 4px",backgroundColor:l},y=null;return console.error("Error handled by React Router default ErrorBoundary:",c),y=rt.createElement(rt.Fragment,null,rt.createElement("p",null," Hey developer "),rt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",rt.createElement("code",{style:v},"ErrorBoundary")," or"," ",rt.createElement("code",{style:v},"errorElement")," prop on your route.")),rt.createElement(rt.Fragment,null,rt.createElement("h2",null,"Unexpected Application Error!"),rt.createElement("h3",{style:{fontStyle:"italic"}},e),i?rt.createElement("pre",{style:f},i):null,y)}var z2=rt.createElement(O2,null),L2=class extends rt.Component{constructor(c){super(c),this.state={location:c.location,revalidation:c.revalidation,error:c.error}}static getDerivedStateFromError(c){return{error:c}}static getDerivedStateFromProps(c,e){return e.location!==c.location||e.revalidation!=="idle"&&c.revalidation==="idle"?{error:c.error,location:c.location,revalidation:c.revalidation}:{error:c.error!==void 0?c.error:e.error,location:e.location,revalidation:c.revalidation||e.revalidation}}componentDidCatch(c,e){this.props.unstable_onError?this.props.unstable_onError(c,e):console.error("React Router caught the following error during render",c)}render(){return this.state.error!==void 0?rt.createElement(wu.Provider,{value:this.props.routeContext},rt.createElement(eb.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function N2({routeContext:c,match:e,children:i}){let l=rt.useContext(om);return l&&l.static&&l.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=e.route.id),rt.createElement(wu.Provider,{value:c},i)}function B2(c,e=[],i=null,l=null,f=null){if(c==null){if(!i)return null;if(i.errors)c=i.matches;else if(e.length===0&&!i.initialized&&i.matches.length>0)c=i.matches;else return null}let v=c,y=i?.errors;if(y!=null){let O=v.findIndex(V=>V.route.id&&y?.[V.route.id]!==void 0);Dr(O>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(y).join(",")}`),v=v.slice(0,Math.min(v.length,O+1))}let h=!1,M=-1;if(i)for(let O=0;O<v.length;O++){let V=v[O];if((V.route.HydrateFallback||V.route.hydrateFallbackElement)&&(M=O),V.route.id){let{loaderData:K,errors:ee}=i,Y=V.route.loader&&!K.hasOwnProperty(V.route.id)&&(!ee||ee[V.route.id]===void 0);if(V.route.lazy||Y){h=!0,M>=0?v=v.slice(0,M+1):v=[v[0]];break}}}return v.reduceRight((O,V,K)=>{let ee,Y=!1,ve=null,Ce=null;i&&(ee=y&&V.route.id?y[V.route.id]:void 0,ve=V.route.errorElement||z2,h&&(M<0&&K===0?(L1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Y=!0,Ce=null):M===K&&(Y=!0,Ce=V.route.hydrateFallbackElement||null)));let Ee=e.concat(v.slice(0,K+1)),Je=()=>{let je;return ee?je=ve:Y?je=Ce:V.route.Component?je=rt.createElement(V.route.Component,null):V.route.element?je=V.route.element:je=O,rt.createElement(N2,{match:V,routeContext:{outlet:O,matches:Ee,isDataRoute:i!=null},children:je})};return i&&(V.route.ErrorBoundary||V.route.errorElement||K===0)?rt.createElement(L2,{location:i.location,revalidation:i.revalidation,component:ve,error:ee,children:Je(),routeContext:{outlet:null,matches:Ee,isDataRoute:!0},unstable_onError:l}):Je()},null)}function tb(c){return`${c} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function V2(c){let e=rt.useContext(om);return Dr(e,tb(c)),e}function j2(c){let e=rt.useContext(rv);return Dr(e,tb(c)),e}function U2(c){let e=rt.useContext(wu);return Dr(e,tb(c)),e}function nb(c){let e=U2(c),i=e.matches[e.matches.length-1];return Dr(i.route.id,`${c} can only be used on routes that contain a unique "id"`),i.route.id}function F2(){return nb("useRouteId")}function $2(){let c=rt.useContext(eb),e=j2("useRouteError"),i=nb("useRouteError");return c!==void 0?c:e.errors?.[i]}function q2(){let{router:c}=V2("useNavigate"),e=nb("useNavigate"),i=rt.useRef(!1);return D1(()=>{i.current=!0}),rt.useCallback(async(f,v={})=>{yu(i.current,k1),i.current&&(typeof f=="number"?c.navigate(f):await c.navigate(f,{fromRouteId:e,...v}))},[c,e])}var gx={};function L1(c,e,i){!e&&!gx[c]&&(gx[c]=!0,yu(!1,i))}rt.memo(G2);function G2({routes:c,future:e,state:i,unstable_onError:l}){return z1(c,void 0,i,l,e)}function H2(c){return k2(c.context)}function wg(c){Dr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Z2({basename:c="/",children:e=null,location:i,navigationType:l="POP",navigator:f,static:v=!1}){Dr(!Yg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let y=c.replace(/^\/*/,"/"),h=rt.useMemo(()=>({basename:y,navigator:f,static:v,future:{}}),[y,f,v]);typeof i=="string"&&(i=am(i));let{pathname:M="/",search:O="",hash:V="",state:K=null,key:ee="default"}=i,Y=rt.useMemo(()=>{let ve=lh(M,y);return ve==null?null:{location:{pathname:ve,search:O,hash:V,state:K,key:ee},navigationType:l}},[y,M,O,V,K,ee,l]);return yu(Y!=null,`<Router basename="${y}"> is not able to match the URL "${M}${O}${V}" because it does not start with the basename, so the <Router> won't render anything.`),Y==null?null:rt.createElement(xu.Provider,{value:h},rt.createElement(Xg.Provider,{children:e,value:Y}))}function W2({children:c,location:e}){return D2(f0(c),e)}function f0(c,e=[]){let i=[];return rt.Children.forEach(c,(l,f)=>{if(!rt.isValidElement(l))return;let v=[...e,f];if(l.type===rt.Fragment){i.push.apply(i,f0(l.props.children,v));return}Dr(l.type===wg,`[${typeof l.type=="string"?l.type:l.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Dr(!l.props.index||!l.props.children,"An index route cannot have child routes.");let y={id:l.props.id||v.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,middleware:l.props.middleware,loader:l.props.loader,action:l.props.action,hydrateFallbackElement:l.props.hydrateFallbackElement,HydrateFallback:l.props.HydrateFallback,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.hasErrorBoundary===!0||l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(y.children=f0(l.props.children,v)),i.push(y)}),i}var vy="get",by="application/x-www-form-urlencoded";function sv(c){return c!=null&&typeof c.tagName=="string"}function K2(c){return sv(c)&&c.tagName.toLowerCase()==="button"}function X2(c){return sv(c)&&c.tagName.toLowerCase()==="form"}function Y2(c){return sv(c)&&c.tagName.toLowerCase()==="input"}function Q2(c){return!!(c.metaKey||c.altKey||c.ctrlKey||c.shiftKey)}function J2(c,e){return c.button===0&&(!e||e==="_self")&&!Q2(c)}var ly=null;function eA(){if(ly===null)try{new FormData(document.createElement("form"),0),ly=!1}catch{ly=!0}return ly}var tA=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function qv(c){return c!=null&&!tA.has(c)?(yu(!1,`"${c}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${by}"`),null):c}function nA(c,e){let i,l,f,v,y;if(X2(c)){let h=c.getAttribute("action");l=h?lh(h,e):null,i=c.getAttribute("method")||vy,f=qv(c.getAttribute("enctype"))||by,v=new FormData(c)}else if(K2(c)||Y2(c)&&(c.type==="submit"||c.type==="image")){let h=c.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let M=c.getAttribute("formaction")||h.getAttribute("action");if(l=M?lh(M,e):null,i=c.getAttribute("formmethod")||h.getAttribute("method")||vy,f=qv(c.getAttribute("formenctype"))||qv(h.getAttribute("enctype"))||by,v=new FormData(h,c),!eA()){let{name:O,type:V,value:K}=c;if(V==="image"){let ee=O?`${O}.`:"";v.append(`${ee}x`,"0"),v.append(`${ee}y`,"0")}else O&&v.append(O,K)}}else{if(sv(c))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=vy,l=null,f=by,y=c}return v&&f==="text/plain"&&(y=v,v=void 0),{action:l,method:i.toLowerCase(),encType:f,formData:v,body:y}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ib(c,e){if(c===!1||c===null||typeof c>"u")throw new Error(e)}function iA(c,e,i){let l=typeof c=="string"?new URL(c,typeof window>"u"?"server://singlefetch/":window.location.origin):c;return l.pathname==="/"?l.pathname=`_root.${i}`:e&&lh(l.pathname,e)==="/"?l.pathname=`${e.replace(/\/$/,"")}/_root.${i}`:l.pathname=`${l.pathname.replace(/\/$/,"")}.${i}`,l}async function rA(c,e){if(c.id in e)return e[c.id];try{let i=await import(c.module);return e[c.id]=i,i}catch(i){return console.error(`Error loading route module \`${c.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function sA(c){return c==null?!1:c.href==null?c.rel==="preload"&&typeof c.imageSrcSet=="string"&&typeof c.imageSizes=="string":typeof c.rel=="string"&&typeof c.href=="string"}async function aA(c,e,i){let l=await Promise.all(c.map(async f=>{let v=e.routes[f.route.id];if(v){let y=await rA(v,i);return y.links?y.links():[]}return[]}));return uA(l.flat(1).filter(sA).filter(f=>f.rel==="stylesheet"||f.rel==="preload").map(f=>f.rel==="stylesheet"?{...f,rel:"prefetch",as:"style"}:{...f,rel:"prefetch"}))}function _x(c,e,i,l,f,v){let y=(M,O)=>i[O]?M.route.id!==i[O].route.id:!0,h=(M,O)=>i[O].pathname!==M.pathname||i[O].route.path?.endsWith("*")&&i[O].params["*"]!==M.params["*"];return v==="assets"?e.filter((M,O)=>y(M,O)||h(M,O)):v==="data"?e.filter((M,O)=>{let V=l.routes[M.route.id];if(!V||!V.hasLoader)return!1;if(y(M,O)||h(M,O))return!0;if(M.route.shouldRevalidate){let K=M.route.shouldRevalidate({currentUrl:new URL(f.pathname+f.search+f.hash,window.origin),currentParams:i[0]?.params||{},nextUrl:new URL(c,window.origin),nextParams:M.params,defaultShouldRevalidate:!0});if(typeof K=="boolean")return K}return!0}):[]}function oA(c,e,{includeHydrateFallback:i}={}){return lA(c.map(l=>{let f=e.routes[l.route.id];if(!f)return[];let v=[f.module];return f.clientActionModule&&(v=v.concat(f.clientActionModule)),f.clientLoaderModule&&(v=v.concat(f.clientLoaderModule)),i&&f.hydrateFallbackModule&&(v=v.concat(f.hydrateFallbackModule)),f.imports&&(v=v.concat(f.imports)),v}).flat(1))}function lA(c){return[...new Set(c)]}function cA(c){let e={},i=Object.keys(c).sort();for(let l of i)e[l]=c[l];return e}function uA(c,e){let i=new Set;return new Set(e),c.reduce((l,f)=>{let v=JSON.stringify(cA(f));return i.has(v)||(i.add(v),l.push({key:v,link:f})),l},[])}function N1(){let c=rt.useContext(om);return ib(c,"You must render this element inside a <DataRouterContext.Provider> element"),c}function hA(){let c=rt.useContext(rv);return ib(c,"You must render this element inside a <DataRouterStateContext.Provider> element"),c}var rb=rt.createContext(void 0);rb.displayName="FrameworkContext";function B1(){let c=rt.useContext(rb);return ib(c,"You must render this element inside a <HydratedRouter> element"),c}function dA(c,e){let i=rt.useContext(rb),[l,f]=rt.useState(!1),[v,y]=rt.useState(!1),{onFocus:h,onBlur:M,onMouseEnter:O,onMouseLeave:V,onTouchStart:K}=e,ee=rt.useRef(null);rt.useEffect(()=>{if(c==="render"&&y(!0),c==="viewport"){let Ce=Je=>{Je.forEach(je=>{y(je.isIntersecting)})},Ee=new IntersectionObserver(Ce,{threshold:.5});return ee.current&&Ee.observe(ee.current),()=>{Ee.disconnect()}}},[c]),rt.useEffect(()=>{if(l){let Ce=setTimeout(()=>{y(!0)},100);return()=>{clearTimeout(Ce)}}},[l]);let Y=()=>{f(!0)},ve=()=>{f(!1),y(!1)};return i?c!=="intent"?[v,ee,{}]:[v,ee,{onFocus:xg(h,Y),onBlur:xg(M,ve),onMouseEnter:xg(O,Y),onMouseLeave:xg(V,ve),onTouchStart:xg(K,Y)}]:[!1,ee,{}]}function xg(c,e){return i=>{c&&c(i),i.defaultPrevented||e(i)}}function fA({page:c,...e}){let{router:i}=N1(),l=rt.useMemo(()=>E1(i.routes,c,i.basename),[i.routes,c,i.basename]);return l?rt.createElement(mA,{page:c,matches:l,...e}):null}function pA(c){let{manifest:e,routeModules:i}=B1(),[l,f]=rt.useState([]);return rt.useEffect(()=>{let v=!1;return aA(c,e,i).then(y=>{v||f(y)}),()=>{v=!0}},[c,e,i]),l}function mA({page:c,matches:e,...i}){let l=$f(),{manifest:f,routeModules:v}=B1(),{basename:y}=N1(),{loaderData:h,matches:M}=hA(),O=rt.useMemo(()=>_x(c,e,M,f,l,"data"),[c,e,M,f,l]),V=rt.useMemo(()=>_x(c,e,M,f,l,"assets"),[c,e,M,f,l]),K=rt.useMemo(()=>{if(c===l.pathname+l.search+l.hash)return[];let ve=new Set,Ce=!1;if(e.forEach(Je=>{let je=f.routes[Je.route.id];!je||!je.hasLoader||(!O.some(He=>He.route.id===Je.route.id)&&Je.route.id in h&&v[Je.route.id]?.shouldRevalidate||je.hasClientLoader?Ce=!0:ve.add(Je.route.id))}),ve.size===0)return[];let Ee=iA(c,y,"data");return Ce&&ve.size>0&&Ee.searchParams.set("_routes",e.filter(Je=>ve.has(Je.route.id)).map(Je=>Je.route.id).join(",")),[Ee.pathname+Ee.search]},[y,h,l,f,O,e,c,v]),ee=rt.useMemo(()=>oA(V,f),[V,f]),Y=pA(V);return rt.createElement(rt.Fragment,null,K.map(ve=>rt.createElement("link",{key:ve,rel:"prefetch",as:"fetch",href:ve,...i})),ee.map(ve=>rt.createElement("link",{key:ve,rel:"modulepreload",href:ve,...i})),Y.map(({key:ve,link:Ce})=>rt.createElement("link",{key:ve,nonce:i.nonce,...Ce})))}function gA(...c){return e=>{c.forEach(i=>{typeof i=="function"?i(e):i!=null&&(i.current=e)})}}var V1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{V1&&(window.__reactRouterVersion="7.9.4")}catch{}function _A({basename:c,children:e,window:i}){let l=rt.useRef();l.current==null&&(l.current=t2({window:i,v5Compat:!0}));let f=l.current,[v,y]=rt.useState({action:f.action,location:f.location}),h=rt.useCallback(M=>{rt.startTransition(()=>y(M))},[y]);return rt.useLayoutEffect(()=>f.listen(h),[f,h]),rt.createElement(Z2,{basename:c,children:e,location:v.location,navigationType:v.action,navigator:f})}var j1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ad=rt.forwardRef(function({onClick:e,discover:i="render",prefetch:l="none",relative:f,reloadDocument:v,replace:y,state:h,target:M,to:O,preventScrollReset:V,viewTransition:K,...ee},Y){let{basename:ve}=rt.useContext(xu),Ce=typeof O=="string"&&j1.test(O),Ee,Je=!1;if(typeof O=="string"&&Ce&&(Ee=O,V1))try{let ye=new URL(window.location.href),Oe=O.startsWith("//")?new URL(ye.protocol+O):new URL(O),Me=lh(Oe.pathname,ve);Oe.origin===ye.origin&&Me!=null?O=Me+Oe.search+Oe.hash:Je=!0}catch{yu(!1,`<Link to="${O}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let je=C2(O,{relative:f}),[He,gt,St]=dA(l,ee),Pt=xA(O,{replace:y,state:h,target:M,preventScrollReset:V,relative:f,viewTransition:K});function Se(ye){e&&e(ye),ye.defaultPrevented||Pt(ye)}let pe=rt.createElement("a",{...ee,...St,href:Ee||je,onClick:Je||v?e:Se,ref:gA(Y,gt),target:M,"data-discover":!Ce&&i==="render"?"true":void 0});return He&&!Ce?rt.createElement(rt.Fragment,null,pe,rt.createElement(fA,{page:je})):pe});ad.displayName="Link";var yA=rt.forwardRef(function({"aria-current":e="page",caseSensitive:i=!1,className:l="",end:f=!1,style:v,to:y,viewTransition:h,children:M,...O},V){let K=Qg(y,{relative:O.relative}),ee=$f(),Y=rt.useContext(rv),{navigator:ve,basename:Ce}=rt.useContext(xu),Ee=Y!=null&&AA(K)&&h===!0,Je=ve.encodeLocation?ve.encodeLocation(K).pathname:K.pathname,je=ee.pathname,He=Y&&Y.navigation&&Y.navigation.location?Y.navigation.location.pathname:null;i||(je=je.toLowerCase(),He=He?He.toLowerCase():null,Je=Je.toLowerCase()),He&&Ce&&(He=lh(He,Ce)||He);const gt=Je!=="/"&&Je.endsWith("/")?Je.length-1:Je.length;let St=je===Je||!f&&je.startsWith(Je)&&je.charAt(gt)==="/",Pt=He!=null&&(He===Je||!f&&He.startsWith(Je)&&He.charAt(Je.length)==="/"),Se={isActive:St,isPending:Pt,isTransitioning:Ee},pe=St?e:void 0,ye;typeof l=="function"?ye=l(Se):ye=[l,St?"active":null,Pt?"pending":null,Ee?"transitioning":null].filter(Boolean).join(" ");let Oe=typeof v=="function"?v(Se):v;return rt.createElement(ad,{...O,"aria-current":pe,className:ye,ref:V,style:Oe,to:y,viewTransition:h},typeof M=="function"?M(Se):M)});yA.displayName="NavLink";var vA=rt.forwardRef(({discover:c="render",fetcherKey:e,navigate:i,reloadDocument:l,replace:f,state:v,method:y=vy,action:h,onSubmit:M,relative:O,preventScrollReset:V,viewTransition:K,...ee},Y)=>{let ve=SA(),Ce=EA(h,{relative:O}),Ee=y.toLowerCase()==="get"?"get":"post",Je=typeof h=="string"&&j1.test(h),je=He=>{if(M&&M(He),He.defaultPrevented)return;He.preventDefault();let gt=He.nativeEvent.submitter,St=gt?.getAttribute("formmethod")||y;ve(gt||He.currentTarget,{fetcherKey:e,method:St,navigate:i,replace:f,state:v,relative:O,preventScrollReset:V,viewTransition:K})};return rt.createElement("form",{ref:Y,method:Ee,action:Ce,onSubmit:l?M:je,...ee,"data-discover":!Je&&c==="render"?"true":void 0})});vA.displayName="Form";function bA(c){return`${c} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function U1(c){let e=rt.useContext(om);return Dr(e,bA(c)),e}function xA(c,{target:e,replace:i,state:l,preventScrollReset:f,relative:v,viewTransition:y}={}){let h=P2(),M=$f(),O=Qg(c,{relative:v});return rt.useCallback(V=>{if(J2(V,e)){V.preventDefault();let K=i!==void 0?i:Ng(M)===Ng(O);h(c,{replace:K,state:l,preventScrollReset:f,relative:v,viewTransition:y})}},[M,h,O,i,l,e,c,f,v,y])}var wA=0,TA=()=>`__${String(++wA)}__`;function SA(){let{router:c}=U1("useSubmit"),{basename:e}=rt.useContext(xu),i=F2();return rt.useCallback(async(l,f={})=>{let{action:v,method:y,encType:h,formData:M,body:O}=nA(l,e);if(f.navigate===!1){let V=f.fetcherKey||TA();await c.fetch(V,i,f.action||v,{preventScrollReset:f.preventScrollReset,formData:M,body:O,formMethod:f.method||y,formEncType:f.encType||h,flushSync:f.flushSync})}else await c.navigate(f.action||v,{preventScrollReset:f.preventScrollReset,formData:M,body:O,formMethod:f.method||y,formEncType:f.encType||h,replace:f.replace,state:f.state,fromRouteId:i,flushSync:f.flushSync,viewTransition:f.viewTransition})},[c,e,i])}function EA(c,{relative:e}={}){let{basename:i}=rt.useContext(xu),l=rt.useContext(wu);Dr(l,"useFormAction must be used inside a RouteContext");let[f]=l.matches.slice(-1),v={...Qg(c||".",{relative:e})},y=$f();if(c==null){v.search=y.search;let h=new URLSearchParams(v.search),M=h.getAll("index");if(M.some(V=>V==="")){h.delete("index"),M.filter(K=>K).forEach(K=>h.append("index",K));let V=h.toString();v.search=V?`?${V}`:""}}return(!c||c===".")&&f.route.index&&(v.search=v.search?v.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(v.pathname=v.pathname==="/"?i:oh([i,v.pathname])),Ng(v)}function AA(c,{relative:e}={}){let i=rt.useContext(M1);Dr(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:l}=U1("useViewTransitionState"),f=Qg(c,{relative:e});if(!i.isTransitioning)return!1;let v=lh(i.currentLocation.pathname,l)||i.currentLocation.pathname,y=lh(i.nextLocation.pathname,l)||i.nextLocation.pathname;return Dy(f.pathname,y)!=null||Dy(f.pathname,v)!=null}const IA="_page_1rx36_31",CA="_header_1rx36_40",PA="_headerInner_1rx36_48",RA="_navPanel_1rx36_61",MA="_navMenu_1rx36_62",kA="_brand_1rx36_70",DA="_brandLogo_1rx36_77",OA="_burger_1rx36_96",zA="_nav_1rx36_61",LA="_navOverlay_1rx36_136",NA="_navOverlayOpen_1rx36_148",BA="_navPanelOpen_1rx36_170",VA="_navPanelHeader_1rx36_176",jA="_navPanelTitle_1rx36_185",UA="_navClose_1rx36_192",FA="_navLink_1rx36_232",$A="_main_1rx36_257",qA="_section_1rx36_263",GA="_sectionBis_1rx36_270",HA="_title_1rx36_278",ZA="_text_1rx36_287",WA="_objTitle_1rx36_310",KA="_list_1rx36_318",XA="_petitionBox_1rx36_328",YA="_petitionBtn_1rx36_336",QA="_mobileArrow_1rx36_381",JA="_mobileArrowIcon_1rx36_403",eI="_mapSectionRoot_1rx36_425",tI="_mapCanvas_1rx36_437",nI="_modalOverlay_1rx36_445",iI="_modalWrapper_1rx36_452",rI="_popup_1rx36_461",sI="_popupTitle_1rx36_474",aI="_sliderLabel_1rx36_485",oI="_slider_1rx36_485",lI="_popupSince_1rx36_522",cI="_popupFooter_1rx36_528",uI="_btn_1rx36_534",hI="_btnGhost_1rx36_543",dI="_btnPrimary_1rx36_549",fI="_nightModeBtn_1rx36_561",pI="_socials_1rx36_571",Yt={page:IA,header:CA,headerInner:PA,navPanel:RA,navMenu:MA,brand:kA,brandLogo:DA,burger:OA,nav:zA,navOverlay:LA,navOverlayOpen:NA,navPanelOpen:BA,navPanelHeader:VA,navPanelTitle:jA,navClose:UA,navLink:FA,main:$A,section:qA,sectionBis:GA,title:HA,text:ZA,objTitle:WA,list:KA,petitionBox:XA,petitionBtn:YA,mobileArrow:QA,mobileArrowIcon:JA,mapSectionRoot:eI,mapCanvas:tI,modalOverlay:nI,modalWrapper:iI,popup:rI,popupTitle:sI,sliderLabel:aI,slider:oI,popupSince:lI,popupFooter:cI,btn:uI,btnGhost:hI,btnPrimary:dI,nightModeBtn:fI,socials:pI},mI="/Skame-Parking/logo.png";var F1={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},yx=Df.createContext&&Df.createContext(F1),gI=["attr","size","title"];function _I(c,e){if(c==null)return{};var i=yI(c,e),l,f;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(c);for(f=0;f<v.length;f++)l=v[f],!(e.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(c,l)&&(i[l]=c[l])}return i}function yI(c,e){if(c==null)return{};var i={};for(var l in c)if(Object.prototype.hasOwnProperty.call(c,l)){if(e.indexOf(l)>=0)continue;i[l]=c[l]}return i}function Oy(){return Oy=Object.assign?Object.assign.bind():function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(c[l]=i[l])}return c},Oy.apply(this,arguments)}function vx(c,e){var i=Object.keys(c);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(c);e&&(l=l.filter(function(f){return Object.getOwnPropertyDescriptor(c,f).enumerable})),i.push.apply(i,l)}return i}function zy(c){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?vx(Object(i),!0).forEach(function(l){vI(c,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(i)):vx(Object(i)).forEach(function(l){Object.defineProperty(c,l,Object.getOwnPropertyDescriptor(i,l))})}return c}function vI(c,e,i){return e=bI(e),e in c?Object.defineProperty(c,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):c[e]=i,c}function bI(c){var e=xI(c,"string");return typeof e=="symbol"?e:e+""}function xI(c,e){if(typeof c!="object"||!c)return c;var i=c[Symbol.toPrimitive];if(i!==void 0){var l=i.call(c,e);if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(c)}function $1(c){return c&&c.map((e,i)=>Df.createElement(e.tag,zy({key:i},e.attr),$1(e.child)))}function lm(c){return e=>Df.createElement(wI,Oy({attr:zy({},c.attr)},e),$1(c.child))}function wI(c){var e=i=>{var{attr:l,size:f,title:v}=c,y=_I(c,gI),h=f||i.size||"1em",M;return i.className&&(M=i.className),c.className&&(M=(M?M+" ":"")+c.className),Df.createElement("svg",Oy({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,l,y,{className:M,style:zy(zy({color:c.color||i.color},i.style),c.style),height:h,width:h,xmlns:"http://www.w3.org/2000/svg"}),v&&Df.createElement("title",null,v),c.children)};return yx!==void 0?Df.createElement(yx.Consumer,null,i=>e(i)):e(F1)}function TI(c){return lm({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"},child:[]}]})(c)}function SI(c){return lm({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"},child:[]}]})(c)}function EI(c){return lm({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448,209.91a210.06,210.06,0,0,1-122.77-39.25V349.38A162.55,162.55,0,1,1,185,188.31V278.2a74.62,74.62,0,1,0,52.23,71.18V0l88,0a121.18,121.18,0,0,0,1.86,22.17h0A122.18,122.18,0,0,0,381,102.39a121.43,121.43,0,0,0,67,20.14Z"},child:[]}]})(c)}function AI(c){return lm({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"},child:[]}]})(c)}function II(c){return lm({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"},child:[]}]})(c)}function CI(c){return lm({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"m289.94 256 95-95A24 24 0 0 0 351 127l-95 95-95-95a24 24 0 0 0-34 34l95 95-95 95a24 24 0 1 0 34 34l95-95 95 95a24 24 0 0 0 34-34z"},child:[]}]})(c)}function PI({nightmode:c,onToggleNightmode:e}){const[i,l]=rt.useState(!1);return ht.jsxs(ht.Fragment,{children:[ht.jsx("header",{className:Yt.header,children:ht.jsxs("div",{className:Yt.headerInner,children:[ht.jsx(ad,{to:"/",className:Yt.brand,children:ht.jsx("img",{src:mI,alt:"Skame Parking",className:Yt.brandLogo})}),ht.jsxs("button",{className:Yt.burger,"aria-label":"Ouvrir le menu","aria-expanded":i,onClick:()=>l(!0),children:[ht.jsx("span",{}),ht.jsx("span",{}),ht.jsx("span",{})]}),ht.jsxs("nav",{className:Yt.nav,children:[ht.jsx(ad,{to:"/#mission",className:Yt.navLink,children:"Notre mission"}),ht.jsx("a",{href:"https://Ko-fi.com/skameparking",target:"_blank",rel:"noreferrer",className:Yt.navLink,children:"Don"}),ht.jsx("a",{href:"https://c.org/CwFHpvtnz2",target:"_blank",rel:"noopener noreferrer",className:Yt.navLink,children:"Ptition"}),ht.jsx(ad,{to:"/contact",className:Yt.navLink,children:"Contact / Rseaux sociaux"}),ht.jsx("button",{className:Yt.nightModeBtn,onClick:e,children:c?ht.jsx(II,{}):ht.jsx(AI,{})})]})]})}),ht.jsx("div",{className:`${Yt.navOverlay} ${i?Yt.navOverlayOpen:""}`,onClick:()=>l(!1),"aria-hidden":!i}),ht.jsxs("div",{className:`${Yt.navPanel} ${i?Yt.navPanelOpen:""}`,role:"dialog","aria-modal":"true","aria-label":"Menu","aria-hidden":!i,children:[ht.jsxs("div",{className:Yt.navPanelHeader,children:[ht.jsx("h3",{className:Yt.navPanelTitle,children:"Menu"}),ht.jsx("button",{className:Yt.navClose,onClick:()=>l(!1),"aria-label":"Fermer le menu",children:ht.jsx(CI,{})})]}),ht.jsxs("div",{className:Yt.navMenu,children:[ht.jsx(ad,{to:"/#mission",onClick:()=>l(!1),children:"Notre mission"}),ht.jsx(ad,{to:"/contact",onClick:()=>l(!1),children:"Contact / Rseaux sociaux"}),ht.jsx("a",{href:"https://Ko-fi.com/skameparking",target:"_blank",rel:"noreferrer",onClick:()=>l(!1),children:"Don"}),ht.jsx("a",{onClick:()=>{e()},children:c?"Mode clair":"Mode sombre"})]})]})]})}function RI(){const[c,e]=rt.useState(!1);rt.useEffect(()=>{document.documentElement.setAttribute("data-theme",c?"dark":"light")},[c]);const i=()=>e(l=>!l);return ht.jsxs(ht.Fragment,{children:[ht.jsx(PI,{nightmode:c,onToggleNightmode:i}),ht.jsx(H2,{context:{nightmode:c,toggleNightmode:i}})]})}var xy={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.7.3/LICENSE.txt
 */var MI=xy.exports,bx;function kI(){return bx||(bx=1,(function(c,e){(function(i,l){c.exports=l()})(MI,(function(){var i={},l={};function f(y,h,M){if(l[y]=M,y==="index"){var O="var sharedModule = {}; ("+l.shared+")(sharedModule); ("+l.worker+")(sharedModule);",V={};return l.shared(V),l.index(i,V),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([O],{type:"text/javascript"}))),i}}f("shared",["exports"],(function(y){function h(a,n,s,d){return new(s||(s=Promise))((function(g,w){function S(D){try{P(d.next(D))}catch(N){w(N)}}function A(D){try{P(d.throw(D))}catch(N){w(N)}}function P(D){var N;D.done?g(D.value):(N=D.value,N instanceof s?N:new s((function(j){j(N)}))).then(S,A)}P((d=d.apply(a,n||[])).next())}))}function M(a,n){this.x=a,this.y=n}function O(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var V,K;typeof SuppressedError=="function"&&SuppressedError,M.prototype={clone(){return new M(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,n){return this.clone()._rotateAround(a,n)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const n=a.x-this.x,s=a.y-this.y;return n*n+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,n){return Math.atan2(this.x*n-this.y*a,this.x*a+this.y*n)},_matMult(a){const n=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=n,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const n=Math.cos(a),s=Math.sin(a),d=s*this.x+n*this.y;return this.x=n*this.x-s*this.y,this.y=d,this},_rotateAround(a,n){const s=Math.cos(a),d=Math.sin(a),g=n.y+d*(this.x-n.x)+s*(this.y-n.y);return this.x=n.x+s*(this.x-n.x)-d*(this.y-n.y),this.y=g,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:M},M.convert=function(a){if(a instanceof M)return a;if(Array.isArray(a))return new M(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new M(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};var ee=(function(){if(K)return V;function a(n,s,d,g){this.cx=3*n,this.bx=3*(d-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(g-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=d,this.p2y=g}return K=1,V=a,a.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,s){if(s===void 0&&(s=1e-6),n<0)return 0;if(n>1)return 1;for(var d=n,g=0;g<8;g++){var w=this.sampleCurveX(d)-n;if(Math.abs(w)<s)return d;var S=this.sampleCurveDerivativeX(d);if(Math.abs(S)<1e-6)break;d-=w/S}var A=0,P=1;for(d=n,g=0;g<20&&(w=this.sampleCurveX(d),!(Math.abs(w-n)<s));g++)n>w?A=d:P=d,d=.5*(P-A)+A;return d},solve:function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))}},V})(),Y=O(ee);let ve,Ce;function Ee(){return ve==null&&(ve=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ve}function Je(){if(Ce==null&&(Ce=!1,Ee())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let d=0;d<25;d++){const g=4*d;n.fillStyle=`rgb(${g},${g+1},${g+2})`,n.fillRect(d%5,Math.floor(d/5),1,1)}const s=n.getImageData(0,0,5,5).data;for(let d=0;d<100;d++)if(d%4!=3&&s[d]!==d){Ce=!0;break}}}return Ce||!1}var je=1e-6,He=typeof Float32Array<"u"?Float32Array:Array;function gt(){var a=new He(9);return He!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function St(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Pt(){var a=new He(3);return He!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Se(a){var n=a[0],s=a[1],d=a[2];return Math.sqrt(n*n+s*s+d*d)}function pe(a,n,s){var d=new He(3);return d[0]=a,d[1]=n,d[2]=s,d}function ye(a,n,s){return a[0]=n[0]+s[0],a[1]=n[1]+s[1],a[2]=n[2]+s[2],a}function Oe(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a[2]=n[2]*s,a}function Me(a,n,s){var d=n[0],g=n[1],w=n[2],S=s[0],A=s[1],P=s[2];return a[0]=g*P-w*A,a[1]=w*S-d*P,a[2]=d*A-g*S,a}var Ve,Te=Se;function dn(a,n,s){var d=n[0],g=n[1],w=n[2],S=n[3];return a[0]=s[0]*d+s[4]*g+s[8]*w+s[12]*S,a[1]=s[1]*d+s[5]*g+s[9]*w+s[13]*S,a[2]=s[2]*d+s[6]*g+s[10]*w+s[14]*S,a[3]=s[3]*d+s[7]*g+s[11]*w+s[15]*S,a}function In(){var a=new He(4);return He!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function st(a,n,s,d){var g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",w=Math.PI/360;n*=w,d*=w,s*=w;var S=Math.sin(n),A=Math.cos(n),P=Math.sin(s),D=Math.cos(s),N=Math.sin(d),j=Math.cos(d);switch(g){case"xyz":a[0]=S*D*j+A*P*N,a[1]=A*P*j-S*D*N,a[2]=A*D*N+S*P*j,a[3]=A*D*j-S*P*N;break;case"xzy":a[0]=S*D*j-A*P*N,a[1]=A*P*j-S*D*N,a[2]=A*D*N+S*P*j,a[3]=A*D*j+S*P*N;break;case"yxz":a[0]=S*D*j+A*P*N,a[1]=A*P*j-S*D*N,a[2]=A*D*N-S*P*j,a[3]=A*D*j+S*P*N;break;case"yzx":a[0]=S*D*j+A*P*N,a[1]=A*P*j+S*D*N,a[2]=A*D*N-S*P*j,a[3]=A*D*j-S*P*N;break;case"zxy":a[0]=S*D*j-A*P*N,a[1]=A*P*j+S*D*N,a[2]=A*D*N+S*P*j,a[3]=A*D*j-S*P*N;break;case"zyx":a[0]=S*D*j-A*P*N,a[1]=A*P*j+S*D*N,a[2]=A*D*N-S*P*j,a[3]=A*D*j+S*P*N;break;default:throw new Error("Unknown angle order "+g)}return a}function kt(){var a=new He(2);return He!=Float32Array&&(a[0]=0,a[1]=0),a}function Zt(a,n){var s=new He(2);return s[0]=a,s[1]=n,s}Pt(),Ve=new He(4),He!=Float32Array&&(Ve[0]=0,Ve[1]=0,Ve[2]=0,Ve[3]=0),Pt(),pe(1,0,0),pe(0,1,0),In(),In(),gt(),kt();const Wt=8192;function De(a,n,s){return n*(Wt/(a.tileSize*Math.pow(2,s-a.tileID.overscaledZ)))}function ut(a,n){return(a%n+n)%n}function Ot(a,n,s){return a*(1-s)+n*s}function Mt(a){if(a<=0)return 0;if(a>=1)return 1;const n=a*a,s=n*a;return 4*(a<.5?s:3*(a-n)+s-.75)}function qt(a,n,s,d){const g=new Y(a,n,s,d);return w=>g.solve(w)}const An=qt(.25,.1,.25,1);function Ht(a,n,s){return Math.min(s,Math.max(n,a))}function Ji(a,n,s){const d=s-n,g=((a-n)%d+d)%d+n;return g===n?s:g}function On(a,...n){for(const s of n)for(const d in s)a[d]=s[d];return a}let ar=1;function uo(a,n,s){const d={};for(const g in a)d[g]=n.call(this,a[g],g,a);return d}function Na(a,n,s){const d={};for(const g in a)n.call(this,a[g],g,a)&&(d[g]=a[g]);return d}function zr(a){return Array.isArray(a)?a.map(zr):typeof a=="object"&&a?uo(a,zr):a}const hi={};function Pi(a){hi[a]||(typeof console<"u"&&console.warn(a),hi[a]=!0)}function Xs(a,n,s){return(s.y-a.y)*(n.x-a.x)>(n.y-a.y)*(s.x-a.x)}function Ls(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let br=null;function Ys(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const di="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Wi(a,n,s,d,g){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(a,{timestamp:0});try{const S=w?.format;if(!S||!S.startsWith("BGR")&&!S.startsWith("RGB"))throw new Error(`Unrecognized format ${S}`);const A=S.startsWith("BGR"),P=new Uint8ClampedArray(d*g*4);if(yield w.copyTo(P,(function(D,N,j,q,W){const X=4*Math.max(-N,0),ne=(Math.max(0,j)-j)*q*4+X,se=4*q,ue=Math.max(0,N),Ne=Math.max(0,j);return{rect:{x:ue,y:Ne,width:Math.min(D.width,N+q)-ue,height:Math.min(D.height,j+W)-Ne},layout:[{offset:ne,stride:se}]}})(a,n,s,d,g)),A)for(let D=0;D<P.length;D+=4){const N=P[D];P[D]=P[D+2],P[D+2]=N}return P}finally{w.close()}}))}let Yr,ho;function xa(a,n,s,d){return a.addEventListener(n,s,d),{unsubscribe:()=>{a.removeEventListener(n,s,d)}}}function Bo(a){return a*Math.PI/180}function Ns(a){return a/Math.PI*180}const gs={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ki={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},qr="AbortError";function Pe(){return new Error(qr)}const J={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Q(a){return J.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const re="global-dispatcher";class me extends Error{constructor(n,s,d,g){super(`AJAXError: ${s} (${n}): ${d}`),this.status=n,this.statusText=s,this.url=d,this.body=g}}const xe=()=>Ls(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ke=function(a,n){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const d=Q(a.url);if(d)return d(a,n);if(Ls(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:re},n)}if(!(/^file:/.test(s=a.url)||/^file:/.test(xe())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(d,g){return h(this,void 0,void 0,(function*(){const w=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,cache:d.cache,referrer:xe(),signal:g.signal});let S,A;d.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");try{S=yield fetch(w)}catch(D){throw new me(0,D.message,d.url,new Blob)}if(!S.ok){const D=yield S.blob();throw new me(S.status,S.statusText,d.url,D)}A=d.type==="arrayBuffer"||d.type==="image"?S.arrayBuffer():d.type==="json"?S.json():S.text();const P=yield A;if(g.signal.aborted)throw Pe();return{data:P,cacheControl:S.headers.get("Cache-Control"),expires:S.headers.get("Expires")}}))})(a,n);if(Ls(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:re},n)}var s;return(function(d,g){return new Promise(((w,S)=>{var A;const P=new XMLHttpRequest;P.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(P.responseType="arraybuffer");for(const D in d.headers)P.setRequestHeader(D,d.headers[D]);d.type==="json"&&(P.responseType="text",!((A=d.headers)===null||A===void 0)&&A.Accept||P.setRequestHeader("Accept","application/json")),P.withCredentials=d.credentials==="include",P.onerror=()=>{S(new Error(P.statusText))},P.onload=()=>{if(!g.signal.aborted)if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let D=P.response;if(d.type==="json")try{D=JSON.parse(P.response)}catch(N){return void S(N)}w({data:D,cacheControl:P.getResponseHeader("Cache-Control"),expires:P.getResponseHeader("Expires")})}else{const D=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});S(new me(P.status,P.statusText,d.url,D))}},g.signal.addEventListener("abort",(()=>{P.abort(),S(Pe())})),P.send(d.body)}))})(a,n)};function Fe(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const n=new URL(a),s=window.location;return n.protocol===s.protocol&&n.host===s.host}function Le(a,n,s){s[a]&&s[a].indexOf(n)!==-1||(s[a]=s[a]||[],s[a].push(n))}function nt(a,n,s){if(s&&s[a]){const d=s[a].indexOf(n);d!==-1&&s[a].splice(d,1)}}class mt{constructor(n,s={}){On(this,s),this.type=n}}class ot extends mt{constructor(n,s={}){super("error",On({error:n},s))}}class zt{on(n,s){return this._listeners=this._listeners||{},Le(n,s,this._listeners),{unsubscribe:()=>{this.off(n,s)}}}off(n,s){return nt(n,s,this._listeners),nt(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Le(n,s,this._oneTimeListeners),this):new Promise((d=>this.once(n,d)))}fire(n,s){typeof n=="string"&&(n=new mt(n,s||{}));const d=n.type;if(this.listens(d)){n.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const A of g)A.call(this,n);const w=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const A of w)nt(d,A,this._oneTimeListeners),A.call(this,n);const S=this._eventedParent;S&&(On(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(n))}else n instanceof ot&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}var Re={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const nn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function _n(a,n){const s={};for(const d in a)d!=="ref"&&(s[d]=a[d]);return nn.forEach((d=>{d in n&&(s[d]=n[d])})),s}function Nt(a,n){if(Array.isArray(a)){if(!Array.isArray(n)||a.length!==n.length)return!1;for(let s=0;s<a.length;s++)if(!Nt(a[s],n[s]))return!1;return!0}if(typeof a=="object"&&a!==null&&n!==null){if(typeof n!="object"||Object.keys(a).length!==Object.keys(n).length)return!1;for(const s in a)if(!Nt(a[s],n[s]))return!1;return!0}return a===n}function cn(a,n){a.push(n)}function Yn(a,n,s){cn(s,{command:"addSource",args:[a,n[a]]})}function vi(a,n,s){cn(n,{command:"removeSource",args:[a]}),s[a]=!0}function or(a,n,s,d){vi(a,s,d),Yn(a,n,s)}function ei(a,n,s){let d;for(d in a[s])if(Object.prototype.hasOwnProperty.call(a[s],d)&&d!=="data"&&!Nt(a[s][d],n[s][d]))return!1;for(d in n[s])if(Object.prototype.hasOwnProperty.call(n[s],d)&&d!=="data"&&!Nt(a[s][d],n[s][d]))return!1;return!0}function Kt(a,n,s,d,g,w){a=a||{},n=n||{};for(const S in a)Object.prototype.hasOwnProperty.call(a,S)&&(Nt(a[S],n[S])||s.push({command:w,args:[d,S,n[S],g]}));for(const S in n)Object.prototype.hasOwnProperty.call(n,S)&&!Object.prototype.hasOwnProperty.call(a,S)&&(Nt(a[S],n[S])||s.push({command:w,args:[d,S,n[S],g]}))}function rn(a){return a.id}function fi(a,n){return a[n.id]=n,a}class yt{constructor(n,s,d,g){this.message=(n?`${n}: `:"")+d,g&&(this.identifier=g),s!=null&&s.__line__&&(this.line=s.__line__)}}function er(a,...n){for(const s of n)for(const d in s)a[d]=s[d];return a}class Ni extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class Lr{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[d,g]of s)this.bindings[d]=g}concat(n){return new Lr(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Qs={kind:"null"},It={kind:"number"},un={kind:"string"},sn={kind:"boolean"},$i={kind:"color"},Bs={kind:"projectionDefinition"},pi={kind:"object"},pn={kind:"value"},fo={kind:"collator"},Gr={kind:"formatted"},Js={kind:"padding"},Qr={kind:"colorArray"},_s={kind:"numberArray"},bi={kind:"resolvedImage"},Cc={kind:"variableAnchorOffsetCollection"};function xr(a,n){return{kind:"array",itemType:a,N:n}}function qn(a){if(a.kind==="array"){const n=qn(a.itemType);return typeof a.N=="number"?`array<${n}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${n}>`}return a.kind}const ea=[Qs,It,un,sn,$i,Bs,Gr,pi,xr(pn),Js,_s,Qr,bi,Cc];function Ba(a,n){if(n.kind==="error")return null;if(a.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Ba(a.itemType,n.itemType))&&(typeof a.N!="number"||a.N===n.N))return null}else{if(a.kind===n.kind)return null;if(a.kind==="value"){for(const s of ea)if(!Ba(s,n))return null}}return`Expected ${qn(a)} but found ${qn(n)} instead.`}function fl(a,n){return n.some((s=>s.kind===a.kind))}function Jr(a,n){return n.some((s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a))}function ta(a,n){return a.kind==="array"&&n.kind==="array"?a.itemType.kind===n.itemType.kind&&typeof a.N=="number":a.kind===n.kind}const pl=.96422,mh=.82521,wa=4/29,mi=6/29,Vo=3*mi*mi,Ul=mi*mi*mi,ml=Math.PI/180,gi=180/Math.PI;function Va(a){return(a%=360)<0&&(a+=360),a}function Ta([a,n,s,d]){let g,w;const S=Fl((.2225045*(a=wr(a))+.7168786*(n=wr(n))+.0606169*(s=wr(s)))/1);a===n&&n===s?g=w=S:(g=Fl((.4360747*a+.3850649*n+.1430804*s)/pl),w=Fl((.0139322*a+.0971045*n+.7141733*s)/mh));const A=116*S-16;return[A<0?0:A,500*(g-S),200*(S-w),d]}function wr(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Fl(a){return a>Ul?Math.pow(a,1/3):a/Vo+wa}function po([a,n,s,d]){let g=(a+16)/116,w=isNaN(n)?g:g+n/500,S=isNaN(s)?g:g-s/200;return g=1*mo(g),w=pl*mo(w),S=mh*mo(S),[$l(3.1338561*w-1.6168667*g-.4906146*S),$l(-.9787684*w+1.9161415*g+.033454*S),$l(.0719453*w-.2289914*g+1.4052427*S),d]}function $l(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function mo(a){return a>mi?a*a*a:Vo*(a-wa)}const gh=Object.hasOwn||function(a,n){return Object.prototype.hasOwnProperty.call(a,n)};function jo(a,n){return gh(a,n)?a[n]:void 0}function es(a){return parseInt(a.padEnd(2,a),16)/255}function Ar(a,n){return xn(n?a/100:a,0,1)}function xn(a,n,s){return Math.min(Math.max(n,a),s)}function ja(a){return!a.some(Number.isNaN)}const na={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Sa(a,n,s){return a+s*(n-a)}function go(a,n,s){return a.map(((d,g)=>Sa(d,n[g],s)))}class on{constructor(n,s,d,g=1,w=!0){this.r=n,this.g=s,this.b=d,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[n,s,d,g]))}static parse(n){if(n instanceof on)return n;if(typeof n!="string")return;const s=(function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=jo(na,d);if(g){const[S,A,P]=g;return[S/255,A/255,P/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const S=d.length<6?1:2;let A=1;return[es(d.slice(A,A+=S)),es(d.slice(A,A+=S)),es(d.slice(A,A+=S)),es(d.slice(A,A+S)||"ff")]}if(d.startsWith("rgb")){const S=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[A,P,D,N,j,q,W,X,ne,se,ue,Ne]=S,_e=[N||" ",W||" ",se].join("");if(_e==="  "||_e==="  /"||_e===",,"||_e===",,,"){const Ae=[D,q,ne].join(""),Ze=Ae==="%%%"?100:Ae===""?255:0;if(Ze){const et=[xn(+P/Ze,0,1),xn(+j/Ze,0,1),xn(+X/Ze,0,1),ue?Ar(+ue,Ne):1];if(ja(et))return et}}return}}const w=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[S,A,P,D,N,j,q,W,X]=w,ne=[P||" ",N||" ",q].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const se=[+A,xn(+D,0,100),xn(+j,0,100),W?Ar(+W,X):1];if(ja(se))return(function([ue,Ne,_e,Ae]){function Ze(et){const dt=(et+ue/30)%12,At=Ne*Math.min(_e,1-_e);return _e-At*Math.max(-1,Math.min(dt-3,9-dt,1))}return ue=Va(ue),Ne/=100,_e/=100,[Ze(0),Ze(8),Ze(4),Ae]})(se)}}})(n);return s?new on(...s,!1):void 0}get rgb(){const{r:n,g:s,b:d,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[n/w,s/w,d/w,g])}get hcl(){return this.overwriteGetter("hcl",(function(n){const[s,d,g,w]=Ta(n),S=Math.sqrt(d*d+g*g);return[Math.round(1e4*S)?Va(Math.atan2(g,d)*gi):NaN,S,s,w]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Ta(this.rgb))}overwriteGetter(n,s){return Object.defineProperty(this,n,{value:s}),s}toString(){const[n,s,d,g]=this.rgb;return`rgba(${[n,s,d].map((w=>Math.round(255*w))).join(",")},${g})`}static interpolate(n,s,d,g="rgb"){switch(g){case"rgb":{const[w,S,A,P]=go(n.rgb,s.rgb,d);return new on(w,S,A,P,!1)}case"hcl":{const[w,S,A,P]=n.hcl,[D,N,j,q]=s.hcl;let W,X;if(isNaN(w)||isNaN(D))isNaN(w)?isNaN(D)?W=NaN:(W=D,A!==1&&A!==0||(X=N)):(W=w,j!==1&&j!==0||(X=S));else{let _e=D-w;D>w&&_e>180?_e-=360:D<w&&w-D>180&&(_e+=360),W=w+d*_e}const[ne,se,ue,Ne]=(function([_e,Ae,Ze,et]){return _e=isNaN(_e)?0:_e*ml,po([Ze,Math.cos(_e)*Ae,Math.sin(_e)*Ae,et])})([W,X??Sa(S,N,d),Sa(A,j,d),Sa(P,q,d)]);return new on(ne,se,ue,Ne,!1)}case"lab":{const[w,S,A,P]=po(go(n.lab,s.lab,d));return new on(w,S,A,P,!1)}}}}on.black=new on(0,0,0,1),on.white=new on(1,1,1,1),on.transparent=new on(0,0,0,0),on.red=new on(1,0,0,1);class Ua{constructor(n,s,d){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const gl=["bottom","center","top"];class Fa{constructor(n,s,d,g,w,S){this.text=n,this.image=s,this.scale=d,this.fontStack=g,this.textColor=w,this.verticalAlign=S}}class si{constructor(n){this.sections=n}static fromString(n){return new si([new Fa(n,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((n=>n.text.length!==0||n.image&&n.image.name.length!==0))}static factory(n){return n instanceof si?n:si.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map((n=>n.text)).join("")}}class lr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof lr)return n;if(typeof n=="number")return new lr([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const s of n)if(typeof s!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new lr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,s,d){return new lr(go(n.values,s.values,d))}}class cr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof cr)return n;if(typeof n=="number")return new cr([n]);if(Array.isArray(n)){for(const s of n)if(typeof s!="number")return;return new cr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,s,d){return new cr(go(n.values,s.values,d))}}class Ri{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Ri)return n;if(typeof n=="string"){const d=on.parse(n);return d?new Ri([d]):void 0}if(!Array.isArray(n))return;const s=[];for(const d of n){if(typeof d!="string")return;const g=on.parse(d);if(!g)return;s.push(g)}return new Ri(s)}toString(){return JSON.stringify(this.values)}static interpolate(n,s,d,g="rgb"){const w=[];if(n.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${n.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let S=0;S<n.values.length;S++)w.push(on.interpolate(n.values[S],s.values[S],d,g));return new Ri(w)}}class Vn extends Error{constructor(n){super(n),this.name="RuntimeError"}toJSON(){return this.message}}const ts=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xi{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Xi)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let s=0;s<n.length;s+=2){const d=n[s],g=n[s+1];if(typeof d!="string"||!ts.has(d)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Xi(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,s,d){const g=n.values,w=s.values;if(g.length!==w.length)throw new Vn(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${s.toString()}`);const S=[];for(let A=0;A<g.length;A+=2){if(g[A]!==w[A])throw new Vn(`Cannot interpolate values containing mismatched anchors. from[${A}]: ${g[A]}, to[${A}]: ${w[A]}`);S.push(g[A]);const[P,D]=g[A+1],[N,j]=w[A+1];S.push([Sa(P,N,d),Sa(D,j,d)])}return new Xi(S)}}class Tr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Tr({name:n,available:!1}):null}}class xi{constructor(n,s,d){this.from=n,this.to=s,this.transition=d}static interpolate(n,s,d){return new xi(n,s,d)}static parse(n){return n instanceof xi?n:Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"?new xi(n[0],n[1],n[2]):typeof n=="object"&&typeof n.from=="string"&&typeof n.to=="string"&&typeof n.transition=="number"?new xi(n.from,n.to,n.transition):typeof n=="string"?new xi(n,n,1):void 0}}function ln(a,n,s,d){return typeof a=="number"&&a>=0&&a<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[a,n,s,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[a,n,s,d]:[a,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ea(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof xi||a instanceof on||a instanceof Ua||a instanceof si||a instanceof lr||a instanceof cr||a instanceof Ri||a instanceof Xi||a instanceof Tr)return!0;if(Array.isArray(a)){for(const n of a)if(!Ea(n))return!1;return!0}if(typeof a=="object"){for(const n in a)if(!Ea(a[n]))return!1;return!0}return!1}function Qt(a){if(a===null)return Qs;if(typeof a=="string")return un;if(typeof a=="boolean")return sn;if(typeof a=="number")return It;if(a instanceof on)return $i;if(a instanceof xi)return Bs;if(a instanceof Ua)return fo;if(a instanceof si)return Gr;if(a instanceof lr)return Js;if(a instanceof cr)return _s;if(a instanceof Ri)return Qr;if(a instanceof Xi)return Cc;if(a instanceof Tr)return bi;if(Array.isArray(a)){const n=a.length;let s;for(const d of a){const g=Qt(d);if(s){if(s===g)continue;s=pn;break}s=g}return xr(s||pn,n)}return pi}function an(a){const n=typeof a;return a===null?"":n==="string"||n==="number"||n==="boolean"?String(a):a instanceof on||a instanceof xi||a instanceof si||a instanceof lr||a instanceof cr||a instanceof Ri||a instanceof Xi||a instanceof Tr?a.toString():JSON.stringify(a)}class ys{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(n.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Ea(n[1]))return s.error("invalid value");const d=n[1];let g=Qt(d);const w=s.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new ys(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Cn={string:un,number:It,boolean:sn,object:pi};class Qn{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let d,g=1;const w=n[0];if(w==="array"){let A,P;if(n.length>2){const D=n[1];if(typeof D!="string"||!(D in Cn)||D==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);A=Cn[D],g++}else A=pn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);P=n[2],g++}d=xr(A,P)}else{if(!Cn[w])throw new Error(`Types doesn't contain name = ${w}`);d=Cn[w]}const S=[];for(;g<n.length;g++){const A=s.parse(n[g],g,pn);if(!A)return null;S.push(A)}return new Qn(d,S)}evaluate(n){for(let s=0;s<this.args.length;s++){const d=this.args[s].evaluate(n);if(!Ba(this.type,Qt(d)))return d;if(s===this.args.length-1)throw new Vn(`Expected value to be of type ${qn(this.type)}, but found ${qn(Qt(d))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}}const Bi={"to-boolean":sn,"to-color":$i,"to-number":It,"to-string":un};class ns{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const d=n[0];if(!Bi[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&n.length!==2)return s.error("Expected one argument.");const g=Bi[d],w=[];for(let S=1;S<n.length;S++){const A=s.parse(n[S],S,pn);if(!A)return null;w.push(A)}return new ns(g,w)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let s,d;for(const g of this.args){if(s=g.evaluate(n),d=null,s instanceof on)return s;if(typeof s=="string"){const w=n.parseColor(s);if(w)return w}else if(Array.isArray(s)&&(d=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:ln(s[0],s[1],s[2],s[3]),!d))return new on(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Vn(d||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const d of this.args){s=d.evaluate(n);const g=lr.parse(s);if(g)return g}throw new Vn(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const d of this.args){s=d.evaluate(n);const g=cr.parse(s);if(g)return g}throw new Vn(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const d of this.args){s=d.evaluate(n);const g=Ri.parse(s);if(g)return g}throw new Vn(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const d of this.args){s=d.evaluate(n);const g=Xi.parse(s);if(g)return g}throw new Vn(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const d of this.args){if(s=d.evaluate(n),s===null)return 0;const g=Number(s);if(!isNaN(g))return g}throw new Vn(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return si.fromString(an(this.args[0].evaluate(n)));case"resolvedImage":return Tr.fromString(an(this.args[0].evaluate(n)));case"projectionDefinition":return this.args[0].evaluate(n);default:return an(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}}const _o=["Unknown","Point","LineString","Polygon"];class Uo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_o[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let s=this._parseColorCache.get(n);return s||(s=on.parse(n),this._parseColorCache.set(n,s)),s}}class $a{constructor(n,s,d=[],g,w=new Lr,S=[]){this.registry=n,this.path=d,this.key=d.map((A=>`[${A}]`)).join(""),this.scope=w,this.errors=S,this.expectedType=g,this._isConstant=s}parse(n,s,d,g,w={}){return s?this.concat(s,d,g)._parse(n,w):this._parse(n,w)}_parse(n,s){function d(g,w,S){return S==="assert"?new Qn(w,[g]):S==="coerce"?new ns(w,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=n[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let S=w.parse(n,this);if(!S)return null;if(this.expectedType){const A=this.expectedType,P=S.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||P.kind!=="value"){if(A.kind==="projectionDefinition"&&["string","array"].includes(P.kind)||["color","formatted","resolvedImage"].includes(A.kind)&&["value","string"].includes(P.kind)||["padding","numberArray"].includes(A.kind)&&["value","number","array"].includes(P.kind)||A.kind==="colorArray"&&["value","string","array"].includes(P.kind)||A.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(P.kind))S=d(S,A,s.typeAnnotation||"coerce");else if(this.checkSubtype(A,P))return null}else S=d(S,A,s.typeAnnotation||"assert")}if(!(S instanceof ys)&&S.type.kind!=="resolvedImage"&&this._isConstant(S)){const A=new Uo;try{S=new ys(S.type,S.evaluate(A))}catch(P){return this.error(P.message),null}}return S}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,d){const g=typeof n=="number"?this.path.concat(n):this.path,w=d?this.scope.concat(d):this.scope;return new $a(this.registry,this._isConstant,g,s||null,w,this.errors)}error(n,...s){const d=`${this.key}${s.map((g=>`[${g}]`)).join("")}`;this.errors.push(new Ni(d,n))}checkSubtype(n,s){const d=Ba(n,s);return d&&this.error(d),d}}class qa{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const d=[];for(let w=1;w<n.length-1;w+=2){const S=n[w];if(typeof S!="string")return s.error(`Expected string, but found ${typeof S} instead.`,w);if(/[^a-zA-Z0-9_]/.test(S))return s.error("Variable names must contain only alphanumeric characters or '_'.",w);const A=s.parse(n[w+1],w+1);if(!A)return null;d.push([S,A])}const g=s.parse(n[n.length-1],n.length-1,s.expectedType,d);return g?new qa(d,g):null}outputDefined(){return this.result.outputDefined()}}class ia{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const d=n[1];return s.scope.has(d)?new ia(d,s.scope.get(d)):s.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class yo{constructor(n,s,d){this.type=n,this.index=s,this.input=d}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=s.parse(n[1],1,It),g=s.parse(n[2],2,xr(s.expectedType||pn));return d&&g?new yo(g.type.itemType,d,g):null}evaluate(n){const s=this.index.evaluate(n),d=this.input.evaluate(n);if(s<0)throw new Vn(`Array index out of bounds: ${s} < 0.`);if(s>=d.length)throw new Vn(`Array index out of bounds: ${s} > ${d.length-1}.`);if(s!==Math.floor(s))throw new Vn(`Array index must be an integer, but found ${s} instead.`);return d[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class vo{constructor(n,s){this.type=sn,this.needle=n,this.haystack=s}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=s.parse(n[1],1,pn),g=s.parse(n[2],2,pn);return d&&g?fl(d.type,[sn,un,It,Qs,pn])?new vo(d,g):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${qn(d.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!d)return!1;if(!Jr(s,["boolean","string","number","null"]))throw new Vn(`Expected first argument to be of type boolean, string, number or null, but found ${qn(Qt(s))} instead.`);if(!Jr(d,["string","array"]))throw new Vn(`Expected second argument to be of type array or string, but found ${qn(Qt(d))} instead.`);return d.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class ra{constructor(n,s,d){this.type=It,this.needle=n,this.haystack=s,this.fromIndex=d}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 2 or 3 arguments, but found ${n.length-1} instead.`);const d=s.parse(n[1],1,pn),g=s.parse(n[2],2,pn);if(!d||!g)return null;if(!fl(d.type,[sn,un,It,Qs,pn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${qn(d.type)} instead`);if(n.length===4){const w=s.parse(n[3],3,It);return w?new ra(d,g,w):null}return new ra(d,g)}evaluate(n){const s=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!Jr(s,["boolean","string","number","null"]))throw new Vn(`Expected first argument to be of type boolean, string, number or null, but found ${qn(Qt(s))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(n)),Jr(d,["string"])){const w=d.indexOf(s,g);return w===-1?-1:[...d.slice(0,w)].length}if(Jr(d,["array"]))return d.indexOf(s,g);throw new Vn(`Expected second argument to be of type array or string, but found ${qn(Qt(d))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class ur{constructor(n,s,d,g,w,S){this.inputType=n,this.type=s,this.input=d,this.cases=g,this.outputs=w,this.otherwise=S}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let d,g;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);const w={},S=[];for(let D=2;D<n.length-1;D+=2){let N=n[D];const j=n[D+1];Array.isArray(N)||(N=[N]);const q=s.concat(D);if(N.length===0)return q.error("Expected at least one branch label.");for(const X of N){if(typeof X!="number"&&typeof X!="string")return q.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return q.error("Numeric branch labels must be integer values.");if(d){if(q.checkSubtype(d,Qt(X)))return null}else d=Qt(X);if(w[String(X)]!==void 0)return q.error("Branch labels must be unique.");w[String(X)]=S.length}const W=s.parse(j,D,g);if(!W)return null;g=g||W.type,S.push(W)}const A=s.parse(n[1],1,pn);if(!A)return null;const P=s.parse(n[n.length-1],n.length-1,g);return P?A.type.kind!=="value"&&s.concat(1).checkSubtype(d,A.type)?null:new ur(d,g,A,w,S,P):null}evaluate(n){const s=this.input.evaluate(n);return(Qt(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Aa{constructor(n,s,d){this.type=n,this.branches=s,this.otherwise=d}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);const g=[];for(let S=1;S<n.length-1;S+=2){const A=s.parse(n[S],S,sn);if(!A)return null;const P=s.parse(n[S+1],S+1,d);if(!P)return null;g.push([A,P]),d=d||P.type}const w=s.parse(n[n.length-1],n.length-1,d);if(!w)return null;if(!d)throw new Error("Can't infer output type");return new Aa(d,g,w)}evaluate(n){for(const[s,d]of this.branches)if(s.evaluate(n))return d.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,d]of this.branches)n(s),n(d);n(this.otherwise)}outputDefined(){return this.branches.every((([n,s])=>s.outputDefined()))&&this.otherwise.outputDefined()}}class bo{constructor(n,s,d,g){this.type=n,this.input=s,this.beginIndex=d,this.endIndex=g}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 2 or 3 arguments, but found ${n.length-1} instead.`);const d=s.parse(n[1],1,pn),g=s.parse(n[2],2,It);if(!d||!g)return null;if(!fl(d.type,[xr(pn),un,pn]))return s.error(`Expected first argument to be of type array or string, but found ${qn(d.type)} instead`);if(n.length===4){const w=s.parse(n[3],3,It);return w?new bo(d.type,d,g,w):null}return new bo(d.type,d,g)}evaluate(n){const s=this.input.evaluate(n),d=this.beginIndex.evaluate(n);let g;if(this.endIndex&&(g=this.endIndex.evaluate(n)),Jr(s,["string"]))return[...s].slice(d,g).join("");if(Jr(s,["array"]))return s.slice(d,g);throw new Vn(`Expected first argument to be of type array or string, but found ${qn(Qt(s))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function xo(a,n){const s=a.length-1;let d,g,w=0,S=s,A=0;for(;w<=S;)if(A=Math.floor((w+S)/2),d=a[A],g=a[A+1],d<=n){if(A===s||n<g)return A;w=A+1}else{if(!(d>n))throw new Vn("Input is not a number.");S=A-1}return 0}class Mi{constructor(n,s,d){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[g,w]of d)this.labels.push(g),this.outputs.push(w)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const d=s.parse(n[1],1,It);if(!d)return null;const g=[];let w=null;s.expectedType&&s.expectedType.kind!=="value"&&(w=s.expectedType);for(let S=1;S<n.length;S+=2){const A=S===1?-1/0:n[S],P=n[S+1],D=S,N=S+1;if(typeof A!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=A)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const j=s.parse(P,N,w);if(!j)return null;w=w||j.type,g.push([A,j])}return new Mi(w,d,g)}evaluate(n){const s=this.labels,d=this.outputs;if(s.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=s[0])return d[0].evaluate(n);const w=s.length;return g>=s[w-1]?d[w-1].evaluate(n):d[xo(s,g)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))}}function Pc(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var _l,yl,Tu=(function(){if(yl)return _l;function a(n,s,d,g){this.cx=3*n,this.bx=3*(d-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(g-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=d,this.p2y=g}return yl=1,_l=a,a.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,s){if(s===void 0&&(s=1e-6),n<0)return 0;if(n>1)return 1;for(var d=n,g=0;g<8;g++){var w=this.sampleCurveX(d)-n;if(Math.abs(w)<s)return d;var S=this.sampleCurveDerivativeX(d);if(Math.abs(S)<1e-6)break;d-=w/S}var A=0,P=1;for(d=n,g=0;g<20&&(w=this.sampleCurveX(d),!(Math.abs(w-n)<s));g++)n>w?A=d:P=d,d=.5*(P-A)+A;return d},solve:function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))}},_l})(),Fo=Pc(Tu);class Vi{constructor(n,s,d,g,w){this.type=n,this.operator=s,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[S,A]of w)this.labels.push(S),this.outputs.push(A)}static interpolationFactor(n,s,d,g){let w=0;if(n.name==="exponential")w=vl(s,n.base,d,g);else if(n.name==="linear")w=vl(s,1,d,g);else if(n.name==="cubic-bezier"){const S=n.controlPoints;w=new Fo(S[0],S[1],S[2],S[3]).solve(vl(s,1,d,g))}return w}static parse(n,s){let[d,g,w,...S]=n;if(!Array.isArray(g)||g.length===0)return s.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const D=g[1];if(typeof D!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:D}}else{if(g[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const D=g.slice(1);if(D.length!==4||D.some((N=>typeof N!="number"||N<0||N>1)))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:D}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(w=s.parse(w,2,It),!w)return null;const A=[];let P=null;d!=="interpolate-hcl"&&d!=="interpolate-lab"||s.expectedType==Qr?s.expectedType&&s.expectedType.kind!=="value"&&(P=s.expectedType):P=$i;for(let D=0;D<S.length;D+=2){const N=S[D],j=S[D+1],q=D+3,W=D+4;if(typeof N!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(A.length&&A[A.length-1][0]>=N)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const X=s.parse(j,W,P);if(!X)return null;P=P||X.type,A.push([N,X])}return ta(P,It)||ta(P,Bs)||ta(P,$i)||ta(P,Js)||ta(P,_s)||ta(P,Qr)||ta(P,Cc)||ta(P,xr(It))?new Vi(P,d,g,w,A):s.error(`Type ${qn(P)} is not interpolatable.`)}evaluate(n){const s=this.labels,d=this.outputs;if(s.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=s[0])return d[0].evaluate(n);const w=s.length;if(g>=s[w-1])return d[w-1].evaluate(n);const S=xo(s,g),A=Vi.interpolationFactor(this.interpolation,g,s[S],s[S+1]),P=d[S].evaluate(n),D=d[S+1].evaluate(n);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Sa(P,D,A);case"color":return on.interpolate(P,D,A);case"padding":return lr.interpolate(P,D,A);case"colorArray":return Ri.interpolate(P,D,A);case"numberArray":return cr.interpolate(P,D,A);case"variableAnchorOffsetCollection":return Xi.interpolate(P,D,A);case"array":return go(P,D,A);case"projectionDefinition":return xi.interpolate(P,D,A)}case"interpolate-hcl":switch(this.type.kind){case"color":return on.interpolate(P,D,A,"hcl");case"colorArray":return Ri.interpolate(P,D,A,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return on.interpolate(P,D,A,"lab");case"colorArray":return Ri.interpolate(P,D,A,"lab")}}}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))}}function vl(a,n,s,d){const g=d-s,w=a-s;return g===0?0:n===1?w/g:(Math.pow(n,w)-1)/(Math.pow(n,g)-1)}const sa={color:on.interpolate,number:Sa,padding:lr.interpolate,numberArray:cr.interpolate,colorArray:Ri.interpolate,variableAnchorOffsetCollection:Xi.interpolate,array:go};class wo{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let d=null;const g=s.expectedType;g&&g.kind!=="value"&&(d=g);const w=[];for(const A of n.slice(1)){const P=s.parse(A,1+w.length,d,void 0,{typeAnnotation:"omit"});if(!P)return null;d=d||P.type,w.push(P)}if(!d)throw new Error("No output type");const S=g&&w.some((A=>Ba(g,A.type)));return new wo(S?pn:d,w)}evaluate(n){let s,d=null,g=0;for(const w of this.args)if(g++,d=w.evaluate(n),d&&d instanceof Tr&&!d.available&&(s||(s=d.name),d=null,g===this.args.length&&(d=s)),d!==null)break;return d}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}}function bl(a,n){return a==="=="||a==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function To(a,n,s,d){return d.compare(n,s)===0}function ti(a,n,s){const d=a!=="=="&&a!=="!=";return class q1{constructor(w,S,A){this.type=sn,this.lhs=w,this.rhs=S,this.collator=A,this.hasUntypedArgument=w.type.kind==="value"||S.type.kind==="value"}static parse(w,S){if(w.length!==3&&w.length!==4)return S.error("Expected two or three arguments.");const A=w[0];let P=S.parse(w[1],1,pn);if(!P)return null;if(!bl(A,P.type))return S.concat(1).error(`"${A}" comparisons are not supported for type '${qn(P.type)}'.`);let D=S.parse(w[2],2,pn);if(!D)return null;if(!bl(A,D.type))return S.concat(2).error(`"${A}" comparisons are not supported for type '${qn(D.type)}'.`);if(P.type.kind!==D.type.kind&&P.type.kind!=="value"&&D.type.kind!=="value")return S.error(`Cannot compare types '${qn(P.type)}' and '${qn(D.type)}'.`);d&&(P.type.kind==="value"&&D.type.kind!=="value"?P=new Qn(D.type,[P]):P.type.kind!=="value"&&D.type.kind==="value"&&(D=new Qn(P.type,[D])));let N=null;if(w.length===4){if(P.type.kind!=="string"&&D.type.kind!=="string"&&P.type.kind!=="value"&&D.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(N=S.parse(w[3],3,fo),!N)return null}return new q1(P,D,N)}evaluate(w){const S=this.lhs.evaluate(w),A=this.rhs.evaluate(w);if(d&&this.hasUntypedArgument){const P=Qt(S),D=Qt(A);if(P.kind!==D.kind||P.kind!=="string"&&P.kind!=="number")throw new Vn(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${P.kind}, ${D.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const P=Qt(S),D=Qt(A);if(P.kind!=="string"||D.kind!=="string")return n(w,S,A)}return this.collator?s(w,S,A,this.collator.evaluate(w)):n(w,S,A)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Rc=ti("==",(function(a,n,s){return n===s}),To),ql=ti("!=",(function(a,n,s){return n!==s}),(function(a,n,s,d){return!To(0,n,s,d)})),xl=ti("<",(function(a,n,s){return n<s}),(function(a,n,s,d){return d.compare(n,s)<0})),I=ti(">",(function(a,n,s){return n>s}),(function(a,n,s,d){return d.compare(n,s)>0})),U=ti("<=",(function(a,n,s){return n<=s}),(function(a,n,s,d){return d.compare(n,s)<=0})),G=ti(">=",(function(a,n,s){return n>=s}),(function(a,n,s,d){return d.compare(n,s)>=0}));class le{constructor(n,s,d){this.type=fo,this.locale=d,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(n.length!==2)return s.error("Expected one argument.");const d=n[1];if(typeof d!="object"||Array.isArray(d))return s.error("Collator options argument must be an object.");const g=s.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,sn);if(!g)return null;const w=s.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,sn);if(!w)return null;let S=null;return d.locale&&(S=s.parse(d.locale,1,un),!S)?null:new le(g,w,S)}evaluate(n){return new Ua(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class We{constructor(n,s,d,g,w){this.type=un,this.number=n,this.locale=s,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(n,s){if(n.length!==3)return s.error("Expected two arguments.");const d=s.parse(n[1],1,It);if(!d)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return s.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=s.parse(g.locale,1,un),!w))return null;let S=null;if(g.currency&&(S=s.parse(g.currency,1,un),!S))return null;let A=null;if(g["min-fraction-digits"]&&(A=s.parse(g["min-fraction-digits"],1,It),!A))return null;let P=null;return g["max-fraction-digits"]&&(P=s.parse(g["max-fraction-digits"],1,It),!P)?null:new We(d,w,S,A,P)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class tt{constructor(n){this.type=Gr,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const d=n[1];if(!Array.isArray(d)&&typeof d=="object")return s.error("First argument must be an image or text section.");const g=[];let w=!1;for(let S=1;S<=n.length-1;++S){const A=n[S];if(w&&typeof A=="object"&&!Array.isArray(A)){w=!1;let P=null;if(A["font-scale"]&&(P=s.parse(A["font-scale"],1,It),!P))return null;let D=null;if(A["text-font"]&&(D=s.parse(A["text-font"],1,xr(un)),!D))return null;let N=null;if(A["text-color"]&&(N=s.parse(A["text-color"],1,$i),!N))return null;let j=null;if(A["vertical-align"]){if(typeof A["vertical-align"]=="string"&&!gl.includes(A["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${A["vertical-align"]}' instead.`);if(j=s.parse(A["vertical-align"],1,un),!j)return null}const q=g[g.length-1];q.scale=P,q.font=D,q.textColor=N,q.verticalAlign=j}else{const P=s.parse(n[S],1,pn);if(!P)return null;const D=P.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:P,scale:null,font:null,textColor:null,verticalAlign:null})}}return new tt(g)}evaluate(n){return new si(this.sections.map((s=>{const d=s.content.evaluate(n);return Qt(d)===bi?new Fa("",d,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(n):null):new Fa(an(d),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null,s.verticalAlign?s.verticalAlign.evaluate(n):null)})))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor),s.verticalAlign&&n(s.verticalAlign)}outputDefined(){return!1}}class Rt{constructor(n){this.type=bi,this.input=n}static parse(n,s){if(n.length!==2)return s.error("Expected two arguments.");const d=s.parse(n[1],1,un);return d?new Rt(d):s.error("No image name provided.")}evaluate(n){const s=this.input.evaluate(n),d=Tr.fromString(s);return d&&n.availableImages&&(d.available=n.availableImages.indexOf(s)>-1),d}eachChild(n){n(this.input)}outputDefined(){return!1}}class yn{constructor(n){this.type=It,this.input=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const d=s.parse(n[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${qn(d.type)} instead.`):new yn(d):null}evaluate(n){const s=this.input.evaluate(n);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new Vn(`Expected value to be of type string or array, but found ${qn(Qt(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const jn=8192;function ai(a,n){const s=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(s*g*jn),Math.round(d*g*jn)]}function qi(a,n){const s=Math.pow(2,n.z);return[(g=(a[0]/jn+n.x)/s,360*g-180),(d=(a[1]/jn+n.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90)];var d,g}function Hr(a,n){a[0]=Math.min(a[0],n[0]),a[1]=Math.min(a[1],n[1]),a[2]=Math.max(a[2],n[0]),a[3]=Math.max(a[3],n[1])}function Vs(a,n){return!(a[0]<=n[0]||a[2]>=n[2]||a[1]<=n[1]||a[3]>=n[3])}function Ga(a,n,s){const d=a[0]-n[0],g=a[1]-n[1],w=a[0]-s[0],S=a[1]-s[1];return d*S-w*g==0&&d*w<=0&&g*S<=0}function js(a,n,s,d){return(g=[d[0]-s[0],d[1]-s[1]])[0]*(w=[n[0]-a[0],n[1]-a[1]])[1]-g[1]*w[0]!=0&&!(!Pd(a,n,s,d)||!Pd(s,d,a,n));var g,w}function Ha(a,n,s){for(const d of s)for(let g=0;g<d.length-1;++g)if(js(a,n,d[g],d[g+1]))return!0;return!1}function Za(a,n,s=!1){let d=!1;for(const A of n)for(let P=0;P<A.length-1;P++){if(Ga(a,A[P],A[P+1]))return s;(w=A[P])[1]>(g=a)[1]!=(S=A[P+1])[1]>g[1]&&g[0]<(S[0]-w[0])*(g[1]-w[1])/(S[1]-w[1])+w[0]&&(d=!d)}var g,w,S;return d}function Zf(a,n){for(const s of n)if(Za(a,s))return!0;return!1}function Cd(a,n){for(const s of a)if(!Za(s,n))return!1;for(let s=0;s<a.length-1;++s)if(Ha(a[s],a[s+1],n))return!1;return!0}function Wf(a,n){for(const s of n)if(Cd(a,s))return!0;return!1}function Pd(a,n,s,d){const g=d[0]-s[0],w=d[1]-s[1],S=(a[0]-s[0])*w-g*(a[1]-s[1]),A=(n[0]-s[0])*w-g*(n[1]-s[1]);return S>0&&A<0||S<0&&A>0}function Gl(a,n,s){const d=[];for(let g=0;g<a.length;g++){const w=[];for(let S=0;S<a[g].length;S++){const A=ai(a[g][S],s);Hr(n,A),w.push(A)}d.push(w)}return d}function Mc(a,n,s){const d=[];for(let g=0;g<a.length;g++){const w=Gl(a[g],n,s);d.push(w)}return d}function _h(a,n,s,d){if(a[0]<s[0]||a[0]>s[2]){const g=.5*d;let w=a[0]-s[0]>g?-d:s[0]-a[0]>g?d:0;w===0&&(w=a[0]-s[2]>g?-d:s[2]-a[0]>g?d:0),a[0]+=w}Hr(n,a)}function Su(a,n,s,d){const g=Math.pow(2,d.z)*jn,w=[d.x*jn,d.y*jn],S=[];for(const A of a)for(const P of A){const D=[P.x+w[0],P.y+w[1]];_h(D,n,s,g),S.push(D)}return S}function Rd(a,n,s,d){const g=Math.pow(2,d.z)*jn,w=[d.x*jn,d.y*jn],S=[];for(const P of a){const D=[];for(const N of P){const j=[N.x+w[0],N.y+w[1]];Hr(n,j),D.push(j)}S.push(D)}if(n[2]-n[0]<=g/2){(A=n)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const P of S)for(const D of P)_h(D,n,s,g)}var A;return S}class wl{constructor(n,s){this.type=sn,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ea(n[1])){const d=n[1];if(d.type==="FeatureCollection"){const g=[];for(const w of d.features){const{type:S,coordinates:A}=w.geometry;S==="Polygon"&&g.push(A),S==="MultiPolygon"&&g.push(...A)}if(g.length)return new wl(d,{type:"MultiPolygon",coordinates:g})}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new wl(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new wl(d,d)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return(function(s,d){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(d.type==="Polygon"){const A=Gl(d.coordinates,w,S),P=Su(s.geometry(),g,w,S);if(!Vs(g,w))return!1;for(const D of P)if(!Za(D,A))return!1}if(d.type==="MultiPolygon"){const A=Mc(d.coordinates,w,S),P=Su(s.geometry(),g,w,S);if(!Vs(g,w))return!1;for(const D of P)if(!Zf(D,A))return!1}return!0})(n,this.geometries);if(n.geometryType()==="LineString")return(function(s,d){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(d.type==="Polygon"){const A=Gl(d.coordinates,w,S),P=Rd(s.geometry(),g,w,S);if(!Vs(g,w))return!1;for(const D of P)if(!Cd(D,A))return!1}if(d.type==="MultiPolygon"){const A=Mc(d.coordinates,w,S),P=Rd(s.geometry(),g,w,S);if(!Vs(g,w))return!1;for(const D of P)if(!Wf(D,A))return!1}return!0})(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Eu=class{constructor(a=[],n=(s,d)=>s<d?-1:s>d?1:0){if(this.data=a,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:n,compare:s}=this,d=n[a];for(;a>0;){const g=a-1>>1,w=n[g];if(s(d,w)>=0)break;n[a]=w,a=g}n[a]=d}_down(a){const{data:n,compare:s}=this,d=this.length>>1,g=n[a];for(;a<d;){let w=1+(a<<1);const S=w+1;if(S<this.length&&s(n[S],n[w])<0&&(w=S),s(n[w],g)>=0)break;n[a]=n[w],a=w}n[a]=g}};function Au(a,n,s=0,d=a.length-1,g=Kf){for(;d>s;){if(d-s>600){const P=d-s+1,D=n-s+1,N=Math.log(P),j=.5*Math.exp(2*N/3),q=.5*Math.sqrt(N*j*(P-j)/P)*(D-P/2<0?-1:1);Au(a,n,Math.max(s,Math.floor(n-D*j/P+q)),Math.min(d,Math.floor(n+(P-D)*j/P+q)),g)}const w=a[n];let S=s,A=d;for(kc(a,s,n),g(a[d],w)>0&&kc(a,s,d);S<A;){for(kc(a,S,A),S++,A--;g(a[S],w)<0;)S++;for(;g(a[A],w)>0;)A--}g(a[s],w)===0?kc(a,s,A):(A++,kc(a,A,d)),A<=n&&(s=A+1),n<=A&&(d=A-1)}}function kc(a,n,s){const d=a[n];a[n]=a[s],a[s]=d}function Kf(a,n){return a<n?-1:a>n?1:0}function Dc(a,n){if(a.length<=1)return[a];const s=[];let d,g;for(const w of a){const S=_m(w);S!==0&&(w.area=Math.abs(S),g===void 0&&(g=S<0),g===S<0?(d&&s.push(d),d=[w]):d.push(w))}if(d&&s.push(d),n>1)for(let w=0;w<s.length;w++)s[w].length<=n||(Au(s[w],n,1,s[w].length-1,Xf),s[w]=s[w].slice(0,n));return s}function Xf(a,n){return n.area-a.area}function _m(a){let n=0;for(let s,d,g=0,w=a.length,S=w-1;g<w;S=g++)s=a[g],d=a[S],n+=(d.x-s.x)*(s.y+d.y);return n}const Yf=1/298.257223563,Qf=Yf*(2-Yf),Md=Math.PI/180;class vs{constructor(n){const s=6378.137*Md*1e3,d=Math.cos(n*Md),g=1/(1-Qf*(1-d*d)),w=Math.sqrt(g);this.kx=s*w*d,this.ky=s*w*g*(1-Qf)}distance(n,s){const d=this.wrap(n[0]-s[0])*this.kx,g=(n[1]-s[1])*this.ky;return Math.sqrt(d*d+g*g)}pointOnLine(n,s){let d,g,w,S,A=1/0;for(let P=0;P<n.length-1;P++){let D=n[P][0],N=n[P][1],j=this.wrap(n[P+1][0]-D)*this.kx,q=(n[P+1][1]-N)*this.ky,W=0;j===0&&q===0||(W=(this.wrap(s[0]-D)*this.kx*j+(s[1]-N)*this.ky*q)/(j*j+q*q),W>1?(D=n[P+1][0],N=n[P+1][1]):W>0&&(D+=j/this.kx*W,N+=q/this.ky*W)),j=this.wrap(s[0]-D)*this.kx,q=(s[1]-N)*this.ky;const X=j*j+q*q;X<A&&(A=X,d=D,g=N,w=P,S=W)}return{point:[d,g],index:w,t:Math.max(0,Math.min(1,S))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function Oc(a,n){return n[0]-a[0]}function Iu(a){return a[1]-a[0]+1}function So(a,n){return a[1]>=a[0]&&a[1]<n}function Un(a,n){if(a[0]>a[1])return[null,null];const s=Iu(a);if(n){if(s===2)return[a,null];const g=Math.floor(s/2);return[[a[0],a[0]+g],[a[0]+g,a[1]]]}if(s===1)return[a,null];const d=Math.floor(s/2)-1;return[[a[0],a[0]+d],[a[0]+d+1,a[1]]]}function yh(a,n){if(!So(n,a.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let d=n[0];d<=n[1];++d)Hr(s,a[d]);return s}function Cu(a){const n=[1/0,1/0,-1/0,-1/0];for(const s of a)for(const d of s)Hr(n,d);return n}function Jf(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function Tl(a,n,s){if(!Jf(a)||!Jf(n))return NaN;let d=0,g=0;return a[2]<n[0]&&(d=n[0]-a[2]),a[0]>n[2]&&(d=a[0]-n[2]),a[1]>n[3]&&(g=a[1]-n[3]),a[3]<n[1]&&(g=n[1]-a[3]),s.distance([0,0],[d,g])}function $o(a,n,s){const d=s.pointOnLine(n,a);return s.distance(a,d.point)}function Hl(a,n,s,d,g){const w=Math.min($o(a,[s,d],g),$o(n,[s,d],g)),S=Math.min($o(s,[a,n],g),$o(d,[a,n],g));return Math.min(w,S)}function kd(a,n,s,d,g){if(!So(n,a.length)||!So(d,s.length))return 1/0;let w=1/0;for(let S=n[0];S<n[1];++S){const A=a[S],P=a[S+1];for(let D=d[0];D<d[1];++D){const N=s[D],j=s[D+1];if(js(A,P,N,j))return 0;w=Math.min(w,Hl(A,P,N,j,g))}}return w}function ep(a,n,s,d,g){if(!So(n,a.length)||!So(d,s.length))return NaN;let w=1/0;for(let S=n[0];S<=n[1];++S)for(let A=d[0];A<=d[1];++A)if(w=Math.min(w,g.distance(a[S],s[A])),w===0)return w;return w}function Zl(a,n,s){if(Za(a,n,!0))return 0;let d=1/0;for(const g of n){const w=g[0],S=g[g.length-1];if(w!==S&&(d=Math.min(d,$o(a,[S,w],s)),d===0))return d;const A=s.pointOnLine(g,a);if(d=Math.min(d,s.distance(a,A.point)),d===0)return d}return d}function zc(a,n,s,d){if(!So(n,a.length))return NaN;for(let w=n[0];w<=n[1];++w)if(Za(a[w],s,!0))return 0;let g=1/0;for(let w=n[0];w<n[1];++w){const S=a[w],A=a[w+1];for(const P of s)for(let D=0,N=P.length,j=N-1;D<N;j=D++){const q=P[j],W=P[D];if(js(S,A,q,W))return 0;g=Math.min(g,Hl(S,A,q,W,d))}}return g}function vh(a,n){for(const s of a)for(const d of s)if(Za(d,n,!0))return!0;return!1}function tp(a,n,s,d=1/0){const g=Cu(a),w=Cu(n);if(d!==1/0&&Tl(g,w,s)>=d)return d;if(Vs(g,w)){if(vh(a,n))return 0}else if(vh(n,a))return 0;let S=1/0;for(const A of a)for(let P=0,D=A.length,N=D-1;P<D;N=P++){const j=A[N],q=A[P];for(const W of n)for(let X=0,ne=W.length,se=ne-1;X<ne;se=X++){const ue=W[se],Ne=W[X];if(js(j,q,ue,Ne))return 0;S=Math.min(S,Hl(j,q,ue,Ne,s))}}return S}function Sl(a,n,s,d,g,w){if(!w)return;const S=Tl(yh(d,w),g,s);S<n&&a.push([S,w,[0,0]])}function Pu(a,n,s,d,g,w,S){if(!w||!S)return;const A=Tl(yh(d,w),yh(g,S),s);A<n&&a.push([A,w,S])}function Ru(a,n,s,d,g=1/0){let w=Math.min(d.distance(a[0],s[0][0]),g);if(w===0)return w;const S=new Eu([[0,[0,a.length-1],[0,0]]],Oc),A=Cu(s);for(;S.length>0;){const P=S.pop();if(P[0]>=w)continue;const D=P[1],N=n?50:100;if(Iu(D)<=N){if(!So(D,a.length))return NaN;if(n){const j=zc(a,D,s,d);if(isNaN(j)||j===0)return j;w=Math.min(w,j)}else for(let j=D[0];j<=D[1];++j){const q=Zl(a[j],s,d);if(w=Math.min(w,q),w===0)return 0}}else{const j=Un(D,n);Sl(S,w,d,a,A,j[0]),Sl(S,w,d,a,A,j[1])}}return w}function Mu(a,n,s,d,g,w=1/0){let S=Math.min(w,g.distance(a[0],s[0]));if(S===0)return S;const A=new Eu([[0,[0,a.length-1],[0,s.length-1]]],Oc);for(;A.length>0;){const P=A.pop();if(P[0]>=S)continue;const D=P[1],N=P[2],j=n?50:100,q=d?50:100;if(Iu(D)<=j&&Iu(N)<=q){if(!So(D,a.length)&&So(N,s.length))return NaN;let W;if(n&&d)W=kd(a,D,s,N,g),S=Math.min(S,W);else if(n&&!d){const X=a.slice(D[0],D[1]+1);for(let ne=N[0];ne<=N[1];++ne)if(W=$o(s[ne],X,g),S=Math.min(S,W),S===0)return S}else if(!n&&d){const X=s.slice(N[0],N[1]+1);for(let ne=D[0];ne<=D[1];++ne)if(W=$o(a[ne],X,g),S=Math.min(S,W),S===0)return S}else W=ep(a,D,s,N,g),S=Math.min(S,W)}else{const W=Un(D,n),X=Un(N,d);Pu(A,S,g,a,s,W[0],X[0]),Pu(A,S,g,a,s,W[0],X[1]),Pu(A,S,g,a,s,W[1],X[0]),Pu(A,S,g,a,s,W[1],X[1])}}return S}function Dd(a){return a.type==="MultiPolygon"?a.coordinates.map((n=>({type:"Polygon",coordinates:n}))):a.type==="MultiLineString"?a.coordinates.map((n=>({type:"LineString",coordinates:n}))):a.type==="MultiPoint"?a.coordinates.map((n=>({type:"Point",coordinates:n}))):[a]}class Wl{constructor(n,s){this.type=It,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ea(n[1])){const d=n[1];if(d.type==="FeatureCollection")return new Wl(d,d.features.map((g=>Dd(g.geometry))).flat());if(d.type==="Feature")return new Wl(d,Dd(d.geometry));if("type"in d&&"coordinates"in d)return new Wl(d,Dd(d))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return(function(s,d){const g=s.geometry(),w=g.flat().map((P=>qi([P.x,P.y],s.canonical)));if(g.length===0)return NaN;const S=new vs(w[0][1]);let A=1/0;for(const P of d){switch(P.type){case"Point":A=Math.min(A,Mu(w,!1,[P.coordinates],!1,S,A));break;case"LineString":A=Math.min(A,Mu(w,!1,P.coordinates,!0,S,A));break;case"Polygon":A=Math.min(A,Ru(w,!1,P.coordinates,S,A))}if(A===0)return A}return A})(n,this.geometries);if(n.geometryType()==="LineString")return(function(s,d){const g=s.geometry(),w=g.flat().map((P=>qi([P.x,P.y],s.canonical)));if(g.length===0)return NaN;const S=new vs(w[0][1]);let A=1/0;for(const P of d){switch(P.type){case"Point":A=Math.min(A,Mu(w,!0,[P.coordinates],!1,S,A));break;case"LineString":A=Math.min(A,Mu(w,!0,P.coordinates,!0,S,A));break;case"Polygon":A=Math.min(A,Ru(w,!0,P.coordinates,S,A))}if(A===0)return A}return A})(n,this.geometries);if(n.geometryType()==="Polygon")return(function(s,d){const g=s.geometry();if(g.length===0||g[0].length===0)return NaN;const w=Dc(g,0).map((P=>P.map((D=>D.map((N=>qi([N.x,N.y],s.canonical))))))),S=new vs(w[0][0][0][1]);let A=1/0;for(const P of d)for(const D of w){switch(P.type){case"Point":A=Math.min(A,Ru([P.coordinates],!1,D,S,A));break;case"LineString":A=Math.min(A,Ru(P.coordinates,!0,D,S,A));break;case"Polygon":A=Math.min(A,tp(D,P.coordinates,S,A))}if(A===0)return A}return A})(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ku{constructor(n){this.type=pn,this.key=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const d=n[1];return d==null?s.error("Global state property must be defined."):typeof d!="string"?s.error(`Global state property must be string, but found ${typeof n[1]} instead.`):new ku(d)}evaluate(n){var s;const d=(s=n.globals)===null||s===void 0?void 0:s.globalState;return d&&Object.keys(d).length!==0?jo(d,this.key):null}eachChild(){}outputDefined(){return!1}}const Kl={"==":Rc,"!=":ql,">":I,"<":xl,">=":G,"<=":U,array:Qn,at:yo,boolean:Qn,case:Aa,coalesce:wo,collator:le,format:tt,image:Rt,in:vo,"index-of":ra,interpolate:Vi,"interpolate-hcl":Vi,"interpolate-lab":Vi,length:yn,let:qa,literal:ys,match:ur,number:Qn,"number-format":We,object:Qn,slice:bo,step:Mi,string:Qn,"to-boolean":ns,"to-color":ns,"to-number":ns,"to-string":ns,var:ia,within:wl,distance:Wl,"global-state":ku};class aa{constructor(n,s,d,g){this.name=n,this.type=s,this._evaluate=d,this.args=g}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,s){const d=n[0],g=aa.definitions[d];if(!g)return s.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,S=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,A=S.filter((([D])=>!Array.isArray(D)||D.length===n.length-1));let P=null;for(const[D,N]of A){P=new $a(s.registry,bs,s.path,null,s.scope);const j=[];let q=!1;for(let W=1;W<n.length;W++){const X=n[W],ne=Array.isArray(D)?D[W-1]:D.type,se=P.parse(X,1+j.length,ne);if(!se){q=!0;break}j.push(se)}if(!q)if(Array.isArray(D)&&D.length!==j.length)P.error(`Expected ${D.length} arguments, but found ${j.length} instead.`);else{for(let W=0;W<j.length;W++){const X=Array.isArray(D)?D[W]:D.type,ne=j[W];P.concat(W+1).checkSubtype(X,ne.type)}if(P.errors.length===0)return new aa(d,w,N,j)}}if(A.length===1)s.errors.push(...P.errors);else{const D=(A.length?A:S).map((([j])=>{return q=j,Array.isArray(q)?`(${q.map(qn).join(", ")})`:`(${qn(q.type)}...)`;var q})).join(" | "),N=[];for(let j=1;j<n.length;j++){const q=s.parse(n[j],1+N.length);if(!q)return null;N.push(qn(q.type))}s.error(`Expected arguments of type ${D}, but found (${N.join(", ")}) instead.`)}return null}static register(n,s){aa.definitions=s;for(const d in s)n[d]=aa}}function bh(a,[n,s,d,g]){n=n.evaluate(a),s=s.evaluate(a),d=d.evaluate(a);const w=g?g.evaluate(a):1,S=ln(n,s,d,w);if(S)throw new Vn(S);return new on(n/255,s/255,d/255,w,!1)}function Ia(a,n){return a in n}function xh(a,n){const s=n[a];return s===void 0?null:s}function Nr(a){return{type:a}}function bs(a){if(a instanceof ia)return bs(a.boundExpression);if(a instanceof aa&&a.name==="error"||a instanceof le||a instanceof wl||a instanceof Wl||a instanceof ku)return!1;const n=a instanceof ns||a instanceof Qn;let s=!0;return a.eachChild((d=>{s=n?s&&bs(d):s&&d instanceof ys})),!!s&&qo(a)&&Yl(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function qo(a){if(a instanceof aa&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof wl||a instanceof Wl)return!1;let n=!0;return a.eachChild((s=>{n&&!qo(s)&&(n=!1)})),n}function Xl(a){if(a instanceof aa&&a.name==="feature-state")return!1;let n=!0;return a.eachChild((s=>{n&&!Xl(s)&&(n=!1)})),n}function Yl(a,n){if(a instanceof aa&&n.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild((d=>{s&&!Yl(d,n)&&(s=!1)})),s}function Du(a){return{result:"success",value:a}}function El(a){return{result:"error",value:a}}function oa(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Od(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Lc(a){return!!a.expression&&a.expression.interpolated}function wn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Ou(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&Qt(a)===pi}function la(a){return a}function wh(a,n){const s=a.stops&&typeof a.stops[0][0]=="object",d=s||!(s||a.property!==void 0),g=a.type||(Lc(n)?"exponential":"interval"),w=(function(N){switch(N.type){case"color":return on.parse;case"padding":return lr.parse;case"numberArray":return cr.parse;case"colorArray":return Ri.parse;default:return null}})(n);if(w&&((a=er({},a)).stops&&(a.stops=a.stops.map((N=>[N[0],w(N[1])]))),a.default=w(a.default?a.default:n.default)),a.colorSpace&&(S=a.colorSpace)!=="rgb"&&S!=="hcl"&&S!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var S;const A=(function(N){switch(N){case"exponential":return Al;case"interval":return Th;case"categorical":return zd;case"identity":return Ld;default:throw new Error(`Unknown function type "${N}"`)}})(g);let P,D;if(g==="categorical"){P=Object.create(null);for(const N of a.stops)P[N[0]]=N[1];D=typeof a.stops[0][0]}if(s){const N={},j=[];for(let X=0;X<a.stops.length;X++){const ne=a.stops[X],se=ne[0].zoom;N[se]===void 0&&(N[se]={zoom:se,type:a.type,property:a.property,default:a.default,stops:[]},j.push(se)),N[se].stops.push([ne[0].value,ne[1]])}const q=[];for(const X of j)q.push([N[X].zoom,wh(N[X],n)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:Vi.interpolationFactor.bind(void 0,W),zoomStops:q.map((X=>X[0])),evaluate:({zoom:X},ne)=>Al({stops:q,base:a.base},n,X).evaluate(X,ne)}}if(d){const N=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:Vi.interpolationFactor.bind(void 0,N),zoomStops:a.stops.map((j=>j[0])),evaluate:({zoom:j})=>A(a,n,j,P,D)}}return{kind:"source",evaluate(N,j){const q=j&&j.properties?j.properties[a.property]:void 0;return q===void 0?is(a.default,n.default):A(a,n,q,P,D)}}}function is(a,n,s){return a!==void 0?a:n!==void 0?n:s!==void 0?s:void 0}function zd(a,n,s,d,g){return is(typeof s===g?d[s]:void 0,a.default,n.default)}function Th(a,n,s){if(wn(s)!=="number")return is(a.default,n.default);const d=a.stops.length;if(d===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[d-1][0])return a.stops[d-1][1];const g=xo(a.stops.map((w=>w[0])),s);return a.stops[g][1]}function Al(a,n,s){const d=a.base!==void 0?a.base:1;if(wn(s)!=="number")return is(a.default,n.default);const g=a.stops.length;if(g===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[g-1][0])return a.stops[g-1][1];const w=xo(a.stops.map((N=>N[0])),s),S=(function(N,j,q,W){const X=W-q,ne=N-q;return X===0?0:j===1?ne/X:(Math.pow(j,ne)-1)/(Math.pow(j,X)-1)})(s,d,a.stops[w][0],a.stops[w+1][0]),A=a.stops[w][1],P=a.stops[w+1][1],D=sa[n.type]||la;return typeof A.evaluate=="function"?{evaluate(...N){const j=A.evaluate.apply(void 0,N),q=P.evaluate.apply(void 0,N);if(j!==void 0&&q!==void 0)return D(j,q,S,a.colorSpace)}}:D(A,P,S,a.colorSpace)}function Ld(a,n,s){switch(n.type){case"color":s=on.parse(s);break;case"formatted":s=si.fromString(s.toString());break;case"resolvedImage":s=Tr.fromString(s.toString());break;case"padding":s=lr.parse(s);break;case"colorArray":s=Ri.parse(s);break;case"numberArray":s=cr.parse(s);break;default:wn(s)===n.type||n.type==="enum"&&n.values[s]||(s=void 0)}return is(s,a.default,n.default)}aa.register(Kl,{error:[{kind:"error"},[un],(a,[n])=>{throw new Vn(n.evaluate(a))}],typeof:[un,[pn],(a,[n])=>qn(Qt(n.evaluate(a)))],"to-rgba":[xr(It,4),[$i],(a,[n])=>{const[s,d,g,w]=n.evaluate(a).rgb;return[255*s,255*d,255*g,w]}],rgb:[$i,[It,It,It],bh],rgba:[$i,[It,It,It,It],bh],has:{type:sn,overloads:[[[un],(a,[n])=>Ia(n.evaluate(a),a.properties())],[[un,pi],(a,[n,s])=>Ia(n.evaluate(a),s.evaluate(a))]]},get:{type:pn,overloads:[[[un],(a,[n])=>xh(n.evaluate(a),a.properties())],[[un,pi],(a,[n,s])=>xh(n.evaluate(a),s.evaluate(a))]]},"feature-state":[pn,[un],(a,[n])=>xh(n.evaluate(a),a.featureState||{})],properties:[pi,[],a=>a.properties()],"geometry-type":[un,[],a=>a.geometryType()],id:[pn,[],a=>a.id()],zoom:[It,[],a=>a.globals.zoom],"heatmap-density":[It,[],a=>a.globals.heatmapDensity||0],elevation:[It,[],a=>a.globals.elevation||0],"line-progress":[It,[],a=>a.globals.lineProgress||0],accumulated:[pn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[It,Nr(It),(a,n)=>{let s=0;for(const d of n)s+=d.evaluate(a);return s}],"*":[It,Nr(It),(a,n)=>{let s=1;for(const d of n)s*=d.evaluate(a);return s}],"-":{type:It,overloads:[[[It,It],(a,[n,s])=>n.evaluate(a)-s.evaluate(a)],[[It],(a,[n])=>-n.evaluate(a)]]},"/":[It,[It,It],(a,[n,s])=>n.evaluate(a)/s.evaluate(a)],"%":[It,[It,It],(a,[n,s])=>n.evaluate(a)%s.evaluate(a)],ln2:[It,[],()=>Math.LN2],pi:[It,[],()=>Math.PI],e:[It,[],()=>Math.E],"^":[It,[It,It],(a,[n,s])=>Math.pow(n.evaluate(a),s.evaluate(a))],sqrt:[It,[It],(a,[n])=>Math.sqrt(n.evaluate(a))],log10:[It,[It],(a,[n])=>Math.log(n.evaluate(a))/Math.LN10],ln:[It,[It],(a,[n])=>Math.log(n.evaluate(a))],log2:[It,[It],(a,[n])=>Math.log(n.evaluate(a))/Math.LN2],sin:[It,[It],(a,[n])=>Math.sin(n.evaluate(a))],cos:[It,[It],(a,[n])=>Math.cos(n.evaluate(a))],tan:[It,[It],(a,[n])=>Math.tan(n.evaluate(a))],asin:[It,[It],(a,[n])=>Math.asin(n.evaluate(a))],acos:[It,[It],(a,[n])=>Math.acos(n.evaluate(a))],atan:[It,[It],(a,[n])=>Math.atan(n.evaluate(a))],min:[It,Nr(It),(a,n)=>Math.min(...n.map((s=>s.evaluate(a))))],max:[It,Nr(It),(a,n)=>Math.max(...n.map((s=>s.evaluate(a))))],abs:[It,[It],(a,[n])=>Math.abs(n.evaluate(a))],round:[It,[It],(a,[n])=>{const s=n.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[It,[It],(a,[n])=>Math.floor(n.evaluate(a))],ceil:[It,[It],(a,[n])=>Math.ceil(n.evaluate(a))],"filter-==":[sn,[un,pn],(a,[n,s])=>a.properties()[n.value]===s.value],"filter-id-==":[sn,[pn],(a,[n])=>a.id()===n.value],"filter-type-==":[sn,[un],(a,[n])=>a.geometryType()===n.value],"filter-<":[sn,[un,pn],(a,[n,s])=>{const d=a.properties()[n.value],g=s.value;return typeof d==typeof g&&d<g}],"filter-id-<":[sn,[pn],(a,[n])=>{const s=a.id(),d=n.value;return typeof s==typeof d&&s<d}],"filter->":[sn,[un,pn],(a,[n,s])=>{const d=a.properties()[n.value],g=s.value;return typeof d==typeof g&&d>g}],"filter-id->":[sn,[pn],(a,[n])=>{const s=a.id(),d=n.value;return typeof s==typeof d&&s>d}],"filter-<=":[sn,[un,pn],(a,[n,s])=>{const d=a.properties()[n.value],g=s.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[sn,[pn],(a,[n])=>{const s=a.id(),d=n.value;return typeof s==typeof d&&s<=d}],"filter->=":[sn,[un,pn],(a,[n,s])=>{const d=a.properties()[n.value],g=s.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[sn,[pn],(a,[n])=>{const s=a.id(),d=n.value;return typeof s==typeof d&&s>=d}],"filter-has":[sn,[pn],(a,[n])=>n.value in a.properties()],"filter-has-id":[sn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[sn,[xr(un)],(a,[n])=>n.value.indexOf(a.geometryType())>=0],"filter-id-in":[sn,[xr(pn)],(a,[n])=>n.value.indexOf(a.id())>=0],"filter-in-small":[sn,[un,xr(pn)],(a,[n,s])=>s.value.indexOf(a.properties()[n.value])>=0],"filter-in-large":[sn,[un,xr(pn)],(a,[n,s])=>(function(d,g,w,S){for(;w<=S;){const A=w+S>>1;if(g[A]===d)return!0;g[A]>d?S=A-1:w=A+1}return!1})(a.properties()[n.value],s.value,0,s.value.length-1)],all:{type:sn,overloads:[[[sn,sn],(a,[n,s])=>n.evaluate(a)&&s.evaluate(a)],[Nr(sn),(a,n)=>{for(const s of n)if(!s.evaluate(a))return!1;return!0}]]},any:{type:sn,overloads:[[[sn,sn],(a,[n,s])=>n.evaluate(a)||s.evaluate(a)],[Nr(sn),(a,n)=>{for(const s of n)if(s.evaluate(a))return!0;return!1}]]},"!":[sn,[sn],(a,[n])=>!n.evaluate(a)],"is-supported-script":[sn,[un],(a,[n])=>{const s=a.globals&&a.globals.isSupportedScript;return!s||s(n.evaluate(a))}],upcase:[un,[un],(a,[n])=>n.evaluate(a).toUpperCase()],downcase:[un,[un],(a,[n])=>n.evaluate(a).toLowerCase()],concat:[un,Nr(pn),(a,n)=>n.map((s=>an(s.evaluate(a)))).join("")],"resolved-locale":[un,[fo],(a,[n])=>n.evaluate(a).resolvedLocale()]});class zu{constructor(n,s,d){this.expression=n,this._warningHistory={},this._evaluator=new Uo,this._defaultValue=s?(function(g){if(g.type==="color"&&Ou(g.default))return new on(0,0,0,0);switch(g.type){case"color":return on.parse(g.default)||null;case"padding":return lr.parse(g.default)||null;case"numberArray":return cr.parse(g.default)||null;case"colorArray":return Ri.parse(g.default)||null;case"variableAnchorOffsetCollection":return Xi.parse(g.default)||null;case"projectionDefinition":return xi.parse(g.default)||null;default:return g.default===void 0?null:g.default}})(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this._globalState=d}evaluateWithoutErrorHandling(n,s,d,g,w,S){return this._globalState&&(n=xs(n,this._globalState)),this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(n,s,d,g,w,S){this._globalState&&(n=xs(n,this._globalState)),this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Vn(`Expected value to be one of ${Object.keys(this._enumValues).map((P=>JSON.stringify(P))).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function Go(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Kl}function Eo(a,n,s){const d=new $a(Kl,bs,[],n?(function(w){const S={color:$i,string:un,number:It,enum:un,boolean:sn,formatted:Gr,padding:Js,numberArray:_s,colorArray:Qr,projectionDefinition:Bs,resolvedImage:bi,variableAnchorOffsetCollection:Cc};return w.type==="array"?xr(S[w.value]||pn,w.length):S[w.type]})(n):void 0),g=d.parse(a,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Du(new zu(g,n,s)):El(d.errors)}class Il{constructor(n,s,d){this.kind=n,this._styleExpression=s,this.isStateDependent=n!=="constant"&&!Xl(s.expression),this.globalStateRefs=ua(s.expression),this._globalState=d}evaluateWithoutErrorHandling(n,s,d,g,w,S){return this._globalState&&(n=xs(n,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(n,s,d,g,w,S)}evaluate(n,s,d,g,w,S){return this._globalState&&(n=xs(n,this._globalState)),this._styleExpression.evaluate(n,s,d,g,w,S)}}class Nc{constructor(n,s,d,g,w){this.kind=n,this.zoomStops=d,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!Xl(s.expression),this.globalStateRefs=ua(s.expression),this.interpolationType=g,this._globalState=w}evaluateWithoutErrorHandling(n,s,d,g,w,S){return this._globalState&&(n=xs(n,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(n,s,d,g,w,S)}evaluate(n,s,d,g,w,S){return this._globalState&&(n=xs(n,this._globalState)),this._styleExpression.evaluate(n,s,d,g,w,S)}interpolationFactor(n,s,d){return this.interpolationType?Vi.interpolationFactor(this.interpolationType,n,s,d):0}}function ca(a,n,s){const d=Eo(a,n,s);if(d.result==="error")return d;const g=d.value.expression,w=qo(g);if(!w&&!oa(n))return El([new Ni("","data expressions not supported")]);const S=Yl(g,["zoom"]);if(!S&&!Od(n))return El([new Ni("","zoom expressions not supported")]);const A=Wa(g);return A||S?A instanceof Ni?El([A]):A instanceof Vi&&!Lc(n)?El([new Ni("",'"interpolate" expressions cannot be used with this property')]):Du(A?new Nc(w?"camera":"composite",d.value,A.labels,A instanceof Vi?A.interpolation:void 0,s):new Il(w?"constant":"source",d.value,s)):El([new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rs{constructor(n,s){this._parameters=n,this._specification=s,er(this,wh(this._parameters,this._specification))}static deserialize(n){return new rs(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Wa(a){let n=null;if(a instanceof qa)n=Wa(a.result);else if(a instanceof wo){for(const s of a.args)if(n=Wa(s),n)break}else(a instanceof Mi||a instanceof Vi)&&a.input instanceof aa&&a.input.name==="zoom"&&(n=a);return n instanceof Ni||a.eachChild((s=>{const d=Wa(s);d instanceof Ni?n=d:!n&&d?n=new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&d&&n!==d&&(n=new Ni("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}function ua(a,n=new Set){return a instanceof ku&&n.add(a.key),a.eachChild((s=>{ua(s,n)})),n}function xs(a,n){const{zoom:s,heatmapDensity:d,elevation:g,lineProgress:w,isSupportedScript:S,accumulated:A}=a??{};return{zoom:s,heatmapDensity:d,elevation:g,lineProgress:w,isSupportedScript:S,accumulated:A,globalState:n}}function Ka(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const n of a.slice(1))if(!Ka(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const Sh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ho(a,n){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ka(a)||(a=ji(a));const s=Eo(a,Sh,n);if(s.result==="error")throw new Error(s.value.map((d=>`${d.key}: ${d.message}`)).join(", "));return{filter:(d,g,w)=>s.value.evaluate(d,g,{},w),needGeometry:Ir(a),getGlobalStateRefs:()=>ua(s.value.expression)}}function Lu(a,n){return a<n?-1:a>n?1:0}function Ir(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let n=1;n<a.length;n++)if(Ir(a[n]))return!0;return!1}function ji(a){if(!a)return!0;const n=a[0];return a.length<=1?n!=="any":n==="=="?Hn(a[1],a[2],"=="):n==="!="?Bc(Hn(a[1],a[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Hn(a[1],a[2],n):n==="any"?(s=a.slice(1),["any"].concat(s.map(ji))):n==="all"?["all"].concat(a.slice(1).map(ji)):n==="none"?["all"].concat(a.slice(1).map(ji).map(Bc)):n==="in"?Cl(a[1],a.slice(2)):n==="!in"?Bc(Cl(a[1],a.slice(2))):n==="has"?Xa(a[1]):n!=="!has"||Bc(Xa(a[1]));var s}function Hn(a,n,s){switch(a){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,a,n]}}function Cl(a,n){if(n.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some((s=>typeof s!=typeof n[0]))?["filter-in-large",a,["literal",n.sort(Lu)]]:["filter-in-small",a,["literal",n]]}}function Xa(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Bc(a){return["!",a]}function Zo(a){const n=typeof a;if(n==="number"||n==="boolean"||n==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let g="[";for(const w of a)g+=`${Zo(w)},`;return`${g}]`}const s=Object.keys(a).sort();let d="{";for(let g=0;g<s.length;g++)d+=`${JSON.stringify(s[g])}:${Zo(a[s[g]])},`;return`${d}}`}function Nd(a){let n="";for(const s of nn)n+=`/${Zo(a[s])}`;return n}function Eh(a){const n=a.value;return n?[new yt(a.key,n,"constants have been deprecated as of v8")]:[]}function oi(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ya(a){if(Array.isArray(a))return a.map(Ya);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const n={};for(const s in a)n[s]=Ya(a[s]);return n}return oi(a)}function Us(a){const n=a.key,s=a.value,d=a.valueSpec||{},g=a.objectElementValidators||{},w=a.style,S=a.styleSpec,A=a.validateSpec;let P=[];const D=wn(s);if(D!=="object")return[new yt(n,s,`object expected, ${D} found`)];for(const N in s){const j=N.split(".")[0],q=jo(d,j)||d["*"];let W;if(jo(g,j))W=g[j];else if(jo(d,j))W=A;else if(g["*"])W=g["*"];else{if(!d["*"]){P.push(new yt(n,s[N],`unknown property "${N}"`));continue}W=A}P=P.concat(W({key:(n&&`${n}.`)+N,value:s[N],valueSpec:q,style:w,styleSpec:S,object:s,objectKey:N,validateSpec:A},s))}for(const N in d)g[N]||d[N].required&&d[N].default===void 0&&s[N]===void 0&&P.push(new yt(n,s,`missing required property "${N}"`));return P}function Pl(a){const n=a.value,s=a.valueSpec,d=a.style,g=a.styleSpec,w=a.key,S=a.arrayElementValidator||a.validateSpec;if(wn(n)!=="array")return[new yt(w,n,`array expected, ${wn(n)} found`)];if(s.length&&n.length!==s.length)return[new yt(w,n,`array length ${s.length} expected, length ${n.length} found`)];if(s["min-length"]&&n.length<s["min-length"])return[new yt(w,n,`array length at least ${s["min-length"]} expected, length ${n.length} found`)];let A={type:s.value,values:s.values};g.$version<7&&(A.function=s.function),wn(s.value)==="object"&&(A=s.value);let P=[];for(let D=0;D<n.length;D++)P=P.concat(S({array:n,arrayIndex:D,value:n[D],valueSpec:A,validateSpec:a.validateSpec,style:d,styleSpec:g,key:`${w}[${D}]`}));return P}function Vc(a){const n=a.key,s=a.value,d=a.valueSpec;let g=wn(s);return g==="number"&&s!=s&&(g="NaN"),g!=="number"?[new yt(n,s,`number expected, ${g} found`)]:"minimum"in d&&s<d.minimum?[new yt(n,s,`${s} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&s>d.maximum?[new yt(n,s,`${s} is greater than the maximum value ${d.maximum}`)]:[]}function Wo(a){const n=a.valueSpec,s=oi(a.value.type);let d,g,w,S={};const A=s!=="categorical"&&a.value.property===void 0,P=!A,D=wn(a.value.stops)==="array"&&wn(a.value.stops[0])==="array"&&wn(a.value.stops[0][0])==="object",N=Us({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(W){if(s==="identity")return[new yt(W.key,W.value,'identity function may not have a "stops" property')];let X=[];const ne=W.value;return X=X.concat(Pl({key:W.key,value:ne,valueSpec:W.valueSpec,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:j})),wn(ne)==="array"&&ne.length===0&&X.push(new yt(W.key,ne,"array must have at least one stop")),X},default:function(W){return W.validateSpec({key:W.key,value:W.value,valueSpec:n,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec})}}});return s==="identity"&&A&&N.push(new yt(a.key,a.value,'missing required property "property"')),s==="identity"||a.value.stops||N.push(new yt(a.key,a.value,'missing required property "stops"')),s==="exponential"&&a.valueSpec.expression&&!Lc(a.valueSpec)&&N.push(new yt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(P&&!oa(a.valueSpec)?N.push(new yt(a.key,a.value,"property functions not supported")):A&&!Od(a.valueSpec)&&N.push(new yt(a.key,a.value,"zoom functions not supported"))),s!=="categorical"&&!D||a.value.property!==void 0||N.push(new yt(a.key,a.value,'"property" property is required')),N;function j(W){let X=[];const ne=W.value,se=W.key;if(wn(ne)!=="array")return[new yt(se,ne,`array expected, ${wn(ne)} found`)];if(ne.length!==2)return[new yt(se,ne,`array length 2 expected, length ${ne.length} found`)];if(D){if(wn(ne[0])!=="object")return[new yt(se,ne,`object expected, ${wn(ne[0])} found`)];if(ne[0].zoom===void 0)return[new yt(se,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new yt(se,ne,"object stop key must have value")];if(w&&w>oi(ne[0].zoom))return[new yt(se,ne[0].zoom,"stop zoom values must appear in ascending order")];oi(ne[0].zoom)!==w&&(w=oi(ne[0].zoom),g=void 0,S={}),X=X.concat(Us({key:`${se}[0]`,value:ne[0],valueSpec:{zoom:{}},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Vc,value:q}}))}else X=X.concat(q({key:`${se}[0]`,value:ne[0],validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec},ne));return Go(Ya(ne[1]))?X.concat([new yt(`${se}[1]`,ne[1],"expressions are not allowed in function stops.")]):X.concat(W.validateSpec({key:`${se}[1]`,value:ne[1],valueSpec:n,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec}))}function q(W,X){const ne=wn(W.value),se=oi(W.value),ue=W.value!==null?W.value:X;if(d){if(ne!==d)return[new yt(W.key,ue,`${ne} stop domain type must match previous stop domain type ${d}`)]}else d=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean")return[new yt(W.key,ue,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&s!=="categorical"){let Ne=`number expected, ${ne} found`;return oa(n)&&s===void 0&&(Ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yt(W.key,ue,Ne)]}return s!=="categorical"||ne!=="number"||isFinite(se)&&Math.floor(se)===se?s!=="categorical"&&ne==="number"&&g!==void 0&&se<g?[new yt(W.key,ue,"stop domain values must appear in ascending order")]:(g=se,s==="categorical"&&se in S?[new yt(W.key,ue,"stop domain values must be unique")]:(S[se]=!0,[])):[new yt(W.key,ue,`integer expected, found ${se}`)]}}function ws(a){const n=(a.expressionContext==="property"?ca:Eo)(Ya(a.value),a.valueSpec);if(n.result==="error")return n.value.map((d=>new yt(`${a.key}${d.key}`,a.value,d.message)));const s=n.value.expression||n.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!s.outputDefined())return[new yt(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Xl(s))return[new yt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Xl(s))return[new yt(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Yl(s,["zoom","feature-state"]))return[new yt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!qo(s))return[new yt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fs(a){const n=a.key,s=a.value,d=wn(s);return d!=="string"?[new yt(n,s,`color expected, ${d} found`)]:on.parse(String(s))?[]:[new yt(n,s,`color expected, "${s}" found`)]}function ha(a){const n=a.key,s=a.value,d=a.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(oi(s))===-1&&g.push(new yt(n,s,`expected one of [${d.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(d.values).indexOf(oi(s))===-1&&g.push(new yt(n,s,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(s)} found`)),g}function Nu(a){return Ka(Ya(a.value))?ws(er({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ah(a)}function Ah(a){const n=a.value,s=a.key;if(wn(n)!=="array")return[new yt(s,n,`array expected, ${wn(n)} found`)];const d=a.styleSpec;let g,w=[];if(n.length<1)return[new yt(s,n,"filter array must have at least 1 element")];switch(w=w.concat(ha({key:`${s}[0]`,value:n[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),oi(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&oi(n[1])==="$type"&&w.push(new yt(s,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&w.push(new yt(s,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(g=wn(n[1]),g!=="string"&&w.push(new yt(`${s}[1]`,n[1],`string expected, ${g} found`)));for(let S=2;S<n.length;S++)g=wn(n[S]),oi(n[1])==="$type"?w=w.concat(ha({key:`${s}[${S}]`,value:n[S],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new yt(`${s}[${S}]`,n[S],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let S=1;S<n.length;S++)w=w.concat(Ah({key:`${s}[${S}]`,value:n[S],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=wn(n[1]),n.length!==2?w.push(new yt(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new yt(`${s}[1]`,n[1],`string expected, ${g} found`))}return w}function jc(a,n){const s=a.key,d=a.validateSpec,g=a.style,w=a.styleSpec,S=a.value,A=a.objectKey,P=w[`${n}_${a.layerType}`];if(!P)return[];const D=A.match(/^(.*)-transition$/);if(n==="paint"&&D&&P[D[1]]&&P[D[1]].transition)return d({key:s,value:S,valueSpec:w.transition,style:g,styleSpec:w});const N=a.valueSpec||P[A];if(!N)return[new yt(s,S,`unknown property "${A}"`)];let j;if(wn(S)==="string"&&oa(N)&&!N.tokens&&(j=/^{([^}]+)}$/.exec(S)))return[new yt(s,S,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const q=[];return a.layerType==="symbol"&&(A==="text-field"&&g&&!g.glyphs&&q.push(new yt(s,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Ou(Ya(S))&&oi(S.type)==="identity"&&q.push(new yt(s,S,'"text-font" does not support identity functions'))),q.concat(d({key:a.key,value:S,valueSpec:N,style:g,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:A}))}function Bu(a){return jc(a,"paint")}function Rl(a){return jc(a,"layout")}function hr(a){let n=[];const s=a.value,d=a.key,g=a.style,w=a.styleSpec;if(wn(s)!=="object")return[new yt(d,s,`object expected, ${wn(s)} found`)];s.type||s.ref||n.push(new yt(d,s,'either "type" or "ref" is required'));let S=oi(s.type);const A=oi(s.ref);if(s.id){const P=oi(s.id);for(let D=0;D<a.arrayIndex;D++){const N=g.layers[D];oi(N.id)===P&&n.push(new yt(d,s.id,`duplicate layer id "${s.id}", previously used at line ${N.id.__line__}`))}}if("ref"in s){let P;["type","source","source-layer","filter","layout"].forEach((D=>{D in s&&n.push(new yt(d,s[D],`"${D}" is prohibited for ref layers`))})),g.layers.forEach((D=>{oi(D.id)===A&&(P=D)})),P?P.ref?n.push(new yt(d,s.ref,"ref cannot reference another ref layer")):S=oi(P.type):n.push(new yt(d,s.ref,`ref layer "${A}" not found`))}else if(S!=="background")if(s.source){const P=g.sources&&g.sources[s.source],D=P&&oi(P.type);P?D==="vector"&&S==="raster"?n.push(new yt(d,s.source,`layer "${s.id}" requires a raster source`)):D!=="raster-dem"&&S==="hillshade"||D!=="raster-dem"&&S==="color-relief"?n.push(new yt(d,s.source,`layer "${s.id}" requires a raster-dem source`)):D==="raster"&&S!=="raster"?n.push(new yt(d,s.source,`layer "${s.id}" requires a vector source`)):D!=="vector"||s["source-layer"]?D==="raster-dem"&&S!=="hillshade"&&S!=="color-relief"?n.push(new yt(d,s.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):S!=="line"||!s.paint||!s.paint["line-gradient"]||D==="geojson"&&P.lineMetrics||n.push(new yt(d,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new yt(d,s,`layer "${s.id}" must specify a "source-layer"`)):n.push(new yt(d,s.source,`source "${s.source}" not found`))}else n.push(new yt(d,s,'missing required property "source"'));return n=n.concat(Us({key:d,value:s,valueSpec:w.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${d}.type`,value:s.type,valueSpec:w.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:s,objectKey:"type"}),filter:Nu,layout:P=>Us({layer:s,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":D=>Rl(er({layerType:S},D))}}),paint:P=>Us({layer:s,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":D=>Bu(er({layerType:S},D))}})}})),n}function $s(a){const n=a.value,s=a.key,d=wn(n);return d!=="string"?[new yt(s,n,`string expected, ${d} found`)]:[]}const Ts={promoteId:function({key:a,value:n}){if(wn(n)==="string")return $s({key:a,value:n});{const s=[];for(const d in n)s.push(...$s({key:`${a}.${d}`,value:n[d]}));return s}}};function Uc(a){const n=a.value,s=a.key,d=a.styleSpec,g=a.style,w=a.validateSpec;if(!n.type)return[new yt(s,n,'"type" is required')];const S=oi(n.type);let A;switch(S){case"vector":case"raster":return A=Us({key:s,value:n,valueSpec:d[`source_${S.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:Ts,validateSpec:w}),A;case"raster-dem":return A=(function(P){var D;const N=(D=P.sourceName)!==null&&D!==void 0?D:"",j=P.value,q=P.styleSpec,W=q.source_raster_dem,X=P.style;let ne=[];const se=wn(j);if(j===void 0)return ne;if(se!=="object")return ne.push(new yt("source_raster_dem",j,`object expected, ${se} found`)),ne;const ue=oi(j.encoding)==="custom",Ne=["redFactor","greenFactor","blueFactor","baseShift"],_e=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Ae in j)!ue&&Ne.includes(Ae)?ne.push(new yt(Ae,j[Ae],`In "${N}": "${Ae}" is only valid when "encoding" is set to "custom". ${_e} encoding found`)):W[Ae]?ne=ne.concat(P.validateSpec({key:Ae,value:j[Ae],valueSpec:W[Ae],validateSpec:P.validateSpec,style:X,styleSpec:q})):ne.push(new yt(Ae,j[Ae],`unknown property "${Ae}"`));return ne})({sourceName:s,value:n,style:a.style,styleSpec:d,validateSpec:w}),A;case"geojson":if(A=Us({key:s,value:n,valueSpec:d.source_geojson,style:g,styleSpec:d,validateSpec:w,objectElementValidators:Ts}),n.cluster)for(const P in n.clusterProperties){const[D,N]=n.clusterProperties[P],j=typeof D=="string"?[D,["accumulated"],["get",P]]:D;A.push(...ws({key:`${s}.${P}.map`,value:N,expressionContext:"cluster-map"})),A.push(...ws({key:`${s}.${P}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return A;case"video":return Us({key:s,value:n,valueSpec:d.source_video,style:g,validateSpec:w,styleSpec:d});case"image":return Us({key:s,value:n,valueSpec:d.source_image,style:g,validateSpec:w,styleSpec:d});case"canvas":return[new yt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ha({key:`${s}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Bd(a){const n=a.value,s=a.styleSpec,d=s.light,g=a.style;let w=[];const S=wn(n);if(n===void 0)return w;if(S!=="object")return w=w.concat([new yt("light",n,`object expected, ${S} found`)]),w;for(const A in n){const P=A.match(/^(.*)-transition$/);w=w.concat(P&&d[P[1]]&&d[P[1]].transition?a.validateSpec({key:A,value:n[A],valueSpec:s.transition,validateSpec:a.validateSpec,style:g,styleSpec:s}):d[A]?a.validateSpec({key:A,value:n[A],valueSpec:d[A],validateSpec:a.validateSpec,style:g,styleSpec:s}):[new yt(A,n[A],`unknown property "${A}"`)])}return w}function np(a){const n=a.value,s=a.styleSpec,d=s.sky,g=a.style,w=wn(n);if(n===void 0)return[];if(w!=="object")return[new yt("sky",n,`object expected, ${w} found`)];let S=[];for(const A in n)S=S.concat(d[A]?a.validateSpec({key:A,value:n[A],valueSpec:d[A],style:g,styleSpec:s}):[new yt(A,n[A],`unknown property "${A}"`)]);return S}function Sr(a){const n=a.value,s=a.styleSpec,d=s.terrain,g=a.style;let w=[];const S=wn(n);if(n===void 0)return w;if(S!=="object")return w=w.concat([new yt("terrain",n,`object expected, ${S} found`)]),w;for(const A in n)w=w.concat(d[A]?a.validateSpec({key:A,value:n[A],valueSpec:d[A],validateSpec:a.validateSpec,style:g,styleSpec:s}):[new yt(A,n[A],`unknown property "${A}"`)]);return w}function Ml(a){let n=[];const s=a.value,d=a.key;if(Array.isArray(s)){const g=[],w=[];for(const S in s)s[S].id&&g.includes(s[S].id)&&n.push(new yt(d,s,`all the sprites' ids must be unique, but ${s[S].id} is duplicated`)),g.push(s[S].id),s[S].url&&w.includes(s[S].url)&&n.push(new yt(d,s,`all the sprites' URLs must be unique, but ${s[S].url} is duplicated`)),w.push(s[S].url),n=n.concat(Us({key:`${d}[${S}]`,value:s[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return n}return $s({key:d,value:s})}function Ql(a){return n=a.value,n&&n.constructor===Object?[]:[new yt(a.key,a.value,`object expected, ${wn(a.value)} found`)];var n}const kl={"*":()=>[],array:Pl,boolean:function(a){const n=a.value,s=a.key,d=wn(n);return d!=="boolean"?[new yt(s,n,`boolean expected, ${d} found`)]:[]},number:Vc,color:Fs,constants:Eh,enum:ha,filter:Nu,function:Wo,layer:hr,object:Us,source:Uc,light:Bd,sky:np,terrain:Sr,projection:function(a){const n=a.value,s=a.styleSpec,d=s.projection,g=a.style,w=wn(n);if(n===void 0)return[];if(w!=="object")return[new yt("projection",n,`object expected, ${w} found`)];let S=[];for(const A in n)S=S.concat(d[A]?a.validateSpec({key:A,value:n[A],valueSpec:d[A],style:g,styleSpec:s}):[new yt(A,n[A],`unknown property "${A}"`)]);return S},projectionDefinition:function(a){const n=a.key;let s=a.value;s=s instanceof String?s.valueOf():s;const d=wn(s);return d!=="array"||(function(g){return Array.isArray(g)&&g.length===3&&typeof g[0]=="string"&&typeof g[1]=="string"&&typeof g[2]=="number"})(s)||(function(g){return!!["interpolate","step","literal"].includes(g[0])})(s)?["array","string"].includes(d)?[]:[new yt(n,s,`projection expected, invalid type "${d}" found`)]:[new yt(n,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:$s,formatted:function(a){return $s(a).length===0?[]:ws(a)},resolvedImage:function(a){return $s(a).length===0?[]:ws(a)},padding:function(a){const n=a.key,s=a.value;if(wn(s)==="array"){if(s.length<1||s.length>4)return[new yt(n,s,`padding requires 1 to 4 values; ${s.length} values found`)];const d={type:"number"};let g=[];for(let w=0;w<s.length;w++)g=g.concat(a.validateSpec({key:`${n}[${w}]`,value:s[w],validateSpec:a.validateSpec,valueSpec:d}));return g}return Vc({key:n,value:s,valueSpec:{}})},numberArray:function(a){const n=a.key,s=a.value;if(wn(s)==="array"){const d={type:"number"};if(s.length<1)return[new yt(n,s,"array length at least 1 expected, length 0 found")];let g=[];for(let w=0;w<s.length;w++)g=g.concat(a.validateSpec({key:`${n}[${w}]`,value:s[w],validateSpec:a.validateSpec,valueSpec:d}));return g}return Vc({key:n,value:s,valueSpec:{}})},colorArray:function(a){const n=a.key,s=a.value;if(wn(s)==="array"){if(s.length<1)return[new yt(n,s,"array length at least 1 expected, length 0 found")];let d=[];for(let g=0;g<s.length;g++)d=d.concat(Fs({key:`${n}[${g}]`,value:s[g]}));return d}return Fs({key:n,value:s})},variableAnchorOffsetCollection:function(a){const n=a.key,s=a.value,d=wn(s),g=a.styleSpec;if(d!=="array"||s.length<1||s.length%2!=0)return[new yt(n,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let S=0;S<s.length;S+=2)w=w.concat(ha({key:`${n}[${S}]`,value:s[S],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(Pl({key:`${n}[${S+1}]`,value:s[S+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:g}));return w},sprite:Ml,state:Ql};function Fc(a){const n=a.value,s=a.valueSpec,d=a.styleSpec;return a.validateSpec=Fc,s.expression&&Ou(oi(n))?Wo(a):s.expression&&Go(Ya(n))?ws(a):s.type&&kl[s.type]?kl[s.type](a):Us(er({},a,{valueSpec:s.type?d[s.type]:s}))}function Ko(a){const n=a.value,s=a.key,d=$s(a);return d.length||(n.indexOf("{fontstack}")===-1&&d.push(new yt(s,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&d.push(new yt(s,n,'"glyphs" url must include a "{range}" token'))),d}function Zr(a,n=Re){let s=[];return s=s.concat(Fc({key:"",value:a,valueSpec:n.$root,styleSpec:n,style:a,validateSpec:Fc,objectElementValidators:{glyphs:Ko,"*":()=>[]}})),a.constants&&(s=s.concat(Eh({key:"constants",value:a.constants}))),Vd(s)}function Ss(a){return function(n){return a({...n,validateSpec:Fc})}}function Vd(a){return[].concat(a).sort(((n,s)=>n.line-s.line))}function Qa(a){return function(...n){return Vd(a.apply(this,n))}}Zr.source=Qa(Ss(Uc)),Zr.sprite=Qa(Ss(Ml)),Zr.glyphs=Qa(Ss(Ko)),Zr.light=Qa(Ss(Bd)),Zr.sky=Qa(Ss(np)),Zr.terrain=Qa(Ss(Sr)),Zr.state=Qa(Ss(Ql)),Zr.layer=Qa(Ss(hr)),Zr.filter=Qa(Ss(Nu)),Zr.paintProperty=Qa(Ss(Bu)),Zr.layoutProperty=Qa(Ss(Rl));const Jl=Zr,Ja=Jl.light,jd=Jl.sky,Ih=Jl.paintProperty,Vu=Jl.layoutProperty;function $c(a,n){let s=!1;if(n&&n.length)for(const d of n)a.fire(new ot(new Error(d.message))),s=!0;return s}class Dl{constructor(n,s,d){const g=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const S=new Int32Array(this.arrayBuffer);n=S[0],this.d=(s=S[1])+2*(d=S[2]);for(let P=0;P<this.d*this.d;P++){const D=S[3+P],N=S[3+P+1];g.push(D===N?null:S.subarray(D,N))}const A=S[3+g.length+1];this.keys=S.subarray(S[3+g.length],A),this.bboxes=S.subarray(A),this.insert=this._insertReadonly}else{this.d=s+2*d;for(let S=0;S<this.d*this.d;S++)g.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=n,this.padding=d,this.scale=s/n,this.uid=0;const w=d/s*n;this.min=-w,this.max=n+w}insert(n,s,d,g,w){this._forEachCell(s,d,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(s),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,s,d,g,w,S){this.cells[w].push(S)}query(n,s,d,g,w){const S=this.min,A=this.max;if(n<=S&&s<=S&&A<=d&&A<=g&&!w)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(n,s,d,g,this._queryCell,P,{},w),P}}_queryCell(n,s,d,g,w,S,A,P){const D=this.cells[w];if(D!==null){const N=this.keys,j=this.bboxes;for(let q=0;q<D.length;q++){const W=D[q];if(A[W]===void 0){const X=4*W;(P?P(j[X+0],j[X+1],j[X+2],j[X+3]):n<=j[X+2]&&s<=j[X+3]&&d>=j[X+0]&&g>=j[X+1])?(A[W]=!0,S.push(N[W])):A[W]=!1}}}}_forEachCell(n,s,d,g,w,S,A,P){const D=this._convertToCellCoord(n),N=this._convertToCellCoord(s),j=this._convertToCellCoord(d),q=this._convertToCellCoord(g);for(let W=D;W<=j;W++)for(let X=N;X<=q;X++){const ne=this.d*X+W;if((!P||P(this._convertFromCellCoord(W),this._convertFromCellCoord(X),this._convertFromCellCoord(W+1),this._convertFromCellCoord(X+1)))&&w.call(this,n,s,d,g,ne,S,A,P))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,s=3+this.cells.length+1+1;let d=0;for(let S=0;S<this.cells.length;S++)d+=this.cells[S].length;const g=new Int32Array(s+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=s;for(let S=0;S<n.length;S++){const A=n[S];g[3+S]=w,g.set(A,w),w+=A.length}return g[3+n.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+n.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(n,s){const d=n.toArrayBuffer();return s&&s.push(d),{buffer:d}}static deserialize(n){return new Dl(n.buffer)}}const Es={};function Dt(a,n,s={}){if(Es[a])throw new Error(`${a} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:a,writeable:!1}),Es[a]={klass:n,omit:s.omit||[],shallow:s.shallow||[]}}Dt("Object",Object),Dt("Set",Set),Dt("TransferableGridIndex",Dl),Dt("Color",on),Dt("Error",Error),Dt("AJAXError",me),Dt("ResolvedImage",Tr),Dt("StylePropertyFunction",rs),Dt("StyleExpression",zu,{omit:["_evaluator"]}),Dt("ZoomDependentExpression",Nc),Dt("ZoomConstantExpression",Il),Dt("CompoundExpression",aa,{omit:["_evaluate"]});for(const a in Kl)Kl[a]._classRegistryKey||Dt(`Expression_${a}`,Kl[a]);function Ch(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function ec(a){return a.$name||a.constructor._classRegistryKey}function Ph(a){return!(function(n){if(n===null||typeof n!="object")return!1;const s=ec(n);return!(!s||s==="Object")})(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||Ch(a)||Ys(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function eo(a,n){if(Ph(a))return(Ch(a)||Ys(a))&&n&&n.push(a),ArrayBuffer.isView(a)&&n&&n.push(a.buffer),a instanceof ImageData&&n&&n.push(a.data.buffer),a;if(Array.isArray(a)){const w=[];for(const S of a)w.push(eo(S,n));return w}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const s=ec(a);if(!s)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!Es[s])throw new Error(`${s} is not registered.`);const{klass:d}=Es[s],g=d.serialize?d.serialize(a,n):{};if(d.serialize){if(n&&g===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in a){if(!a.hasOwnProperty(w)||Es[s].omit.indexOf(w)>=0)continue;const S=a[w];g[w]=Es[s].shallow.indexOf(w)>=0?S:eo(S,n)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(g.$name=s),g}function tc(a){if(Ph(a))return a;if(Array.isArray(a))return a.map(tc);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const n=ec(a)||"Object";if(!Es[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:s}=Es[n];if(!s)throw new Error(`can't deserialize unregistered class ${n}`);if(s.deserialize)return s.deserialize(a);const d=Object.create(s.prototype);for(const g of Object.keys(a)){if(g==="$name")continue;const w=a[g];d[g]=Es[n].shallow.indexOf(g)>=0?w:tc(w)}return d}class Rh{constructor(){this.first=!0}update(n,s){const d=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=s),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=d,!0))}}const vn={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function ju(a){for(const n of a)if(Uu(n.charCodeAt(0)))return!0;return!1}function Mh(a){for(const n of a)if(!qc(n.charCodeAt(0)))return!1;return!0}function Ao(a){const n=a.map((s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}})).filter((s=>s));return new RegExp(n.join("|"),"u")}const Xo=Ao(["Arab","Dupl","Mong","Ougr","Syrc"]);function qc(a){return!Xo.test(String.fromCodePoint(a))}const kh=Ao(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Uu(a){return!(a!==746&&a!==747&&(a<4352||!(vn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||vn["CJK Compatibility"](a)||vn["CJK Strokes"](a)||!(!vn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||vn["Enclosed CJK Letters and Months"](a)||vn["Ideographic Description Characters"](a)||vn.Kanbun(a)||vn.Katakana(a)&&a!==12540||!(!vn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!vn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||vn["Vertical Forms"](a)||vn["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||kh.test(String.fromCodePoint(a)))))}function nc(a){return!(Uu(a)||(function(n){return!!(vn["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||vn["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||vn["Letterlike Symbols"](n)||vn["Number Forms"](n)||vn["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||vn["Control Pictures"](n)&&n!==9251||vn["Optical Character Recognition"](n)||vn["Enclosed Alphanumerics"](n)||vn["Geometric Shapes"](n)||vn["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||vn["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||vn["CJK Symbols and Punctuation"](n)||vn.Katakana(n)||vn["Private Use Area"](n)||vn["CJK Compatibility Forms"](n)||vn["Small Form Variants"](n)||vn["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)})(a))}const Gc=Ao(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Dh(a){return Gc.test(String.fromCodePoint(a))}function Ud(a,n){return!(!n&&Dh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||vn.Khmer(a))}function Yo(a){for(const n of a)if(Dh(n.charCodeAt(0)))return!0;return!1}const to=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(to.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,n){return h(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const s=a.pluginURL,d=new Promise((w=>{this.loadScriptResolve=w}));n(s);const g=new Promise((w=>setTimeout((()=>w()),this.TIMEOUT)));if(yield Promise.race([d,g]),this.isParsed()){const w={pluginStatus:"loaded",pluginURL:s};return this.setState(w),w}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)}))}};class Jn{constructor(n,s){this.isSupportedScript=Fd,this.zoom=n,s?(this.now=s.now||0,this.fadeDuration=s.fadeDuration||0,this.zoomHistory=s.zoomHistory||new Rh,this.transition=s.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Rh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,s=n-Math.floor(n),d=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*s}}}function Fd(a){return(function(n,s){for(const d of n)if(!Ud(d.charCodeAt(0),s))return!1;return!0})(a,to.getRTLTextPluginStatus()==="loaded")}class Hc{constructor(n,s,d){this.property=n,this.value=s,this.expression=(function(g,w,S){if(Ou(g))return new rs(g,w);if(Go(g)){const A=ca(g,w,S);if(A.result==="error")throw new Error(A.value.map((P=>`${P.key}: ${P.message}`)).join(", "));return A.value}{let A=g;return w.type==="color"&&typeof g=="string"?A=on.parse(g):w.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?w.type!=="numberArray"||typeof g!="number"&&!Array.isArray(g)?w.type!=="colorArray"||typeof g!="string"&&!Array.isArray(g)?w.type==="variableAnchorOffsetCollection"&&Array.isArray(g)?A=Xi.parse(g):w.type==="projectionDefinition"&&typeof g=="string"&&(A=xi.parse(g)):A=Ri.parse(g):A=cr.parse(g):A=lr.parse(g),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>A}}})(s===void 0?n.specification.default:s,n.specification,d)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(n,s,d){return this.property.possiblyEvaluate(this,n,s,d)}}class no{constructor(n,s){this.property=n,this.value=new Hc(n,void 0,s)}transitioned(n,s){return new ni(this.property,this.value,s,On({},n.transition,this.transition),n.now)}untransitioned(){return new ni(this.property,this.value,null,{},0)}}class Pn{constructor(n,s){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._globalState=s}getValue(n){return zr(this._values[n].value.value)}setValue(n,s){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new no(this._values[n].property,this._globalState)),this._values[n].value=new Hc(this._values[n].property,s===null?void 0:zr(s),this._globalState)}getTransition(n){return zr(this._values[n].transition)}setTransition(n,s){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new no(this._values[n].property,this._globalState)),this._values[n].transition=zr(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const d=this.getValue(s);d!==void 0&&(n[s]=d);const g=this.getTransition(s);g!==void 0&&(n[`${s}-transition`]=g)}return n}transitioned(n,s){const d=new dr(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(n,s._values[g]);return d}untransitioned(){const n=new dr(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}}class ni{constructor(n,s,d,g,w){this.property=n,this.value=s,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,n.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(n,s,d){const g=n.now||0,w=this.value.possiblyEvaluate(n,s,d),S=this.prior;if(S){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return S.possiblyEvaluate(n,s,d);{const A=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(n,s,d),w,Mt(A))}}return w}}class dr{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,d){const g=new Io(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(n,s,d);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Oh{constructor(n,s){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._globalState=s}hasValue(n){return this._values[n].value!==void 0}getValue(n){return zr(this._values[n].value)}setValue(n,s){this._values[n]=new Hc(this._values[n].property,s===null?void 0:zr(s),this._globalState)}serialize(){const n={};for(const s of Object.keys(this._values)){const d=this.getValue(s);d!==void 0&&(n[s]=d)}return n}possiblyEvaluate(n,s,d){const g=new Io(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(n,s,d);return g}}class As{constructor(n,s,d){this.property=n,this.value=s,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,s,d,g){return this.property.evaluate(this.value,this.parameters,n,s,d,g)}}class Io{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Lt{constructor(n){this.specification=n}possiblyEvaluate(n,s){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(s)}interpolate(n,s,d){const g=sa[this.specification.type];return g?g(n,s,d):n}}class Ft{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,d,g){return new As(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},d,g)}:n.expression,s)}interpolate(n,s,d){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new As(this,{kind:"constant",value:void 0},n.parameters);const g=sa[this.specification.type];if(g){const w=g(n.value.value,s.value.value,d);return new As(this,{kind:"constant",value:w},n.parameters)}return n}evaluate(n,s,d,g,w,S){return n.kind==="constant"?n.value:n.evaluate(s,d,g,w,S)}}class Qo extends Ft{possiblyEvaluate(n,s,d,g){if(n.value===void 0)return new As(this,{kind:"constant",value:void 0},s);if(n.expression.kind==="constant"){const w=n.expression.evaluate(s,null,{},d,g),S=n.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,A=this._calculate(S,S,S,s);return new As(this,{kind:"constant",value:A},s)}if(n.expression.kind==="camera"){const w=this._calculate(n.expression.evaluate({zoom:s.zoom-1}),n.expression.evaluate({zoom:s.zoom}),n.expression.evaluate({zoom:s.zoom+1}),s);return new As(this,{kind:"constant",value:w},s)}return new As(this,n.expression,s)}evaluate(n,s,d,g,w,S){if(n.kind==="source"){const A=n.evaluate(s,d,g,w,S);return this._calculate(A,A,A,s)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(s.zoom)-1},d,g),n.evaluate({zoom:Math.floor(s.zoom)},d,g),n.evaluate({zoom:Math.floor(s.zoom)+1},d,g),s):n.value}_calculate(n,s,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:d,to:s}}interpolate(n){return n}}class $d{constructor(n){this.specification=n}possiblyEvaluate(n,s,d,g){if(n.value!==void 0){if(n.expression.kind==="constant"){const w=n.expression.evaluate(s,null,{},d,g);return this._calculate(w,w,w,s)}return this._calculate(n.expression.evaluate(new Jn(Math.floor(s.zoom-1),s)),n.expression.evaluate(new Jn(Math.floor(s.zoom),s)),n.expression.evaluate(new Jn(Math.floor(s.zoom+1),s)),s)}}_calculate(n,s,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:d,to:s}}interpolate(n){return n}}class Gi{constructor(n){this.specification=n}possiblyEvaluate(n,s,d,g){return!!n.expression.evaluate(s,null,{},d,g)}interpolate(){return!1}}class Br{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in n){const d=n[s];d.specification.overridable&&this.overridableProperties.push(s);const g=this.defaultPropertyValues[s]=new Hc(d,void 0,void 0),w=this.defaultTransitionablePropertyValues[s]=new no(d,void 0);this.defaultTransitioningPropertyValues[s]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=g.possiblyEvaluate({})}}}Dt("DataDrivenProperty",Ft),Dt("DataConstantProperty",Lt),Dt("CrossFadedDataDrivenProperty",Qo),Dt("CrossFadedProperty",$d),Dt("ColorRampProperty",Gi);const zh="-transition";class Ca extends zt{constructor(n,s,d){if(super(),this.id=n.id,this.type=n.type,this._globalState=d,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter,this._featureFilter=Ho(n.filter,d)),s.layout&&(this._unevaluatedLayout=new Oh(s.layout,d)),s.paint)){this._transitionablePaint=new Pn(s.paint,d);for(const g in n.paint)this.setPaintProperty(g,n.paint[g],{validate:!1});for(const g in n.layout)this.setLayoutProperty(g,n.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Io(s.paint)}}setFilter(n){this.filter=n,this._featureFilter=Ho(n,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}getLayoutAffectingGlobalStateRefs(){const n=new Set;if(this._unevaluatedLayout)for(const s in this._unevaluatedLayout._values){const d=this._unevaluatedLayout._values[s];for(const g of d.getGlobalStateRefs())n.add(g)}for(const s of this._featureFilter.getGlobalStateRefs())n.add(s);return n}getPaintAffectingGlobalStateRefs(){var n;const s=new globalThis.Map;if(this._transitionablePaint)for(const d in this._transitionablePaint._values){const g=this._transitionablePaint._values[d].value;for(const w of g.getGlobalStateRefs()){const S=(n=s.get(w))!==null&&n!==void 0?n:[];S.push({name:d,value:g.value}),s.set(w,S)}}return s}setLayoutProperty(n,s,d={}){s!=null&&this._validate(Vu,`layers.${this.id}.layout.${n}`,n,s,d)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,s):this.visibility=s)}getPaintProperty(n){return n.endsWith(zh)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,s,d={}){if(s!=null&&this._validate(Ih,`layers.${this.id}.paint.${n}`,n,s,d))return!1;if(n.endsWith(zh))return this._transitionablePaint.setTransition(n.slice(0,-11),s||void 0),!1;{const g=this._transitionablePaint._values[n],w=g.property.specification["property-type"]==="cross-faded-data-driven",S=g.value.isDataDriven(),A=g.value;this._transitionablePaint.setValue(n,s),this._handleSpecialPaintPropertyUpdate(n);const P=this._transitionablePaint._values[n].value;return P.isDataDriven()||S||w||this._handleOverridablePaintPropertyUpdate(n,A,P)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,s,d){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,s){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Na(n,((s,d)=>!(s===void 0||d==="layout"&&!Object.keys(s).length||d==="paint"&&!Object.keys(s).length)))}_validate(n,s,d,g,w={}){return(!w||w.validate!==!1)&&$c(this,n.call(Jl,{key:s,layerType:this.type,objectKey:d,value:g,styleSpec:Re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof As&&oa(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Ol={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zc{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,s){return n._trim(),s&&(n.isTransferred=!0,s.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Hi(a,n=1){let s=0,d=0;return{members:a.map((g=>{const w=Ol[g.type].BYTES_PER_ELEMENT,S=s=Wc(s,Math.max(n,w)),A=g.components||1;return d=Math.max(d,w),s+=w*A,{name:g.name,type:g.type,components:A,offset:S}})),size:Wc(s,Math.max(d,n)),alignment:n}}function Wc(a,n){return Math.ceil(a/n)*n}class Vr extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const d=this.length;return this.resize(d+1),this.emplace(d,n,s)}emplace(n,s,d){const g=2*n;return this.int16[g+0]=s,this.int16[g+1]=d,n}}Vr.prototype.bytesPerElement=4,Dt("StructArrayLayout2i4",Vr);class ki extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,d)}emplace(n,s,d,g){const w=3*n;return this.int16[w+0]=s,this.int16[w+1]=d,this.int16[w+2]=g,n}}ki.prototype.bytesPerElement=6,Dt("StructArrayLayout3i6",ki);class Jo extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,d,g)}emplace(n,s,d,g,w){const S=4*n;return this.int16[S+0]=s,this.int16[S+1]=d,this.int16[S+2]=g,this.int16[S+3]=w,n}}Jo.prototype.bytesPerElement=8,Dt("StructArrayLayout4i8",Jo);class ic extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,s,d,g,w,S)}emplace(n,s,d,g,w,S,A){const P=6*n;return this.int16[P+0]=s,this.int16[P+1]=d,this.int16[P+2]=g,this.int16[P+3]=w,this.int16[P+4]=S,this.int16[P+5]=A,n}}ic.prototype.bytesPerElement=12,Dt("StructArrayLayout2i4i12",ic);class rc extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,s,d,g,w,S)}emplace(n,s,d,g,w,S,A){const P=4*n,D=8*n;return this.int16[P+0]=s,this.int16[P+1]=d,this.uint8[D+4]=g,this.uint8[D+5]=w,this.uint8[D+6]=S,this.uint8[D+7]=A,n}}rc.prototype.bytesPerElement=8,Dt("StructArrayLayout2i4ub8",rc);class io extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const d=this.length;return this.resize(d+1),this.emplace(d,n,s)}emplace(n,s,d){const g=2*n;return this.float32[g+0]=s,this.float32[g+1]=d,n}}io.prototype.bytesPerElement=8,Dt("StructArrayLayout2f8",io);class ro extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w,S,A,P,D,N){const j=this.length;return this.resize(j+1),this.emplace(j,n,s,d,g,w,S,A,P,D,N)}emplace(n,s,d,g,w,S,A,P,D,N,j){const q=10*n;return this.uint16[q+0]=s,this.uint16[q+1]=d,this.uint16[q+2]=g,this.uint16[q+3]=w,this.uint16[q+4]=S,this.uint16[q+5]=A,this.uint16[q+6]=P,this.uint16[q+7]=D,this.uint16[q+8]=N,this.uint16[q+9]=j,n}}ro.prototype.bytesPerElement=20,Dt("StructArrayLayout10ui20",ro);class Kc extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w,S,A,P,D,N,j,q){const W=this.length;return this.resize(W+1),this.emplace(W,n,s,d,g,w,S,A,P,D,N,j,q)}emplace(n,s,d,g,w,S,A,P,D,N,j,q,W){const X=12*n;return this.int16[X+0]=s,this.int16[X+1]=d,this.int16[X+2]=g,this.int16[X+3]=w,this.uint16[X+4]=S,this.uint16[X+5]=A,this.uint16[X+6]=P,this.uint16[X+7]=D,this.int16[X+8]=N,this.int16[X+9]=j,this.int16[X+10]=q,this.int16[X+11]=W,n}}Kc.prototype.bytesPerElement=24,Dt("StructArrayLayout4i4ui4i24",Kc);class Xc extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,d)}emplace(n,s,d,g){const w=3*n;return this.float32[w+0]=s,this.float32[w+1]=d,this.float32[w+2]=g,n}}Xc.prototype.bytesPerElement=12,Dt("StructArrayLayout3f12",Xc);class Fu extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}Fu.prototype.bytesPerElement=4,Dt("StructArrayLayout1ul4",Fu);class b extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w,S,A,P,D){const N=this.length;return this.resize(N+1),this.emplace(N,n,s,d,g,w,S,A,P,D)}emplace(n,s,d,g,w,S,A,P,D,N){const j=10*n,q=5*n;return this.int16[j+0]=s,this.int16[j+1]=d,this.int16[j+2]=g,this.int16[j+3]=w,this.int16[j+4]=S,this.int16[j+5]=A,this.uint32[q+3]=P,this.uint16[j+8]=D,this.uint16[j+9]=N,n}}b.prototype.bytesPerElement=20,Dt("StructArrayLayout6i1ul2ui20",b);class t extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,s,d,g,w,S)}emplace(n,s,d,g,w,S,A){const P=6*n;return this.int16[P+0]=s,this.int16[P+1]=d,this.int16[P+2]=g,this.int16[P+3]=w,this.int16[P+4]=S,this.int16[P+5]=A,n}}t.prototype.bytesPerElement=12,Dt("StructArrayLayout2i2i2i12",t);class o extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w){const S=this.length;return this.resize(S+1),this.emplace(S,n,s,d,g,w)}emplace(n,s,d,g,w,S){const A=4*n,P=8*n;return this.float32[A+0]=s,this.float32[A+1]=d,this.float32[A+2]=g,this.int16[P+6]=w,this.int16[P+7]=S,n}}o.prototype.bytesPerElement=16,Dt("StructArrayLayout2f1f2i16",o);class p extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,s,d,g,w,S)}emplace(n,s,d,g,w,S,A){const P=16*n,D=4*n,N=8*n;return this.uint8[P+0]=s,this.uint8[P+1]=d,this.float32[D+1]=g,this.float32[D+2]=w,this.int16[N+6]=S,this.int16[N+7]=A,n}}p.prototype.bytesPerElement=16,Dt("StructArrayLayout2ub2f2i16",p);class _ extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,d)}emplace(n,s,d,g){const w=3*n;return this.uint16[w+0]=s,this.uint16[w+1]=d,this.uint16[w+2]=g,n}}_.prototype.bytesPerElement=6,Dt("StructArrayLayout3ui6",_);class T extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w,S,A,P,D,N,j,q,W,X,ne,se,ue){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,n,s,d,g,w,S,A,P,D,N,j,q,W,X,ne,se,ue)}emplace(n,s,d,g,w,S,A,P,D,N,j,q,W,X,ne,se,ue,Ne){const _e=24*n,Ae=12*n,Ze=48*n;return this.int16[_e+0]=s,this.int16[_e+1]=d,this.uint16[_e+2]=g,this.uint16[_e+3]=w,this.uint32[Ae+2]=S,this.uint32[Ae+3]=A,this.uint32[Ae+4]=P,this.uint16[_e+10]=D,this.uint16[_e+11]=N,this.uint16[_e+12]=j,this.float32[Ae+7]=q,this.float32[Ae+8]=W,this.uint8[Ze+36]=X,this.uint8[Ze+37]=ne,this.uint8[Ze+38]=se,this.uint32[Ae+10]=ue,this.int16[_e+22]=Ne,n}}T.prototype.bytesPerElement=48,Dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",T);class E extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,d,g,w,S,A,P,D,N,j,q,W,X,ne,se,ue,Ne,_e,Ae,Ze,et,dt,At,bt,Ct,Ut,xt){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,n,s,d,g,w,S,A,P,D,N,j,q,W,X,ne,se,ue,Ne,_e,Ae,Ze,et,dt,At,bt,Ct,Ut,xt)}emplace(n,s,d,g,w,S,A,P,D,N,j,q,W,X,ne,se,ue,Ne,_e,Ae,Ze,et,dt,At,bt,Ct,Ut,xt,Tt){const at=32*n,Xt=16*n;return this.int16[at+0]=s,this.int16[at+1]=d,this.int16[at+2]=g,this.int16[at+3]=w,this.int16[at+4]=S,this.int16[at+5]=A,this.int16[at+6]=P,this.int16[at+7]=D,this.uint16[at+8]=N,this.uint16[at+9]=j,this.uint16[at+10]=q,this.uint16[at+11]=W,this.uint16[at+12]=X,this.uint16[at+13]=ne,this.uint16[at+14]=se,this.uint16[at+15]=ue,this.uint16[at+16]=Ne,this.uint16[at+17]=_e,this.uint16[at+18]=Ae,this.uint16[at+19]=Ze,this.uint16[at+20]=et,this.uint16[at+21]=dt,this.uint16[at+22]=At,this.uint32[Xt+12]=bt,this.float32[Xt+13]=Ct,this.float32[Xt+14]=Ut,this.uint16[at+30]=xt,this.uint16[at+31]=Tt,n}}E.prototype.bytesPerElement=64,Dt("StructArrayLayout8i15ui1ul2f2ui64",E);class R extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}R.prototype.bytesPerElement=4,Dt("StructArrayLayout1f4",R);class k extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,d)}emplace(n,s,d,g){const w=3*n;return this.uint16[6*n+0]=s,this.float32[w+1]=d,this.float32[w+2]=g,n}}k.prototype.bytesPerElement=12,Dt("StructArrayLayout1ui2f12",k);class L extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,d)}emplace(n,s,d,g){const w=4*n;return this.uint32[2*n+0]=s,this.uint16[w+2]=d,this.uint16[w+3]=g,n}}L.prototype.bytesPerElement=8,Dt("StructArrayLayout1ul2ui8",L);class B extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const d=this.length;return this.resize(d+1),this.emplace(d,n,s)}emplace(n,s,d){const g=2*n;return this.uint16[g+0]=s,this.uint16[g+1]=d,n}}B.prototype.bytesPerElement=4,Dt("StructArrayLayout2ui4",B);class $ extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}$.prototype.bytesPerElement=2,Dt("StructArrayLayout1ui2",$);class F extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,d,g)}emplace(n,s,d,g,w){const S=4*n;return this.float32[S+0]=s,this.float32[S+1]=d,this.float32[S+2]=g,this.float32[S+3]=w,n}}F.prototype.bytesPerElement=16,Dt("StructArrayLayout4f16",F);class Z extends Zc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}Z.prototype.size=20;class te extends b{get(n){return new Z(this,n)}}Dt("CollisionBoxArray",te);class ae extends Zc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ae.prototype.size=48;class oe extends T{get(n){return new ae(this,n)}}Dt("PlacedSymbolArray",oe);class ce extends Zc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ce.prototype.size=64;class he extends E{get(n){return new ce(this,n)}}Dt("SymbolInstanceArray",he);class ge extends R{getoffsetX(n){return this.float32[1*n+0]}}Dt("GlyphOffsetArray",ge);class de extends ki{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}Dt("SymbolLineVertexArray",de);class be extends Zc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}be.prototype.size=12;class Ie extends k{get(n){return new be(this,n)}}Dt("TextAnchorOffsetArray",Ie);class fe extends Zc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}fe.prototype.size=8;class ze extends L{get(n){return new fe(this,n)}}Dt("FeatureIndexArray",ze);class Xe extends Vr{}class $e extends Vr{}class Ge extends Vr{}class Ye extends ic{}class Et extends rc{}class wt extends io{}class lt extends ro{}class Bt extends Kc{}class Tn extends Xc{}class Fn extends Fu{}class Di extends t{}class li extends p{}class ci extends _{}class Ti extends B{}const _i=Hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ui}=_i;class Ln{constructor(n=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=n}prepareSegment(n,s,d,g){const w=this.segments[this.segments.length-1];return n>Ln.MAX_VERTEX_ARRAY_LENGTH&&Pi(`Max vertices per segment is ${Ln.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ln.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!w||w.vertexLength+n>Ln.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g?this.createNewSegment(s,d,g):w}createNewSegment(n,s,d){const g={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return d!==void 0&&(g.sortKey=d),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(g),g}getOrCreateLatestSegment(n,s,d){return this.prepareSegment(0,n,s,d)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,d,g){return new Ln([{vertexOffset:n,primitiveOffset:s,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function Er(a,n){return 256*(a=Ht(Math.floor(a),0,255))+Ht(Math.floor(n),0,255)}Ln.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dt("SegmentVector",Ln);const fr=Hi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Is,zl,el,Cs={exports:{}},tl={exports:{}},Ll={exports:{}},$u=(function(){if(el)return Cs.exports;el=1;var a=(Is||(Is=1,tl.exports=function(s,d){var g,w,S,A,P,D,N,j;for(w=s.length-(g=3&s.length),S=d,P=3432918353,D=461845907,j=0;j<w;)N=255&s.charCodeAt(j)|(255&s.charCodeAt(++j))<<8|(255&s.charCodeAt(++j))<<16|(255&s.charCodeAt(++j))<<24,++j,S=27492+(65535&(A=5*(65535&(S=(S^=N=(65535&(N=(N=(65535&N)*P+(((N>>>16)*P&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(N=0,g){case 3:N^=(255&s.charCodeAt(j+2))<<16;case 2:N^=(255&s.charCodeAt(j+1))<<8;case 1:S^=N=(65535&(N=(N=(65535&(N^=255&s.charCodeAt(j)))*P+(((N>>>16)*P&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295}return S^=s.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}),tl.exports),n=(zl||(zl=1,Ll.exports=function(s,d){for(var g,w=s.length,S=d^w,A=0;w>=4;)g=1540483477*(65535&(g=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24))+((1540483477*(g>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),w-=4,++A;switch(w){case 3:S^=(255&s.charCodeAt(A+2))<<16;case 2:S^=(255&s.charCodeAt(A+1))<<8;case 1:S=1540483477*(65535&(S^=255&s.charCodeAt(A)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}),Ll.exports);return Cs.exports=a,Cs.exports.murmur3=a,Cs.exports.murmur2=n,Cs.exports})(),nl=O($u);class jr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,s,d,g){this.ids.push(Co(n)),this.positions.push(s,d,g)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=Co(n);let d=0,g=this.ids.length-1;for(;d<g;){const S=d+g>>1;this.ids[S]>=s?g=S:d=S+1}const w=[];for(;this.ids[d]===s;)w.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return w}static serialize(n,s){const d=new Float64Array(n.ids),g=new Uint32Array(n.positions);return Po(d,g,0,d.length-1),s&&s.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(n){const s=new jr;return s.ids=n.ids,s.positions=n.positions,s.indexed=!0,s}}function Co(a){const n=+a;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:nl(String(a))}function Po(a,n,s,d){for(;s<d;){const g=a[s+d>>1];let w=s-1,S=d+1;for(;;){do w++;while(a[w]<g);do S--;while(a[S]>g);if(w>=S)break;Nl(a,w,S),Nl(n,3*w,3*S),Nl(n,3*w+1,3*S+1),Nl(n,3*w+2,3*S+2)}S-s<d-S?(Po(a,n,s,S),s=S+1):(Po(a,n,S+1,d),d=S)}}function Nl(a,n,s){const d=a[n];a[n]=a[s],a[s]=d}Dt("FeaturePositionMap",jr);class Zn{constructor(n,s){this.gl=n.gl,this.location=s}}class Ui extends Zn{constructor(n,s){super(n,s),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class ss extends Zn{constructor(n,s){super(n,s),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Yi extends Zn{constructor(n,s){super(n,s),this.current=on.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const Lh=new Float32Array(16);function Nh(a){return[Er(255*a.r,255*a.g),Er(255*a.b,255*a.a)]}class Yc{constructor(n,s,d){this.value=n,this.uniformNames=s.map((g=>`u_${g}`)),this.type=d}setUniform(n,s,d){n.set(d.constantOr(this.value))}getBinding(n,s,d){return this.type==="color"?new Yi(n,s):new Ui(n,s)}}class so{constructor(n,s){this.uniformNames=s.map((d=>`u_${d}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=n.tlbr}setUniform(n,s,d,g){const w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&n.set(w)}getBinding(n,s,d){return d.substr(0,9)==="u_pattern"?new ss(n,s):new Ui(n,s)}}class Ro{constructor(n,s,d,g){this.expression=n,this.type=d,this.maxValue=0,this.paintVertexAttributes=s.map((w=>({name:`a_${w}`,type:"Float32",components:d==="color"?2:1,offset:0}))),this.paintVertexArray=new g}populatePaintArray(n,s,d){const g=this.paintVertexArray.length,w=this.expression.evaluate(new Jn(0,d),s,{},d.canonical,[],d.formattedSection);this.paintVertexArray.resize(n),this._setPaintValue(g,n,w)}updatePaintArray(n,s,d,g,w){const S=this.expression.evaluate(new Jn(0,w),d,g);this._setPaintValue(n,s,S)}_setPaintValue(n,s,d){if(this.type==="color"){const g=Nh(d);for(let w=n;w<s;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=n;g<s;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tr{constructor(n,s,d,g,w,S){this.expression=n,this.uniformNames=s.map((A=>`u_${A}_t`)),this.type=d,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=s.map((A=>({name:`a_${A}`,type:"Float32",components:d==="color"?4:2,offset:0}))),this.paintVertexArray=new S}populatePaintArray(n,s,d){const g=this.expression.evaluate(new Jn(this.zoom,d),s,{},d.canonical,[],d.formattedSection),w=this.expression.evaluate(new Jn(this.zoom+1,d),s,{},d.canonical,[],d.formattedSection),S=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(S,n,g,w)}updatePaintArray(n,s,d,g,w){const S=this.expression.evaluate(new Jn(this.zoom,w),d,g),A=this.expression.evaluate(new Jn(this.zoom+1,w),d,g);this._setPaintValue(n,s,S,A)}_setPaintValue(n,s,d,g){if(this.type==="color"){const w=Nh(d),S=Nh(g);for(let A=n;A<s;A++)this.paintVertexArray.emplace(A,w[0],w[1],S[0],S[1])}else{for(let w=n;w<s;w++)this.paintVertexArray.emplace(w,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s){const d=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,g=Ht(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);n.set(g)}getBinding(n,s,d){return new Ui(n,s)}}class Qi{constructor(n,s,d,g,w,S){this.expression=n,this.type=s,this.useIntegerZoom=d,this.zoom=g,this.layerId=S,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(n,s,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(g,n,s.patterns&&s.patterns[this.layerId],d.imagePositions)}updatePaintArray(n,s,d,g,w){this._setPaintValues(n,s,d.patterns&&d.patterns[this.layerId],w.imagePositions)}_setPaintValues(n,s,d,g){if(!g||!d)return;const{min:w,mid:S,max:A}=d,P=g[w],D=g[S],N=g[A];if(P&&D&&N)for(let j=n;j<s;j++)this.zoomInPaintVertexArray.emplace(j,D.tl[0],D.tl[1],D.br[0],D.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],D.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,D.tl[0],D.tl[1],D.br[0],D.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],D.pixelRatio,N.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,fr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,fr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Mo{constructor(n,s,d){this.binders={},this._buffers=[];const g=[];for(const w in n.paint._values){if(!d(w))continue;const S=n.paint.get(w);if(!(S instanceof As&&oa(S.property.specification)))continue;const A=rl(w,n.type),P=S.value,D=S.property.specification.type,N=S.property.useIntegerZoom,j=S.property.specification["property-type"],q=j==="cross-faded"||j==="cross-faded-data-driven";if(P.kind==="constant")this.binders[w]=q?new so(P.value,A):new Yc(P.value,A,D),g.push(`/u_${w}`);else if(P.kind==="source"||q){const W=Pa(w,D,"source");this.binders[w]=q?new Qi(P,D,N,s,W,n.id):new Ro(P,A,D,W),g.push(`/a_${w}`)}else{const W=Pa(w,D,"composite");this.binders[w]=new tr(P,A,D,N,s,W),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof Ro||s instanceof tr?s.maxValue:0}populatePaintArrays(n,s,d){for(const g in this.binders){const w=this.binders[g];(w instanceof Ro||w instanceof tr||w instanceof Qi)&&w.populatePaintArray(n,s,d)}}setConstantPatternPositions(n,s){for(const d in this.binders){const g=this.binders[d];g instanceof so&&g.setConstantPatternPositions(n,s)}}updatePaintArrays(n,s,d,g,w){let S=!1;for(const A in n){const P=s.getPositions(A);for(const D of P){const N=d.feature(D.index);for(const j in this.binders){const q=this.binders[j];if((q instanceof Ro||q instanceof tr||q instanceof Qi)&&q.expression.isStateDependent===!0){const W=g.paint.get(j);q.expression=W.value,q.updatePaintArray(D.start,D.end,N,n[A],w),S=!0}}}}return S}defines(){const n=[];for(const s in this.binders){const d=this.binders[s];(d instanceof Yc||d instanceof so)&&n.push(...d.uniformNames.map((g=>`#define HAS_UNIFORM_${g}`)))}return n}getBinderAttributes(){const n=[];for(const s in this.binders){const d=this.binders[s];if(d instanceof Ro||d instanceof tr)for(let g=0;g<d.paintVertexAttributes.length;g++)n.push(d.paintVertexAttributes[g].name);else if(d instanceof Qi)for(let g=0;g<fr.members.length;g++)n.push(fr.members[g].name)}return n}getBinderUniforms(){const n=[];for(const s in this.binders){const d=this.binders[s];if(d instanceof Yc||d instanceof so||d instanceof tr)for(const g of d.uniformNames)n.push(g)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,s){const d=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof Yc||w instanceof so||w instanceof tr){for(const S of w.uniformNames)if(s[S]){const A=w.getBinding(n,s[S],S);d.push({name:S,property:g,binding:A})}}}return d}setUniforms(n,s,d,g){for(const{name:w,property:S,binding:A}of s)this.binders[S].setUniform(A,g,d.get(S),w)}updatePaintBuffers(n){this._buffers=[];for(const s in this.binders){const d=this.binders[s];if(n&&d instanceof Qi){const g=n.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof Ro||d instanceof tr)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(n){for(const s in this.binders){const d=this.binders[s];(d instanceof Ro||d instanceof tr||d instanceof Qi)&&d.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof Ro||s instanceof tr||s instanceof Qi)&&s.destroy()}}}class il{constructor(n,s,d=()=>!0){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new Mo(g,s,d);this.needsUpload=!1,this._featureMap=new jr,this._bufferOffset=0}populatePaintArrays(n,s,d,g){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(n,s,g);s.id!==void 0&&this._featureMap.add(s.id,d,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,d,g){for(const w of d)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(n,this._featureMap,s,w,g)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function rl(a,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${n}-`,"").replace(/-/g,"_")]}function Pa(a,n,s){const d={color:{source:io,composite:F},number:{source:R,composite:io}},g=(function(w){return{"line-pattern":{source:lt,composite:lt},"fill-pattern":{source:lt,composite:lt},"fill-extrusion-pattern":{source:lt,composite:lt}}[w]})(a);return g&&g[s]||d[n][s]}Dt("ConstantBinder",Yc),Dt("CrossFadedConstantBinder",so),Dt("SourceExpressionBinder",Ro),Dt("CrossFadedCompositeBinder",Qi),Dt("CompositeExpressionBinder",tr),Dt("ProgramConfiguration",Mo,{omit:["_buffers"]}),Dt("ProgramConfigurationSet",il);const nr=Math.pow(2,14)-1,sc=-nr-1;function ac(a){const n=Wt/a.extent,s=a.loadGeometry();for(let d=0;d<s.length;d++){const g=s[d];for(let w=0;w<g.length;w++){const S=g[w],A=Math.round(S.x*n),P=Math.round(S.y*n);S.x=Ht(A,sc,nr),S.y=Ht(P,sc,nr),(A<S.x||A>S.x+1||P<S.y||P>S.y+1)&&Pi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function oc(a,n){return{type:a.type,id:a.id,properties:a.properties,geometry:n?ac(a):[]}}const ym=-32768;function f_(a,n,s,d,g){a.emplaceBack(ym+8*n+d,ym+8*s+g)}class lc{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new $e,this.indexArray=new ci,this.segments=new Ln,this.programConfigurations=new il(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(n,s,d){const g=this.layers[0],w=[];let S=null,A=!1,P=g.type==="heatmap";if(g.type==="circle"){const N=g;S=N.layout.get("circle-sort-key"),A=!S.isConstant(),P=P||N.paint.get("circle-pitch-alignment")==="map"}const D=P?s.subdivisionGranularity.circle:1;for(const{feature:N,id:j,index:q,sourceLayerIndex:W}of n){const X=this.layers[0]._featureFilter.needGeometry,ne=oc(N,X);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),ne,d))continue;const se=A?S.evaluate(ne,{},d):void 0,ue={id:j,properties:N.properties,type:N.type,sourceLayerIndex:W,index:q,geometry:X?ne.geometry:ac(N),patterns:{},sortKey:se};w.push(ue)}A&&w.sort(((N,j)=>N.sortKey-j.sortKey));for(const N of w){const{geometry:j,index:q,sourceLayerIndex:W}=N,X=n[q].feature;this.addFeature(N,j,q,d,D),s.featureIndex.insert(X,j,q,W,this.index)}}update(n,s,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,{imagePositions:d})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ui),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,d,g,w=1){let S;switch(w){case 1:S=[0,7];break;case 3:S=[0,2,5,7];break;case 5:S=[0,1,3,4,6,7];break;case 7:S=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${w}; valid values are 1, 3, 5, 7.`)}const A=S.length;for(const P of s)for(const D of P){const N=D.x,j=D.y;if(N<0||N>=Wt||j<0||j>=Wt)continue;const q=this.segments.prepareSegment(A*A,this.layoutVertexArray,this.indexArray,n.sortKey),W=q.vertexLength;for(let X=0;X<A;X++)for(let ne=0;ne<A;ne++)f_(this.layoutVertexArray,N,j,S[ne],S[X]);for(let X=0;X<A-1;X++)for(let ne=0;ne<A-1;ne++){const se=W+X*A+ne,ue=W+(X+1)*A+ne;this.indexArray.emplaceBack(se,ue+1,se+1),this.indexArray.emplaceBack(se,ue,ue+1)}q.vertexLength+=A*A,q.primitiveLength+=(A-1)*(A-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{imagePositions:{},canonical:g})}}function qd(a,n){for(let s=0;s<a.length;s++)if(Vh(n,a[s]))return!0;for(let s=0;s<n.length;s++)if(Vh(a,n[s]))return!0;return!!Bh(a,n)}function Gd(a,n,s){return!!Vh(a,n)||!!Hd(n,a,s)}function vm(a,n){if(a.length===1)return xm(n,a[0]);for(let s=0;s<n.length;s++){const d=n[s];for(let g=0;g<d.length;g++)if(Vh(a,d[g]))return!0}for(let s=0;s<a.length;s++)if(xm(n,a[s]))return!0;for(let s=0;s<n.length;s++)if(Bh(a,n[s]))return!0;return!1}function p_(a,n,s){if(a.length>1){if(Bh(a,n))return!0;for(let d=0;d<n.length;d++)if(Hd(n[d],a,s))return!0}for(let d=0;d<a.length;d++)if(Hd(a[d],n,s))return!0;return!1}function Bh(a,n){if(a.length===0||n.length===0)return!1;for(let s=0;s<a.length-1;s++){const d=a[s],g=a[s+1];for(let w=0;w<n.length-1;w++)if(m_(d,g,n[w],n[w+1]))return!0}return!1}function m_(a,n,s,d){return Xs(a,s,d)!==Xs(n,s,d)&&Xs(a,n,s)!==Xs(a,n,d)}function Hd(a,n,s){const d=s*s;if(n.length===1)return a.distSqr(n[0])<d;for(let g=1;g<n.length;g++)if(bm(a,n[g-1],n[g])<d)return!0;return!1}function bm(a,n,s){const d=n.distSqr(s);if(d===0)return a.distSqr(n);const g=((a.x-n.x)*(s.x-n.x)+(a.y-n.y)*(s.y-n.y))/d;return a.distSqr(g<0?n:g>1?s:s.sub(n)._mult(g)._add(n))}function xm(a,n){let s,d,g,w=!1;for(let S=0;S<a.length;S++){s=a[S];for(let A=0,P=s.length-1;A<s.length;P=A++)d=s[A],g=s[P],d.y>n.y!=g.y>n.y&&n.x<(g.x-d.x)*(n.y-d.y)/(g.y-d.y)+d.x&&(w=!w)}return w}function Vh(a,n){let s=!1;for(let d=0,g=a.length-1;d<a.length;g=d++){const w=a[d],S=a[g];w.y>n.y!=S.y>n.y&&n.x<(S.x-w.x)*(n.y-w.y)/(S.y-w.y)+w.x&&(s=!s)}return s}function g_(a,n,s){const d=s[0],g=s[2];if(a.x<d.x&&n.x<d.x||a.x>g.x&&n.x>g.x||a.y<d.y&&n.y<d.y||a.y>g.y&&n.y>g.y)return!1;const w=Xs(a,n,s[0]);return w!==Xs(a,n,s[1])||w!==Xs(a,n,s[2])||w!==Xs(a,n,s[3])}function pr(a,n,s){const d=n.paint.get(a).value;return d.kind==="constant"?d.value:s.programConfigurations.get(n.id).getMaxValue(a)}function Ur(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Zd(a,n,s,d,g){if(!n[0]&&!n[1])return a;const w=M.convert(n)._mult(g);s==="viewport"&&w._rotate(-d);const S=[];for(let A=0;A<a.length;A++)S.push(a[A].sub(w));return S}function __({queryGeometry:a,size:n},s){return Gd(a,s,n)}function y_({queryGeometry:a,size:n,transform:s,unwrappedTileID:d,getElevation:g},w){return Gd(a,w,n*(s.projectTileCoordinates(w.x,w.y,d,g).signedDistanceFromCamera/s.cameraToCenterDistance))}function v_({queryGeometry:a,size:n,transform:s,unwrappedTileID:d,getElevation:g},w){const S=s.projectTileCoordinates(w.x,w.y,d,g).signedDistanceFromCamera,A=n*(s.cameraToCenterDistance/S);return Gd(a,Kd(w,s,d,g),A)}function b_({queryGeometry:a,size:n,transform:s,unwrappedTileID:d,getElevation:g},w){return Gd(a,Kd(w,s,d,g),n)}function Wd({queryGeometry:a,size:n,transform:s,unwrappedTileID:d,getElevation:g,pitchAlignment:w="map",pitchScale:S="map"},A){const P=w==="map"?S==="map"?__:y_:S==="map"?v_:b_,D={queryGeometry:a,size:n,transform:s,unwrappedTileID:d,getElevation:g};for(const N of A)for(const j of N)if(P(D,j))return!0;return!1}function Kd(a,n,s,d){const g=n.projectTileCoordinates(a.x,a.y,s,d).point;return new M((.5*g.x+.5)*n.width,(.5*-g.y+.5)*n.height)}let wm,Tm;Dt("CircleBucket",lc,{omit:["layers"]});var x_={get paint(){return Tm=Tm||new Br({"circle-radius":new Ft(Re.paint_circle["circle-radius"]),"circle-color":new Ft(Re.paint_circle["circle-color"]),"circle-blur":new Ft(Re.paint_circle["circle-blur"]),"circle-opacity":new Ft(Re.paint_circle["circle-opacity"]),"circle-translate":new Lt(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new Lt(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Lt(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Lt(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ft(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ft(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ft(Re.paint_circle["circle-stroke-opacity"])})},get layout(){return wm=wm||new Br({"circle-sort-key":new Ft(Re.layout_circle["circle-sort-key"])})}};class Sm extends Ca{constructor(n,s){super(n,x_,s)}createBucket(n){return new lc(n)}queryRadius(n){const s=n;return pr("circle-radius",this,s)+pr("circle-stroke-width",this,s)+Ur(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:d,geometry:g,transform:w,pixelsToTileUnits:S,unwrappedTileID:A,getElevation:P}){const D=Zd(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-w.bearingInRadians,S),N=this.paint.get("circle-radius").evaluate(s,d)+this.paint.get("circle-stroke-width").evaluate(s,d),j=this.paint.get("circle-pitch-scale"),q=this.paint.get("circle-pitch-alignment");let W,X;return q==="map"?(W=D,X=N*S):(W=(function(ne,se,ue,Ne){return ne.map((_e=>Kd(_e,se,ue,Ne)))})(D,w,A,P),X=N),Wd({queryGeometry:W,size:X,transform:w,unwrappedTileID:A,getElevation:P,pitchAlignment:q,pitchScale:j},g)}}class ip extends lc{}let rp;Dt("HeatmapBucket",ip,{omit:["layers"]});var w_={get paint(){return rp=rp||new Br({"heatmap-radius":new Ft(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ft(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Lt(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gi(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Lt(Re.paint_heatmap["heatmap-opacity"])})}};function Xd(a,{width:n,height:s},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*s*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${n*s*d}`)}else g=new Uint8Array(n*s*d);return a.width=n,a.height=s,a.data=g,a}function Yd(a,{width:n,height:s},d){if(n===a.width&&s===a.height)return;const g=Xd({},{width:n,height:s},d);Qd(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,n),height:Math.min(a.height,s)},d),a.width=n,a.height=s,a.data=g.data}function Qd(a,n,s,d,g,w){if(g.width===0||g.height===0)return n;if(g.width>a.width||g.height>a.height||s.x>a.width-g.width||s.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||d.x>n.width-g.width||d.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const S=a.data,A=n.data;if(S===A)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<g.height;P++){const D=((s.y+P)*a.width+s.x)*w,N=((d.y+P)*n.width+d.x)*w;for(let j=0;j<g.width*w;j++)A[N+j]=S[D+j]}return n}class jh{constructor(n,s){Xd(this,n,1,s)}resize(n){Yd(this,n,1)}clone(){return new jh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,d,g,w){Qd(n,s,d,g,w,1)}}class Ps{constructor(n,s){Xd(this,n,4,s)}resize(n){Yd(this,n,4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ps({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,d,g,w){Qd(n,s,d,g,w,4)}setPixel(n,s,d){const g=4*(n*this.width+s);this.data[g+0]=Math.round(255*d.r/d.a),this.data[g+1]=Math.round(255*d.g/d.a),this.data[g+2]=Math.round(255*d.b/d.a),this.data[g+3]=Math.round(255*d.a)}}function Em(a){const n={},s=a.resolution||256,d=a.clips?a.clips.length:1,g=a.image||new Ps({width:s,height:d});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const w=(S,A,P)=>{n[a.evaluationKey]=P;const D=a.expression.evaluate(n);g.setPixel(S/4/s,A/4,D)};if(a.clips)for(let S=0,A=0;S<d;++S,A+=4*s)for(let P=0,D=0;P<s;P++,D+=4){const N=P/(s-1),{start:j,end:q}=a.clips[S];w(A,D,j*(1-N)+q*N)}else for(let S=0,A=0;S<s;S++,A+=4)w(0,A,S/(s-1));return g}Dt("AlphaImage",jh),Dt("RGBAImage",Ps);const sl="big-fb";class Am extends Ca{createBucket(n){return new ip(n)}constructor(n,s){super(n,w_,s),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Em({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(sl)&&this.heatmapFbos.delete(sl)}queryRadius(n){return pr("heatmap-radius",this,n)}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:d,geometry:g,transform:w,pixelsToTileUnits:S,unwrappedTileID:A,getElevation:P}){return Wd({queryGeometry:n,size:this.paint.get("heatmap-radius").evaluate(s,d)*S,transform:w,unwrappedTileID:A,getElevation:P},g)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let T_;var S_={get paint(){return T_=T_||new Br({"hillshade-illumination-direction":new Lt(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Lt(Re.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Lt(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Lt(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Lt(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Lt(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Lt(Re.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Lt(Re.paint_hillshade["hillshade-method"])})}};class cc extends Ca{constructor(n,s){super(n,S_,s),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let n=this.paint.get("hillshade-illumination-direction").values,s=this.paint.get("hillshade-illumination-altitude").values,d=this.paint.get("hillshade-highlight-color").values,g=this.paint.get("hillshade-shadow-color").values;const w=Math.max(n.length,s.length,d.length,g.length);n=n.concat(Array(w-n.length).fill(n.at(-1))),s=s.concat(Array(w-s.length).fill(s.at(-1))),d=d.concat(Array(w-d.length).fill(d.at(-1))),g=g.concat(Array(w-g.length).fill(g.at(-1)));const S=s.map(Bo);return{directionRadians:n.map(Bo),altitudeRadians:S,shadowColor:g,highlightColor:d}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Im;var sp={get paint(){return Im=Im||new Br({"color-relief-opacity":new Lt(Re["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Gi(Re["paint_color-relief"]["color-relief-color"])})}};class qu{constructor(n,s,d,g){this.context=n,this.format=d,this.texture=n.gl.createTexture(),this.update(s,g)}update(n,s,d){const{width:g,height:w}=n,S=!(this.size&&this.size[0]===g&&this.size[1]===w||d),{context:A}=this,{gl:P}=A;if(this.useMipmap=!!(s&&s.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!s||s.premultiply!==!1)),S)this.size=[g,w],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||Ys(n)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,n):P.texImage2D(P.TEXTURE_2D,0,this.format,g,w,0,this.format,P.UNSIGNED_BYTE,n.data);else{const{x:D,y:N}=d||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||Ys(n)?P.texSubImage2D(P.TEXTURE_2D,0,D,N,P.RGBA,P.UNSIGNED_BYTE,n):P.texSubImage2D(P.TEXTURE_2D,0,D,N,g,w,P.RGBA,P.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D),A.pixelStoreUnpackFlipY.setDefault(),A.pixelStoreUnpack.setDefault(),A.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(n,s,d){const{context:g}=this,{gl:w}=g;w.bindTexture(w.TEXTURE_2D,this.texture),d!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=w.LINEAR),n!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,n),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,d||n),this.filter=n),s!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,s),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class ir{constructor(n,s,d,g=1,w=1,S=1,A=0){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void Pi(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const P=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=S,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<P;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(P,D)]=this.data[this._idx(P-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,P)]=this.data[this._idx(D,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<P;D++)for(let N=0;N<P;N++){const j=this.get(D,N);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(n,s){const d=new Uint8Array(this.data.buffer),g=4*this._idx(n,s);return this.unpack(d[g],d[g+1],d[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)}unpack(n,s,d){return n*this.redFactor+s*this.greenFactor+d*this.blueFactor-this.baseShift}pack(n){return E_(n,this.getUnpackVector())}getPixels(){return new Ps({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,s,d){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=s*this.dim,w=s*this.dim+this.dim,S=d*this.dim,A=d*this.dim+this.dim;switch(s){case-1:g=w-1;break;case 1:w=g+1}switch(d){case-1:S=A-1;break;case 1:A=S+1}const P=-s*this.dim,D=-d*this.dim;for(let N=S;N<A;N++)for(let j=g;j<w;j++)this.data[this._idx(j,N)]=n.data[this._idx(j+P,N+D)]}}function E_(a,n){const s=n[0],d=n[1],g=n[2],w=n[3],S=Math.min(s,d,g),A=Math.round((a+w)/S);return{r:Math.floor(A*S/s)%256,g:Math.floor(A*S/d)%256,b:Math.floor(A*S/g)%256}}Dt("DEMData",ir);class Iv extends Ca{constructor(n,s){super(n,sp,s)}_createColorRamp(n){const s={elevationStops:[],colorStops:[]},d=this._transitionablePaint._values["color-relief-color"].value.expression;if(d instanceof Il&&d._styleExpression.expression instanceof Vi){this.colorRampExpression=d;const S=d._styleExpression.expression;s.elevationStops=S.labels,s.colorStops=[];for(const A of s.elevationStops)s.colorStops.push(S.evaluate({globals:{elevation:A}}))}if(s.elevationStops.length<1&&(s.elevationStops=[0],s.colorStops=[on.transparent]),s.elevationStops.length<2&&(s.elevationStops.push(s.elevationStops[0]+1),s.colorStops.push(s.colorStops[0])),s.elevationStops.length<=n)return s;const g={elevationStops:[],colorStops:[]},w=(s.elevationStops.length-1)/(n-1);for(let S=0;S<s.elevationStops.length-.5;S+=w)g.elevationStops.push(s.elevationStops[Math.round(S)]),g.colorStops.push(s.colorStops[Math.round(S)]);return Pi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),g}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(n,s,d){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const g=this._createColorRamp(s),w=new Ps({width:g.colorStops.length,height:1}),S=new Ps({width:g.colorStops.length,height:1});for(let A=0;A<g.elevationStops.length;A++){const P=E_(g.elevationStops[A],d);S.setPixel(0,A,new on(P.r/255,P.g/255,P.b/255,1)),w.setPixel(0,A,g.colorStops[A])}return this.colorRampTextures={elevationTexture:new qu(n,S,n.gl.RGBA),colorTexture:new qu(n,w,n.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const A_=Hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jd}=A_;function Bl(a,n,s){const d=s.patternDependencies;let g=!1;for(const w of n){const S=w.paint.get(`${a}-pattern`);S.isConstant()||(g=!0);const A=S.constantOr(null);A&&(g=!0,d[A.to]=!0,d[A.from]=!0)}return g}function ap(a,n,s,d,g){const{zoom:w}=d,S=g.patternDependencies;for(const A of n){const P=A.paint.get(`${a}-pattern`).value;if(P.kind!=="constant"){let D=P.evaluate({zoom:w-1},s,{},g.availableImages),N=P.evaluate({zoom:w},s,{},g.availableImages),j=P.evaluate({zoom:w+1},s,{},g.availableImages);D=D&&D.name?D.name:D,N=N&&N.name?N.name:N,j=j&&j.name?j.name:j,S[D]=!0,S[N]=!0,S[j]=!0,s.patterns[A.id]={min:D,mid:N,max:j}}}return s}function Cm(a,n,s,d,g){let w;if(g===(function(S,A,P,D){let N=0;for(let j=A,q=P-D;j<P;j+=D)N+=(S[q]-S[j])*(S[j+1]+S[q+1]),q=j;return N})(a,n,s,d)>0)for(let S=n;S<s;S+=d)w=Om(S/d|0,a[S],a[S+1],w);else for(let S=s-d;S>=n;S-=d)w=Om(S/d|0,a[S],a[S+1],w);return w&&Gu(w,w.next)&&(ef(w),w=w.next),w}function al(a,n){if(!a)return a;n||(n=a);let s,d=a;do if(s=!1,d.steiner||!Gu(d,d.next)&&mr(d.prev,d,d.next)!==0)d=d.next;else{if(ef(d),d=n=d.prev,d===d.next)break;s=!0}while(s||d!==n);return n}function Ra(a,n,s,d,g,w,S){if(!a)return;!S&&w&&(function(P,D,N,j){let q=P;do q.z===0&&(q.z=ol(q.x,q.y,D,N,j)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==P);q.prevZ.nextZ=null,q.prevZ=null,(function(W){let X,ne=1;do{let se,ue=W;W=null;let Ne=null;for(X=0;ue;){X++;let _e=ue,Ae=0;for(let et=0;et<ne&&(Ae++,_e=_e.nextZ,_e);et++);let Ze=ne;for(;Ae>0||Ze>0&&_e;)Ae!==0&&(Ze===0||!_e||ue.z<=_e.z)?(se=ue,ue=ue.nextZ,Ae--):(se=_e,_e=_e.nextZ,Ze--),Ne?Ne.nextZ=se:W=se,se.prevZ=Ne,Ne=se;ue=_e}Ne.nextZ=null,ne*=2}while(X>1)})(q)})(a,d,g,w);let A=a;for(;a.prev!==a.next;){const P=a.prev,D=a.next;if(w?Pm(a,d,g,w):I_(a))n.push(P.i,a.i,D.i),ef(a),a=D.next,A=D.next;else if((a=D)===A){S?S===1?Ra(a=C_(al(a),n),n,s,d,g,w,2):S===2&&Rm(a,n,s,d,g,w):Ra(al(a),n,s,d,g,w,1);break}}}function I_(a){const n=a.prev,s=a,d=a.next;if(mr(n,s,d)>=0)return!1;const g=n.x,w=s.x,S=d.x,A=n.y,P=s.y,D=d.y,N=Math.min(g,w,S),j=Math.min(A,P,D),q=Math.max(g,w,S),W=Math.max(A,P,D);let X=d.next;for(;X!==n;){if(X.x>=N&&X.x<=q&&X.y>=j&&X.y<=W&&Uh(g,A,w,P,S,D,X.x,X.y)&&mr(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function Pm(a,n,s,d){const g=a.prev,w=a,S=a.next;if(mr(g,w,S)>=0)return!1;const A=g.x,P=w.x,D=S.x,N=g.y,j=w.y,q=S.y,W=Math.min(A,P,D),X=Math.min(N,j,q),ne=Math.max(A,P,D),se=Math.max(N,j,q),ue=ol(W,X,n,s,d),Ne=ol(ne,se,n,s,d);let _e=a.prevZ,Ae=a.nextZ;for(;_e&&_e.z>=ue&&Ae&&Ae.z<=Ne;){if(_e.x>=W&&_e.x<=ne&&_e.y>=X&&_e.y<=se&&_e!==g&&_e!==S&&Uh(A,N,P,j,D,q,_e.x,_e.y)&&mr(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,Ae.x>=W&&Ae.x<=ne&&Ae.y>=X&&Ae.y<=se&&Ae!==g&&Ae!==S&&Uh(A,N,P,j,D,q,Ae.x,Ae.y)&&mr(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;_e&&_e.z>=ue;){if(_e.x>=W&&_e.x<=ne&&_e.y>=X&&_e.y<=se&&_e!==g&&_e!==S&&Uh(A,N,P,j,D,q,_e.x,_e.y)&&mr(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;Ae&&Ae.z<=Ne;){if(Ae.x>=W&&Ae.x<=ne&&Ae.y>=X&&Ae.y<=se&&Ae!==g&&Ae!==S&&Uh(A,N,P,j,D,q,Ae.x,Ae.y)&&mr(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function C_(a,n){let s=a;do{const d=s.prev,g=s.next.next;!Gu(d,g)&&km(d,s,s.next,g)&&ao(d,g)&&ao(g,d)&&(n.push(d.i,s.i,g.i),ef(s),ef(s.next),s=a=g),s=s.next}while(s!==a);return al(s)}function Rm(a,n,s,d,g,w){let S=a;do{let A=S.next.next;for(;A!==S.prev;){if(S.i!==A.i&&as(S,A)){let P=Dm(S,A);return S=al(S,S.next),P=al(P,P.next),Ra(S,n,s,d,g,w,0),void Ra(P,n,s,d,g,w,0)}A=A.next}S=S.next}while(S!==a)}function Mm(a,n){let s=a.x-n.x;return s===0&&(s=a.y-n.y,s===0)&&(s=(a.next.y-a.y)/(a.next.x-a.x)-(n.next.y-n.y)/(n.next.x-n.x)),s}function op(a,n){const s=(function(g,w){let S=w;const A=g.x,P=g.y;let D,N=-1/0;if(Gu(g,S))return S;do{if(Gu(g,S.next))return S.next;if(P<=S.y&&P>=S.next.y&&S.next.y!==S.y){const ne=S.x+(P-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(ne<=A&&ne>N&&(N=ne,D=S.x<S.next.x?S:S.next,ne===A))return D}S=S.next}while(S!==w);if(!D)return null;const j=D,q=D.x,W=D.y;let X=1/0;S=D;do{if(A>=S.x&&S.x>=q&&A!==S.x&&lp(P<W?A:N,P,q,W,P<W?N:A,P,S.x,S.y)){const ne=Math.abs(P-S.y)/(A-S.x);ao(S,g)&&(ne<X||ne===X&&(S.x>D.x||S.x===D.x&&P_(D,S)))&&(D=S,X=ne)}S=S.next}while(S!==j);return D})(a,n);if(!s)return n;const d=Dm(s,a);return al(d,d.next),al(s,s.next)}function P_(a,n){return mr(a.prev,a,n.prev)<0&&mr(n.next,a,a.next)<0}function ol(a,n,s,d,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-s)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-d)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Cr(a){let n=a,s=a;do(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next;while(n!==a);return s}function lp(a,n,s,d,g,w,S,A){return(g-S)*(n-A)>=(a-S)*(w-A)&&(a-S)*(d-A)>=(s-S)*(n-A)&&(s-S)*(w-A)>=(g-S)*(d-A)}function Uh(a,n,s,d,g,w,S,A){return!(a===S&&n===A)&&lp(a,n,s,d,g,w,S,A)}function as(a,n){return a.next.i!==n.i&&a.prev.i!==n.i&&!(function(s,d){let g=s;do{if(g.i!==s.i&&g.next.i!==s.i&&g.i!==d.i&&g.next.i!==d.i&&km(g,g.next,s,d))return!0;g=g.next}while(g!==s);return!1})(a,n)&&(ao(a,n)&&ao(n,a)&&(function(s,d){let g=s,w=!1;const S=(s.x+d.x)/2,A=(s.y+d.y)/2;do g.y>A!=g.next.y>A&&g.next.y!==g.y&&S<(g.next.x-g.x)*(A-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==s);return w})(a,n)&&(mr(a.prev,a,n.prev)||mr(a,n.prev,n))||Gu(a,n)&&mr(a.prev,a,a.next)>0&&mr(n.prev,n,n.next)>0)}function mr(a,n,s){return(n.y-a.y)*(s.x-n.x)-(n.x-a.x)*(s.y-n.y)}function Gu(a,n){return a.x===n.x&&a.y===n.y}function km(a,n,s,d){const g=Rs(mr(a,n,s)),w=Rs(mr(a,n,d)),S=Rs(mr(s,d,a)),A=Rs(mr(s,d,n));return g!==w&&S!==A||!(g!==0||!Fi(a,s,n))||!(w!==0||!Fi(a,d,n))||!(S!==0||!Fi(s,a,d))||!(A!==0||!Fi(s,n,d))}function Fi(a,n,s){return n.x<=Math.max(a.x,s.x)&&n.x>=Math.min(a.x,s.x)&&n.y<=Math.max(a.y,s.y)&&n.y>=Math.min(a.y,s.y)}function Rs(a){return a>0?1:a<0?-1:0}function ao(a,n){return mr(a.prev,a,a.next)<0?mr(a,n,a.next)>=0&&mr(a,a.prev,n)>=0:mr(a,n,a.prev)<0||mr(a,a.next,n)<0}function Dm(a,n){const s=tf(a.i,a.x,a.y),d=tf(n.i,n.x,n.y),g=a.next,w=n.prev;return a.next=n,n.prev=a,s.next=g,g.prev=s,d.next=s,s.prev=d,w.next=d,d.prev=w,d}function Om(a,n,s,d){const g=tf(a,n,s);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function ef(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function tf(a,n,s){return{i:a,x:n,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class os{constructor(n,s){if(s>n)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=n,this._minGranularity=s}getGranularityForZoomLevel(n){return Math.max(Math.floor(this._baseZoomGranularity/(1<<n)),this._minGranularity,1)}}class Ma{constructor(n){this.fill=n.fill,this.line=n.line,this.tile=n.tile,this.stencil=n.stencil,this.circle=n.circle}}Ma.noSubdivision=new Ma({fill:new os(0,0),line:new os(0,0),tile:new os(0,0),stencil:new os(0,0),circle:1}),Dt("SubdivisionGranularityExpression",os),Dt("SubdivisionGranularitySetting",Ma);const Hu=-32768,Ms=32767;class R_{constructor(n,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=n,this._granularityCellSize=Wt/n,this._canonical=s}_getKey(n,s){return(n+=32768)<<16|s+32768}_vertexToIndex(n,s){if(n<-32768||s<-32768||n>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const d=0|Math.round(n),g=0|Math.round(s),w=this._getKey(d,g);if(this._vertexDictionary.has(w))return this._vertexDictionary.get(w);const S=this._vertexBuffer.length/2;return this._vertexDictionary.set(w,S),this._vertexBuffer.push(d,g),S}_subdivideTrianglesScanline(n){if(this._granularity<2)return(function(g,w){const S=[];for(let A=0;A<w.length;A+=3){const P=w[A],D=w[A+1],N=w[A+2],j=g[2*P],q=g[2*P+1];(g[2*D]-j)*(g[2*N+1]-q)-(g[2*D+1]-q)*(g[2*N]-j)>0?(S.push(P),S.push(N),S.push(D)):(S.push(P),S.push(D),S.push(N))}return S})(this._vertexBuffer,n);const s=[],d=n.length;for(let g=0;g<d;g+=3){const w=[n[g+0],n[g+1],n[g+2]],S=[this._vertexBuffer[2*n[g+0]+0],this._vertexBuffer[2*n[g+0]+1],this._vertexBuffer[2*n[g+1]+0],this._vertexBuffer[2*n[g+1]+1],this._vertexBuffer[2*n[g+2]+0],this._vertexBuffer[2*n[g+2]+1]];let A=1/0,P=1/0,D=-1/0,N=-1/0;for(let ne=0;ne<3;ne++){const se=S[2*ne],ue=S[2*ne+1];A=Math.min(A,se),D=Math.max(D,se),P=Math.min(P,ue),N=Math.max(N,ue)}if(A===D||P===N)continue;const j=Math.floor(A/this._granularityCellSize),q=Math.ceil(D/this._granularityCellSize),W=Math.floor(P/this._granularityCellSize),X=Math.ceil(N/this._granularityCellSize);if(j!==q||W!==X)for(let ne=W;ne<X;ne++){const se=this._scanlineGenerateVertexRingForCellRow(ne,S,w);Qc(this._vertexBuffer,se,s)}else s.push(...w)}return s}_scanlineGenerateVertexRingForCellRow(n,s,d){const g=n*this._granularityCellSize,w=g+this._granularityCellSize,S=[];for(let A=0;A<3;A++){const P=s[2*A],D=s[2*A+1],N=s[2*(A+1)%6],j=s[(2*(A+1)+1)%6],q=s[2*(A+2)%6],W=s[(2*(A+2)+1)%6],X=N-P,ne=j-D,se=X===0,ue=ne===0,Ne=(g-D)/ne,_e=(w-D)/ne,Ae=Math.min(Ne,_e),Ze=Math.max(Ne,_e);if(!ue&&(Ae>=1||Ze<=0)||ue&&(D<g||D>w)){j>=g&&j<=w&&S.push(d[(A+1)%3]);continue}!ue&&Ae>0&&S.push(this._vertexToIndex(P+X*Ae,D+ne*Ae));const et=P+X*Math.max(Ae,0),dt=P+X*Math.min(Ze,1);se||this._generateIntraEdgeVertices(S,P,D,N,j,et,dt),!ue&&Ze<1&&S.push(this._vertexToIndex(P+X*Ze,D+ne*Ze)),(ue||j>=g&&j<=w)&&S.push(d[(A+1)%3]),!ue&&(j<=g||j>=w)&&this._generateInterEdgeVertices(S,P,D,N,j,q,W,dt,g,w)}return S}_generateIntraEdgeVertices(n,s,d,g,w,S,A){const P=g-s,D=w-d,N=D===0,j=N?Math.min(s,g):Math.min(S,A),q=N?Math.max(s,g):Math.max(S,A),W=Math.floor(j/this._granularityCellSize)+1,X=Math.ceil(q/this._granularityCellSize)-1;if(N?s<g:S<A)for(let ne=W;ne<=X;ne++){const se=ne*this._granularityCellSize;n.push(this._vertexToIndex(se,d+D*(se-s)/P))}else for(let ne=X;ne>=W;ne--){const se=ne*this._granularityCellSize;n.push(this._vertexToIndex(se,d+D*(se-s)/P))}}_generateInterEdgeVertices(n,s,d,g,w,S,A,P,D,N){const j=w-d,q=S-g,W=A-w,X=(D-w)/W,ne=(N-w)/W,se=Math.min(X,ne),ue=Math.max(X,ne),Ne=g+q*se;let _e=Math.floor(Math.min(Ne,P)/this._granularityCellSize)+1,Ae=Math.ceil(Math.max(Ne,P)/this._granularityCellSize)-1,Ze=P<Ne;const et=W===0;if(et&&(A===D||A===N))return;if(et||se>=1||ue<=0){const At=d-A,bt=S+(s-S)*Math.min((D-A)/At,(N-A)/At);_e=Math.floor(Math.min(bt,P)/this._granularityCellSize)+1,Ae=Math.ceil(Math.max(bt,P)/this._granularityCellSize)-1,Ze=P<bt}const dt=j>0?N:D;if(Ze)for(let At=_e;At<=Ae;At++)n.push(this._vertexToIndex(At*this._granularityCellSize,dt));else for(let At=Ae;At>=_e;At--)n.push(this._vertexToIndex(At*this._granularityCellSize,dt))}_generateOutline(n){const s=[];for(const d of n){const g=oo(d,this._granularity,!0),w=this._pointArrayToIndices(g),S=[];for(let A=1;A<w.length;A++)S.push(w[A-1]),S.push(w[A]);s.push(S)}return s}_handlePoles(n){let s=!1,d=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(d=!0)),(s||d)&&this._fillPoles(n,s,d)}_ensureNoPoleVertices(){const n=this._vertexBuffer;for(let s=0;s<n.length;s+=2){const d=n[s+1];d===Hu&&(n[s+1]=-32767),d===Ms&&(n[s+1]=32766)}}_generatePoleQuad(n,s,d,g,w,S){g>w!=(S===Hu)?(n.push(s),n.push(d),n.push(this._vertexToIndex(g,S)),n.push(d),n.push(this._vertexToIndex(w,S)),n.push(this._vertexToIndex(g,S))):(n.push(d),n.push(s),n.push(this._vertexToIndex(g,S)),n.push(this._vertexToIndex(w,S)),n.push(d),n.push(this._vertexToIndex(g,S)))}_fillPoles(n,s,d){const g=this._vertexBuffer,w=Wt,S=n.length;for(let A=2;A<S;A+=3){const P=n[A-2],D=n[A-1],N=n[A],j=g[2*P],q=g[2*P+1],W=g[2*D],X=g[2*D+1],ne=g[2*N],se=g[2*N+1];s&&(q===0&&X===0&&this._generatePoleQuad(n,P,D,j,W,Hu),X===0&&se===0&&this._generatePoleQuad(n,D,N,W,ne,Hu),se===0&&q===0&&this._generatePoleQuad(n,N,P,ne,j,Hu)),d&&(q===w&&X===w&&this._generatePoleQuad(n,P,D,j,W,Ms),X===w&&se===w&&this._generatePoleQuad(n,D,N,W,ne,Ms),se===w&&q===w&&this._generatePoleQuad(n,N,P,ne,j,Ms))}}_initializeVertices(n){for(let s=0;s<n.length;s+=2)this._vertexToIndex(n[s],n[s+1])}subdividePolygonInternal(n,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:d,holeIndices:g}=(function(A){const P=[],D=[];for(const N of A)if(N.length!==0){N!==A[0]&&P.push(D.length/2);for(let j=0;j<N.length;j++)D.push(N[j].x),D.push(N[j].y)}return{flattened:D,holeIndices:P}})(n);let w;this._initializeVertices(d);try{const A=(function(D,N,j=2){const q=N&&N.length,W=q?N[0]*j:D.length;let X=Cm(D,0,W,j,!0);const ne=[];if(!X||X.next===X.prev)return ne;let se,ue,Ne;if(q&&(X=(function(_e,Ae,Ze,et){const dt=[];for(let At=0,bt=Ae.length;At<bt;At++){const Ct=Cm(_e,Ae[At]*et,At<bt-1?Ae[At+1]*et:_e.length,et,!1);Ct===Ct.next&&(Ct.steiner=!0),dt.push(Cr(Ct))}dt.sort(Mm);for(let At=0;At<dt.length;At++)Ze=op(dt[At],Ze);return Ze})(D,N,X,j)),D.length>80*j){se=D[0],ue=D[1];let _e=se,Ae=ue;for(let Ze=j;Ze<W;Ze+=j){const et=D[Ze],dt=D[Ze+1];et<se&&(se=et),dt<ue&&(ue=dt),et>_e&&(_e=et),dt>Ae&&(Ae=dt)}Ne=Math.max(_e-se,Ae-ue),Ne=Ne!==0?32767/Ne:0}return Ra(X,ne,j,se,ue,Ne,0),ne})(d,g),P=this._convertIndices(d,A);w=this._subdivideTrianglesScanline(P)}catch(A){console.error(A)}let S=[];return s&&(S=this._generateOutline(n)),this._ensureNoPoleVertices(),this._handlePoles(w),{verticesFlattened:this._vertexBuffer,indicesTriangles:w,indicesLineList:S}}_convertIndices(n,s){const d=[];for(let g=0;g<s.length;g++)d.push(this._vertexToIndex(n[2*s[g]],n[2*s[g]+1]));return d}_pointArrayToIndices(n){const s=[];for(let d=0;d<n.length;d++){const g=n[d];s.push(this._vertexToIndex(g.x,g.y))}return s}}function uc(a,n,s,d=!0){return new R_(s,n).subdividePolygonInternal(a,d)}function oo(a,n,s=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const d=a[0],g=a[a.length-1],w=s&&(d.x!==g.x||d.y!==g.y);if(n<2)return w?[...a,a[0]]:[...a];const S=Math.floor(Wt/n),A=[];A.push(new M(a[0].x,a[0].y));const P=a.length,D=w?P:P-1;for(let N=0;N<D;N++){const j=a[N],q=N<P-1?a[N+1]:a[0],W=j.x,X=j.y,ne=q.x,se=q.y,ue=W!==ne,Ne=X!==se;if(!ue&&!Ne)continue;const _e=ne-W,Ae=se-X,Ze=Math.abs(_e),et=Math.abs(Ae);let dt=W,At=X;for(;;){const Ct=_e>0?(Math.floor(dt/S)+1)*S:(Math.ceil(dt/S)-1)*S,Ut=Ae>0?(Math.floor(At/S)+1)*S:(Math.ceil(At/S)-1)*S,xt=Math.abs(dt-Ct),Tt=Math.abs(At-Ut),at=Math.abs(dt-ne),Xt=Math.abs(At-se),en=ue?xt/Ze:Number.POSITIVE_INFINITY,jt=Ne?Tt/et:Number.POSITIVE_INFINITY;if((at<=xt||!ue)&&(Xt<=Tt||!Ne))break;if(en<jt&&ue||!Ne){dt=Ct,At+=Ae*en;const Vt=new M(dt,Math.round(At));A[A.length-1].x===Vt.x&&A[A.length-1].y===Vt.y||A.push(Vt)}else{dt+=_e*jt,At=Ut;const Vt=new M(Math.round(dt),At);A[A.length-1].x===Vt.x&&A[A.length-1].y===Vt.y||A.push(Vt)}}const bt=new M(ne,se);A[A.length-1].x===bt.x&&A[A.length-1].y===bt.y||A.push(bt)}return A}function Qc(a,n,s){if(n.length===0)throw new Error("Subdivision vertex ring is empty.");let d=0,g=a[2*n[0]];for(let P=1;P<n.length;P++){const D=a[2*n[P]];D<g&&(g=D,d=P)}const w=n.length;let S=d,A=(S+1)%w;for(;;){const P=S-1>=0?S-1:w-1,D=(A+1)%w,N=a[2*n[P]],j=a[2*n[D]],q=a[2*n[S]],W=a[2*n[S]+1],X=a[2*n[A]+1];let ne=!1;if(N<j)ne=!0;else if(N>j)ne=!1;else{const se=X-W,ue=-(a[2*n[A]]-q),Ne=W<X?1:-1;((N-q)*se+(a[2*n[P]+1]-W)*ue)*Ne>((j-q)*se+(a[2*n[D]+1]-W)*ue)*Ne&&(ne=!0)}if(ne){const se=n[P],ue=n[S],Ne=n[A];se!==ue&&se!==Ne&&ue!==Ne&&s.push(Ne,ue,se),S--,S<0&&(S=w-1)}else{const se=n[D],ue=n[S],Ne=n[A];se!==ue&&se!==Ne&&ue!==Ne&&s.push(Ne,ue,se),A++,A>=w&&(A=0)}if(P===D)break}}function cp(a,n,s,d,g,w,S,A,P){const D=g.length/2,N=S&&A&&P;if(D<Ln.MAX_VERTEX_ARRAY_LENGTH){const j=n.prepareSegment(D,s,d),q=j.vertexLength;for(let ne=0;ne<w.length;ne+=3)d.emplaceBack(q+w[ne],q+w[ne+1],q+w[ne+2]);let W,X;j.vertexLength+=D,j.primitiveLength+=w.length/3,N&&(X=S.prepareSegment(D,s,A),W=X.vertexLength,X.vertexLength+=D);for(let ne=0;ne<g.length;ne+=2)a(g[ne],g[ne+1]);if(N)for(let ne=0;ne<P.length;ne++){const se=P[ne];for(let ue=1;ue<se.length;ue+=2)A.emplaceBack(W+se[ue-1],W+se[ue]);X.primitiveLength+=se.length/2}}else(function(j,q,W,X,ne,se){const ue=[];for(let et=0;et<X.length/2;et++)ue.push(-1);const Ne={count:0};let _e=0,Ae=j.getOrCreateLatestSegment(q,W),Ze=Ae.vertexLength;for(let et=2;et<ne.length;et+=3){const dt=ne[et-2],At=ne[et-1],bt=ne[et];let Ct=ue[dt]<_e,Ut=ue[At]<_e,xt=ue[bt]<_e;Ae.vertexLength+((Ct?1:0)+(Ut?1:0)+(xt?1:0))>Ln.MAX_VERTEX_ARRAY_LENGTH&&(Ae=j.createNewSegment(q,W),_e=Ne.count,Ct=!0,Ut=!0,xt=!0,Ze=0);const Tt=Zu(ue,X,se,Ne,dt,Ct,Ae),at=Zu(ue,X,se,Ne,At,Ut,Ae),Xt=Zu(ue,X,se,Ne,bt,xt,Ae);W.emplaceBack(Ze+Tt-_e,Ze+at-_e,Ze+Xt-_e),Ae.primitiveLength++}})(n,s,d,g,w,a),N&&(function(j,q,W,X,ne,se){const ue=[];for(let et=0;et<X.length/2;et++)ue.push(-1);const Ne={count:0};let _e=0,Ae=j.getOrCreateLatestSegment(q,W),Ze=Ae.vertexLength;for(let et=0;et<ne.length;et++){const dt=ne[et];for(let At=1;At<ne[et].length;At+=2){const bt=dt[At-1],Ct=dt[At];let Ut=ue[bt]<_e,xt=ue[Ct]<_e;Ae.vertexLength+((Ut?1:0)+(xt?1:0))>Ln.MAX_VERTEX_ARRAY_LENGTH&&(Ae=j.createNewSegment(q,W),_e=Ne.count,Ut=!0,xt=!0,Ze=0);const Tt=Zu(ue,X,se,Ne,bt,Ut,Ae),at=Zu(ue,X,se,Ne,Ct,xt,Ae);W.emplaceBack(Ze+Tt-_e,Ze+at-_e),Ae.primitiveLength++}}})(S,s,A,g,P,a),n.forceNewSegmentOnNextPrepare(),S?.forceNewSegmentOnNextPrepare()}function Zu(a,n,s,d,g,w,S){if(w){const A=d.count;return s(n[2*g],n[2*g+1]),a[g]=d.count,d.count++,S.vertexLength++,A}return a[g]}class ko{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ge,this.indexArray=new ci,this.indexArray2=new Ti,this.programConfigurations=new il(n.layers,n.zoom),this.segments=new Ln,this.segments2=new Ln,this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(n,s,d){this.hasPattern=Bl("fill",this.layers,s);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),S=[];for(const{feature:A,id:P,index:D,sourceLayerIndex:N}of n){const j=this.layers[0]._featureFilter.needGeometry,q=oc(A,j);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),q,d))continue;const W=w?g.evaluate(q,{},d,s.availableImages):void 0,X={id:P,properties:A.properties,type:A.type,sourceLayerIndex:N,index:D,geometry:j?q.geometry:ac(A),patterns:{},sortKey:W};S.push(X)}w&&S.sort(((A,P)=>A.sortKey-P.sortKey));for(const A of S){const{geometry:P,index:D,sourceLayerIndex:N}=A;if(this.hasPattern){const j=ap("fill",this.layers,A,{zoom:this.zoom},s);this.patternFeatures.push(j)}else this.addFeature(A,P,D,d,{},s.subdivisionGranularity);s.featureIndex.insert(n[D].feature,P,D,N,this.index)}}update(n,s,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,{imagePositions:d})}addFeatures(n,s,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,s,d,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Jd),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,s,d,g,w,S){for(const A of Dc(s,500)){const P=uc(A,g,S.fill.getGranularityForZoomLevel(g.z)),D=this.layoutVertexArray;cp(((N,j)=>{D.emplaceBack(N,j)}),this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles,this.segments2,this.indexArray2,P.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{imagePositions:w,canonical:g})}}let zm,Wu;Dt("FillBucket",ko,{omit:["layers","patternFeatures"]});var nf={get paint(){return Wu=Wu||new Br({"fill-antialias":new Lt(Re.paint_fill["fill-antialias"]),"fill-opacity":new Ft(Re.paint_fill["fill-opacity"]),"fill-color":new Ft(Re.paint_fill["fill-color"]),"fill-outline-color":new Ft(Re.paint_fill["fill-outline-color"]),"fill-translate":new Lt(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new Lt(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new Qo(Re.paint_fill["fill-pattern"])})},get layout(){return zm=zm||new Br({"fill-sort-key":new Ft(Re.layout_fill["fill-sort-key"])})}};class rf extends Ca{constructor(n,s){super(n,nf,s)}recalculate(n,s){super.recalculate(n,s);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new ko(n)}queryRadius(){return Ur(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:n,geometry:s,transform:d,pixelsToTileUnits:g}){return vm(Zd(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-d.bearingInRadians,g),s)}isTileClipped(){return!0}}const Fh=Hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),M_=Hi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:k_}=Fh;class Vl{constructor(n,s,d,g,w){this.properties={},this.extent=d,this.type=0,this.id=void 0,this._pbf=n,this._geometry=-1,this._keys=g,this._values=w,n.readFields(D_,this,s)}loadGeometry(){const n=this._pbf;n.pos=this._geometry;const s=n.readVarint()+n.pos,d=[];let g,w=1,S=0,A=0,P=0;for(;n.pos<s;){if(S<=0){const D=n.readVarint();w=7&D,S=D>>3}if(S--,w===1||w===2)A+=n.readSVarint(),P+=n.readSVarint(),w===1&&(g&&d.push(g),g=[]),g&&g.push(new M(A,P));else{if(w!==7)throw new Error(`unknown command ${w}`);g&&g.push(g[0].clone())}}return g&&d.push(g),d}bbox(){const n=this._pbf;n.pos=this._geometry;const s=n.readVarint()+n.pos;let d=1,g=0,w=0,S=0,A=1/0,P=-1/0,D=1/0,N=-1/0;for(;n.pos<s;){if(g<=0){const j=n.readVarint();d=7&j,g=j>>3}if(g--,d===1||d===2)w+=n.readSVarint(),S+=n.readSVarint(),w<A&&(A=w),w>P&&(P=w),S<D&&(D=S),S>N&&(N=S);else if(d!==7)throw new Error(`unknown command ${d}`)}return[A,D,P,N]}toGeoJSON(n,s,d){const g=this.extent*Math.pow(2,d),w=this.extent*n,S=this.extent*s,A=this.loadGeometry();function P(q){return[360*(q.x+w)/g-180,360/Math.PI*Math.atan(Math.exp((1-2*(q.y+S)/g)*Math.PI))-90]}function D(q){return q.map(P)}let N;if(this.type===1){const q=[];for(const X of A)q.push(X[0]);const W=D(q);N=q.length===1?{type:"Point",coordinates:W[0]}:{type:"MultiPoint",coordinates:W}}else if(this.type===2){const q=A.map(D);N=q.length===1?{type:"LineString",coordinates:q[0]}:{type:"MultiLineString",coordinates:q}}else{if(this.type!==3)throw new Error("unknown feature type");{const q=(function(X){const ne=X.length;if(ne<=1)return[X];const se=[];let ue,Ne;for(let _e=0;_e<ne;_e++){const Ae=up(X[_e]);Ae!==0&&(Ne===void 0&&(Ne=Ae<0),Ne===Ae<0?(ue&&se.push(ue),ue=[X[_e]]):ue&&ue.push(X[_e]))}return ue&&se.push(ue),se})(A),W=[];for(const X of q)W.push(X.map(D));N=W.length===1?{type:"Polygon",coordinates:W[0]}:{type:"MultiPolygon",coordinates:W}}}const j={type:"Feature",geometry:N,properties:this.properties};return this.id!=null&&(j.id=this.id),j}}function D_(a,n,s){a===1?n.id=s.readVarint():a===2?(function(d,g){const w=d.readVarint()+d.pos;for(;d.pos<w;){const S=g._keys[d.readVarint()],A=g._values[d.readVarint()];g.properties[S]=A}})(s,n):a===3?n.type=s.readVarint():a===4&&(n._geometry=s.pos)}function up(a){let n=0;for(let s,d,g=0,w=a.length,S=w-1;g<w;S=g++)s=a[g],d=a[S],n+=(d.x-s.x)*(s.y+d.y);return n}Vl.types=["Unknown","Point","LineString","Polygon"];class Lm{constructor(n,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Cv,this,s),this.length=this._features.length}feature(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];const s=this._pbf.readVarint()+this._pbf.pos;return new Vl(this._pbf,s,this.extent,this._keys,this._values)}}function Cv(a,n,s){a===15?n.version=s.readVarint():a===1?n.name=s.readString():a===5?n.extent=s.readVarint():a===2?n._features.push(s.pos):a===3?n._keys.push(s.readString()):a===4&&n._values.push((function(d){let g=null;const w=d.readVarint()+d.pos;for(;d.pos<w;){const S=d.readVarint()>>3;g=S===1?d.readString():S===2?d.readFloat():S===3?d.readDouble():S===4?d.readVarint64():S===5?d.readVarint():S===6?d.readSVarint():S===7?d.readBoolean():null}if(g==null)throw new Error("unknown feature value");return g})(s))}class O_{constructor(n,s){this.layers=n.readFields(Si,{},s)}}function Si(a,n,s){if(a===3){const d=new Lm(s,s.readVarint()+s.pos);d.length&&(n[d.name]=d)}}const Oi=Math.pow(2,13);function zn(a,n,s,d,g,w,S,A){a.emplaceBack(n,s,2*Math.floor(d*Oi)+S,g*Oi*2,w*Oi*2,Math.round(A))}class Gn{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Ye,this.centroidVertexArray=new Xe,this.indexArray=new ci,this.programConfigurations=new il(n.layers,n.zoom),this.segments=new Ln,this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(n,s,d){this.features=[],this.hasPattern=Bl("fill-extrusion",this.layers,s);for(const{feature:g,id:w,index:S,sourceLayerIndex:A}of n){const P=this.layers[0]._featureFilter.needGeometry,D=oc(g,P);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),D,d))continue;const N={id:w,sourceLayerIndex:A,index:S,geometry:P?D.geometry:ac(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(ap("fill-extrusion",this.layers,N,{zoom:this.zoom},s)):this.addFeature(N,N.geometry,S,d,{},s.subdivisionGranularity),s.featureIndex.insert(g,N.geometry,S,A,this.index,!0)}}addFeatures(n,s,d){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,s,d,n.subdivisionGranularity)}}update(n,s,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,{imagePositions:d})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,k_),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,M_.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,s,d,g,w,S){for(const A of Dc(s,500)){const P={x:0,y:0,sampleCount:0},D=this.layoutVertexArray.length;this.processPolygon(P,g,n,A,S);const N=this.layoutVertexArray.length-D,j=Math.floor(P.x/P.sampleCount),q=Math.floor(P.y/P.sampleCount);for(let W=0;W<N;W++)this.centroidVertexArray.emplaceBack(j,q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{imagePositions:w,canonical:g})}processPolygon(n,s,d,g,w){if(g.length<1||hc(g[0]))return;for(const j of g)j.length!==0&&Ei(n,j);const S={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},A=w.fill.getGranularityForZoomLevel(s.z),P=Vl.types[d.type]==="Polygon";for(const j of g){if(j.length===0||hc(j))continue;const q=oo(j,A,P);this._generateSideFaces(q,S)}if(!P)return;const D=uc(g,s,A,!1),N=this.layoutVertexArray;cp(((j,q)=>{zn(N,j,q,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles)}_generateSideFaces(n,s){let d=0;for(let g=1;g<n.length;g++){const w=n[g],S=n[g-1];if(lo(w,S))continue;s.segment.vertexLength+4>Ln.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const A=w.sub(S)._perp()._unit(),P=S.dist(w);d+P>32768&&(d=0),zn(this.layoutVertexArray,w.x,w.y,A.x,A.y,0,0,d),zn(this.layoutVertexArray,w.x,w.y,A.x,A.y,0,1,d),d+=P,zn(this.layoutVertexArray,S.x,S.y,A.x,A.y,0,0,d),zn(this.layoutVertexArray,S.x,S.y,A.x,A.y,0,1,d);const D=s.segment.vertexLength;this.indexArray.emplaceBack(D,D+2,D+1),this.indexArray.emplaceBack(D+1,D+2,D+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function Ei(a,n){for(let s=0;s<n.length;s++){const d=n[s];s===n.length-1&&n[0].x===d.x&&n[0].y===d.y||(a.x+=d.x,a.y+=d.y,a.sampleCount++)}}function lo(a,n){return a.x===n.x&&(a.x<0||a.x>Wt)||a.y===n.y&&(a.y<0||a.y>Wt)}function hc(a){return a.every((n=>n.x<0))||a.every((n=>n.x>Wt))||a.every((n=>n.y<0))||a.every((n=>n.y>Wt))}let Ku;Dt("FillExtrusionBucket",Gn,{omit:["layers","features"]});var Nm={get paint(){return Ku=Ku||new Br({"fill-extrusion-opacity":new Lt(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ft(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Lt(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Lt(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Qo(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ft(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ft(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Lt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class dc extends Ca{constructor(n,s){super(n,Nm,s)}createBucket(n){return new Gn(n)}queryRadius(){return Ur(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:d,geometry:g,transform:w,pixelsToTileUnits:S,pixelPosMatrix:A}){const P=Zd(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-w.bearingInRadians,S),D=this.paint.get("fill-extrusion-height").evaluate(s,d),N=this.paint.get("fill-extrusion-base").evaluate(s,d),j=(function(W,X){const ne=[];for(const se of W){const ue=[se.x,se.y,0,1];dn(ue,ue,X),ne.push(new M(ue[0]/ue[3],ue[1]/ue[3]))}return ne})(P,A),q=(function(W,X,ne,se){const ue=[],Ne=[],_e=se[8]*X,Ae=se[9]*X,Ze=se[10]*X,et=se[11]*X,dt=se[8]*ne,At=se[9]*ne,bt=se[10]*ne,Ct=se[11]*ne;for(const Ut of W){const xt=[],Tt=[];for(const at of Ut){const Xt=at.x,en=at.y,jt=se[0]*Xt+se[4]*en+se[12],Vt=se[1]*Xt+se[5]*en+se[13],Mn=se[2]*Xt+se[6]*en+se[14],Ai=se[3]*Xt+se[7]*en+se[15],Mr=Mn+Ze,Wr=Ai+et,Gs=jt+dt,Hs=Vt+At,Kr=Mn+bt,Ii=Ai+Ct,gr=new M((jt+_e)/Wr,(Vt+Ae)/Wr);gr.z=Mr/Wr,xt.push(gr);const $r=new M(Gs/Ii,Hs/Ii);$r.z=Kr/Ii,Tt.push($r)}ue.push(xt),Ne.push(Tt)}return[ue,Ne]})(g,N,D,A);return(function(W,X,ne){let se=1/0;vm(ne,X)&&(se=fc(ne,X[0]));for(let ue=0;ue<X.length;ue++){const Ne=X[ue],_e=W[ue];for(let Ae=0;Ae<Ne.length-1;Ae++){const Ze=Ne[Ae],et=[Ze,Ne[Ae+1],_e[Ae+1],_e[Ae],Ze];qd(ne,et)&&(se=Math.min(se,fc(ne,et)))}}return se!==1/0&&se})(q[0],q[1],j)}}function Zi(a,n){return a.x*n.x+a.y*n.y}function fc(a,n){if(a.length===1){let s=0;const d=n[s++];let g;for(;!g||d.equals(g);)if(g=n[s++],!g)return 1/0;for(;s<n.length;s++){const w=n[s],S=a[0],A=g.sub(d),P=w.sub(d),D=S.sub(d),N=Zi(A,A),j=Zi(A,P),q=Zi(P,P),W=Zi(D,A),X=Zi(D,P),ne=N*q-j*j,se=(q*W-j*X)/ne,ue=(N*X-j*W)/ne,Ne=d.z*(1-se-ue)+g.z*se+w.z*ue;if(isFinite(Ne))return Ne}return 1/0}{let s=1/0;for(const d of n)s=Math.min(s,d.z);return s}}const Xu=Hi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Bm}=Xu,Do=Hi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:$h}=Do,sf=Math.cos(Math.PI/180*37.5),da=Math.pow(2,14)/.5;class af{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((s=>{this.gradients[s.id]={}})),this.layoutVertexArray=new Et,this.layoutVertexArray2=new wt,this.indexArray=new ci,this.programConfigurations=new il(n.layers,n.zoom),this.segments=new Ln,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(n,s,d){this.hasPattern=Bl("line",this.layers,s);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),S=[];for(const{feature:A,id:P,index:D,sourceLayerIndex:N}of n){const j=this.layers[0]._featureFilter.needGeometry,q=oc(A,j);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),q,d))continue;const W=w?g.evaluate(q,{},d):void 0,X={id:P,properties:A.properties,type:A.type,sourceLayerIndex:N,index:D,geometry:j?q.geometry:ac(A),patterns:{},sortKey:W};S.push(X)}w&&S.sort(((A,P)=>A.sortKey-P.sortKey));for(const A of S){const{geometry:P,index:D,sourceLayerIndex:N}=A;if(this.hasPattern){const j=ap("line",this.layers,A,{zoom:this.zoom},s);this.patternFeatures.push(j)}else this.addFeature(A,P,D,d,{},s.subdivisionGranularity);s.featureIndex.insert(n[D].feature,P,D,N,this.index)}}update(n,s,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,{imagePositions:d})}addFeatures(n,s,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,s,d,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,$h)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Bm),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,s,d,g,w,S){const A=this.layers[0].layout,P=A.get("line-join").evaluate(n,{}),D=A.get("line-cap"),N=A.get("line-miter-limit"),j=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const q of s)this.addLine(q,n,P,D,N,j,g,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{imagePositions:w,canonical:g})}addLine(n,s,d,g,w,S,A,P){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,n=oo(n,A?P.line.getGranularityForZoomLevel(A.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _e=0;_e<n.length-1;_e++)this.totalDistance+=n[_e].dist(n[_e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D=Vl.types[s.type]==="Polygon";let N=n.length;for(;N>=2&&n[N-1].equals(n[N-2]);)N--;let j=0;for(;j<N-1&&n[j].equals(n[j+1]);)j++;if(N<(D?3:2))return;d==="bevel"&&(w=1.05);const q=this.overscaling<=16?122880/(512*this.overscaling):0,W=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let X,ne,se,ue,Ne;this.e1=this.e2=-1,D&&(X=n[N-2],Ne=n[j].sub(X)._unit()._perp());for(let _e=j;_e<N;_e++){if(se=_e===N-1?D?n[j+1]:void 0:n[_e+1],se&&n[_e].equals(se))continue;Ne&&(ue=Ne),X&&(ne=X),X=n[_e],Ne=se?se.sub(X)._unit()._perp():ue,ue=ue||Ne;let Ae=ue.add(Ne);Ae.x===0&&Ae.y===0||Ae._unit();const Ze=ue.x*Ne.x+ue.y*Ne.y,et=Ae.x*Ne.x+Ae.y*Ne.y,dt=et!==0?1/et:1/0,At=2*Math.sqrt(2-2*et),bt=et<sf&&ne&&se,Ct=ue.x*Ne.y-ue.y*Ne.x>0;if(bt&&_e>j){const Tt=X.dist(ne);if(Tt>2*q){const at=X.sub(X.sub(ne)._mult(q/Tt)._round());this.updateDistance(ne,at),this.addCurrentVertex(at,ue,0,0,W),ne=at}}const Ut=ne&&se;let xt=Ut?d:D?"butt":g;if(Ut&&xt==="round"&&(dt<S?xt="miter":dt<=2&&(xt="fakeround")),xt==="miter"&&dt>w&&(xt="bevel"),xt==="bevel"&&(dt>2&&(xt="flipbevel"),dt<w&&(xt="miter")),ne&&this.updateDistance(ne,X),xt==="miter")Ae._mult(dt),this.addCurrentVertex(X,Ae,0,0,W);else if(xt==="flipbevel"){if(dt>100)Ae=Ne.mult(-1);else{const Tt=dt*ue.add(Ne).mag()/ue.sub(Ne).mag();Ae._perp()._mult(Tt*(Ct?-1:1))}this.addCurrentVertex(X,Ae,0,0,W),this.addCurrentVertex(X,Ae.mult(-1),0,0,W)}else if(xt==="bevel"||xt==="fakeround"){const Tt=-Math.sqrt(dt*dt-1),at=Ct?Tt:0,Xt=Ct?0:Tt;if(ne&&this.addCurrentVertex(X,ue,at,Xt,W),xt==="fakeround"){const en=Math.round(180*At/Math.PI/20);for(let jt=1;jt<en;jt++){let Vt=jt/en;if(Vt!==.5){const Ai=Vt-.5;Vt+=Vt*Ai*(Vt-1)*((1.0904+Ze*(Ze*(3.55645-1.43519*Ze)-3.2452))*Ai*Ai+(.848013+Ze*(.215638*Ze-1.06021)))}const Mn=Ne.sub(ue)._mult(Vt)._add(ue)._unit()._mult(Ct?-1:1);this.addHalfVertex(X,Mn.x,Mn.y,!1,Ct,0,W)}}se&&this.addCurrentVertex(X,Ne,-at,-Xt,W)}else if(xt==="butt")this.addCurrentVertex(X,Ae,0,0,W);else if(xt==="square"){const Tt=ne?1:-1;this.addCurrentVertex(X,Ae,Tt,Tt,W)}else xt==="round"&&(ne&&(this.addCurrentVertex(X,ue,0,0,W),this.addCurrentVertex(X,ue,1,1,W,!0)),se&&(this.addCurrentVertex(X,Ne,-1,-1,W,!0),this.addCurrentVertex(X,Ne,0,0,W)));if(bt&&_e<N-1){const Tt=X.dist(se);if(Tt>2*q){const at=X.add(se.sub(X)._mult(q/Tt)._round());this.updateDistance(X,at),this.addCurrentVertex(at,Ne,0,0,W),X=at}}}}addCurrentVertex(n,s,d,g,w,S=!1){const A=s.y*g-s.x,P=-s.y-s.x*g;this.addHalfVertex(n,s.x+s.y*d,s.y-s.x*d,S,!1,d,w),this.addHalfVertex(n,A,P,S,!0,-g,w),this.distance>da/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,s,d,g,w,S))}addHalfVertex({x:n,y:s},d,g,w,S,A,P){const D=.5*(this.lineClips?this.scaledDistance*(da-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(w?1:0),(s<<1)+(S?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(A===0?0:A<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,N,this.e2),P.primitiveLength++),S?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,s){this.distance+=n.dist(s),this.updateScaledDistance()}}let hp,of;Dt("LineBucket",af,{omit:["layers","patternFeatures"]});var lf={get paint(){return of=of||new Br({"line-opacity":new Ft(Re.paint_line["line-opacity"]),"line-color":new Ft(Re.paint_line["line-color"]),"line-translate":new Lt(Re.paint_line["line-translate"]),"line-translate-anchor":new Lt(Re.paint_line["line-translate-anchor"]),"line-width":new Ft(Re.paint_line["line-width"]),"line-gap-width":new Ft(Re.paint_line["line-gap-width"]),"line-offset":new Ft(Re.paint_line["line-offset"]),"line-blur":new Ft(Re.paint_line["line-blur"]),"line-dasharray":new $d(Re.paint_line["line-dasharray"]),"line-pattern":new Qo(Re.paint_line["line-pattern"]),"line-gradient":new Gi(Re.paint_line["line-gradient"])})},get layout(){return hp=hp||new Br({"line-cap":new Lt(Re.layout_line["line-cap"]),"line-join":new Ft(Re.layout_line["line-join"]),"line-miter-limit":new Lt(Re.layout_line["line-miter-limit"]),"line-round-limit":new Lt(Re.layout_line["line-round-limit"]),"line-sort-key":new Ft(Re.layout_line["line-sort-key"])})}};class Jc extends Ft{possiblyEvaluate(n,s){return s=new Jn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(n,s)}evaluate(n,s,d,g){return s=On({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(n,s,d,g)}}let Fr;class eu extends Ca{constructor(n,s){super(n,lf,s),this.gradientVersion=0,Fr||(Fr=new Jc(lf.paint.properties["line-width"].specification),Fr.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!(function(d){return d._styleExpression!==void 0})(s)&&s._styleExpression.expression instanceof Mi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,s){super.recalculate(n,s),this.paint._values["line-floorwidth"]=Fr.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new af(n)}queryRadius(n){const s=n,d=Yu(pr("line-width",this,s),pr("line-gap-width",this,s)),g=pr("line-offset",this,s);return d/2+Math.abs(g)+Ur(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:d,geometry:g,transform:w,pixelsToTileUnits:S}){const A=Zd(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-w.bearingInRadians,S),P=S/2*Yu(this.paint.get("line-width").evaluate(s,d),this.paint.get("line-gap-width").evaluate(s,d)),D=this.paint.get("line-offset").evaluate(s,d);return D&&(g=(function(N,j){const q=[];for(let W=0;W<N.length;W++){const X=N[W],ne=[];for(let se=0;se<X.length;se++){const ue=X[se-1],Ne=X[se],_e=X[se+1],Ae=se===0?new M(0,0):Ne.sub(ue)._unit()._perp(),Ze=se===X.length-1?new M(0,0):_e.sub(Ne)._unit()._perp(),et=Ae._add(Ze)._unit(),dt=et.x*Ze.x+et.y*Ze.y;dt!==0&&et._mult(1/dt),ne.push(et._mult(j)._add(Ne))}q.push(ne)}return q})(g,D*S)),(function(N,j,q){for(let W=0;W<j.length;W++){const X=j[W];if(N.length>=3){for(let ne=0;ne<X.length;ne++)if(Vh(N,X[ne]))return!0}if(p_(N,X,q))return!0}return!1})(A,g,P)}isTileClipped(){return!0}}function Yu(a,n){return n>0?n+2*a:a}const qh=Hi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vm=Hi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const jm=Hi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Hi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Um=Hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cf=Hi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Fm(a,n,s){return a.sections.forEach((d=>{d.text=(function(g,w,S){const A=w.layout.get("text-transform").evaluate(S,{});return A==="uppercase"?g=g.toLocaleUpperCase():A==="lowercase"&&(g=g.toLocaleLowerCase()),to.applyArabicShaping&&(g=to.applyArabicShaping(g)),g})(d.text,n,s)})),a}Hi([{name:"triangle",components:3,type:"Uint16"}]),Hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Hi([{type:"Float32",name:"offsetX"}]),Hi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Hi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ks={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Pr=24;const fa=4294967296,$m=1/fa,qm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Gm{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,s,d=this.length){for(;this.pos<d;){const g=this.readVarint(),w=g>>3,S=this.pos;this.type=7&g,n(w,s,this),this.pos===S&&this.skip(g)}return s}readMessage(n,s){return this.readFields(n,s,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*fa;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*fa;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const s=this.buf;let d,g;return g=s[this.pos++],d=127&g,g<128?d:(g=s[this.pos++],d|=(127&g)<<7,g<128?d:(g=s[this.pos++],d|=(127&g)<<14,g<128?d:(g=s[this.pos++],d|=(127&g)<<21,g<128?d:(g=s[this.pos],d|=(15&g)<<28,(function(w,S,A){const P=A.buf;let D,N;if(N=P[A.pos++],D=(112&N)>>4,N<128||(N=P[A.pos++],D|=(127&N)<<3,N<128)||(N=P[A.pos++],D|=(127&N)<<10,N<128)||(N=P[A.pos++],D|=(127&N)<<17,N<128)||(N=P[A.pos++],D|=(127&N)<<24,N<128)||(N=P[A.pos++],D|=(1&N)<<31,N<128))return co(w,D,S);throw new Error("Expected varint not more than 10 bytes")})(d,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,s=this.pos;return this.pos=n,n-s>=12&&qm?qm.decode(this.buf.subarray(s,n)):(function(d,g,w){let S="",A=g;for(;A<w;){const P=d[A];let D,N,j,q=null,W=P>239?4:P>223?3:P>191?2:1;if(A+W>w)break;W===1?P<128&&(q=P):W===2?(D=d[A+1],(192&D)==128&&(q=(31&P)<<6|63&D,q<=127&&(q=null))):W===3?(D=d[A+1],N=d[A+2],(192&D)==128&&(192&N)==128&&(q=(15&P)<<12|(63&D)<<6|63&N,(q<=2047||q>=55296&&q<=57343)&&(q=null))):W===4&&(D=d[A+1],N=d[A+2],j=d[A+3],(192&D)==128&&(192&N)==128&&(192&j)==128&&(q=(15&P)<<18|(63&D)<<12|(63&N)<<6|63&j,(q<=65535||q>=1114112)&&(q=null))),q===null?(q=65533,W=1):q>65535&&(q-=65536,S+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),S+=String.fromCharCode(q),A+=W}return S})(this.buf,s,n)}readBytes(){const n=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,n);return this.pos=n,s}readPackedVarint(n=[],s){const d=this.readPackedEnd();for(;this.pos<d;)n.push(this.readVarint(s));return n}readPackedSVarint(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const s=this.readPackedEnd();for(;this.pos<s;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const s=7&n;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(n,s){this.writeVarint(n<<3|s)}realloc(n){let s=this.length||16;for(;s<this.pos+n;)s*=2;if(s!==this.length){const d=new Uint8Array(s);d.set(this.buf),this.buf=d,this.dataView=new DataView(d.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*$m),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*$m),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?(function(s,d){let g,w;if(s>=0?(g=s%4294967296|0,w=s/4294967296|0):(g=~(-s%4294967296),w=~(-s/4294967296),4294967295^g?g=g+1|0:(g=0,w=w+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),(function(S,A,P){P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,P.buf[P.pos]=127&(S>>>=7)})(g,0,d),(function(S,A){const P=(7&S)<<4;A.buf[A.pos++]|=P|((S>>>=3)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S)))))})(w,d)})(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const s=this.pos;this.pos=(function(g,w,S){for(let A,P,D=0;D<w.length;D++){if(A=w.charCodeAt(D),A>55295&&A<57344){if(!P){A>56319||D+1===w.length?(g[S++]=239,g[S++]=191,g[S++]=189):P=A;continue}if(A<56320){g[S++]=239,g[S++]=191,g[S++]=189,P=A;continue}A=P-55296<<10|A-56320|65536,P=null}else P&&(g[S++]=239,g[S++]=191,g[S++]=189,P=null);A<128?g[S++]=A:(A<2048?g[S++]=A>>6|192:(A<65536?g[S++]=A>>12|224:(g[S++]=A>>18|240,g[S++]=A>>12&63|128),g[S++]=A>>6&63|128),g[S++]=63&A|128)}return S})(this.buf,n,this.pos);const d=this.pos-s;d>=128&&uf(s,d,this),this.pos=s-1,this.writeVarint(d),this.pos+=d}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const s=n.length;this.writeVarint(s),this.realloc(s);for(let d=0;d<s;d++)this.buf[this.pos++]=n[d]}writeRawMessage(n,s){this.pos++;const d=this.pos;n(s,this);const g=this.pos-d;g>=128&&uf(d,g,this),this.pos=d-1,this.writeVarint(g),this.pos+=g}writeMessage(n,s,d){this.writeTag(n,2),this.writeRawMessage(s,d)}writePackedVarint(n,s){s.length&&this.writeMessage(n,Hm,s)}writePackedSVarint(n,s){s.length&&this.writeMessage(n,Gh,s)}writePackedBoolean(n,s){s.length&&this.writeMessage(n,N_,s)}writePackedFloat(n,s){s.length&&this.writeMessage(n,z_,s)}writePackedDouble(n,s){s.length&&this.writeMessage(n,L_,s)}writePackedFixed32(n,s){s.length&&this.writeMessage(n,Zm,s)}writePackedSFixed32(n,s){s.length&&this.writeMessage(n,Wm,s)}writePackedFixed64(n,s){s.length&&this.writeMessage(n,Pv,s)}writePackedSFixed64(n,s){s.length&&this.writeMessage(n,Rv,s)}writeBytesField(n,s){this.writeTag(n,2),this.writeBytes(s)}writeFixed32Field(n,s){this.writeTag(n,5),this.writeFixed32(s)}writeSFixed32Field(n,s){this.writeTag(n,5),this.writeSFixed32(s)}writeFixed64Field(n,s){this.writeTag(n,1),this.writeFixed64(s)}writeSFixed64Field(n,s){this.writeTag(n,1),this.writeSFixed64(s)}writeVarintField(n,s){this.writeTag(n,0),this.writeVarint(s)}writeSVarintField(n,s){this.writeTag(n,0),this.writeSVarint(s)}writeStringField(n,s){this.writeTag(n,2),this.writeString(s)}writeFloatField(n,s){this.writeTag(n,5),this.writeFloat(s)}writeDoubleField(n,s){this.writeTag(n,1),this.writeDouble(s)}writeBooleanField(n,s){this.writeVarintField(n,+s)}}function co(a,n,s){return s?4294967296*n+(a>>>0):4294967296*(n>>>0)+(a>>>0)}function uf(a,n,s){const d=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));s.realloc(d);for(let g=s.pos-1;g>=a;g--)s.buf[g+d]=s.buf[g]}function Hm(a,n){for(let s=0;s<a.length;s++)n.writeVarint(a[s])}function Gh(a,n){for(let s=0;s<a.length;s++)n.writeSVarint(a[s])}function z_(a,n){for(let s=0;s<a.length;s++)n.writeFloat(a[s])}function L_(a,n){for(let s=0;s<a.length;s++)n.writeDouble(a[s])}function N_(a,n){for(let s=0;s<a.length;s++)n.writeBoolean(a[s])}function Zm(a,n){for(let s=0;s<a.length;s++)n.writeFixed32(a[s])}function Wm(a,n){for(let s=0;s<a.length;s++)n.writeSFixed32(a[s])}function Pv(a,n){for(let s=0;s<a.length;s++)n.writeFixed64(a[s])}function Rv(a,n){for(let s=0;s<a.length;s++)n.writeSFixed64(a[s])}function Mv(a,n,s){a===1&&s.readMessage(B_,n)}function B_(a,n,s){if(a===3){const{id:d,bitmap:g,width:w,height:S,left:A,top:P,advance:D}=s.readMessage(V_,{});n.push({id:d,bitmap:new jh({width:w+6,height:S+6},g),metrics:{width:w,height:S,left:A,top:P,advance:D}})}}function V_(a,n,s){a===1?n.id=s.readVarint():a===2?n.bitmap=s.readBytes():a===3?n.width=s.readVarint():a===4?n.height=s.readVarint():a===5?n.left=s.readSVarint():a===6?n.top=s.readSVarint():a===7&&(n.advance=s.readVarint())}function Qu(a){let n=0,s=0;for(const S of a)n+=S.w*S.h,s=Math.max(s,S.w);a.sort(((S,A)=>A.h-S.h));const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let g=0,w=0;for(const S of a)for(let A=d.length-1;A>=0;A--){const P=d[A];if(!(S.w>P.w||S.h>P.h)){if(S.x=P.x,S.y=P.y,w=Math.max(w,S.y+S.h),g=Math.max(g,S.x+S.w),S.w===P.w&&S.h===P.h){const D=d.pop();D&&A<d.length&&(d[A]=D)}else S.h===P.h?(P.x+=S.w,P.w-=S.w):S.w===P.w?(P.y+=S.h,P.h-=S.h):(d.push({x:P.x+S.w,y:P.y,w:P.w-S.w,h:S.h}),P.y+=S.h,P.h-=S.h);break}}return{w:g,h:w,fill:n/(g*w)||0}}class Hh{constructor(n,{pixelRatio:s,version:d,stretchX:g,stretchY:w,content:S,textFitWidth:A,textFitHeight:P}){this.paddedRect=n,this.pixelRatio=s,this.stretchX=g,this.stretchY=w,this.content=S,this.version=d,this.textFitWidth=A,this.textFitHeight=P}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Km{constructor(n,s){const d={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(n,d,w),this.addImages(s,g,w);const{w:S,h:A}=Qu(w),P=new Ps({width:S||1,height:A||1});for(const D in n){const N=n[D],j=d[D].paddedRect;Ps.copy(N.data,P,{x:0,y:0},{x:j.x+1,y:j.y+1},N.data)}for(const D in s){const N=s[D],j=g[D].paddedRect,q=j.x+1,W=j.y+1,X=N.data.width,ne=N.data.height;Ps.copy(N.data,P,{x:0,y:0},{x:q,y:W},N.data),Ps.copy(N.data,P,{x:0,y:ne-1},{x:q,y:W-1},{width:X,height:1}),Ps.copy(N.data,P,{x:0,y:0},{x:q,y:W+ne},{width:X,height:1}),Ps.copy(N.data,P,{x:X-1,y:0},{x:q-1,y:W},{width:1,height:ne}),Ps.copy(N.data,P,{x:0,y:0},{x:q+X,y:W},{width:1,height:ne})}this.image=P,this.iconPositions=d,this.patternPositions=g}addImages(n,s,d){for(const g in n){const w=n[g],S={x:0,y:0,w:w.data.width+2,h:w.data.height+2};d.push(S),s[g]=new Hh(S,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(n,s){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in n.updatedImages)this.patchUpdatedImage(this.iconPositions[d],n.getImage(d),s),this.patchUpdatedImage(this.patternPositions[d],n.getImage(d),s)}patchUpdatedImage(n,s,d){if(!n||!s||n.version===s.version)return;n.version=s.version;const[g,w]=n.tl;d.update(s.data,void 0,{x:g,y:w})}}var pc;Dt("ImagePosition",Hh),Dt("ImageAtlas",Km),y.ao=void 0,(pc=y.ao||(y.ao={}))[pc.none=0]="none",pc[pc.horizontal=1]="horizontal",pc[pc.vertical=2]="vertical",pc[pc.horizontalOnly=3]="horizontalOnly";class Zh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(n,s,d){const g=new Zh;return g.scale=n||1,g.fontStack=s,g.verticalAlign=d||"bottom",g}static forImage(n,s){const d=new Zh;return d.imageName=n,d.verticalAlign=s||"bottom",d}}class Ju{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,s){const d=new Ju;for(let g=0;g<n.sections.length;g++){const w=n.sections[g];w.image?d.addImageSection(w):d.addTextSection(w,s)}return d}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=(function(n){let s="";for(let d=0;d<n.length;d++){const g=n.charCodeAt(d+1)||null,w=n.charCodeAt(d-1)||null;s+=g&&nc(g)&&!ks[n[d+1]]||w&&nc(w)&&!ks[n[d-1]]||!ks[n[d]]?n[d]:ks[n[d]]}return s})(this.text)}trim(){let n=0;for(let d=0;d<this.text.length&&df[this.text.charCodeAt(d)];d++)n++;let s=this.text.length;for(let d=this.text.length-1;d>=0&&d>=n&&df[this.text.charCodeAt(d)];d--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)}substring(n,s){const d=new Ju;return d.text=this.text.substring(n,s),d.sectionIndex=this.sectionIndex.slice(n,s),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((n,s)=>Math.max(n,this.sections[s].scale)),0)}getMaxImageSize(n){let s=0,d=0;for(let g=0;g<this.length();g++){const w=this.getSection(g);if(w.imageName){const S=n[w.imageName];if(!S)continue;const A=S.displaySize;s=Math.max(s,A[0]),d=Math.max(d,A[1])}}return{maxImageWidth:s,maxImageHeight:d}}addTextSection(n,s){this.text+=n.text,this.sections.push(Zh.forText(n.scale,n.fontStack||s,n.verticalAlign));const d=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(d)}addImageSection(n){const s=n.image?n.image.name:"";if(s.length===0)return void Pi("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Zh.forImage(s,n.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hf(a,n,s,d,g,w,S,A,P,D,N,j,q,W,X){const ne=Ju.fromFeature(a,g);let se;j===y.ao.vertical&&ne.verticalizePunctuation();const{processBidirectionalText:ue,processStyledBidirectionalText:Ne}=to;if(ue&&ne.sections.length===1){se=[];const Ze=ue(ne.toString(),Jm(ne,D,w,n,d,W));for(const et of Ze){const dt=new Ju;dt.text=et,dt.sections=ne.sections;for(let At=0;At<et.length;At++)dt.sectionIndex.push(0);se.push(dt)}}else if(Ne){se=[];const Ze=Ne(ne.text,ne.sectionIndex,Jm(ne,D,w,n,d,W));for(const et of Ze){const dt=new Ju;dt.text=et[0],dt.sectionIndex=et[1],dt.sections=ne.sections,se.push(dt)}}else se=(function(Ze,et){const dt=[],At=Ze.text;let bt=0;for(const Ct of et)dt.push(Ze.substring(bt,Ct)),bt=Ct;return bt<At.length&&dt.push(Ze.substring(bt,At.length)),dt})(ne,Jm(ne,D,w,n,d,W));const _e=[],Ae={positionedLines:_e,text:ne.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:j,iconsInText:!1,verticalizable:!1};return(function(Ze,et,dt,At,bt,Ct,Ut,xt,Tt,at,Xt,en){let jt=0,Vt=0,Mn=0,Ai=0;const Mr=xt==="right"?1:xt==="left"?0:.5,Wr=Pr/en;let Gs=0;for(const Ii of bt){Ii.trim();const gr=Ii.getMaxScale(),$r={positionedGlyphs:[],lineOffset:0};Ze.positionedLines[Gs]=$r;const _r=$r.positionedGlyphs;let cs=0;if(!Ii.length()){Vt+=Ct,++Gs;continue}const Zs=kv(At,Ii,Wr);for(let ma=0;ma<Ii.length();ma++){const rr=Ii.getSection(ma),r=Ii.getSectionIndex(ma),u=Ii.getCharCode(ma),m=Wh(Tt,Xt,u);let x;if(rr.imageName){if(Ze.iconsInText=!0,rr.scale=rr.scale*Wr,x=fp(rr,m,gr,Zs,At),!x)continue;cs=Math.max(cs,x.imageOffset)}else if(x=tg(rr,u,m,Zs,et,dt),!x)continue;const{rect:C,metrics:z,baselineOffset:H}=x;_r.push({glyph:u,imageName:rr.imageName,x:jt,y:Vt+H+-17,vertical:m,scale:rr.scale,fontStack:rr.fontStack,sectionIndex:r,metrics:z,rect:C}),m?(Ze.verticalizable=!0,jt+=(rr.imageName?z.advance:Pr)*rr.scale+at):jt+=z.advance*rr.scale+at}_r.length!==0&&(Mn=Math.max(jt-at,Mn),ng(_r,0,_r.length-1,Mr)),jt=0,$r.lineOffset=Math.max(cs,(gr-1)*Pr);const kr=Ct*gr+cs;Vt+=kr,Ai=Math.max(kr,Ai),++Gs}const{horizontalAlign:Hs,verticalAlign:Kr}=eg(Ut);(function(Ii,gr,$r,_r,cs,Zs,kr,ma,rr){const r=(gr-$r)*cs;let u=0;u=Zs!==kr?-ma*_r- -17:-_r*rr*kr+.5*kr;for(const m of Ii)for(const x of m.positionedGlyphs)x.x+=r,x.y+=u})(Ze.positionedLines,Mr,Hs,Kr,Mn,Ai,Ct,Vt,bt.length),Ze.top+=-Kr*Vt,Ze.bottom=Ze.top+Vt,Ze.left+=-Hs*Mn,Ze.right=Ze.left+Mn})(Ae,n,s,d,se,S,A,P,j,D,q,X),!(function(Ze){for(const et of Ze)if(et.positionedGlyphs.length!==0)return!1;return!0})(_e)&&Ae}const df={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dp={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},j_={40:!0};function Xm(a,n,s,d,g,w){if(n.imageName){const S=d[n.imageName];return S?S.displaySize[0]*n.scale*Pr/w+g:0}{const S=s[n.fontStack],A=S&&S[a];return A?A.metrics.advance*n.scale+g:0}}function zi(a,n,s,d){const g=Math.pow(a-n,2);return d?a<n?g/2:2*g:g+Math.abs(s)*s}function Ym(a,n,s){let d=0;return a===10&&(d-=1e4),s&&(d+=150),a!==40&&a!==65288||(d+=50),n!==41&&n!==65289||(d+=50),d}function U_(a,n,s,d,g,w){let S=null,A=zi(n,s,g,w);for(const P of d){const D=zi(n-P.x,s,g,w)+P.badness;D<=A&&(S=P,A=D)}return{index:a,x:n,priorBreak:S,badness:A}}function Qm(a){return a?Qm(a.priorBreak).concat(a.index):[]}function Jm(a,n,s,d,g,w){if(!a)return[];const S=[],A=(function(j,q,W,X,ne,se){let ue=0;for(let Ne=0;Ne<j.length();Ne++){const _e=j.getSection(Ne);ue+=Xm(j.getCharCode(Ne),_e,X,ne,q,se)}return ue/Math.max(1,Math.ceil(ue/W))})(a,n,s,d,g,w),P=a.text.indexOf("")>=0;let D=0;for(let j=0;j<a.length();j++){const q=a.getSection(j),W=a.getCharCode(j);if(df[W]||(D+=Xm(W,q,d,g,n,w)),j<a.length()-1){const X=!((N=W)<11904)&&(!!vn["CJK Compatibility Forms"](N)||!!vn["CJK Compatibility"](N)||!!vn["CJK Strokes"](N)||!!vn["CJK Symbols and Punctuation"](N)||!!vn["Enclosed CJK Letters and Months"](N)||!!vn["Halfwidth and Fullwidth Forms"](N)||!!vn["Ideographic Description Characters"](N)||!!vn["Vertical Forms"](N)||kh.test(String.fromCodePoint(N)));(dp[W]||X||q.imageName||j!==a.length()-2&&j_[a.getCharCode(j+1)])&&S.push(U_(j+1,D,A,S,Ym(W,a.getCharCode(j+1),X&&P),!1))}}var N;return Qm(U_(a.length(),D,A,S,0,!0))}function eg(a){let n=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function kv(a,n,s){const d=n.getMaxScale()*Pr,{maxImageWidth:g,maxImageHeight:w}=n.getMaxImageSize(a),S=Math.max(d,w*s);return{verticalLineContentWidth:Math.max(d,g*s),horizontalLineContentHeight:S}}function ff(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function Wh(a,n,s){return!(a===y.ao.horizontal||!n&&!Uu(s)||n&&(df[s]||(d=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(d)))));var d}function tg(a,n,s,d,g,w){const S=w[a.fontStack],A=(function(D,N,j,q){if(D&&D.rect)return D;const W=N[j.fontStack],X=W&&W[q];return X?{rect:null,metrics:X.metrics}:null})(S&&S[n],g,a,n);if(A===null)return null;let P;if(s)P=d.verticalLineContentWidth-a.scale*Pr;else{const D=ff(a.verticalAlign);P=(d.horizontalLineContentHeight-a.scale*Pr)*D}return{rect:A.rect,metrics:A.metrics,baselineOffset:P}}function fp(a,n,s,d,g){const w=g[a.imageName];if(!w)return null;const S=w.paddedRect,A=w.displaySize,P={width:A[0],height:A[1],left:1,top:-3,advance:n?A[1]:A[0]};let D;if(n)D=d.verticalLineContentWidth-A[1]*a.scale;else{const N=ff(a.verticalAlign);D=(d.horizontalLineContentHeight-A[1]*a.scale)*N}return{rect:S,metrics:P,baselineOffset:D,imageOffset:(n?A[0]:A[1])*a.scale-Pr*s}}function ng(a,n,s,d){if(d===0)return;const g=a[s],w=(a[s].x+g.metrics.advance*g.scale)*d;for(let S=n;S<=s;S++)a[S].x-=w}function eh(a,n,s){const{horizontalAlign:d,verticalAlign:g}=eg(s),w=n[0]-a.displaySize[0]*d,S=n[1]-a.displaySize[1]*g;return{image:a,top:S,bottom:S+a.displaySize[1],left:w,right:w+a.displaySize[0]}}function ll(a){var n,s;let d=a.left,g=a.top,w=a.right-d,S=a.bottom-g;const A=(n=a.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",P=(s=a.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",D=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(P==="proportional"){if(A==="stretchOnly"&&w/S<D||A==="proportional"){const N=Math.ceil(S*D);d*=N/w,w=N}}else if(A==="proportional"&&P==="stretchOnly"&&D!==0&&w/S>D){const N=Math.ceil(w/D);g*=N/S,S=N}return{x1:d,y1:g,x2:d+w,y2:g+S}}function Kh(a,n,s,d,g,w){const S=a.image;let A;if(S.content){const se=S.content,ue=S.pixelRatio||1;A=[se[0]/ue,se[1]/ue,S.displaySize[0]-se[2]/ue,S.displaySize[1]-se[3]/ue]}const P=n.left*w,D=n.right*w;let N,j,q,W;s==="width"||s==="both"?(W=g[0]+P-d[3],j=g[0]+D+d[1]):(W=g[0]+(P+D-S.displaySize[0])/2,j=W+S.displaySize[0]);const X=n.top*w,ne=n.bottom*w;return s==="height"||s==="both"?(N=g[1]+X-d[0],q=g[1]+ne+d[2]):(N=g[1]+(X+ne-S.displaySize[1])/2,q=N+S.displaySize[1]),{image:S,top:N,right:j,bottom:q,left:W,collisionPadding:A}}const mc=128,gc=32640;function ig(a,n){const{expression:s}=n;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Jn(a+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=s;let w=0;for(;w<d.length&&d[w]<=a;)w++;w=Math.max(0,w-1);let S=w;for(;S<d.length&&d[S]<a+1;)S++;S=Math.min(d.length-1,S);const A=d[w],P=d[S];return s.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:P,interpolationType:g}:{kind:"camera",minZoom:A,maxZoom:P,minSize:s.evaluate(new Jn(A)),maxSize:s.evaluate(new Jn(P)),interpolationType:g}}}function pp(a,n,s){let d="never";const g=a.get(n);return g?d=g:a.get(s)&&(d="always"),d}const F_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function mp(a,n,s,d,g,w,S,A,P,D,N,j,q){const W=A?Math.min(gc,Math.round(A[0])):0,X=A?Math.min(gc,Math.round(A[1])):0;a.emplaceBack(n,s,Math.round(32*d),Math.round(32*g),w,S,(W<<1)+(P?1:0),X,16*D,16*N,256*j,256*q)}function pf(a,n,s){a.emplaceBack(n.x,n.y,s),a.emplaceBack(n.x,n.y,s),a.emplaceBack(n.x,n.y,s),a.emplaceBack(n.x,n.y,s)}function $_(a){for(const n of a.sections)if(Yo(n.text))return!0;return!1}class gp{constructor(n){this.layoutVertexArray=new Bt,this.indexArray=new ci,this.programConfigurations=n,this.segments=new Ln,this.dynamicLayoutVertexArray=new Tn,this.opacityVertexArray=new Fn,this.hasVisibleVertices=!1,this.placedSymbolArray=new oe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,s,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,qh.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,Vm.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,F_,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Dt("SymbolBuffers",gp);class rg{constructor(n,s,d){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new d,this.segments=new Ln,this.collisionVertexArray=new li}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,jm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Dt("CollisionBuffers",rg);class tu{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((S=>S.id)),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ig(this.zoom,s["text-size"]),this.iconSizeData=ig(this.zoom,s["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),w=d.get("symbol-z-order");this.canOverlap=pp(d,"text-overlap","text-allow-overlap")!=="never"||pp(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map((S=>y.ao[S]))),this.stateDependentLayerIds=this.layers.filter((S=>S.isStateDependent())).map((S=>S.id)),this.sourceID=n.sourceID}createArrays(){this.text=new gp(new il(this.layers,this.zoom,(n=>/^text/.test(n)))),this.icon=new gp(new il(this.layers,this.zoom,(n=>/^icon/.test(n)))),this.glyphOffsetArray=new ge,this.lineVertexArray=new de,this.symbolInstances=new he,this.textAnchorOffsets=new Ie}calculateGlyphDependencies(n,s,d,g,w){for(let S=0;S<n.length;S++)if(s[n.charCodeAt(S)]=!0,(d||g)&&w){const A=ks[n.charAt(S)];A&&(s[A.charCodeAt(0)]=!0)}}populate(n,s,d){const g=this.layers[0],w=g.layout,S=w.get("text-font"),A=w.get("text-field"),P=w.get("icon-image"),D=(A.value.kind!=="constant"||A.value.value instanceof si&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),N=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,j=w.get("symbol-sort-key");if(this.features=[],!D&&!N)return;const q=s.iconDependencies,W=s.glyphDependencies,X=s.availableImages,ne=new Jn(this.zoom);for(const{feature:se,id:ue,index:Ne,sourceLayerIndex:_e}of n){const Ae=g._featureFilter.needGeometry,Ze=oc(se,Ae);if(!g._featureFilter.filter(ne,Ze,d))continue;let et,dt;if(Ae||(Ze.geometry=ac(se)),D){const bt=g.getValueAndResolveTokens("text-field",Ze,d,X),Ct=si.factory(bt),Ut=this.hasRTLText=this.hasRTLText||$_(Ct);(!Ut||to.getRTLTextPluginStatus()==="unavailable"||Ut&&to.isParsed())&&(et=Fm(Ct,g,Ze))}if(N){const bt=g.getValueAndResolveTokens("icon-image",Ze,d,X);dt=bt instanceof Tr?bt:Tr.fromString(bt)}if(!et&&!dt)continue;const At=this.sortFeaturesByKey?j.evaluate(Ze,{},d):void 0;if(this.features.push({id:ue,text:et,icon:dt,index:Ne,sourceLayerIndex:_e,geometry:Ze.geometry,properties:se.properties,type:Vl.types[se.type],sortKey:At}),dt&&(q[dt.name]=!0),et){const bt=S.evaluate(Ze,{},d).join(","),Ct=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(y.ao.vertical)>=0;for(const Ut of et.sections)if(Ut.image)q[Ut.image.name]=!0;else{const xt=ju(et.toString()),Tt=Ut.fontStack||bt,at=W[Tt]=W[Tt]||{};this.calculateGlyphDependencies(Ut.text,at,Ct,this.allowVerticalPlacement,xt)}}}w.get("symbol-placement")==="line"&&(this.features=(function(se){const ue={},Ne={},_e=[];let Ae=0;function Ze(bt){_e.push(se[bt]),Ae++}function et(bt,Ct,Ut){const xt=Ne[bt];return delete Ne[bt],Ne[Ct]=xt,_e[xt].geometry[0].pop(),_e[xt].geometry[0]=_e[xt].geometry[0].concat(Ut[0]),xt}function dt(bt,Ct,Ut){const xt=ue[Ct];return delete ue[Ct],ue[bt]=xt,_e[xt].geometry[0].shift(),_e[xt].geometry[0]=Ut[0].concat(_e[xt].geometry[0]),xt}function At(bt,Ct,Ut){const xt=Ut?Ct[0][Ct[0].length-1]:Ct[0][0];return`${bt}:${xt.x}:${xt.y}`}for(let bt=0;bt<se.length;bt++){const Ct=se[bt],Ut=Ct.geometry,xt=Ct.text?Ct.text.toString():null;if(!xt){Ze(bt);continue}const Tt=At(xt,Ut),at=At(xt,Ut,!0);if(Tt in Ne&&at in ue&&Ne[Tt]!==ue[at]){const Xt=dt(Tt,at,Ut),en=et(Tt,at,_e[Xt].geometry);delete ue[Tt],delete Ne[at],Ne[At(xt,_e[en].geometry,!0)]=en,_e[Xt].geometry=null}else Tt in Ne?et(Tt,at,Ut):at in ue?dt(Tt,at,Ut):(Ze(bt),ue[Tt]=Ae-1,Ne[at]=Ae-1)}return _e.filter((bt=>bt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((se,ue)=>se.sortKey-ue.sortKey))}update(n,s,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,s,this.layers,{imagePositions:d}),this.icon.programConfigurations.updatePaintArrays(n,s,this.layers,{imagePositions:d}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const d=this.lineVertexArray.length;if(n.segment!==void 0){let g=n.dist(s[n.segment+1]),w=n.dist(s[n.segment]);const S={};for(let A=n.segment+1;A<s.length;A++)S[A]={x:s[A].x,y:s[A].y,tileUnitDistanceFromAnchor:g},A<s.length-1&&(g+=s[A+1].dist(s[A]));for(let A=n.segment||0;A>=0;A--)S[A]={x:s[A].x,y:s[A].y,tileUnitDistanceFromAnchor:w},A>0&&(w+=s[A-1].dist(s[A]));for(let A=0;A<s.length;A++){const P=S[A];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(n,s,d,g,w,S,A,P,D,N,j,q){const W=n.indexArray,X=n.layoutVertexArray,ne=n.segments.prepareSegment(4*s.length,X,W,this.canOverlap?S.sortKey:void 0),se=this.glyphOffsetArray.length,ue=ne.vertexLength,Ne=this.allowVerticalPlacement&&A===y.ao.vertical?Math.PI/2:0,_e=S.text&&S.text.sections;for(let Ae=0;Ae<s.length;Ae++){const{tl:Ze,tr:et,bl:dt,br:At,tex:bt,pixelOffsetTL:Ct,pixelOffsetBR:Ut,minFontScaleX:xt,minFontScaleY:Tt,glyphOffset:at,isSDF:Xt,sectionIndex:en}=s[Ae],jt=ne.vertexLength,Vt=at[1];mp(X,P.x,P.y,Ze.x,Vt+Ze.y,bt.x,bt.y,d,Xt,Ct.x,Ct.y,xt,Tt),mp(X,P.x,P.y,et.x,Vt+et.y,bt.x+bt.w,bt.y,d,Xt,Ut.x,Ct.y,xt,Tt),mp(X,P.x,P.y,dt.x,Vt+dt.y,bt.x,bt.y+bt.h,d,Xt,Ct.x,Ut.y,xt,Tt),mp(X,P.x,P.y,At.x,Vt+At.y,bt.x+bt.w,bt.y+bt.h,d,Xt,Ut.x,Ut.y,xt,Tt),pf(n.dynamicLayoutVertexArray,P,Ne),W.emplaceBack(jt,jt+2,jt+1),W.emplaceBack(jt+1,jt+2,jt+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),Ae!==s.length-1&&en===s[Ae+1].sectionIndex||n.programConfigurations.populatePaintArrays(X.length,S,S.index,{imagePositions:{},canonical:q,formattedSection:_e&&_e[en]})}n.placedSymbolArray.emplaceBack(P.x,P.y,se,this.glyphOffsetArray.length-se,ue,D,N,P.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],A,0,!1,0,j)}_addCollisionDebugVertex(n,s,d,g,w,S){return s.emplaceBack(0,0),n.emplaceBack(d.x,d.y,g,w,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(n,s,d,g,w,S,A){const P=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),D=P.vertexLength,N=w.layoutVertexArray,j=w.collisionVertexArray,q=A.anchorX,W=A.anchorY;this._addCollisionDebugVertex(N,j,S,q,W,new M(n,s)),this._addCollisionDebugVertex(N,j,S,q,W,new M(d,s)),this._addCollisionDebugVertex(N,j,S,q,W,new M(d,g)),this._addCollisionDebugVertex(N,j,S,q,W,new M(n,g)),P.vertexLength+=4;const X=w.indexArray;X.emplaceBack(D,D+1),X.emplaceBack(D+1,D+2),X.emplaceBack(D+2,D+3),X.emplaceBack(D+3,D),P.primitiveLength+=4}addDebugCollisionBoxes(n,s,d,g){for(let w=n;w<s;w++){const S=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,g?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rg(Di,Um.members,Ti),this.iconCollisionBox=new rg(Di,Um.members,Ti);for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(n,s,d,g,w,S,A,P,D){const N={};for(let j=s;j<d;j++){const q=n.get(j);N.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},N.textFeatureIndex=q.featureIndex;break}for(let j=g;j<w;j++){const q=n.get(j);N.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},N.verticalTextFeatureIndex=q.featureIndex;break}for(let j=S;j<A;j++){const q=n.get(j);N.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},N.iconFeatureIndex=q.featureIndex;break}for(let j=P;j<D;j++){const q=n.get(j);N.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},N.verticalIconFeatureIndex=q.featureIndex;break}return N}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const d=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,s){const d=n.placedSymbolArray.get(s),g=d.vertexStartIndex+4*d.numGlyphs;for(let w=d.vertexStartIndex;w<g;w+=4)n.indexArray.emplaceBack(w,w+2,w+1),n.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(n),d=Math.cos(n),g=[],w=[],S=[];for(let A=0;A<this.symbolInstances.length;++A){S.push(A);const P=this.symbolInstances.get(A);g.push(0|Math.round(s*P.anchorX+d*P.anchorY)),w.push(P.featureIndex)}return S.sort(((A,P)=>g[A]-g[P]||w[P]-w[A])),S}addToSortKeyRanges(n,s){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===s?d.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const d=this.symbolInstances.get(s);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach(((g,w,S)=>{g>=0&&S.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)})),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let _p,q_;Dt("SymbolBucket",tu,{omit:["layers","collisionBoxArray","features","compareText"]}),tu.MAX_GLYPHS=65535,tu.addDynamicAttributes=pf;var sg={get paint(){return q_=q_||new Br({"icon-opacity":new Ft(Re.paint_symbol["icon-opacity"]),"icon-color":new Ft(Re.paint_symbol["icon-color"]),"icon-halo-color":new Ft(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ft(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ft(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new Lt(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new Lt(Re.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ft(Re.paint_symbol["text-opacity"]),"text-color":new Ft(Re.paint_symbol["text-color"],{runtimeType:$i,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Ft(Re.paint_symbol["text-halo-color"]),"text-halo-width":new Ft(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new Ft(Re.paint_symbol["text-halo-blur"]),"text-translate":new Lt(Re.paint_symbol["text-translate"]),"text-translate-anchor":new Lt(Re.paint_symbol["text-translate-anchor"])})},get layout(){return _p=_p||new Br({"symbol-placement":new Lt(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new Lt(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Lt(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ft(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Lt(Re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Lt(Re.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Lt(Re.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Lt(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new Lt(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Lt(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ft(Re.layout_symbol["icon-size"]),"icon-text-fit":new Lt(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Lt(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ft(Re.layout_symbol["icon-image"]),"icon-rotate":new Ft(Re.layout_symbol["icon-rotate"]),"icon-padding":new Ft(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new Lt(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new Ft(Re.layout_symbol["icon-offset"]),"icon-anchor":new Ft(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Lt(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Lt(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Lt(Re.layout_symbol["text-rotation-alignment"]),"text-field":new Ft(Re.layout_symbol["text-field"]),"text-font":new Ft(Re.layout_symbol["text-font"]),"text-size":new Ft(Re.layout_symbol["text-size"]),"text-max-width":new Ft(Re.layout_symbol["text-max-width"]),"text-line-height":new Lt(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new Ft(Re.layout_symbol["text-letter-spacing"]),"text-justify":new Ft(Re.layout_symbol["text-justify"]),"text-radial-offset":new Ft(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Lt(Re.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ft(Re.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ft(Re.layout_symbol["text-anchor"]),"text-max-angle":new Lt(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new Lt(Re.layout_symbol["text-writing-mode"]),"text-rotate":new Ft(Re.layout_symbol["text-rotate"]),"text-padding":new Lt(Re.layout_symbol["text-padding"]),"text-keep-upright":new Lt(Re.layout_symbol["text-keep-upright"]),"text-transform":new Ft(Re.layout_symbol["text-transform"]),"text-offset":new Ft(Re.layout_symbol["text-offset"]),"text-allow-overlap":new Lt(Re.layout_symbol["text-allow-overlap"]),"text-overlap":new Lt(Re.layout_symbol["text-overlap"]),"text-ignore-placement":new Lt(Re.layout_symbol["text-ignore-placement"]),"text-optional":new Lt(Re.layout_symbol["text-optional"])})}};class Xh{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Qs,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dt("FormatSectionOverride",Xh,{omit:["defaultValue"]});class yp extends Ca{constructor(n,s){super(n,sg,s)}recalculate(n,s){if(super.recalculate(n,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const w of d)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,s,d,g){const w=this.layout.get(n).evaluate(s,{},d,g),S=this._unevaluatedLayout._values[n];return S.isDataDriven()||Go(S.value)||!w?w:(function(A,P){return P.replace(/{([^{}]+)}/g,((D,N)=>A&&N in A?String(A[N]):""))})(s.properties,w)}createBucket(n){return new tu(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of sg.paint.overridableProperties){if(!yp.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),d=new Xh(s),g=new zu(d,s.property.specification);let w=null;w=s.value.kind==="constant"||s.value.kind==="source"?new Il("source",g):new Nc("composite",g,s.value.zoomStops),this.paint._values[n]=new As(s.property,w,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,d){return!(!this.layout||s.isDataDriven()||d.isDataDriven())&&yp.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const d=n.get("text-field"),g=sg.paint.properties[s];let w=!1;const S=A=>{for(const P of A)if(g.overrides&&g.overrides.hasOverride(P))return void(w=!0)};if(d.value.kind==="constant"&&d.value.value instanceof si)S(d.value.value.sections);else if(d.value.kind==="source"||d.value.kind==="composite"){const A=D=>{w||(D instanceof ys&&Qt(D.value)===Gr?S(D.value.sections):D instanceof tt?S(D.sections):D.eachChild(A))},P=d.value;P._styleExpression&&A(P._styleExpression.expression)}return w}}let ag;var $n={get paint(){return ag=ag||new Br({"background-color":new Lt(Re.paint_background["background-color"]),"background-pattern":new $d(Re.paint_background["background-pattern"]),"background-opacity":new Lt(Re.paint_background["background-opacity"])})}};class og extends Ca{constructor(n,s){super(n,$n,s)}}let mf;var lg={get paint(){return mf=mf||new Br({"raster-opacity":new Lt(Re.paint_raster["raster-opacity"]),"raster-hue-rotate":new Lt(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Lt(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Lt(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new Lt(Re.paint_raster["raster-saturation"]),"raster-contrast":new Lt(Re.paint_raster["raster-contrast"]),"raster-resampling":new Lt(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new Lt(Re.paint_raster["raster-fade-duration"])})}};class G_ extends Ca{constructor(n,s){super(n,lg,s)}}class cg extends Ca{constructor(n,s){super(n,{},s),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class gf{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const vp={once:!0},nu=63710088e-1;class _c{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _c(Ji(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,d=this.lat*s,g=n.lat*s,w=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((n.lng-this.lng)*s);return nu*Math.acos(Math.min(w,1))}static convert(n){if(n instanceof _c)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new _c(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new _c(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const H_=2*Math.PI*nu;function Z_(a){return H_*Math.cos(a*Math.PI/180)}function ug(a){return(180+a)/360}function hg(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function _f(a,n){return a/Z_(n)}function yi(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function bp(a,n){return a*Z_(yi(n))}class Rr{constructor(n,s,d=0){this.x=+n,this.y=+s,this.z=+d}static fromLngLat(n,s=0){const d=_c.convert(n);return new Rr(ug(d.lng),hg(d.lat),_f(s,d.lat))}toLngLat(){return new _c(360*this.x-180,yi(this.y))}toAltitude(){return bp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/H_*(n=yi(this.y),1/Math.cos(n*Math.PI/180));var n}}function W_(a,n,s){var d=2*Math.PI*6378137/256/Math.pow(2,s);return[a*d-2*Math.PI*6378137/2,n*d-2*Math.PI*6378137/2]}class yf{constructor(n,s,d){if(!(function(g,w,S){return!(g<0||g>25||S<0||S>=Math.pow(2,g)||w<0||w>=Math.pow(2,g))})(n,s,d))throw new Error(`x=${s}, y=${d}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=s,this.y=d,this.key=th(0,n,n,s,d)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,s,d){const g=(S=this.y,A=this.z,P=W_(256*(w=this.x),256*(S=Math.pow(2,A)-S-1),A),D=W_(256*(w+1),256*(S+1),A),P[0]+","+P[1]+","+D[0]+","+D[1]);var w,S,A,P,D;const N=(function(j,q,W){let X,ne="";for(let se=j;se>0;se--)X=1<<se-1,ne+=(q&X?1:0)+(W&X?2:0);return ne})(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,g)}isChildOf(n){const s=this.z-n.z;return s>0&&n.x===this.x>>s&&n.y===this.y>>s}getTilePoint(n){const s=Math.pow(2,this.z);return new M((n.x*s-this.x)*Wt,(n.y*s-this.y)*Wt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class xp{constructor(n,s){this.wrap=n,this.canonical=s,this.key=th(n,s.z,s.z,s.x,s.y)}}class qs{constructor(n,s,d,g,w){if(this.terrainRttPosMatrix32f=null,n<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${d}`);this.overscaledZ=n,this.wrap=s,this.canonical=new yf(d,+g,+w),this.key=th(s,n,d,g,w)}clone(){return new qs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-n;return n>this.canonical.z?new qs(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qs(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(n,s){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-n;return n>this.canonical.z?th(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y):th(this.wrap*+s,n,n,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(n){if(n.wrap!==this.wrap||this.overscaledZ-n.overscaledZ<=0)return!1;if(n.overscaledZ===0)return this.overscaledZ>0;const s=this.canonical.z-n.canonical.z;return!(s<0)&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new qs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new qs(s,this.wrap,s,d,g),new qs(s,this.wrap,s,d+1,g),new qs(s,this.wrap,s,d,g+1),new qs(s,this.wrap,s,d+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new qs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new qs(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new Rr(n.x-this.wrap,n.y))}}function th(a,n,s,d,g){(a*=2)<0&&(a=-1*a-1);const w=1<<s;return(w*w*a+w*g+d).toString(36)+s.toString(36)+n.toString(36)}function Yh(a,n){return n?a.properties[n]:a.id}Dt("CanonicalTileID",yf),Dt("OverscaledTileID",qs,{omit:["terrainRttPosMatrix32f"]});class yc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(n){return this.minX=Math.min(this.minX,n.x),this.minY=Math.min(this.minY,n.y),this.maxX=Math.max(this.maxX,n.x),this.maxY=Math.max(this.maxY,n.y),this}expandBy(n){return this.minX-=n,this.minY-=n,this.maxX+=n,this.maxY+=n,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(n){return this.expandBy(-n)}map(n){const s=new yc;return s.extend(n(new M(this.minX,this.minY))),s.extend(n(new M(this.maxX,this.minY))),s.extend(n(new M(this.minX,this.maxY))),s.extend(n(new M(this.maxX,this.maxY))),s}static fromPoints(n){const s=new yc;for(const d of n)s.extend(d);return s}contains(n){return n.x>=this.minX&&n.x<=this.maxX&&n.y>=this.minY&&n.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(n){return!this.empty()&&!n.empty()&&n.minX>=this.minX&&n.maxX<=this.maxX&&n.minY>=this.minY&&n.maxY<=this.maxY}intersects(n){return!this.empty()&&!n.empty()&&n.minX<=this.maxX&&n.maxX>=this.minX&&n.minY<=this.maxY&&n.maxY>=this.minY}}class wp{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const d=n[s];this._stringToNumber[d]=s,this._numberToString[s]=d}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class K_{constructor(n,s,d,g,w){this.type="Feature",this._vectorTileFeature=n,n._z=s,n._x=d,n._y=g,this.properties=n.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(n[s]=this[s]);return n}}class dg{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Dl(Wt,16,0),this.grid3D=new Dl(Wt,16,0),this.featureIndexArray=new ze,this.promoteId=s}insert(n,s,d,g,w,S){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,w);const P=S?this.grid3D:this.grid;for(let D=0;D<s.length;D++){const N=s[D],j=[1/0,1/0,-1/0,-1/0];for(let q=0;q<N.length;q++){const W=N[q];j[0]=Math.min(j[0],W.x),j[1]=Math.min(j[1],W.y),j[2]=Math.max(j[2],W.x),j[3]=Math.max(j[3],W.y)}j[0]<Wt&&j[1]<Wt&&j[2]>=0&&j[3]>=0&&P.insert(A,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new O_(new Gm(this.rawTileData)).layers,this.sourceLayerCoder=new wp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,s,d,g){this.loadVTLayers();const w=n.params,S=Wt/n.tileSize/n.scale,A=Ho(w.filter,w.globalState),P=n.queryGeometry,D=n.queryPadding*S,N=yc.fromPoints(P),j=this.grid.query(N.minX-D,N.minY-D,N.maxX+D,N.maxY+D),q=yc.fromPoints(n.cameraQueryGeometry).expandBy(D),W=this.grid3D.query(q.minX,q.minY,q.maxX,q.maxY,((se,ue,Ne,_e)=>(function(Ae,Ze,et,dt,At){for(const Ct of Ae)if(Ze<=Ct.x&&et<=Ct.y&&dt>=Ct.x&&At>=Ct.y)return!0;const bt=[new M(Ze,et),new M(Ze,At),new M(dt,At),new M(dt,et)];if(Ae.length>2){for(const Ct of bt)if(Vh(Ae,Ct))return!0}for(let Ct=0;Ct<Ae.length-1;Ct++)if(g_(Ae[Ct],Ae[Ct+1],bt))return!0;return!1})(n.cameraQueryGeometry,se-D,ue-D,Ne+D,_e+D)));for(const se of W)j.push(se);j.sort(Y_);const X={};let ne;for(let se=0;se<j.length;se++){const ue=j[se];if(ue===ne)continue;ne=ue;const Ne=this.featureIndexArray.get(ue);let _e=null;this.loadMatchingFeature(X,Ne.bucketIndex,Ne.sourceLayerIndex,Ne.featureIndex,A,w.layers,w.availableImages,s,d,g,((Ae,Ze,et)=>(_e||(_e=ac(Ae)),Ze.queryIntersectsFeature({queryGeometry:P,feature:Ae,featureState:et,geometry:_e,zoom:this.z,transform:n.transform,pixelsToTileUnits:S,pixelPosMatrix:n.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:n.getElevation}))))}return X}loadMatchingFeature(n,s,d,g,w,S,A,P,D,N,j){const q=this.bucketLayerIDs[s];if(S&&!q.some((se=>S.has(se))))return;const W=this.sourceLayerCoder.decode(d),X=this.vtLayers[W].feature(g);if(w.needGeometry){const se=oc(X,!0);if(!w.filter(new Jn(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!w.filter(new Jn(this.tileID.overscaledZ),X))return;const ne=this.getId(X,W);for(let se=0;se<q.length;se++){const ue=q[se];if(S&&!S.has(ue))continue;const Ne=P[ue];if(!Ne)continue;let _e={};ne&&N&&(_e=N.getState(Ne.sourceLayer||"_geojsonTileLayer",ne));const Ae=On({},D[ue]);Ae.paint=X_(Ae.paint,Ne.paint,X,_e,A),Ae.layout=X_(Ae.layout,Ne.layout,X,_e,A);const Ze=!j||j(X,Ne,_e);if(!Ze)continue;const et=new K_(X,this.z,this.x,this.y,ne);et.layer=Ae;let dt=n[ue];dt===void 0&&(dt=n[ue]=[]),dt.push({featureIndex:g,feature:et,intersectionZ:Ze})}}lookupSymbolFeatures(n,s,d,g,w,S,A,P){const D={};this.loadVTLayers();const N=Ho(w.filterSpec,w.globalState);for(const j of n)this.loadMatchingFeature(D,d,g,j,N,S,A,P,s);return D}hasLayer(n){for(const s of this.bucketLayerIDs)for(const d of s)if(n===d)return!0;return!1}getId(n,s){var d;let g=n.id;return this.promoteId&&(g=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof g=="boolean"&&(g=Number(g)),g===void 0&&(!((d=n.properties)===null||d===void 0)&&d.cluster)&&this.promoteId&&(g=Number(n.properties.cluster_id))),g}}function X_(a,n,s,d,g){return uo(a,((w,S)=>{const A=n instanceof Io?n.get(S):null;return A&&A.evaluate?A.evaluate(s,d,g):A}))}function Y_(a,n){return n-a}function Q_(a,n,s,d,g){const w=[];for(let S=0;S<a.length;S++){const A=a[S];let P;for(let D=0;D<A.length-1;D++){let N=A[D],j=A[D+1];N.x<n&&j.x<n||(N.x<n?N=new M(n,N.y+(n-N.x)/(j.x-N.x)*(j.y-N.y))._round():j.x<n&&(j=new M(n,N.y+(n-N.x)/(j.x-N.x)*(j.y-N.y))._round()),N.y<s&&j.y<s||(N.y<s?N=new M(N.x+(s-N.y)/(j.y-N.y)*(j.x-N.x),s)._round():j.y<s&&(j=new M(N.x+(s-N.y)/(j.y-N.y)*(j.x-N.x),s)._round()),N.x>=d&&j.x>=d||(N.x>=d?N=new M(d,N.y+(d-N.x)/(j.x-N.x)*(j.y-N.y))._round():j.x>=d&&(j=new M(d,N.y+(d-N.x)/(j.x-N.x)*(j.y-N.y))._round()),N.y>=g&&j.y>=g||(N.y>=g?N=new M(N.x+(g-N.y)/(j.y-N.y)*(j.x-N.x),g)._round():j.y>=g&&(j=new M(N.x+(g-N.y)/(j.y-N.y)*(j.x-N.x),g)._round()),P&&N.equals(P[P.length-1])||(P=[N],w.push(P)),P.push(j)))))}}return w}Dt("FeatureIndex",dg,{omit:["rawTileData","sourceLayerCoder"]});class iu extends M{constructor(n,s,d,g){super(n,s),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new iu(this.x,this.y,this.angle,this.segment)}}function vc(a,n,s,d,g){if(n.segment===void 0||s===0)return!0;let w=n,S=n.segment+1,A=0;for(;A>-s/2;){if(S--,S<0)return!1;A-=a[S].dist(w),w=a[S]}A+=a[S].dist(a[S+1]),S++;const P=[];let D=0;for(;A<s/2;){const N=a[S],j=a[S+1];if(!j)return!1;let q=a[S-1].angleTo(N)-N.angleTo(j);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:A,angleDelta:q}),D+=q;A-P[0].distance>d;)D-=P.shift().angleDelta;if(D>g)return!1;S++,A+=N.dist(j)}return!0}function fg(a){let n=0;for(let s=0;s<a.length-1;s++)n+=a[s].dist(a[s+1]);return n}function Tp(a,n,s){return a?.6*n*s:0}function J_(a,n){return Math.max(a?a.right-a.left:0,n?n.right-n.left:0)}function Dv(a,n,s,d,g,w){const S=Tp(s,g,w),A=J_(s,d)*w;let P=0;const D=fg(a)/2;for(let N=0;N<a.length-1;N++){const j=a[N],q=a[N+1],W=j.dist(q);if(P+W>D){const X=(D-P)/W,ne=sa.number(j.x,q.x,X),se=sa.number(j.y,q.y,X),ue=new iu(ne,se,q.angleTo(j),N);return ue._round(),!S||vc(a,ue,A,S,n)?ue:void 0}P+=W}}function pg(a,n,s,d,g,w,S,A,P){const D=Tp(d,w,S),N=J_(d,g),j=N*S,q=a[0].x===0||a[0].x===P||a[0].y===0||a[0].y===P;return n-j<n/4&&(n=j+n/4),ey(a,q?n/2*A%n:(N/2+2*w)*S*A%n,n,D,s,j,q,!1,P)}function ey(a,n,s,d,g,w,S,A,P){const D=w/2,N=fg(a);let j=0,q=n-s,W=[];for(let X=0;X<a.length-1;X++){const ne=a[X],se=a[X+1],ue=ne.dist(se),Ne=se.angleTo(ne);for(;q+s<j+ue;){q+=s;const _e=(q-j)/ue,Ae=sa.number(ne.x,se.x,_e),Ze=sa.number(ne.y,se.y,_e);if(Ae>=0&&Ae<P&&Ze>=0&&Ze<P&&q-D>=0&&q+D<=N){const et=new iu(Ae,Ze,Ne,X);et._round(),d&&!vc(a,et,w,d,g)||W.push(et)}}j+=ue}return A||W.length||S||(W=ey(a,j/2,s,d,g,w,S,!0,P)),W}function Oo(a,n,s,d){const g=[],w=a.image,S=w.pixelRatio,A=w.paddedRect.w-2,P=w.paddedRect.h-2;let D={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const N=w.stretchX||[[0,A]],j=w.stretchY||[[0,P]],q=(at,Xt)=>at+Xt[1]-Xt[0],W=N.reduce(q,0),X=j.reduce(q,0),ne=A-W,se=P-X;let ue=0,Ne=W,_e=0,Ae=X,Ze=0,et=ne,dt=0,At=se;if(w.content&&d){const at=w.content,Xt=at[2]-at[0],en=at[3]-at[1];(w.textFitWidth||w.textFitHeight)&&(D=ll(a)),ue=Qh(N,0,at[0]),_e=Qh(j,0,at[1]),Ne=Qh(N,at[0],at[2]),Ae=Qh(j,at[1],at[3]),Ze=at[0]-ue,dt=at[1]-_e,et=Xt-Ne,At=en-Ae}const bt=D.x1,Ct=D.y1,Ut=D.x2-bt,xt=D.y2-Ct,Tt=(at,Xt,en,jt)=>{const Vt=vf(at.stretch-ue,Ne,Ut,bt),Mn=ru(at.fixed-Ze,et,at.stretch,W),Ai=vf(Xt.stretch-_e,Ae,xt,Ct),Mr=ru(Xt.fixed-dt,At,Xt.stretch,X),Wr=vf(en.stretch-ue,Ne,Ut,bt),Gs=ru(en.fixed-Ze,et,en.stretch,W),Hs=vf(jt.stretch-_e,Ae,xt,Ct),Kr=ru(jt.fixed-dt,At,jt.stretch,X),Ii=new M(Vt,Ai),gr=new M(Wr,Ai),$r=new M(Wr,Hs),_r=new M(Vt,Hs),cs=new M(Mn/S,Mr/S),Zs=new M(Gs/S,Kr/S),kr=n*Math.PI/180;if(kr){const r=Math.sin(kr),u=Math.cos(kr),m=[u,-r,r,u];Ii._matMult(m),gr._matMult(m),_r._matMult(m),$r._matMult(m)}const ma=at.stretch+at.fixed,rr=Xt.stretch+Xt.fixed;return{tl:Ii,tr:gr,bl:_r,br:$r,tex:{x:w.paddedRect.x+1+ma,y:w.paddedRect.y+1+rr,w:en.stretch+en.fixed-ma,h:jt.stretch+jt.fixed-rr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cs,pixelOffsetBR:Zs,minFontScaleX:et/S/Ut,minFontScaleY:At/S/xt,isSDF:s}};if(d&&(w.stretchX||w.stretchY)){const at=mg(N,ne,W),Xt=mg(j,se,X);for(let en=0;en<at.length-1;en++){const jt=at[en],Vt=at[en+1];for(let Mn=0;Mn<Xt.length-1;Mn++)g.push(Tt(jt,Xt[Mn],Vt,Xt[Mn+1]))}}else g.push(Tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:P+1}));return g}function Qh(a,n,s){let d=0;for(const g of a)d+=Math.max(n,Math.min(s,g[1]))-Math.max(n,Math.min(s,g[0]));return d}function mg(a,n,s){const d=[{fixed:-1,stretch:0}];for(const[g,w]of a){const S=d[d.length-1];d.push({fixed:g-S.stretch,stretch:S.stretch}),d.push({fixed:g-S.stretch,stretch:S.stretch+(w-g)})}return d.push({fixed:n+1,stretch:s}),d}function vf(a,n,s,d){return a/n*s+d}function ru(a,n,s,d){return a-n*s/d}Dt("Anchor",iu);class pa{constructor(n,s,d,g,w,S,A,P,D,N){var j;if(this.boxStartIndex=n.length,D){let q=S.top,W=S.bottom;const X=S.collisionPadding;X&&(q-=X[1],W+=X[3]);let ne=W-q;ne>0&&(ne=Math.max(10,ne),this.circleDiameter=ne)}else{const q=!((j=S.image)===null||j===void 0)&&j.content&&(S.image.textFitWidth||S.image.textFitHeight)?ll(S):{x1:S.left,y1:S.top,x2:S.right,y2:S.bottom};q.y1=q.y1*A-P[0],q.y2=q.y2*A+P[2],q.x1=q.x1*A-P[3],q.x2=q.x2*A+P[1];const W=S.collisionPadding;if(W&&(q.x1-=W[0]*A,q.y1-=W[1]*A,q.x2+=W[2]*A,q.y2+=W[3]*A),N){const X=new M(q.x1,q.y1),ne=new M(q.x2,q.y1),se=new M(q.x1,q.y2),ue=new M(q.x2,q.y2),Ne=N*Math.PI/180;X._rotate(Ne),ne._rotate(Ne),se._rotate(Ne),ue._rotate(Ne),q.x1=Math.min(X.x,ne.x,se.x,ue.x),q.x2=Math.max(X.x,ne.x,se.x,ue.x),q.y1=Math.min(X.y,ne.y,se.y,ue.y),q.y2=Math.max(X.y,ne.y,se.y,ue.y)}n.emplaceBack(s.x,s.y,q.x1,q.y1,q.x2,q.y2,d,g,w)}this.boxEndIndex=n.length}}class ty{constructor(n=[],s=(d,g)=>d<g?-1:d>g?1:0){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:d}=this,g=s[n];for(;n>0;){const w=n-1>>1,S=s[w];if(d(g,S)>=0)break;s[n]=S,n=w}s[n]=g}_down(n){const{data:s,compare:d}=this,g=this.length>>1,w=s[n];for(;n<g;){let S=1+(n<<1);const A=S+1;if(A<this.length&&d(s[A],s[S])<0&&(S=A),d(s[S],w)>=0)break;s[n]=s[S],n=S}s[n]=w}}function Sp(a,n=1,s=!1){const d=yc.fromPoints(a[0]),g=Math.min(d.width(),d.height());let w=g/2;const S=new ty([],bc),{minX:A,minY:P,maxX:D,maxY:N}=d;if(g===0)return new M(A,P);for(let W=A;W<D;W+=g)for(let X=P;X<N;X+=g)S.push(new Jh(W+w,X+w,w,a));let j=(function(W){let X=0,ne=0,se=0;const ue=W[0];for(let Ne=0,_e=ue.length,Ae=_e-1;Ne<_e;Ae=Ne++){const Ze=ue[Ne],et=ue[Ae],dt=Ze.x*et.y-et.x*Ze.y;ne+=(Ze.x+et.x)*dt,se+=(Ze.y+et.y)*dt,X+=3*dt}return new Jh(ne/X,se/X,0,W)})(a),q=S.length;for(;S.length;){const W=S.pop();(W.d>j.d||!j.d)&&(j=W,s&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,q)),W.max-j.d<=n||(w=W.h/2,S.push(new Jh(W.p.x-w,W.p.y-w,w,a)),S.push(new Jh(W.p.x+w,W.p.y-w,w,a)),S.push(new Jh(W.p.x-w,W.p.y+w,w,a)),S.push(new Jh(W.p.x+w,W.p.y+w,w,a)),q+=4)}return s&&(console.log(`num probes: ${q}`),console.log(`best distance: ${j.d}`)),j.p}function bc(a,n){return n.max-a.max}function Jh(a,n,s,d){this.p=new M(a,n),this.h=s,this.d=(function(g,w){let S=!1,A=1/0;for(let P=0;P<w.length;P++){const D=w[P];for(let N=0,j=D.length,q=j-1;N<j;q=N++){const W=D[N],X=D[q];W.y>g.y!=X.y>g.y&&g.x<(X.x-W.x)*(g.y-W.y)/(X.y-W.y)+W.x&&(S=!S),A=Math.min(A,bm(g,W,X))}}return(S?1:-1)*Math.sqrt(A)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}var ls;y.aE=void 0,(ls=y.aE||(y.aE={}))[ls.center=1]="center",ls[ls.left=2]="left",ls[ls.right=3]="right",ls[ls.top=4]="top",ls[ls.bottom=5]="bottom",ls[ls["top-left"]=6]="top-left",ls[ls["top-right"]=7]="top-right",ls[ls["bottom-left"]=8]="bottom-left",ls[ls["bottom-right"]=9]="bottom-right";const su=Number.POSITIVE_INFINITY;function gg(a,n){return n[1]!==su?(function(s,d,g){let w=0,S=0;switch(d=Math.abs(d),g=Math.abs(g),s){case"top-right":case"top-left":case"top":S=g-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-g}switch(s){case"top-right":case"bottom-right":case"right":w=-d;break;case"top-left":case"bottom-left":case"left":w=d}return[w,S]})(a,n[0],n[1]):(function(s,d){let g=0,w=0;d<0&&(d=0);const S=d/Math.SQRT2;switch(s){case"top-right":case"top-left":w=S-7;break;case"bottom-right":case"bottom-left":w=7-S;break;case"bottom":w=7-d;break;case"top":w=d-7}switch(s){case"top-right":case"bottom-right":g=-S;break;case"top-left":case"bottom-left":g=S;break;case"left":g=d;break;case"right":g=-d}return[g,w]})(a,n[0])}function ny(a,n,s){var d;const g=a.layout,w=(d=g.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(n,{},s);if(w){const A=w.values,P=[];for(let D=0;D<A.length;D+=2){const N=P[D]=A[D],j=A[D+1].map((q=>q*Pr));N.startsWith("top")?j[1]-=7:N.startsWith("bottom")&&(j[1]+=7),P[D+1]=j}return new Xi(P)}const S=g.get("text-variable-anchor");if(S){let A;A=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(n,{},s)*Pr,su]:g.get("text-offset").evaluate(n,{},s).map((D=>D*Pr));const P=[];for(const D of S)P.push(D,gg(D,A));return new Xi(P)}return null}function _g(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ov(a,n,s,d,g,w,S,A,P,D,N,j){let q=w.textMaxSize.evaluate(n,{});q===void 0&&(q=S);const W=a.layers[0].layout,X=W.get("icon-offset").evaluate(n,{},N),ne=ry(s.horizontal),se=S/24,ue=a.tilePixelRatio*se,Ne=a.tilePixelRatio*q/24,_e=a.tilePixelRatio*A,Ae=a.tilePixelRatio*W.get("symbol-spacing"),Ze=W.get("text-padding")*a.tilePixelRatio,et=(function(en,jt,Vt,Mn=1){const Ai=en.get("icon-padding").evaluate(jt,{},Vt),Mr=Ai&&Ai.values;return[Mr[0]*Mn,Mr[1]*Mn,Mr[2]*Mn,Mr[3]*Mn]})(W,n,N,a.tilePixelRatio),dt=W.get("text-max-angle")/180*Math.PI,At=W.get("text-rotation-alignment")!=="viewport"&&W.get("symbol-placement")!=="point",bt=W.get("icon-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",Ct=W.get("symbol-placement"),Ut=Ae/2,xt=W.get("icon-text-fit");let Tt;d&&xt!=="none"&&(a.allowVerticalPlacement&&s.vertical&&(Tt=Kh(d,s.vertical,xt,W.get("icon-text-fit-padding"),X,se)),ne&&(d=Kh(d,ne,xt,W.get("icon-text-fit-padding"),X,se)));const at=N?j.line.getGranularityForZoomLevel(N.z):1,Xt=(en,jt)=>{jt.x<0||jt.x>=Wt||jt.y<0||jt.y>=Wt||(function(Vt,Mn,Ai,Mr,Wr,Gs,Hs,Kr,Ii,gr,$r,_r,cs,Zs,kr,ma,rr,r,u,m,x,C,z,H,ie){const we=Vt.addToLineVertexArray(Mn,Ai);let Ke,ct,pt,Qe,it=0,bn=0,hn=0,Ci=0,Ue=-1,Be=-1;const qe={};let ft=nl("");if(Vt.allowVerticalPlacement&&Mr.vertical){const ga=Kr.layout.get("text-rotate").evaluate(x,{},H)+90;pt=new pa(Ii,Mn,gr,$r,_r,Mr.vertical,cs,Zs,kr,ga),Hs&&(Qe=new pa(Ii,Mn,gr,$r,_r,Hs,rr,r,kr,ga))}if(Wr){const ga=Kr.layout.get("icon-rotate").evaluate(x,{}),cl=Kr.layout.get("icon-text-fit")!=="none",Tf=Oo(Wr,ga,z,cl),wc=Hs?Oo(Hs,ga,z,cl):void 0;ct=new pa(Ii,Mn,gr,$r,_r,Wr,rr,r,!1,ga),it=4*Tf.length;const Sf=Vt.iconSizeData;let cu=null;Sf.kind==="source"?(cu=[mc*Kr.layout.get("icon-size").evaluate(x,{})],cu[0]>gc&&Pi(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Sf.kind==="composite"&&(cu=[mc*C.compositeIconSizes[0].evaluate(x,{},H),mc*C.compositeIconSizes[1].evaluate(x,{},H)],(cu[0]>gc||cu[1]>gc)&&Pi(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Vt.addSymbols(Vt.icon,Tf,cu,m,u,x,y.ao.none,Mn,we.lineStartIndex,we.lineLength,-1,H),Ue=Vt.icon.placedSymbolArray.length-1,wc&&(bn=4*wc.length,Vt.addSymbols(Vt.icon,wc,cu,m,u,x,y.ao.vertical,Mn,we.lineStartIndex,we.lineLength,-1,H),Be=Vt.icon.placedSymbolArray.length-1)}const Gt=Object.keys(Mr.horizontal);for(const ga of Gt){const cl=Mr.horizontal[ga];if(!Ke){ft=nl(cl.text);const wc=Kr.layout.get("text-rotate").evaluate(x,{},H);Ke=new pa(Ii,Mn,gr,$r,_r,cl,cs,Zs,kr,wc)}const Tf=cl.positionedLines.length===1;if(hn+=iy(Vt,Mn,cl,Gs,Kr,kr,x,ma,we,Mr.vertical?y.ao.horizontal:y.ao.horizontalOnly,Tf?Gt:[ga],qe,Ue,C,H),Tf)break}Mr.vertical&&(Ci+=iy(Vt,Mn,Mr.vertical,Gs,Kr,kr,x,ma,we,y.ao.vertical,["vertical"],qe,Be,C,H));const Bn=Ke?Ke.boxStartIndex:Vt.collisionBoxArray.length,tn=Ke?Ke.boxEndIndex:Vt.collisionBoxArray.length,mn=pt?pt.boxStartIndex:Vt.collisionBoxArray.length,us=pt?pt.boxEndIndex:Vt.collisionBoxArray.length,ii=ct?ct.boxStartIndex:Vt.collisionBoxArray.length,lu=ct?ct.boxEndIndex:Vt.collisionBoxArray.length,Lv=Qe?Qe.boxStartIndex:Vt.collisionBoxArray.length,jE=Qe?Qe.boxEndIndex:Vt.collisionBoxArray.length;let xc=-1;const oy=(ga,cl)=>ga&&ga.circleDiameter?Math.max(ga.circleDiameter,cl):cl;xc=oy(Ke,xc),xc=oy(pt,xc),xc=oy(ct,xc),xc=oy(Qe,xc);const nx=xc>-1?1:0;nx&&(xc*=ie/Pr),Vt.glyphOffsetArray.length>=tu.MAX_GLYPHS&&Pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),x.sortKey!==void 0&&Vt.addToSortKeyRanges(Vt.symbolInstances.length,x.sortKey);const UE=ny(Kr,x,H),[FE,$E]=(function(ga,cl){const Tf=ga.length,wc=cl?.values;if(wc?.length>0)for(let Sf=0;Sf<wc.length;Sf+=2){const cu=wc[Sf+1];ga.emplaceBack(y.aE[wc[Sf]],cu[0],cu[1])}return[Tf,ga.length]})(Vt.textAnchorOffsets,UE);Vt.symbolInstances.emplaceBack(Mn.x,Mn.y,qe.right>=0?qe.right:-1,qe.center>=0?qe.center:-1,qe.left>=0?qe.left:-1,qe.vertical||-1,Ue,Be,ft,Bn,tn,mn,us,ii,lu,Lv,jE,gr,hn,Ci,it,bn,nx,0,cs,xc,FE,$E)})(a,jt,en,s,d,g,Tt,a.layers[0],a.collisionBoxArray,n.index,n.sourceLayerIndex,a.index,ue,[Ze,Ze,Ze,Ze],At,P,_e,et,bt,X,n,w,D,N,S)};if(Ct==="line")for(const en of Q_(n.geometry,0,0,Wt,Wt)){const jt=oo(en,at),Vt=pg(jt,Ae,dt,s.vertical||ne,d,24,Ne,a.overscaling,Wt);for(const Mn of Vt)ne&&zv(a,ne.text,Ut,Mn)||Xt(jt,Mn)}else if(Ct==="line-center"){for(const en of n.geometry)if(en.length>1){const jt=oo(en,at),Vt=Dv(jt,dt,s.vertical||ne,d,24,Ne);Vt&&Xt(jt,Vt)}}else if(n.type==="Polygon")for(const en of Dc(n.geometry,0)){const jt=Sp(en,16);Xt(oo(en[0],at,!0),new iu(jt.x,jt.y,0))}else if(n.type==="LineString")for(const en of n.geometry){const jt=oo(en,at);Xt(jt,new iu(jt[0].x,jt[0].y,0))}else if(n.type==="Point")for(const en of n.geometry)for(const jt of en)Xt([jt],new iu(jt.x,jt.y,0))}function iy(a,n,s,d,g,w,S,A,P,D,N,j,q,W,X){const ne=(function(Ne,_e,Ae,Ze,et,dt,At,bt){const Ct=Ze.layout.get("text-rotate").evaluate(dt,{})*Math.PI/180,Ut=[];for(const xt of _e.positionedLines)for(const Tt of xt.positionedGlyphs){if(!Tt.rect)continue;const at=Tt.rect||{};let Xt=4,en=!0,jt=1,Vt=0;const Mn=(et||bt)&&Tt.vertical,Ai=Tt.metrics.advance*Tt.scale/2;if(bt&&_e.verticalizable&&(Vt=xt.lineOffset/2-(Tt.imageName?-(Pr-Tt.metrics.width*Tt.scale)/2:(Tt.scale-1)*Pr)),Tt.imageName){const r=At[Tt.imageName];en=r.sdf,jt=r.pixelRatio,Xt=1/jt}const Mr=et?[Tt.x+Ai,Tt.y]:[0,0];let Wr=et?[0,0]:[Tt.x+Ai+Ae[0],Tt.y+Ae[1]-Vt],Gs=[0,0];Mn&&(Gs=Wr,Wr=[0,0]);const Hs=Tt.metrics.isDoubleResolution?2:1,Kr=(Tt.metrics.left-Xt)*Tt.scale-Ai+Wr[0],Ii=(-Tt.metrics.top-Xt)*Tt.scale+Wr[1],gr=Kr+at.w/Hs*Tt.scale/jt,$r=Ii+at.h/Hs*Tt.scale/jt,_r=new M(Kr,Ii),cs=new M(gr,Ii),Zs=new M(Kr,$r),kr=new M(gr,$r);if(Mn){const r=new M(-Ai,Ai- -17),u=-Math.PI/2,m=12-Ai,x=new M(22-m,-(Tt.imageName?m:0)),C=new M(...Gs);_r._rotateAround(u,r)._add(x)._add(C),cs._rotateAround(u,r)._add(x)._add(C),Zs._rotateAround(u,r)._add(x)._add(C),kr._rotateAround(u,r)._add(x)._add(C)}if(Ct){const r=Math.sin(Ct),u=Math.cos(Ct),m=[u,-r,r,u];_r._matMult(m),cs._matMult(m),Zs._matMult(m),kr._matMult(m)}const ma=new M(0,0),rr=new M(0,0);Ut.push({tl:_r,tr:cs,bl:Zs,br:kr,tex:at,writingMode:_e.writingMode,glyphOffset:Mr,sectionIndex:Tt.sectionIndex,isSDF:en,pixelOffsetTL:ma,pixelOffsetBR:rr,minFontScaleX:0,minFontScaleY:0})}return Ut})(0,s,A,g,w,S,d,a.allowVerticalPlacement),se=a.textSizeData;let ue=null;se.kind==="source"?(ue=[mc*g.layout.get("text-size").evaluate(S,{})],ue[0]>gc&&Pi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(ue=[mc*W.compositeTextSizes[0].evaluate(S,{},X),mc*W.compositeTextSizes[1].evaluate(S,{},X)],(ue[0]>gc||ue[1]>gc)&&Pi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,ne,ue,A,w,S,D,n,P.lineStartIndex,P.lineLength,q,X);for(const Ne of N)j[Ne]=a.text.placedSymbolArray.length-1;return 4*ne.length}function ry(a){for(const n in a)return a[n];return null}function zv(a,n,s,d){const g=a.compareText;if(n in g){const w=g[n];for(let S=w.length-1;S>=0;S--)if(d.dist(w[S])<s)return!0}else g[n]=[];return g[n].push(d),!1}const sy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ep{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,d]=new Uint8Array(n,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=d>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=sy[15&d];if(!w)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(n,2,1),[A]=new Uint32Array(n,4,1);return new Ep(A,S,w,n)}constructor(n,s=64,d=Float64Array,g){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=d,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const w=sy.indexOf(this.ArrayType),S=2*n*this.ArrayType.BYTES_PER_ELEMENT,A=n*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-A%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${d}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+A+P,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+S+A+P),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+A+P,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=n)}add(n,s){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=n,this.coords[this._pos++]=s,d}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return au(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,s,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:S,nodeSize:A}=this,P=[0,w.length-1,0],D=[];for(;P.length;){const N=P.pop()||0,j=P.pop()||0,q=P.pop()||0;if(j-q<=A){for(let se=q;se<=j;se++){const ue=S[2*se],Ne=S[2*se+1];ue>=n&&ue<=d&&Ne>=s&&Ne<=g&&D.push(w[se])}continue}const W=q+j>>1,X=S[2*W],ne=S[2*W+1];X>=n&&X<=d&&ne>=s&&ne<=g&&D.push(w[W]),(N===0?n<=X:s<=ne)&&(P.push(q),P.push(W-1),P.push(1-N)),(N===0?d>=X:g>=ne)&&(P.push(W+1),P.push(j),P.push(1-N))}return D}within(n,s,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:S}=this,A=[0,g.length-1,0],P=[],D=d*d;for(;A.length;){const N=A.pop()||0,j=A.pop()||0,q=A.pop()||0;if(j-q<=S){for(let se=q;se<=j;se++)nh(w[2*se],w[2*se+1],n,s)<=D&&P.push(g[se]);continue}const W=q+j>>1,X=w[2*W],ne=w[2*W+1];nh(X,ne,n,s)<=D&&P.push(g[W]),(N===0?n-d<=X:s-d<=ne)&&(A.push(q),A.push(W-1),A.push(1-N)),(N===0?n+d>=X:s+d>=ne)&&(A.push(W+1),A.push(j),A.push(1-N))}return P}}function au(a,n,s,d,g,w){if(g-d<=s)return;const S=d+g>>1;ed(a,n,S,d,g,w),au(a,n,s,d,S-1,1-w),au(a,n,s,S+1,g,1-w)}function ed(a,n,s,d,g,w){for(;g>d;){if(g-d>600){const D=g-d+1,N=s-d+1,j=Math.log(D),q=.5*Math.exp(2*j/3),W=.5*Math.sqrt(j*q*(D-q)/D)*(N-D/2<0?-1:1);ed(a,n,s,Math.max(d,Math.floor(s-N*q/D+W)),Math.min(g,Math.floor(s+(D-N)*q/D+W)),w)}const S=n[2*s+w];let A=d,P=g;for(td(a,n,d,s),n[2*g+w]>S&&td(a,n,d,g);A<P;){for(td(a,n,A,P),A++,P--;n[2*A+w]<S;)A++;for(;n[2*P+w]>S;)P--}n[2*d+w]===S?td(a,n,d,P):(P++,td(a,n,P,g)),P<=s&&(d=P+1),s<=P&&(g=P-1)}}function td(a,n,s,d){yg(a,s,d),yg(n,2*s,2*d),yg(n,2*s+1,2*d+1)}function yg(a,n,s){const d=a[n];a[n]=a[s],a[s]=d}function nh(a,n,s,d){const g=a-s,w=n-d;return g*g+w*w}var ih;y.cx=void 0,(ih=y.cx||(y.cx={})).create="create",ih.load="load",ih.fullLoad="fullLoad";let bf=null,ou=[];const xf=1e3/60,wf="loadTime",nd="fullLoadTime",ay={mark(a){performance.mark(a)},frame(a){const n=a;bf!=null&&ou.push(n-bf),bf=n},clearMetrics(){bf=null,ou=[],performance.clearMeasures(wf),performance.clearMeasures(nd);for(const a in y.cx)performance.clearMarks(y.cx[a])},getPerformanceMetrics(){performance.measure(wf,y.cx.create,y.cx.load),performance.measure(nd,y.cx.create,y.cx.fullLoad);const a=performance.getEntriesByName(wf)[0].duration,n=performance.getEntriesByName(nd)[0].duration,s=ou.length,d=1/(ou.reduce(((w,S)=>w+S),0)/s/1e3),g=ou.filter((w=>w>xf)).reduce(((w,S)=>w+(S-xf)/xf),0);return{loadTime:a,fullLoadTime:n,fps:d,percentDroppedFrames:g/(s+g)*100,totalFrames:s}}};y.$=Wt,y.A=He,y.B=function([a,n,s]){return n+=90,n*=Math.PI/180,s*=Math.PI/180,{x:a*Math.cos(n)*Math.sin(s),y:a*Math.sin(n)*Math.sin(s),z:a*Math.cos(s)}},y.C=sa,y.D=Lt,y.E=zt,y.F=Jn,y.G=jd,y.H=function(a){if(br==null){const n=a.navigator?a.navigator.userAgent:null;br=!!a.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return br},y.I=Hh,y.J=class{constructor(a,n){this.target=a,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new gf((()=>this.process())),this.subscription=xa(this.target,"message",(s=>this.receive(s)),!1),this.globalScope=Ls(self)?a:window}registerMessageHandler(a,n){this.messageHandlers[a]=n}sendAsync(a,n){return new Promise(((s,d)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10),w=n?xa(n.signal,"abort",(()=>{w?.unsubscribe(),delete this.resolveRejects[g];const P={id:g,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(P)}),vp):null;this.resolveRejects[g]={resolve:P=>{w?.unsubscribe(),s(P)},reject:P=>{w?.unsubscribe(),d(P)}};const S=[],A=Object.assign(Object.assign({},a),{id:g,sourceMapId:this.mapId,origin:location.origin,data:eo(a.data,S)});this.target.postMessage(A,{transfer:S})}))}receive(a){const n=a.data,s=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[s];const d=this.abortControllers[s];return delete this.abortControllers[s],void(d&&d.abort())}if(Ls(self)||n.mustQueue)return this.tasks[s]=n,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,n)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),n=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(a,n)}processTask(a,n){return h(this,void 0,void 0,(function*(){if(n.type==="<response>"){const g=this.resolveRejects[a];return delete this.resolveRejects[a],g?void(n.error?g.reject(tc(n.error)):g.resolve(tc(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=tc(n.data),d=new AbortController;this.abortControllers[a]=d;try{const g=yield this.messageHandlers[n.type](n.sourceMapId,s,d);this.completeTask(a,null,g)}catch(g){this.completeTask(a,g)}}))}completeTask(a,n,s){const d=[];delete this.abortControllers[a];const g={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?eo(n):null,data:eo(s,d)};this.target.postMessage(g,{transfer:d})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},y.K=re,y.L=function(){var a=new He(16);return He!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.M=function(a,n,s){var d,g,w,S,A,P,D,N,j,q,W,X,ne=s[0],se=s[1],ue=s[2];return n===a?(a[12]=n[0]*ne+n[4]*se+n[8]*ue+n[12],a[13]=n[1]*ne+n[5]*se+n[9]*ue+n[13],a[14]=n[2]*ne+n[6]*se+n[10]*ue+n[14],a[15]=n[3]*ne+n[7]*se+n[11]*ue+n[15]):(g=n[1],w=n[2],S=n[3],A=n[4],P=n[5],D=n[6],N=n[7],j=n[8],q=n[9],W=n[10],X=n[11],a[0]=d=n[0],a[1]=g,a[2]=w,a[3]=S,a[4]=A,a[5]=P,a[6]=D,a[7]=N,a[8]=j,a[9]=q,a[10]=W,a[11]=X,a[12]=d*ne+A*se+j*ue+n[12],a[13]=g*ne+P*se+q*ue+n[13],a[14]=w*ne+D*se+W*ue+n[14],a[15]=S*ne+N*se+X*ue+n[15]),a},y.N=function(a,n,s){var d=s[0],g=s[1],w=s[2];return a[0]=n[0]*d,a[1]=n[1]*d,a[2]=n[2]*d,a[3]=n[3]*d,a[4]=n[4]*g,a[5]=n[5]*g,a[6]=n[6]*g,a[7]=n[7]*g,a[8]=n[8]*w,a[9]=n[9]*w,a[10]=n[10]*w,a[11]=n[11]*w,a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a},y.O=function(a,n,s){var d=n[0],g=n[1],w=n[2],S=n[3],A=n[4],P=n[5],D=n[6],N=n[7],j=n[8],q=n[9],W=n[10],X=n[11],ne=n[12],se=n[13],ue=n[14],Ne=n[15],_e=s[0],Ae=s[1],Ze=s[2],et=s[3];return a[0]=_e*d+Ae*A+Ze*j+et*ne,a[1]=_e*g+Ae*P+Ze*q+et*se,a[2]=_e*w+Ae*D+Ze*W+et*ue,a[3]=_e*S+Ae*N+Ze*X+et*Ne,a[4]=(_e=s[4])*d+(Ae=s[5])*A+(Ze=s[6])*j+(et=s[7])*ne,a[5]=_e*g+Ae*P+Ze*q+et*se,a[6]=_e*w+Ae*D+Ze*W+et*ue,a[7]=_e*S+Ae*N+Ze*X+et*Ne,a[8]=(_e=s[8])*d+(Ae=s[9])*A+(Ze=s[10])*j+(et=s[11])*ne,a[9]=_e*g+Ae*P+Ze*q+et*se,a[10]=_e*w+Ae*D+Ze*W+et*ue,a[11]=_e*S+Ae*N+Ze*X+et*Ne,a[12]=(_e=s[12])*d+(Ae=s[13])*A+(Ze=s[14])*j+(et=s[15])*ne,a[13]=_e*g+Ae*P+Ze*q+et*se,a[14]=_e*w+Ae*D+Ze*W+et*ue,a[15]=_e*S+Ae*N+Ze*X+et*Ne,a},y.P=M,y.Q=function(a,n){const s={};for(let d=0;d<n.length;d++){const g=n[d];g in a&&(s[g]=a[g])}return s},y.R=Ps,y.S=_c,y.T=qu,y.U=hg,y.V=ug,y.W=Ee,y.X=Je,y.Y=Wi,y.Z=qs,y._=h,y.a=J,y.a$=Te,y.a0=function(a,n){var s,d,g,w,S;if(!a)return n??{};if(!n)return a;let A=Object.assign({},a);if(n.removeAll&&(A={removeAll:!0}),n.remove){const P=new Set(n.remove);A.add&&(A.add=A.add.filter((N=>!P.has(N.id)))),A.update&&(A.update=A.update.filter((N=>!P.has(N.id))));const D=new Set(((s=a.add)!==null&&s!==void 0?s:[]).map((N=>N.id)));n.remove=n.remove.filter((N=>!D.has(N)))}if(n.remove){const P=new Set(A.remove?A.remove.concat(n.remove):n.remove);A.remove=Array.from(P.values())}if(n.add){const P=A.add?A.add.concat(n.add):n.add,D=new Map(P.map((N=>[N.id,N])));A.add=Array.from(D.values())}if(n.update){const P=new Map((d=A.update)===null||d===void 0?void 0:d.map((D=>[D.id,D])));for(const D of n.update){const N=(g=P.get(D.id))!==null&&g!==void 0?g:{id:D.id};D.newGeometry&&(N.newGeometry=D.newGeometry),D.addOrUpdateProperties&&(N.addOrUpdateProperties=((w=N.addOrUpdateProperties)!==null&&w!==void 0?w:[]).concat(D.addOrUpdateProperties)),D.removeProperties&&(N.removeProperties=((S=N.removeProperties)!==null&&S!==void 0?S:[]).concat(D.removeProperties)),D.removeAllProperties&&(N.removeAllProperties=!0),P.set(D.id,N)}A.update=Array.from(P.values())}return A.remove&&A.add&&(A.remove=A.remove.filter((P=>A.add.findIndex((D=>D.id===P))===-1))),A},y.a1=Rr,y.a2=yc,y.a3=25,y.a4=yf,y.a5=a=>{const n=window.document.createElement("video");return n.muted=!0,new Promise((s=>{n.onloadstart=()=>{s(n)};for(const d of a){const g=window.document.createElement("source");Fe(d)||(n.crossOrigin="Anonymous"),g.src=d,n.appendChild(g)}}))},y.a6=yt,y.a7=function(){return ar++},y.a8=te,y.a9=tu,y.aA=function(a){let n=1/0,s=1/0,d=-1/0,g=-1/0;for(const w of a)n=Math.min(n,w.x),s=Math.min(s,w.y),d=Math.max(d,w.x),g=Math.max(g,w.y);return[n,s,d,g]},y.aB=Pr,y.aC=De,y.aD=function(a,n,s,d,g=!1){if(!s[0]&&!s[1])return[0,0];const w=g?d==="map"?-a.bearingInRadians:0:d==="viewport"?a.bearingInRadians:0;if(w){const S=Math.sin(w),A=Math.cos(w);s=[s[0]*A-s[1]*S,s[0]*S+s[1]*A]}return[g?s[0]:De(n,s[0],a.zoom),g?s[1]:De(n,s[1],a.zoom)]},y.aF=pp,y.aG=_g,y.aH=eg,y.aI=Ep,y.aJ=Hi,y.aK=Ma,y.aL=Xe,y.aM=Ln,y.aN=ci,y.aO=Ji,y.aP=Ns,y.aQ=bp,y.aR=Oe,y.aS=ye,y.aT=function(a){var n=new He(3);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n},y.aU=function(a,n,s){return a[0]=n[0]-s[0],a[1]=n[1]-s[1],a[2]=n[2]-s[2],a},y.aV=function(a,n){var s=n[0],d=n[1],g=n[2],w=s*s+d*d+g*g;return w>0&&(w=1/Math.sqrt(w)),a[0]=n[0]*w,a[1]=n[1]*w,a[2]=n[2]*w,a},y.aW=Me,y.aX=function(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]},y.aY=function(a,n,s){return a[0]=n[0]*s[0],a[1]=n[1]*s[1],a[2]=n[2]*s[2],a[3]=n[3]*s[3],a},y.aZ=Se,y.a_=function(a,n,s){const d=n[0]*s[0]+n[1]*s[1]+n[2]*s[2];return d===0?null:(-(a[0]*s[0]+a[1]*s[1]+a[2]*s[2])-s[3])/d},y.aa=Ho,y.ab=oc,y.ac=K_,y.ad=function(a){const n={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((s,d,g,w)=>{const S=g||w;return n[d]=!S||S.toLowerCase(),""})),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n},y.ae=Bo,y.af=function(a){return Math.pow(2,a)},y.ag=St,y.ah=Ht,y.ai=85.051129,y.aj=_f,y.ak=function(a){return Math.log(a)/Math.LN2},y.al=function(a){var n=a[0],s=a[1];return n*n+s*s},y.am=function(a,n){const s=[];for(const d in a)d in n||s.push(d);return s},y.an=function(a,n){let s=0,d=0;if(a.kind==="constant")d=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:S}=a,A=g?Ht(Vi.interpolationFactor(g,n,w,S),0,1):0;a.kind==="camera"?d=sa.number(a.minSize,a.maxSize,A):s=A}return{uSizeT:s,uSize:d}},y.ap=function(a,{uSize:n,uSizeT:s},{lowerSize:d,upperSize:g}){return a.kind==="source"?d/mc:a.kind==="composite"?sa.number(d/mc,g/mc,s):n},y.aq=function(a,n){var s=n[0],d=n[1],g=n[2],w=n[3],S=n[4],A=n[5],P=n[6],D=n[7],N=n[8],j=n[9],q=n[10],W=n[11],X=n[12],ne=n[13],se=n[14],ue=n[15],Ne=s*A-d*S,_e=s*P-g*S,Ae=s*D-w*S,Ze=d*P-g*A,et=d*D-w*A,dt=g*D-w*P,At=N*ne-j*X,bt=N*se-q*X,Ct=N*ue-W*X,Ut=j*se-q*ne,xt=j*ue-W*ne,Tt=q*ue-W*se,at=Ne*Tt-_e*xt+Ae*Ut+Ze*Ct-et*bt+dt*At;return at?(a[0]=(A*Tt-P*xt+D*Ut)*(at=1/at),a[1]=(g*xt-d*Tt-w*Ut)*at,a[2]=(ne*dt-se*et+ue*Ze)*at,a[3]=(q*et-j*dt-W*Ze)*at,a[4]=(P*Ct-S*Tt-D*bt)*at,a[5]=(s*Tt-g*Ct+w*bt)*at,a[6]=(se*Ae-X*dt-ue*_e)*at,a[7]=(N*dt-q*Ae+W*_e)*at,a[8]=(S*xt-A*Ct+D*At)*at,a[9]=(d*Ct-s*xt-w*At)*at,a[10]=(X*et-ne*Ae+ue*Ne)*at,a[11]=(j*Ae-N*et-W*Ne)*at,a[12]=(A*bt-S*Ut-P*At)*at,a[13]=(s*Ut-d*bt+g*At)*at,a[14]=(ne*_e-X*Ze-se*Ne)*at,a[15]=(N*Ze-j*_e+q*Ne)*at,a):null},y.ar=kt,y.as=function(a){var n=a[0],s=a[1];return Math.sqrt(n*n+s*s)},y.at=function(a){return a[0]=0,a[1]=0,a},y.au=function(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a},y.av=pf,y.aw=dn,y.ax=function(a,n,s,d){const g=n.y-a.y,w=n.x-a.x,S=d.y-s.y,A=d.x-s.x,P=S*w-A*g;if(P===0)return null;const D=(A*(a.y-s.y)-S*(a.x-s.x))/P;return new M(a.x+D*w,a.y+D*g)},y.ay=Q_,y.az=qd,y.b=Ys,y.b$=class extends o{},y.b0=function(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a[2]=n[2]*s,a[3]=n[3]*s,a},y.b1=function(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]+a[3]},y.b2=xp,y.b3=th,y.b4=function(a,n,s,d,g){var w=1/Math.tan(n/2);if(a[0]=w/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=w,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0){var S=1/(d-g);a[10]=(g+d)*S,a[14]=2*g*d*S}else a[10]=-1,a[14]=-2*d;return a},y.b5=function(a){var n=new He(16);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=a[3],n[4]=a[4],n[5]=a[5],n[6]=a[6],n[7]=a[7],n[8]=a[8],n[9]=a[9],n[10]=a[10],n[11]=a[11],n[12]=a[12],n[13]=a[13],n[14]=a[14],n[15]=a[15],n},y.b6=function(a,n,s){var d=Math.sin(s),g=Math.cos(s),w=n[0],S=n[1],A=n[2],P=n[3],D=n[4],N=n[5],j=n[6],q=n[7];return n!==a&&(a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=w*g+D*d,a[1]=S*g+N*d,a[2]=A*g+j*d,a[3]=P*g+q*d,a[4]=D*g-w*d,a[5]=N*g-S*d,a[6]=j*g-A*d,a[7]=q*g-P*d,a},y.b7=function(a,n,s){var d=Math.sin(s),g=Math.cos(s),w=n[4],S=n[5],A=n[6],P=n[7],D=n[8],N=n[9],j=n[10],q=n[11];return n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[4]=w*g+D*d,a[5]=S*g+N*d,a[6]=A*g+j*d,a[7]=P*g+q*d,a[8]=D*g-w*d,a[9]=N*g-S*d,a[10]=j*g-A*d,a[11]=q*g-P*d,a},y.b8=function(){const a=new Float32Array(16);return St(a),a},y.b9=function(){const a=new Float64Array(16);return St(a),a},y.bA=function(a,n){const s=ut(a,360),d=ut(n,360),g=d-s,w=d>s?g-360:g+360;return Math.abs(g)<Math.abs(w)?g:w},y.bB=function(a){return a[0]=0,a[1]=0,a[2]=0,a},y.bC=function(a,n,s,d){const g=Math.sqrt(a*a+n*n),w=Math.sqrt(s*s+d*d);a/=g,n/=g,s/=w,d/=w;const S=Math.acos(a*s+n*d);return-n*s+a*d>0?S:-S},y.bD=function(a,n){const s=ut(a,2*Math.PI),d=ut(n,2*Math.PI);return Math.min(Math.abs(s-d),Math.abs(s-d+2*Math.PI),Math.abs(s-d-2*Math.PI))},y.bE=function(){const a={},n=Re.$version;for(const s in Re.$root){const d=Re.$root[s];if(d.required){let g=null;g=s==="version"?n:d.type==="array"?[]:{},g!=null&&(a[s]=g)}}return a},y.bF=Rh,y.bG=xe,y.bH=function a(n,s){if(Array.isArray(n)){if(!Array.isArray(s)||n.length!==s.length)return!1;for(let d=0;d<n.length;d++)if(!a(n[d],s[d]))return!1;return!0}if(typeof n=="object"&&n!==null&&s!==null){if(typeof s!="object"||Object.keys(n).length!==Object.keys(s).length)return!1;for(const d in n)if(!a(n[d],s[d]))return!1;return!0}return n===s},y.bI=function(a){a=a.slice();const n=Object.create(null);for(let s=0;s<a.length;s++)n[a[s].id]=a[s];for(let s=0;s<a.length;s++)"ref"in a[s]&&(a[s]=_n(a[s],n[a[s].ref]));return a},y.bJ=function(a,n){if(a.type==="custom")return new cg(a,n);switch(a.type){case"background":return new og(a,n);case"circle":return new Sm(a,n);case"color-relief":return new Iv(a,n);case"fill":return new rf(a,n);case"fill-extrusion":return new dc(a,n);case"heatmap":return new Am(a,n);case"hillshade":return new cc(a,n);case"line":return new eu(a,n);case"raster":return new G_(a,n);case"symbol":return new yp(a,n)}},y.bK=zr,y.bL=function(a,n){if(!a)return[{command:"setStyle",args:[n]}];let s=[];try{if(!Nt(a.version,n.version))return[{command:"setStyle",args:[n]}];Nt(a.center,n.center)||s.push({command:"setCenter",args:[n.center]}),Nt(a.state,n.state)||s.push({command:"setGlobalState",args:[n.state]}),Nt(a.centerAltitude,n.centerAltitude)||s.push({command:"setCenterAltitude",args:[n.centerAltitude]}),Nt(a.zoom,n.zoom)||s.push({command:"setZoom",args:[n.zoom]}),Nt(a.bearing,n.bearing)||s.push({command:"setBearing",args:[n.bearing]}),Nt(a.pitch,n.pitch)||s.push({command:"setPitch",args:[n.pitch]}),Nt(a.roll,n.roll)||s.push({command:"setRoll",args:[n.roll]}),Nt(a.sprite,n.sprite)||s.push({command:"setSprite",args:[n.sprite]}),Nt(a.glyphs,n.glyphs)||s.push({command:"setGlyphs",args:[n.glyphs]}),Nt(a.transition,n.transition)||s.push({command:"setTransition",args:[n.transition]}),Nt(a.light,n.light)||s.push({command:"setLight",args:[n.light]}),Nt(a.terrain,n.terrain)||s.push({command:"setTerrain",args:[n.terrain]}),Nt(a.sky,n.sky)||s.push({command:"setSky",args:[n.sky]}),Nt(a.projection,n.projection)||s.push({command:"setProjection",args:[n.projection]});const d={},g=[];(function(S,A,P,D){let N;for(N in A=A||{},S=S||{})Object.prototype.hasOwnProperty.call(S,N)&&(Object.prototype.hasOwnProperty.call(A,N)||vi(N,P,D));for(N in A)Object.prototype.hasOwnProperty.call(A,N)&&(Object.prototype.hasOwnProperty.call(S,N)?Nt(S[N],A[N])||(S[N].type==="geojson"&&A[N].type==="geojson"&&ei(S,A,N)?cn(P,{command:"setGeoJSONSourceData",args:[N,A[N].data]}):or(N,A,P,D)):Yn(N,A,P))})(a.sources,n.sources,g,d);const w=[];a.layers&&a.layers.forEach((S=>{"source"in S&&d[S.source]?s.push({command:"removeLayer",args:[S.id]}):w.push(S)})),s=s.concat(g),(function(S,A,P){A=A||[];const D=(S=S||[]).map(rn),N=A.map(rn),j=S.reduce(fi,{}),q=A.reduce(fi,{}),W=D.slice(),X=Object.create(null);let ne,se,ue,Ne,_e;for(let Ae=0,Ze=0;Ae<D.length;Ae++)ne=D[Ae],Object.prototype.hasOwnProperty.call(q,ne)?Ze++:(cn(P,{command:"removeLayer",args:[ne]}),W.splice(W.indexOf(ne,Ze),1));for(let Ae=0,Ze=0;Ae<N.length;Ae++)ne=N[N.length-1-Ae],W[W.length-1-Ae]!==ne&&(Object.prototype.hasOwnProperty.call(j,ne)?(cn(P,{command:"removeLayer",args:[ne]}),W.splice(W.lastIndexOf(ne,W.length-Ze),1)):Ze++,Ne=W[W.length-Ae],cn(P,{command:"addLayer",args:[q[ne],Ne]}),W.splice(W.length-Ae,0,ne),X[ne]=!0);for(let Ae=0;Ae<N.length;Ae++)if(ne=N[Ae],se=j[ne],ue=q[ne],!X[ne]&&!Nt(se,ue))if(Nt(se.source,ue.source)&&Nt(se["source-layer"],ue["source-layer"])&&Nt(se.type,ue.type)){for(_e in Kt(se.layout,ue.layout,P,ne,null,"setLayoutProperty"),Kt(se.paint,ue.paint,P,ne,null,"setPaintProperty"),Nt(se.filter,ue.filter)||cn(P,{command:"setFilter",args:[ne,ue.filter]}),Nt(se.minzoom,ue.minzoom)&&Nt(se.maxzoom,ue.maxzoom)||cn(P,{command:"setLayerZoomRange",args:[ne,ue.minzoom,ue.maxzoom]}),se)Object.prototype.hasOwnProperty.call(se,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?Kt(se[_e],ue[_e],P,ne,_e.slice(6),"setPaintProperty"):Nt(se[_e],ue[_e])||cn(P,{command:"setLayerProperty",args:[ne,_e,ue[_e]]}));for(_e in ue)Object.prototype.hasOwnProperty.call(ue,_e)&&!Object.prototype.hasOwnProperty.call(se,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?Kt(se[_e],ue[_e],P,ne,_e.slice(6),"setPaintProperty"):Nt(se[_e],ue[_e])||cn(P,{command:"setLayerProperty",args:[ne,_e,ue[_e]]}))}else cn(P,{command:"removeLayer",args:[ne]}),Ne=W[W.lastIndexOf(ne)+1],cn(P,{command:"addLayer",args:[ue,Ne]})})(w,n.layers,s)}catch(d){console.warn("Unable to compute style diff:",d),s=[{command:"setStyle",args:[n]}]}return s},y.bM=function(a){const n=[],s=a.id;return s===void 0&&n.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&n.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},y.bN=uo,y.bO=Na,y.bP=class extends Zn{constructor(a,n){super(a,n),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},y.bQ=Yi,y.bR=class extends Zn{constructor(a,n){super(a,n),this.current=Lh}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let n=1;n<16;n++)if(a[n]!==this.current[n]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},y.bS=ss,y.bT=class extends Zn{constructor(a,n){super(a,n),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},y.bU=class extends Zn{constructor(a,n){super(a,n),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},y.bV=gt,y.bW=function(a,n){var s=Math.sin(n),d=Math.cos(n);return a[0]=d,a[1]=s,a[2]=0,a[3]=-s,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},y.bX=function(a,n,s){var d=n[0],g=n[1],w=n[2];return a[0]=d*s[0]+g*s[3]+w*s[6],a[1]=d*s[1]+g*s[4]+w*s[7],a[2]=d*s[2]+g*s[5]+w*s[8],a},y.bY=function(a,n,s,d,g,w,S){var A=1/(n-s),P=1/(d-g),D=1/(w-S);return a[0]=-2*A,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*P,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*D,a[11]=0,a[12]=(n+s)*A,a[13]=(g+d)*P,a[14]=(S+w)*D,a[15]=1,a},y.bZ=class extends Zn{constructor(a,n){super(a,n),this.current=new Array}set(a){if(a!=this.current){this.current=a;const n=new Float32Array(4*a.length);for(let s=0;s<a.length;s++)n[4*s]=a[s].r,n[4*s+1]=a[s].g,n[4*s+2]=a[s].b,n[4*s+3]=a[s].a;this.gl.uniform4fv(this.location,n)}}},y.b_=class extends Zn{constructor(a,n){super(a,n),this.current=new Array}set(a){if(a!=this.current){this.current=a;const n=new Float32Array(a);this.gl.uniform1fv(this.location,n)}}},y.ba=function(){return new Float64Array(16)},y.bb=function(a,n,s){const d=new Float64Array(4);return st(d,a,n-90,s),d},y.bc=function(a,n,s,d){var g,w,S,A,P,D=n[0],N=n[1],j=n[2],q=n[3],W=s[0],X=s[1],ne=s[2],se=s[3];return(w=D*W+N*X+j*ne+q*se)<0&&(w=-w,W=-W,X=-X,ne=-ne,se=-se),1-w>je?(g=Math.acos(w),S=Math.sin(g),A=Math.sin((1-d)*g)/S,P=Math.sin(d*g)/S):(A=1-d,P=d),a[0]=A*D+P*W,a[1]=A*N+P*X,a[2]=A*j+P*ne,a[3]=A*q+P*se,a},y.bd=function(a){const n=new Float64Array(9);var s,d,g,w,S,A,P,D,N,j,q,W,X,ne,se,ue,Ne,_e;j=(g=(d=a)[0])*(P=g+g),q=(w=d[1])*P,X=(S=d[2])*P,ne=S*(D=w+w),ue=(A=d[3])*P,Ne=A*D,_e=A*(N=S+S),(s=n)[0]=1-(W=w*D)-(se=S*N),s[3]=q-_e,s[6]=X+Ne,s[1]=q+_e,s[4]=1-j-se,s[7]=ne-ue,s[2]=X-Ne,s[5]=ne+ue,s[8]=1-j-W;const Ae=Ns(-Math.asin(Ht(n[2],-1,1)));let Ze,et;return Math.hypot(n[5],n[8])<.001?(Ze=0,et=-Ns(Math.atan2(n[3],n[4]))):(Ze=Ns(n[5]===0&&n[8]===0?0:Math.atan2(n[5],n[8])),et=Ns(n[1]===0&&n[0]===0?0:Math.atan2(n[1],n[0]))),{roll:Ze,pitch:Ae+90,bearing:et}},y.be=function(a,n){return a.roll==n.roll&&a.pitch==n.pitch&&a.bearing==n.bearing},y.bf=on,y.bg=Ui,y.bh=Hu,y.bi=Ms,y.bj=os,y.bk=Ot,y.bl=Mt,y.bm=xi,y.bn=function(a,n,s,d,g){return Ot(d,g,Ht((a-n)/(s-n),0,1))},y.bo=ut,y.bp=function(){return new Float64Array(3)},y.bq=function(a,n,s,d){return a[0]=n[0]+s[0]*d,a[1]=n[1]+s[1]*d,a[2]=n[2]+s[2]*d,a},y.br=st,y.bs=function(a,n,s){var d=s[0],g=s[1],w=s[2],S=s[3],A=n[0],P=n[1],D=n[2],N=g*D-w*P,j=w*A-d*D,q=d*P-g*A;return a[0]=A+S*(N+=N)+g*(q+=q)-w*(j+=j),a[1]=P+S*j+w*N-d*q,a[2]=D+S*q+d*j-g*N,a},y.bt=function(a,n,s){const d=(g=[a[0],a[1],a[2],n[0],n[1],n[2],s[0],s[1],s[2]])[0]*((N=g[8])*(S=g[4])-(A=g[5])*(D=g[7]))+g[1]*(-N*(w=g[3])+A*(P=g[6]))+g[2]*(D*w-S*P);var g,w,S,A,P,D,N;if(d===0)return null;const j=Me([],[n[0],n[1],n[2]],[s[0],s[1],s[2]]),q=Me([],[s[0],s[1],s[2]],[a[0],a[1],a[2]]),W=Me([],[a[0],a[1],a[2]],[n[0],n[1],n[2]]),X=Oe([],j,-a[3]);return ye(X,X,Oe([],q,-n[3])),ye(X,X,Oe([],W,-s[3])),Oe(X,X,1/d),X},y.bu=nu,y.bv=function(){return new Float64Array(4)},y.bw=function(a,n,s,d){var g=[],w=[];return g[0]=n[0]-s[0],g[1]=n[1]-s[1],g[2]=n[2]-s[2],w[0]=g[0]*Math.cos(d)-g[1]*Math.sin(d),w[1]=g[0]*Math.sin(d)+g[1]*Math.cos(d),w[2]=g[2],a[0]=w[0]+s[0],a[1]=w[1]+s[1],a[2]=w[2]+s[2],a},y.bx=function(a,n,s,d){var g=[],w=[];return g[0]=n[0]-s[0],g[1]=n[1]-s[1],g[2]=n[2]-s[2],w[0]=g[0],w[1]=g[1]*Math.cos(d)-g[2]*Math.sin(d),w[2]=g[1]*Math.sin(d)+g[2]*Math.cos(d),a[0]=w[0]+s[0],a[1]=w[1]+s[1],a[2]=w[2]+s[2],a},y.by=function(a,n,s,d){var g=[],w=[];return g[0]=n[0]-s[0],g[1]=n[1]-s[1],g[2]=n[2]-s[2],w[0]=g[2]*Math.sin(d)+g[0]*Math.cos(d),w[1]=g[1],w[2]=g[2]*Math.cos(d)-g[0]*Math.sin(d),a[0]=w[0]+s[0],a[1]=w[1]+s[1],a[2]=w[2]+s[2],a},y.bz=function(a,n,s){var d=Math.sin(s),g=Math.cos(s),w=n[0],S=n[1],A=n[2],P=n[3],D=n[8],N=n[9],j=n[10],q=n[11];return n!==a&&(a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=w*g-D*d,a[1]=S*g-N*d,a[2]=A*g-j*d,a[3]=P*g-q*d,a[8]=w*d+D*g,a[9]=S*d+N*g,a[10]=A*d+j*g,a[11]=P*d+q*g,a},y.c=Pe,y.c0=cf,y.c1=class extends _{},y.c2=sl,y.c3=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.c4=Em,y.c5=function(a,n,s){var d=n[0],g=n[1],w=n[2],S=s[3]*d+s[7]*g+s[11]*w+s[15];return a[0]=(s[0]*d+s[4]*g+s[8]*w+s[12])/(S=S||1),a[1]=(s[1]*d+s[5]*g+s[9]*w+s[13])/S,a[2]=(s[2]*d+s[6]*g+s[10]*w+s[14])/S,a},y.c6=class extends Jo{},y.c7=class extends ${},y.c8=function(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]&&a[4]===n[4]&&a[5]===n[5]&&a[6]===n[6]&&a[7]===n[7]&&a[8]===n[8]&&a[9]===n[9]&&a[10]===n[10]&&a[11]===n[11]&&a[12]===n[12]&&a[13]===n[13]&&a[14]===n[14]&&a[15]===n[15]},y.c9=function(a,n){var s=a[0],d=a[1],g=a[2],w=a[3],S=a[4],A=a[5],P=a[6],D=a[7],N=a[8],j=a[9],q=a[10],W=a[11],X=a[12],ne=a[13],se=a[14],ue=a[15],Ne=n[0],_e=n[1],Ae=n[2],Ze=n[3],et=n[4],dt=n[5],At=n[6],bt=n[7],Ct=n[8],Ut=n[9],xt=n[10],Tt=n[11],at=n[12],Xt=n[13],en=n[14],jt=n[15];return Math.abs(s-Ne)<=je*Math.max(1,Math.abs(s),Math.abs(Ne))&&Math.abs(d-_e)<=je*Math.max(1,Math.abs(d),Math.abs(_e))&&Math.abs(g-Ae)<=je*Math.max(1,Math.abs(g),Math.abs(Ae))&&Math.abs(w-Ze)<=je*Math.max(1,Math.abs(w),Math.abs(Ze))&&Math.abs(S-et)<=je*Math.max(1,Math.abs(S),Math.abs(et))&&Math.abs(A-dt)<=je*Math.max(1,Math.abs(A),Math.abs(dt))&&Math.abs(P-At)<=je*Math.max(1,Math.abs(P),Math.abs(At))&&Math.abs(D-bt)<=je*Math.max(1,Math.abs(D),Math.abs(bt))&&Math.abs(N-Ct)<=je*Math.max(1,Math.abs(N),Math.abs(Ct))&&Math.abs(j-Ut)<=je*Math.max(1,Math.abs(j),Math.abs(Ut))&&Math.abs(q-xt)<=je*Math.max(1,Math.abs(q),Math.abs(xt))&&Math.abs(W-Tt)<=je*Math.max(1,Math.abs(W),Math.abs(Tt))&&Math.abs(X-at)<=je*Math.max(1,Math.abs(X),Math.abs(at))&&Math.abs(ne-Xt)<=je*Math.max(1,Math.abs(ne),Math.abs(Xt))&&Math.abs(se-en)<=je*Math.max(1,Math.abs(se),Math.abs(en))&&Math.abs(ue-jt)<=je*Math.max(1,Math.abs(ue),Math.abs(jt))},y.cA=function(a,n){J.REGISTERED_PROTOCOLS[a]=n},y.cB=function(a){delete J.REGISTERED_PROTOCOLS[a]},y.cC=function(a,n){const s={};for(let g=0;g<a.length;g++){const w=n&&n[a[g].id]||Nd(a[g]);n&&(n[a[g].id]=w);let S=s[w];S||(S=s[w]=[]),S.push(a[g])}const d=[];for(const g in s)d.push(s[g]);return d},y.cD=Dt,y.cE=wp,y.cF=dg,y.cG=Km,y.cH=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Wt/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const n=a.bucket.layers[0],s=n.layout,d=n._unevaluatedLayout._values,g={layoutIconSize:d["icon-size"].possiblyEvaluate(new Jn(a.bucket.zoom+1),a.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new Jn(a.bucket.zoom+1),a.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new Jn(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:N}=a.bucket.textSizeData;g.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Jn(D),a.canonical),d["text-size"].possiblyEvaluate(new Jn(N),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:N}=a.bucket.iconSizeData;g.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Jn(D),a.canonical),d["icon-size"].possiblyEvaluate(new Jn(N),a.canonical)]}const w=s.get("text-line-height")*Pr,S=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",A=s.get("text-keep-upright"),P=s.get("text-size");for(const D of a.bucket.features){const N=s.get("text-font").evaluate(D,{},a.canonical).join(","),j=P.evaluate(D,{},a.canonical),q=g.layoutTextSize.evaluate(D,{},a.canonical),W=g.layoutIconSize.evaluate(D,{},a.canonical),X={horizontal:{},vertical:void 0},ne=D.text;let se,ue=[0,0];if(ne){const Ae=ne.toString(),Ze=s.get("text-letter-spacing").evaluate(D,{},a.canonical)*Pr,et=Mh(Ae)?Ze:0,dt=s.get("text-anchor").evaluate(D,{},a.canonical),At=ny(n,D,a.canonical);if(!At){const xt=s.get("text-radial-offset").evaluate(D,{},a.canonical);ue=xt?gg(dt,[xt*Pr,su]):s.get("text-offset").evaluate(D,{},a.canonical).map((Tt=>Tt*Pr))}let bt=S?"center":s.get("text-justify").evaluate(D,{},a.canonical);const Ct=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(D,{},a.canonical)*Pr:1/0,Ut=()=>{a.bucket.allowVerticalPlacement&&ju(Ae)&&(X.vertical=hf(ne,a.glyphMap,a.glyphPositions,a.imagePositions,N,Ct,w,dt,"left",et,ue,y.ao.vertical,!0,q,j))};if(!S&&At){const xt=new Set;if(bt==="auto")for(let at=0;at<At.values.length;at+=2)xt.add(_g(At.values[at]));else xt.add(bt);let Tt=!1;for(const at of xt)if(!X.horizontal[at])if(Tt)X.horizontal[at]=X.horizontal[0];else{const Xt=hf(ne,a.glyphMap,a.glyphPositions,a.imagePositions,N,Ct,w,"center",at,et,ue,y.ao.horizontal,!1,q,j);Xt&&(X.horizontal[at]=Xt,Tt=Xt.positionedLines.length===1)}Ut()}else{bt==="auto"&&(bt=_g(dt));const xt=hf(ne,a.glyphMap,a.glyphPositions,a.imagePositions,N,Ct,w,dt,bt,et,ue,y.ao.horizontal,!1,q,j);xt&&(X.horizontal[bt]=xt),Ut(),ju(Ae)&&S&&A&&(X.vertical=hf(ne,a.glyphMap,a.glyphPositions,a.imagePositions,N,Ct,w,dt,bt,et,ue,y.ao.vertical,!1,q,j))}}let Ne=!1;if(D.icon&&D.icon.name){const Ae=a.imageMap[D.icon.name];Ae&&(se=eh(a.imagePositions[D.icon.name],s.get("icon-offset").evaluate(D,{},a.canonical),s.get("icon-anchor").evaluate(D,{},a.canonical)),Ne=!!Ae.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=Ne:a.bucket.sdfIcons!==Ne&&Pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==a.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const _e=ry(X.horizontal)||X.vertical;a.bucket.iconsInText=!!_e&&_e.iconsInText,(_e||se)&&Ov(a.bucket,D,X,se,a.imageMap,g,q,W,ue,Ne,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},y.cI=af,y.cJ=ko,y.cK=Gn,y.cL=O_,y.cM=Gm,y.cN=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},y.cO=function(a,n,s,d,g){return h(this,void 0,void 0,(function*(){if(Je())try{return yield Wi(a,n,s,d,g)}catch{}return(function(w,S,A,P,D){const N=w.width,j=w.height;Yr&&ho||(Yr=new OffscreenCanvas(N,j),ho=Yr.getContext("2d",{willReadFrequently:!0})),Yr.width=N,Yr.height=j,ho.drawImage(w,0,0,N,j);const q=ho.getImageData(S,A,P,D);return ho.clearRect(0,0,N,j),q.data})(a,n,s,d,g)}))},y.cP=ir,y.cQ=O,y.cR=Lm,y.cS=Vl,y.cT=Eo,y.cU=function(a,n){const s=new Map;if(a!=null)if(a.type==="Feature")s.set(Yh(a,n),a);else for(const d of a.features)s.set(Yh(d,n),d);return s},y.cV=function(a,n){if(a==null)return!0;if(a.type==="Feature")return Yh(a,n)!=null;if(a.type==="FeatureCollection"){const s=new Set;for(const d of a.features){const g=Yh(d,n);if(g==null||s.has(g))return!1;s.add(g)}return!0}return!1},y.cW=function(a,n,s){var d,g,w,S;if(n.removeAll&&a.clear(),n.remove)for(const A of n.remove)a.delete(A);if(n.add)for(const A of n.add){const P=Yh(A,s);P!=null&&a.set(P,A)}if(n.update)for(const A of n.update){let P=a.get(A.id);if(P==null)continue;const D=!A.removeAllProperties&&(((d=A.removeProperties)===null||d===void 0?void 0:d.length)>0||((g=A.addOrUpdateProperties)===null||g===void 0?void 0:g.length)>0);if((A.newGeometry||A.removeAllProperties||D)&&(P=Object.assign({},P),a.set(A.id,P),D&&(P.properties=Object.assign({},P.properties))),A.newGeometry&&(P.geometry=A.newGeometry),A.removeAllProperties)P.properties={};else if(((w=A.removeProperties)===null||w===void 0?void 0:w.length)>0)for(const N of A.removeProperties)Object.prototype.hasOwnProperty.call(P.properties,N)&&delete P.properties[N];if(((S=A.addOrUpdateProperties)===null||S===void 0?void 0:S.length)>0)for(const{key:N,value:j}of A.addOrUpdateProperties)P.properties[N]=j}},y.cX=to,y.ca=function(a,n){return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a},y.cb=a=>a.type==="symbol",y.cc=a=>a.type==="circle",y.cd=a=>a.type==="heatmap",y.ce=a=>a.type==="line",y.cf=a=>a.type==="fill",y.cg=a=>a.type==="fill-extrusion",y.ch=a=>a.type==="hillshade",y.ci=a=>a.type==="color-relief",y.cj=a=>a.type==="raster",y.ck=a=>a.type==="background",y.cl=a=>a.type==="custom",y.cm=qt,y.cn=function(a,n,s){const d=Zt(n.x-s.x,n.y-s.y),g=Zt(a.x-s.x,a.y-s.y);var w,S;return Ns(Math.atan2(d[0]*g[1]-d[1]*g[0],(w=d)[0]*(S=g)[0]+w[1]*S[1]))},y.co=An,y.cp=function(a,n){return Ki[n]&&(a instanceof MouseEvent||a instanceof WheelEvent)},y.cq=function(a,n){return gs[n]&&"touches"in a},y.cr=function(a){return gs[a]||Ki[a]},y.cs=function(a,n,s){var d=n[0],g=n[1];return a[0]=s[0]*d+s[4]*g+s[12],a[1]=s[1]*d+s[5]*g+s[13],a},y.ct=function(a,n){const{x:s,y:d}=Rr.fromLngLat(n);return!(a<0||a>25||d<0||d>=1||s<0||s>=1)},y.cu=function(a,n){return a[0]=n[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=n[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},y.cv=class extends ki{},y.cw=ay,y.cy=function(a){return a.message===qr},y.cz=me,y.d=Fe,y.e=On,y.f=a=>h(void 0,void 0,void 0,(function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(n)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),y.g=Q,y.h=a=>new Promise(((n,s)=>{const d=new Image;d.onload=()=>{n(d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame((()=>{d.src=di}))},d.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(a)],{type:"image/png"});d.src=a.byteLength?URL.createObjectURL(g):di})),y.i=Ls,y.j=(a,n)=>ke(On(a,{type:"json"}),n),y.k=ot,y.l=mt,y.m=ke,y.n=(a,n)=>ke(On(a,{type:"arrayBuffer"}),n),y.o=function(a){return new Gm(a).readFields(Mv,[])},y.p=Qu,y.q=jh,y.r=Br,y.s=xa,y.t=Pn,y.u=vn,y.v=Re,y.w=Pi,y.x=Ja,y.y=$c,y.z=Jl})),f("worker",["./shared"],(function(y){class h{constructor(J,Q){this.keyCache={},J&&this.replace(J,Q)}replace(J,Q){this._layerConfigs={},this._layers={},this.update(J,[],Q)}update(J,Q,re){for(const xe of J){this._layerConfigs[xe.id]=xe;const ke=this._layers[xe.id]=y.bJ(xe,re);ke._featureFilter=y.aa(ke.filter,re),this.keyCache[xe.id]&&delete this.keyCache[xe.id]}for(const xe of Q)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const me=y.cC(Object.values(this._layerConfigs),this.keyCache);for(const xe of me){const ke=xe.map((zt=>this._layers[zt.id])),Fe=ke[0];if(Fe.visibility==="none")continue;const Le=Fe.source||"";let nt=this.familiesBySource[Le];nt||(nt=this.familiesBySource[Le]={});const mt=Fe.sourceLayer||"_geojsonTileLayer";let ot=nt[mt];ot||(ot=nt[mt]=[]),ot.push(ke)}}}class M{constructor(J){const Q={},re=[];for(const Fe in J){const Le=J[Fe],nt=Q[Fe]={};for(const mt in Le){const ot=Le[+mt];if(!ot||ot.bitmap.width===0||ot.bitmap.height===0)continue;const zt={x:0,y:0,w:ot.bitmap.width+2,h:ot.bitmap.height+2};re.push(zt),nt[mt]={rect:zt,metrics:ot.metrics}}}const{w:me,h:xe}=y.p(re),ke=new y.q({width:me||1,height:xe||1});for(const Fe in J){const Le=J[Fe];for(const nt in Le){const mt=Le[+nt];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const ot=Q[Fe][nt].rect;y.q.copy(mt.bitmap,ke,{x:0,y:0},{x:ot.x+1,y:ot.y+1},mt.bitmap)}}this.image=ke,this.positions=Q}}y.cD("GlyphAtlas",M);class O{constructor(J){this.tileID=new y.Z(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[]}parse(J,Q,re,me,xe){return y._(this,void 0,void 0,(function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new y.a8;const ke=new y.cE(Object.keys(J.layers).sort()),Fe=new y.cF(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const Le={},nt={featureIndex:Fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re,subdivisionGranularity:xe},mt=Q.familiesBySource[this.source];for(const Kt in mt){const rn=J.layers[Kt];if(!rn)continue;rn.version===1&&y.w(`Vector tile source "${this.source}" layer "${Kt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fi=ke.encode(Kt),yt=[];for(let er=0;er<rn.length;er++){const Ni=rn.feature(er),Lr=Fe.getId(Ni,Kt);yt.push({feature:Ni,id:Lr,index:er,sourceLayerIndex:fi})}for(const er of mt[Kt]){const Ni=er[0];Ni.source!==this.source&&y.w(`layer.source = ${Ni.source} does not equal this.source = ${this.source}`),Ni.minzoom&&this.zoom<Math.floor(Ni.minzoom)||Ni.maxzoom&&this.zoom>=Ni.maxzoom||Ni.visibility!=="none"&&(V(er,this.zoom,re),(Le[Ni.id]=Ni.createBucket({index:Fe.bucketLayerIDs.length,layers:er,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fi,sourceID:this.source})).populate(yt,nt,this.tileID.canonical),Fe.bucketLayerIDs.push(er.map((Lr=>Lr.id))))}}const ot=y.bN(nt.glyphDependencies,(Kt=>Object.keys(Kt).map(Number)));this.inFlightDependencies.forEach((Kt=>Kt?.abort())),this.inFlightDependencies=[];let zt=Promise.resolve({});if(Object.keys(ot).length){const Kt=new AbortController;this.inFlightDependencies.push(Kt),zt=me.sendAsync({type:"GG",data:{stacks:ot,source:this.source,tileID:this.tileID,type:"glyphs"}},Kt)}const Re=Object.keys(nt.iconDependencies);let nn=Promise.resolve({});if(Re.length){const Kt=new AbortController;this.inFlightDependencies.push(Kt),nn=me.sendAsync({type:"GI",data:{icons:Re,source:this.source,tileID:this.tileID,type:"icons"}},Kt)}const _n=Object.keys(nt.patternDependencies);let Nt=Promise.resolve({});if(_n.length){const Kt=new AbortController;this.inFlightDependencies.push(Kt),Nt=me.sendAsync({type:"GI",data:{icons:_n,source:this.source,tileID:this.tileID,type:"patterns"}},Kt)}const[cn,Yn,vi]=yield Promise.all([zt,nn,Nt]),or=new M(cn),ei=new y.cG(Yn,vi);for(const Kt in Le){const rn=Le[Kt];rn instanceof y.a9?(V(rn.layers,this.zoom,re),y.cH({bucket:rn,glyphMap:cn,glyphPositions:or.positions,imageMap:Yn,imagePositions:ei.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:nt.subdivisionGranularity})):rn.hasPattern&&(rn instanceof y.cI||rn instanceof y.cJ||rn instanceof y.cK)&&(V(rn.layers,this.zoom,re),rn.addFeatures(nt,this.tileID.canonical,ei.patternPositions))}return this.status="done",{buckets:Object.values(Le).filter((Kt=>!Kt.isEmpty())),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:or.image,imageAtlas:ei,glyphMap:this.returnDependencies?cn:null,iconMap:this.returnDependencies?Yn:null,glyphPositions:this.returnDependencies?or.positions:null}}))}}function V(Pe,J,Q){const re=new y.F(J);for(const me of Pe)me.recalculate(re,Q)}class K{constructor(J,Q,re){this.actor=J,this.layerIndex=Q,this.availableImages=re,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(J,Q){return y._(this,void 0,void 0,(function*(){const re=yield y.n(J.request,Q);try{return{vectorTile:new y.cL(new y.cM(re.data)),rawData:re.data,cacheControl:re.cacheControl,expires:re.expires}}catch(me){const xe=new Uint8Array(re.data);let ke=`Unable to parse the tile at ${J.request.url}, `;throw ke+=xe[0]===31&&xe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${me.message}`,new Error(ke)}}))}loadTile(J){return y._(this,void 0,void 0,(function*(){const Q=J.uid,re=!!(J&&J.request&&J.request.collectResourceTiming)&&new y.cN(J.request),me=new O(J);this.loading[Q]=me;const xe=new AbortController;me.abort=xe;try{const ke=yield this.loadVectorTile(J,xe);if(delete this.loading[Q],!ke)return null;const Fe=ke.rawData,Le={};ke.expires&&(Le.expires=ke.expires),ke.cacheControl&&(Le.cacheControl=ke.cacheControl);const nt={};if(re){const ot=re.finish();ot&&(nt.resourceTiming=JSON.parse(JSON.stringify(ot)))}me.vectorTile=ke.vectorTile;const mt=me.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity);this.loaded[Q]=me,this.fetching[Q]={rawTileData:Fe,cacheControl:Le,resourceTiming:nt};try{const ot=yield mt;return y.e({rawTileData:Fe.slice(0)},ot,Le,nt)}finally{delete this.fetching[Q]}}catch(ke){throw delete this.loading[Q],me.status="done",this.loaded[Q]=me,ke}}))}reloadTile(J){return y._(this,void 0,void 0,(function*(){const Q=J.uid;if(!this.loaded||!this.loaded[Q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const re=this.loaded[Q];if(re.showCollisionBoxes=J.showCollisionBoxes,re.status==="parsing"){const me=yield re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity);let xe;if(this.fetching[Q]){const{rawTileData:ke,cacheControl:Fe,resourceTiming:Le}=this.fetching[Q];delete this.fetching[Q],xe=y.e({rawTileData:ke.slice(0)},me,Fe,Le)}else xe=me;return xe}if(re.status==="done"&&re.vectorTile)return re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity)}))}abortTile(J){return y._(this,void 0,void 0,(function*(){const Q=this.loading,re=J.uid;Q&&Q[re]&&Q[re].abort&&(Q[re].abort.abort(),delete Q[re])}))}removeTile(J){return y._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[J.uid]&&delete this.loaded[J.uid]}))}}class ee{constructor(){this.loaded={}}loadTile(J){return y._(this,void 0,void 0,(function*(){const{uid:Q,encoding:re,rawImageData:me,redFactor:xe,greenFactor:ke,blueFactor:Fe,baseShift:Le}=J,nt=me.width+2,mt=me.height+2,ot=y.b(me)?new y.R({width:nt,height:mt},yield y.cO(me,-1,-1,nt,mt)):me,zt=new y.cP(Q,ot,re,xe,ke,Fe,Le);return this.loaded=this.loaded||{},this.loaded[Q]=zt,zt}))}removeTile(J){const Q=this.loaded,re=J.uid;Q&&Q[re]&&delete Q[re]}}var Y,ve,Ce=(function(){if(ve)return Y;function Pe(Q,re){if(Q.length!==0){J(Q[0],re);for(var me=1;me<Q.length;me++)J(Q[me],!re)}}function J(Q,re){for(var me=0,xe=0,ke=0,Fe=Q.length,Le=Fe-1;ke<Fe;Le=ke++){var nt=(Q[ke][0]-Q[Le][0])*(Q[Le][1]+Q[ke][1]),mt=me+nt;xe+=Math.abs(me)>=Math.abs(nt)?me-mt+nt:nt-mt+me,me=mt}me+xe>=0!=!!re&&Q.reverse()}return ve=1,Y=function Q(re,me){var xe,ke=re&&re.type;if(ke==="FeatureCollection")for(xe=0;xe<re.features.length;xe++)Q(re.features[xe],me);else if(ke==="GeometryCollection")for(xe=0;xe<re.geometries.length;xe++)Q(re.geometries[xe],me);else if(ke==="Feature")Q(re.geometry,me);else if(ke==="Polygon")Pe(re.coordinates,me);else if(ke==="MultiPolygon")for(xe=0;xe<re.coordinates.length;xe++)Pe(re.coordinates[xe],me);return re}})(),Ee=y.cQ(Ce);class Je extends y.cS{constructor(J,Q){super(new y.cM,0,Q,[],[]),this.feature=J,this.type=J.type,this.properties=J.tags?J.tags:{},"id"in J&&(typeof J.id=="string"?this.id=parseInt(J.id,10):typeof J.id!="number"||isNaN(J.id)||(this.id=J.id))}loadGeometry(){const J=[],Q=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const re of Q){const me=[];for(const xe of re)me.push(new y.P(xe[0],xe[1]));J.push(me)}return J}}class je extends y.cR{constructor(J,Q){super(new y.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=Q?Q.version:1,this.extent=Q?Q.extent:4096,this.length=J.length,this.features=J}feature(J){return new Je(this.features[J],this.extent)}}function He(Pe,J){J.writeVarintField(15,Pe.version||1),J.writeStringField(1,Pe.name||""),J.writeVarintField(5,Pe.extent||4096);const Q={keys:[],values:[],keycache:{},valuecache:{}};for(let xe=0;xe<Pe.length;xe++)Q.feature=Pe.feature(xe),J.writeMessage(2,gt,Q);const re=Q.keys;for(const xe of re)J.writeStringField(3,xe);const me=Q.values;for(const xe of me)J.writeMessage(4,ye,xe)}function gt(Pe,J){if(!Pe.feature)return;const Q=Pe.feature;Q.id!==void 0&&J.writeVarintField(1,Q.id),J.writeMessage(2,St,Pe),J.writeVarintField(3,Q.type),J.writeMessage(4,pe,Q)}function St(Pe,J){for(const Q in Pe.feature?.properties){let re=Pe.feature.properties[Q],me=Pe.keycache[Q];if(re===null)continue;me===void 0&&(Pe.keys.push(Q),me=Pe.keys.length-1,Pe.keycache[Q]=me),J.writeVarint(me),typeof re!="string"&&typeof re!="boolean"&&typeof re!="number"&&(re=JSON.stringify(re));const xe=typeof re+":"+re;let ke=Pe.valuecache[xe];ke===void 0&&(Pe.values.push(re),ke=Pe.values.length-1,Pe.valuecache[xe]=ke),J.writeVarint(ke)}}function Pt(Pe,J){return(J<<3)+(7&Pe)}function Se(Pe){return Pe<<1^Pe>>31}function pe(Pe,J){const Q=Pe.loadGeometry(),re=Pe.type;let me=0,xe=0;for(const ke of Q){let Fe=1;re===1&&(Fe=ke.length),J.writeVarint(Pt(1,Fe));const Le=re===3?ke.length-1:ke.length;for(let nt=0;nt<Le;nt++){nt===1&&re!==1&&J.writeVarint(Pt(2,Le-1));const mt=ke[nt].x-me,ot=ke[nt].y-xe;J.writeVarint(Se(mt)),J.writeVarint(Se(ot)),me+=mt,xe+=ot}Pe.type===3&&J.writeVarint(Pt(7,1))}}function ye(Pe,J){const Q=typeof Pe;Q==="string"?J.writeStringField(1,Pe):Q==="boolean"?J.writeBooleanField(7,Pe):Q==="number"&&(Pe%1!=0?J.writeDoubleField(3,Pe):Pe<0?J.writeSVarintField(6,Pe):J.writeVarintField(5,Pe))}const Oe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pe=>Pe},Me=Math.fround||(Ve=new Float32Array(1),Pe=>(Ve[0]=+Pe,Ve[0]));var Ve;class Te{constructor(J){this.options=Object.assign(Object.create(Oe),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:Q,minZoom:re,maxZoom:me}=this.options;Q&&console.time("total time");const xe=`prepare ${J.length} points`;Q&&console.time(xe),this.points=J;const ke=[];for(let Le=0;Le<J.length;Le++){const nt=J[Le];if(!nt.geometry)continue;const[mt,ot]=nt.geometry.coordinates,zt=Me(st(mt)),Re=Me(kt(ot));ke.push(zt,Re,1/0,Le,-1,1),this.options.reduce&&ke.push(0)}let Fe=this.trees[me+1]=this._createTree(ke);Q&&console.timeEnd(xe);for(let Le=me;Le>=re;Le--){const nt=+Date.now();Fe=this.trees[Le]=this._createTree(this._cluster(Fe,Le)),Q&&console.log("z%d: %d clusters in %dms",Le,Fe.numItems,+Date.now()-nt)}return Q&&console.timeEnd("total time"),this}getClusters(J,Q){let re=((J[0]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,J[1]));let xe=J[2]===180?180:((J[2]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)re=-180,xe=180;else if(re>xe){const ot=this.getClusters([re,me,180,ke],Q),zt=this.getClusters([-180,me,xe,ke],Q);return ot.concat(zt)}const Fe=this.trees[this._limitZoom(Q)],Le=Fe.range(st(re),kt(ke),st(xe),kt(me)),nt=Fe.data,mt=[];for(const ot of Le){const zt=this.stride*ot;mt.push(nt[zt+5]>1?dn(nt,zt,this.clusterProps):this.points[nt[zt+3]])}return mt}getChildren(J){const Q=this._getOriginId(J),re=this._getOriginZoom(J),me="No cluster with the specified id.",xe=this.trees[re];if(!xe)throw new Error(me);const ke=xe.data;if(Q*this.stride>=ke.length)throw new Error(me);const Fe=this.options.radius/(this.options.extent*Math.pow(2,re-1)),Le=xe.within(ke[Q*this.stride],ke[Q*this.stride+1],Fe),nt=[];for(const mt of Le){const ot=mt*this.stride;ke[ot+4]===J&&nt.push(ke[ot+5]>1?dn(ke,ot,this.clusterProps):this.points[ke[ot+3]])}if(nt.length===0)throw new Error(me);return nt}getLeaves(J,Q,re){const me=[];return this._appendLeaves(me,J,Q=Q||10,re=re||0,0),me}getTile(J,Q,re){const me=this.trees[this._limitZoom(J)],xe=Math.pow(2,J),{extent:ke,radius:Fe}=this.options,Le=Fe/ke,nt=(re-Le)/xe,mt=(re+1+Le)/xe,ot={features:[]};return this._addTileFeatures(me.range((Q-Le)/xe,nt,(Q+1+Le)/xe,mt),me.data,Q,re,xe,ot),Q===0&&this._addTileFeatures(me.range(1-Le/xe,nt,1,mt),me.data,xe,re,xe,ot),Q===xe-1&&this._addTileFeatures(me.range(0,nt,Le/xe,mt),me.data,-1,re,xe,ot),ot.features.length?ot:null}getClusterExpansionZoom(J){let Q=this._getOriginZoom(J)-1;for(;Q<=this.options.maxZoom;){const re=this.getChildren(J);if(Q++,re.length!==1)break;J=re[0].properties.cluster_id}return Q}_appendLeaves(J,Q,re,me,xe){const ke=this.getChildren(Q);for(const Fe of ke){const Le=Fe.properties;if(Le&&Le.cluster?xe+Le.point_count<=me?xe+=Le.point_count:xe=this._appendLeaves(J,Le.cluster_id,re,me,xe):xe<me?xe++:J.push(Fe),J.length===re)break}return xe}_createTree(J){const Q=new y.aI(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<J.length;re+=this.stride)Q.add(J[re],J[re+1]);return Q.finish(),Q.data=J,Q}_addTileFeatures(J,Q,re,me,xe,ke){for(const Fe of J){const Le=Fe*this.stride,nt=Q[Le+5]>1;let mt,ot,zt;if(nt)mt=In(Q,Le,this.clusterProps),ot=Q[Le],zt=Q[Le+1];else{const _n=this.points[Q[Le+3]];mt=_n.properties;const[Nt,cn]=_n.geometry.coordinates;ot=st(Nt),zt=kt(cn)}const Re={type:1,geometry:[[Math.round(this.options.extent*(ot*xe-re)),Math.round(this.options.extent*(zt*xe-me))]],tags:mt};let nn;nn=nt||this.options.generateId?Q[Le+3]:this.points[Q[Le+3]].id,nn!==void 0&&(Re.id=nn),ke.features.push(Re)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,Q){const{radius:re,extent:me,reduce:xe,minPoints:ke}=this.options,Fe=re/(me*Math.pow(2,Q)),Le=J.data,nt=[],mt=this.stride;for(let ot=0;ot<Le.length;ot+=mt){if(Le[ot+2]<=Q)continue;Le[ot+2]=Q;const zt=Le[ot],Re=Le[ot+1],nn=J.within(Le[ot],Le[ot+1],Fe),_n=Le[ot+5];let Nt=_n;for(const cn of nn){const Yn=cn*mt;Le[Yn+2]>Q&&(Nt+=Le[Yn+5])}if(Nt>_n&&Nt>=ke){let cn,Yn=zt*_n,vi=Re*_n,or=-1;const ei=(ot/mt<<5)+(Q+1)+this.points.length;for(const Kt of nn){const rn=Kt*mt;if(Le[rn+2]<=Q)continue;Le[rn+2]=Q;const fi=Le[rn+5];Yn+=Le[rn]*fi,vi+=Le[rn+1]*fi,Le[rn+4]=ei,xe&&(cn||(cn=this._map(Le,ot,!0),or=this.clusterProps.length,this.clusterProps.push(cn)),xe(cn,this._map(Le,rn)))}Le[ot+4]=ei,nt.push(Yn/Nt,vi/Nt,1/0,ei,-1,Nt),xe&&nt.push(or)}else{for(let cn=0;cn<mt;cn++)nt.push(Le[ot+cn]);if(Nt>1)for(const cn of nn){const Yn=cn*mt;if(!(Le[Yn+2]<=Q)){Le[Yn+2]=Q;for(let vi=0;vi<mt;vi++)nt.push(Le[Yn+vi])}}}}return nt}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,Q,re){if(J[Q+5]>1){const ke=this.clusterProps[J[Q+6]];return re?Object.assign({},ke):ke}const me=this.points[J[Q+3]].properties,xe=this.options.map(me);return re&&xe===me?Object.assign({},xe):xe}}function dn(Pe,J,Q){return{type:"Feature",id:Pe[J+3],properties:In(Pe,J,Q),geometry:{type:"Point",coordinates:[(re=Pe[J],360*(re-.5)),Zt(Pe[J+1])]}};var re}function In(Pe,J,Q){const re=Pe[J+5],me=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,xe=Pe[J+6],ke=xe===-1?{}:Object.assign({},Q[xe]);return Object.assign(ke,{cluster:!0,cluster_id:Pe[J+3],point_count:re,point_count_abbreviated:me})}function st(Pe){return Pe/360+.5}function kt(Pe){const J=Math.sin(Pe*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function Zt(Pe){const J=(180-360*Pe)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function Wt(Pe,J,Q,re){let me=re;const xe=J+(Q-J>>1);let ke,Fe=Q-J;const Le=Pe[J],nt=Pe[J+1],mt=Pe[Q],ot=Pe[Q+1];for(let zt=J+3;zt<Q;zt+=3){const Re=De(Pe[zt],Pe[zt+1],Le,nt,mt,ot);if(Re>me)ke=zt,me=Re;else if(Re===me){const nn=Math.abs(zt-xe);nn<Fe&&(ke=zt,Fe=nn)}}me>re&&(ke-J>3&&Wt(Pe,J,ke,re),Pe[ke+2]=me,Q-ke>3&&Wt(Pe,ke,Q,re))}function De(Pe,J,Q,re,me,xe){let ke=me-Q,Fe=xe-re;if(ke!==0||Fe!==0){const Le=((Pe-Q)*ke+(J-re)*Fe)/(ke*ke+Fe*Fe);Le>1?(Q=me,re=xe):Le>0&&(Q+=ke*Le,re+=Fe*Le)}return ke=Pe-Q,Fe=J-re,ke*ke+Fe*Fe}function ut(Pe,J,Q,re){const me={id:Pe??null,type:J,geometry:Q,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")Ot(me,Q);else if(J==="Polygon")Ot(me,Q[0]);else if(J==="MultiLineString")for(const xe of Q)Ot(me,xe);else if(J==="MultiPolygon")for(const xe of Q)Ot(me,xe[0]);return me}function Ot(Pe,J){for(let Q=0;Q<J.length;Q+=3)Pe.minX=Math.min(Pe.minX,J[Q]),Pe.minY=Math.min(Pe.minY,J[Q+1]),Pe.maxX=Math.max(Pe.maxX,J[Q]),Pe.maxY=Math.max(Pe.maxY,J[Q+1])}function Mt(Pe,J,Q,re){if(!J.geometry)return;const me=J.geometry.coordinates;if(me&&me.length===0)return;const xe=J.geometry.type,ke=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let Fe=[],Le=J.id;if(Q.promoteId?Le=J.properties[Q.promoteId]:Q.generateId&&(Le=re||0),xe==="Point")qt(me,Fe);else if(xe==="MultiPoint")for(const nt of me)qt(nt,Fe);else if(xe==="LineString")An(me,Fe,ke,!1);else if(xe==="MultiLineString"){if(Q.lineMetrics){for(const nt of me)Fe=[],An(nt,Fe,ke,!1),Pe.push(ut(Le,"LineString",Fe,J.properties));return}Ht(me,Fe,ke,!1)}else if(xe==="Polygon")Ht(me,Fe,ke,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const nt of J.geometry.geometries)Mt(Pe,{id:Le,geometry:nt,properties:J.properties},Q,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of me){const mt=[];Ht(nt,mt,ke,!0),Fe.push(mt)}}Pe.push(ut(Le,xe,Fe,J.properties))}function qt(Pe,J){J.push(Ji(Pe[0]),On(Pe[1]),0)}function An(Pe,J,Q,re){let me,xe,ke=0;for(let Le=0;Le<Pe.length;Le++){const nt=Ji(Pe[Le][0]),mt=On(Pe[Le][1]);J.push(nt,mt,0),Le>0&&(ke+=re?(me*mt-nt*xe)/2:Math.sqrt(Math.pow(nt-me,2)+Math.pow(mt-xe,2))),me=nt,xe=mt}const Fe=J.length-3;J[2]=1,Wt(J,0,Fe,Q),J[Fe+2]=1,J.size=Math.abs(ke),J.start=0,J.end=J.size}function Ht(Pe,J,Q,re){for(let me=0;me<Pe.length;me++){const xe=[];An(Pe[me],xe,Q,re),J.push(xe)}}function Ji(Pe){return Pe/360+.5}function On(Pe){const J=Math.sin(Pe*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function ar(Pe,J,Q,re,me,xe,ke,Fe){if(re/=J,xe>=(Q/=J)&&ke<re)return Pe;if(ke<Q||xe>=re)return null;const Le=[];for(const nt of Pe){const mt=nt.geometry;let ot=nt.type;const zt=me===0?nt.minX:nt.minY,Re=me===0?nt.maxX:nt.maxY;if(zt>=Q&&Re<re){Le.push(nt);continue}if(Re<Q||zt>=re)continue;let nn=[];if(ot==="Point"||ot==="MultiPoint")uo(mt,nn,Q,re,me);else if(ot==="LineString")Na(mt,nn,Q,re,me,!1,Fe.lineMetrics);else if(ot==="MultiLineString")hi(mt,nn,Q,re,me,!1);else if(ot==="Polygon")hi(mt,nn,Q,re,me,!0);else if(ot==="MultiPolygon")for(const _n of mt){const Nt=[];hi(_n,Nt,Q,re,me,!0),Nt.length&&nn.push(Nt)}if(nn.length){if(Fe.lineMetrics&&ot==="LineString"){for(const _n of nn)Le.push(ut(nt.id,ot,_n,nt.tags));continue}ot!=="LineString"&&ot!=="MultiLineString"||(nn.length===1?(ot="LineString",nn=nn[0]):ot="MultiLineString"),ot!=="Point"&&ot!=="MultiPoint"||(ot=nn.length===3?"Point":"MultiPoint"),Le.push(ut(nt.id,ot,nn,nt.tags))}}return Le.length?Le:null}function uo(Pe,J,Q,re,me){for(let xe=0;xe<Pe.length;xe+=3){const ke=Pe[xe+me];ke>=Q&&ke<=re&&Pi(J,Pe[xe],Pe[xe+1],Pe[xe+2])}}function Na(Pe,J,Q,re,me,xe,ke){let Fe=zr(Pe);const Le=me===0?Xs:Ls;let nt,mt,ot=Pe.start;for(let Nt=0;Nt<Pe.length-3;Nt+=3){const cn=Pe[Nt],Yn=Pe[Nt+1],vi=Pe[Nt+2],or=Pe[Nt+3],ei=Pe[Nt+4],Kt=me===0?cn:Yn,rn=me===0?or:ei;let fi=!1;ke&&(nt=Math.sqrt(Math.pow(cn-or,2)+Math.pow(Yn-ei,2))),Kt<Q?rn>Q&&(mt=Le(Fe,cn,Yn,or,ei,Q),ke&&(Fe.start=ot+nt*mt)):Kt>re?rn<re&&(mt=Le(Fe,cn,Yn,or,ei,re),ke&&(Fe.start=ot+nt*mt)):Pi(Fe,cn,Yn,vi),rn<Q&&Kt>=Q&&(mt=Le(Fe,cn,Yn,or,ei,Q),fi=!0),rn>re&&Kt<=re&&(mt=Le(Fe,cn,Yn,or,ei,re),fi=!0),!xe&&fi&&(ke&&(Fe.end=ot+nt*mt),J.push(Fe),Fe=zr(Pe)),ke&&(ot+=nt)}let zt=Pe.length-3;const Re=Pe[zt],nn=Pe[zt+1],_n=me===0?Re:nn;_n>=Q&&_n<=re&&Pi(Fe,Re,nn,Pe[zt+2]),zt=Fe.length-3,xe&&zt>=3&&(Fe[zt]!==Fe[0]||Fe[zt+1]!==Fe[1])&&Pi(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&J.push(Fe)}function zr(Pe){const J=[];return J.size=Pe.size,J.start=Pe.start,J.end=Pe.end,J}function hi(Pe,J,Q,re,me,xe){for(const ke of Pe)Na(ke,J,Q,re,me,xe,!1)}function Pi(Pe,J,Q,re){Pe.push(J,Q,re)}function Xs(Pe,J,Q,re,me,xe){const ke=(xe-J)/(re-J);return Pi(Pe,xe,Q+(me-Q)*ke,1),ke}function Ls(Pe,J,Q,re,me,xe){const ke=(xe-Q)/(me-Q);return Pi(Pe,J+(re-J)*ke,xe,1),ke}function br(Pe,J){const Q=[];for(let re=0;re<Pe.length;re++){const me=Pe[re],xe=me.type;let ke;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")ke=Ys(me.geometry,J);else if(xe==="MultiLineString"||xe==="Polygon"){ke=[];for(const Fe of me.geometry)ke.push(Ys(Fe,J))}else if(xe==="MultiPolygon"){ke=[];for(const Fe of me.geometry){const Le=[];for(const nt of Fe)Le.push(Ys(nt,J));ke.push(Le)}}Q.push(ut(me.id,xe,ke,me.tags))}return Q}function Ys(Pe,J){const Q=[];Q.size=Pe.size,Pe.start!==void 0&&(Q.start=Pe.start,Q.end=Pe.end);for(let re=0;re<Pe.length;re+=3)Q.push(Pe[re]+J,Pe[re+1],Pe[re+2]);return Q}function di(Pe,J){if(Pe.transformed)return Pe;const Q=1<<Pe.z,re=Pe.x,me=Pe.y;for(const xe of Pe.features){const ke=xe.geometry,Fe=xe.type;if(xe.geometry=[],Fe===1)for(let Le=0;Le<ke.length;Le+=2)xe.geometry.push(Wi(ke[Le],ke[Le+1],J,Q,re,me));else for(let Le=0;Le<ke.length;Le++){const nt=[];for(let mt=0;mt<ke[Le].length;mt+=2)nt.push(Wi(ke[Le][mt],ke[Le][mt+1],J,Q,re,me));xe.geometry.push(nt)}}return Pe.transformed=!0,Pe}function Wi(Pe,J,Q,re,me,xe){return[Math.round(Q*(Pe*re-me)),Math.round(Q*(J*re-xe))]}function Yr(Pe,J,Q,re,me){const xe=J===me.maxZoom?0:me.tolerance/((1<<J)*me.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:Pe.length,source:null,x:Q,y:re,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Fe of Pe)ho(ke,Fe,xe,me);return ke}function ho(Pe,J,Q,re){const me=J.geometry,xe=J.type,ke=[];if(Pe.minX=Math.min(Pe.minX,J.minX),Pe.minY=Math.min(Pe.minY,J.minY),Pe.maxX=Math.max(Pe.maxX,J.maxX),Pe.maxY=Math.max(Pe.maxY,J.maxY),xe==="Point"||xe==="MultiPoint")for(let Fe=0;Fe<me.length;Fe+=3)ke.push(me[Fe],me[Fe+1]),Pe.numPoints++,Pe.numSimplified++;else if(xe==="LineString")xa(ke,me,Pe,Q,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let Fe=0;Fe<me.length;Fe++)xa(ke,me[Fe],Pe,Q,xe==="Polygon",Fe===0);else if(xe==="MultiPolygon")for(let Fe=0;Fe<me.length;Fe++){const Le=me[Fe];for(let nt=0;nt<Le.length;nt++)xa(ke,Le[nt],Pe,Q,!0,nt===0)}if(ke.length){let Fe=J.tags||null;if(xe==="LineString"&&re.lineMetrics){Fe={};for(const nt in J.tags)Fe[nt]=J.tags[nt];Fe.mapbox_clip_start=me.start/me.size,Fe.mapbox_clip_end=me.end/me.size}const Le={geometry:ke,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:Fe};J.id!==null&&(Le.id=J.id),Pe.features.push(Le)}}function xa(Pe,J,Q,re,me,xe){const ke=re*re;if(re>0&&J.size<(me?ke:re))return void(Q.numPoints+=J.length/3);const Fe=[];for(let Le=0;Le<J.length;Le+=3)(re===0||J[Le+2]>ke)&&(Q.numSimplified++,Fe.push(J[Le],J[Le+1])),Q.numPoints++;me&&(function(Le,nt){let mt=0;for(let ot=0,zt=Le.length,Re=zt-2;ot<zt;Re=ot,ot+=2)mt+=(Le[ot]-Le[Re])*(Le[ot+1]+Le[Re+1]);if(mt>0===nt)for(let ot=0,zt=Le.length;ot<zt/2;ot+=2){const Re=Le[ot],nn=Le[ot+1];Le[ot]=Le[zt-2-ot],Le[ot+1]=Le[zt-1-ot],Le[zt-2-ot]=Re,Le[zt-1-ot]=nn}})(Fe,xe),Pe.push(Fe)}const Bo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ns{constructor(J,Q){const re=(Q=this.options=(function(xe,ke){for(const Fe in ke)xe[Fe]=ke[Fe];return xe})(Object.create(Bo),Q)).debug;if(re&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let me=(function(xe,ke){const Fe=[];if(xe.type==="FeatureCollection")for(let Le=0;Le<xe.features.length;Le++)Mt(Fe,xe.features[Le],ke,Le);else Mt(Fe,xe.type==="Feature"?xe:{geometry:xe},ke);return Fe})(J,Q);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),me=(function(xe,ke){const Fe=ke.buffer/ke.extent;let Le=xe;const nt=ar(xe,1,-1-Fe,Fe,0,-1,2,ke),mt=ar(xe,1,1-Fe,2+Fe,0,-1,2,ke);return(nt||mt)&&(Le=ar(xe,1,-Fe,1+Fe,0,-1,2,ke)||[],nt&&(Le=br(nt,1).concat(Le)),mt&&(Le=Le.concat(br(mt,-1)))),Le})(me,Q),me.length&&this.splitTile(me,0,0,0),re&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,Q,re,me,xe,ke,Fe){const Le=[J,Q,re,me],nt=this.options,mt=nt.debug;for(;Le.length;){me=Le.pop(),re=Le.pop(),Q=Le.pop(),J=Le.pop();const ot=1<<Q,zt=gs(Q,re,me);let Re=this.tiles[zt];if(!Re&&(mt>1&&console.time("creation"),Re=this.tiles[zt]=Yr(J,Q,re,me,nt),this.tileCoords.push({z:Q,x:re,y:me}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,re,me,Re.numFeatures,Re.numPoints,Re.numSimplified),console.timeEnd("creation"));const fi=`z${Q}`;this.stats[fi]=(this.stats[fi]||0)+1,this.total++}if(Re.source=J,xe==null){if(Q===nt.indexMaxZoom||Re.numPoints<=nt.indexMaxPoints)continue}else{if(Q===nt.maxZoom||Q===xe)continue;if(xe!=null){const fi=xe-Q;if(re!==ke>>fi||me!==Fe>>fi)continue}}if(Re.source=null,J.length===0)continue;mt>1&&console.time("clipping");const nn=.5*nt.buffer/nt.extent,_n=.5-nn,Nt=.5+nn,cn=1+nn;let Yn=null,vi=null,or=null,ei=null,Kt=ar(J,ot,re-nn,re+Nt,0,Re.minX,Re.maxX,nt),rn=ar(J,ot,re+_n,re+cn,0,Re.minX,Re.maxX,nt);J=null,Kt&&(Yn=ar(Kt,ot,me-nn,me+Nt,1,Re.minY,Re.maxY,nt),vi=ar(Kt,ot,me+_n,me+cn,1,Re.minY,Re.maxY,nt),Kt=null),rn&&(or=ar(rn,ot,me-nn,me+Nt,1,Re.minY,Re.maxY,nt),ei=ar(rn,ot,me+_n,me+cn,1,Re.minY,Re.maxY,nt),rn=null),mt>1&&console.timeEnd("clipping"),Le.push(Yn||[],Q+1,2*re,2*me),Le.push(vi||[],Q+1,2*re,2*me+1),Le.push(or||[],Q+1,2*re+1,2*me),Le.push(ei||[],Q+1,2*re+1,2*me+1)}}getTile(J,Q,re){J=+J,Q=+Q,re=+re;const me=this.options,{extent:xe,debug:ke}=me;if(J<0||J>24)return null;const Fe=1<<J,Le=gs(J,Q=Q+Fe&Fe-1,re);if(this.tiles[Le])return di(this.tiles[Le],xe);ke>1&&console.log("drilling down to z%d-%d-%d",J,Q,re);let nt,mt=J,ot=Q,zt=re;for(;!nt&&mt>0;)mt--,ot>>=1,zt>>=1,nt=this.tiles[gs(mt,ot,zt)];return nt&&nt.source?(ke>1&&(console.log("found parent tile z%d-%d-%d",mt,ot,zt),console.time("drilling down")),this.splitTile(nt.source,mt,ot,zt,J,Q,re),ke>1&&console.timeEnd("drilling down"),this.tiles[Le]?di(this.tiles[Le],xe):null):null}}function gs(Pe,J,Q){return 32*((1<<Pe)*Q+J)+Pe}class Ki extends K{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(J,Q){return y._(this,void 0,void 0,(function*(){const re=J.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const me=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!me)return null;const xe=new je(me.features,{version:2,extent:y.$});let ke=(function(Fe){const Le=new y.cM;return(function(nt,mt){for(const ot in nt.layers)mt.writeMessage(3,He,nt.layers[ot])})(Fe,Le),Le.finish()})(xe);return ke.byteOffset===0&&ke.byteLength===ke.buffer.byteLength||(ke=new Uint8Array(ke)),{vectorTile:xe,rawData:ke.buffer}}))}loadData(J){return y._(this,void 0,void 0,(function*(){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.abort();const re=!!(J&&J.request&&J.request.collectResourceTiming)&&new y.cN(J.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest);const me=yield this._pendingData;this._geoJSONIndex=J.cluster?new Te((function({superclusterOptions:ke,clusterProperties:Fe}){if(!Fe||!ke)return ke;const Le={},nt={},mt={accumulated:null,zoom:0},ot={properties:null},zt=Object.keys(Fe);for(const Re of zt){const[nn,_n]=Fe[Re],Nt=y.cT(_n),cn=y.cT(typeof nn=="string"?[nn,["accumulated"],["get",Re]]:nn);Le[Re]=Nt.value,nt[Re]=cn.value}return ke.map=Re=>{ot.properties=Re;const nn={};for(const _n of zt)nn[_n]=Le[_n].evaluate(mt,ot);return nn},ke.reduce=(Re,nn)=>{ot.properties=nn;for(const _n of zt)mt.accumulated=Re[_n],Re[_n]=nt[_n].evaluate(mt,ot)},ke})(J)).load(me.features):(function(ke,Fe){return new Ns(ke,Fe)})(me,J.geojsonVtOptions),this.loaded={};const xe={data:me};if(re){const ke=re.finish();ke&&(xe.resourceTiming={},xe.resourceTiming[J.source]=JSON.parse(JSON.stringify(ke)))}return xe}catch(me){if(delete this._pendingRequest,y.cy(me))return{abandoned:!0};throw me}}))}getData(){return y._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(J){const Q=this.loaded;return Q&&Q[J.uid]?super.reloadTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,Q){return y._(this,void 0,void 0,(function*(){let re=yield this.loadGeoJSON(J,Q);if(delete this._pendingRequest,typeof re!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(Ee(re,!0),J.filter){const me=y.cT(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(me.result==="error")throw new Error(me.value.map((ke=>`${ke.key}: ${ke.message}`)).join(", "));re={type:"FeatureCollection",features:re.features.filter((ke=>me.value.evaluate({zoom:0},ke)))}}return re}))}loadGeoJSON(J,Q){return y._(this,void 0,void 0,(function*(){const{promoteId:re}=J;if(J.request){const me=yield y.j(J.request,Q);return this._dataUpdateable=y.cV(me.data,re)?y.cU(me.data,re):void 0,me.data}if(typeof J.data=="string")try{const me=JSON.parse(J.data);return this._dataUpdateable=y.cV(me,re)?y.cU(me,re):void 0,me}catch{throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`)}if(!J.dataDiff)throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${J.source}`);return y.cW(this._dataUpdateable,J.dataDiff,re),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(J){return y._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}class qr{constructor(J){this.self=J,this.actor=new y.J(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(Q,re)=>{if(this.externalWorkerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.externalWorkerSourceTypes[Q]=re},this.self.addProtocol=y.cA,this.self.removeProtocol=y.cB,this.self.registerRTLTextPlugin=Q=>{y.cX.setMethods(Q)},this.actor.registerMessageHandler("LDT",((Q,re)=>this._getDEMWorkerSource(Q,re.source).loadTile(re))),this.actor.registerMessageHandler("RDT",((Q,re)=>y._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(Q,re.source).removeTile(re)})))),this.actor.registerMessageHandler("GCEZ",((Q,re)=>y._(this,void 0,void 0,(function*(){return this._getWorkerSource(Q,re.type,re.source).getClusterExpansionZoom(re)})))),this.actor.registerMessageHandler("GCC",((Q,re)=>y._(this,void 0,void 0,(function*(){return this._getWorkerSource(Q,re.type,re.source).getClusterChildren(re)})))),this.actor.registerMessageHandler("GCL",((Q,re)=>y._(this,void 0,void 0,(function*(){return this._getWorkerSource(Q,re.type,re.source).getClusterLeaves(re)})))),this.actor.registerMessageHandler("LD",((Q,re)=>this._getWorkerSource(Q,re.type,re.source).loadData(re))),this.actor.registerMessageHandler("GD",((Q,re)=>this._getWorkerSource(Q,re.type,re.source).getData())),this.actor.registerMessageHandler("LT",((Q,re)=>this._getWorkerSource(Q,re.type,re.source).loadTile(re))),this.actor.registerMessageHandler("RT",((Q,re)=>this._getWorkerSource(Q,re.type,re.source).reloadTile(re))),this.actor.registerMessageHandler("AT",((Q,re)=>this._getWorkerSource(Q,re.type,re.source).abortTile(re))),this.actor.registerMessageHandler("RMT",((Q,re)=>this._getWorkerSource(Q,re.type,re.source).removeTile(re))),this.actor.registerMessageHandler("RS",((Q,re)=>y._(this,void 0,void 0,(function*(){if(!this.workerSources[Q]||!this.workerSources[Q][re.type]||!this.workerSources[Q][re.type][re.source])return;const me=this.workerSources[Q][re.type][re.source];delete this.workerSources[Q][re.type][re.source],me.removeSource!==void 0&&me.removeSource(re)})))),this.actor.registerMessageHandler("RM",(Q=>y._(this,void 0,void 0,(function*(){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q],this.globalStates.delete(Q)})))),this.actor.registerMessageHandler("SR",((Q,re)=>y._(this,void 0,void 0,(function*(){this.referrer=re})))),this.actor.registerMessageHandler("SRPS",((Q,re)=>this._syncRTLPluginState(Q,re))),this.actor.registerMessageHandler("IS",((Q,re)=>y._(this,void 0,void 0,(function*(){this.self.importScripts(re)})))),this.actor.registerMessageHandler("SI",((Q,re)=>this._setImages(Q,re))),this.actor.registerMessageHandler("UL",((Q,re)=>y._(this,void 0,void 0,(function*(){this._getLayerIndex(Q).update(re.layers,re.removedIds,this._getGlobalState(Q))})))),this.actor.registerMessageHandler("UGS",((Q,re)=>y._(this,void 0,void 0,(function*(){const me=this._getGlobalState(Q);for(const xe in re)me[xe]=re[xe]})))),this.actor.registerMessageHandler("SL",((Q,re)=>y._(this,void 0,void 0,(function*(){this._getLayerIndex(Q).replace(re,this._getGlobalState(Q))}))))}_getGlobalState(J){let Q=this.globalStates.get(J);return Q||(Q={},this.globalStates.set(J,Q)),Q}_setImages(J,Q){return y._(this,void 0,void 0,(function*(){this.availableImages[J]=Q;for(const re in this.workerSources[J]){const me=this.workerSources[J][re];for(const xe in me)me[xe].availableImages=Q}}))}_syncRTLPluginState(J,Q){return y._(this,void 0,void 0,(function*(){return yield y.cX.syncState(Q,this.self.importScripts)}))}_getAvailableImages(J){let Q=this.availableImages[J];return Q||(Q=[]),Q}_getLayerIndex(J){let Q=this.layerIndexes[J];return Q||(Q=this.layerIndexes[J]=new h),Q}_getWorkerSource(J,Q,re){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][Q]||(this.workerSources[J][Q]={}),!this.workerSources[J][Q][re]){const me={sendAsync:(xe,ke)=>(xe.targetMapId=J,this.actor.sendAsync(xe,ke))};switch(Q){case"vector":this.workerSources[J][Q][re]=new K(me,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][Q][re]=new Ki(me,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][Q][re]=new this.externalWorkerSourceTypes[Q](me,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][Q][re]}_getDEMWorkerSource(J,Q){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][Q]||(this.demWorkerSources[J][Q]=new ee),this.demWorkerSources[J][Q]}}return y.i(self)&&(self.worker=new qr(self)),qr})),f("index",["exports","./shared"],(function(y,h){var M="5.7.3";function O(){var b=new h.A(4);return h.A!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b}let V,K;const ee={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(b,t,o){const p=requestAnimationFrame((T=>{_(),t(T)})),{unsubscribe:_}=h.s(b.signal,"abort",(()=>{_(),cancelAnimationFrame(p),o(h.c())}),!1)},frameAsync(b){return new Promise(((t,o)=>{this.frame(b,t,o)}))},getImageData(b,t=0){return this.getImageCanvasContext(b).getImageData(-t,-t,b.width+2*t,b.height+2*t)},getImageCanvasContext(b){const t=window.document.createElement("canvas"),o=t.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return t.width=b.width,t.height=b.height,o.drawImage(b,0,0,b.width,b.height),o},resolveURL:b=>(V||(V=document.createElement("a")),V.href=b,V.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)}};class Y{static testProp(t){if(!Y.docStyle)return t[0];for(let o=0;o<t.length;o++)if(t[o]in Y.docStyle)return t[o];return t[0]}static create(t,o,p){const _=window.document.createElement(t);return o!==void 0&&(_.className=o),p&&p.appendChild(_),_}static createNS(t,o){return window.document.createElementNS(t,o)}static disableDrag(){Y.docStyle&&Y.selectProp&&(Y.userSelect=Y.docStyle[Y.selectProp],Y.docStyle[Y.selectProp]="none")}static enableDrag(){Y.docStyle&&Y.selectProp&&(Y.docStyle[Y.selectProp]=Y.userSelect)}static setTransform(t,o){t.style[Y.transformProp]=o}static addEventListener(t,o,p,_={}){t.addEventListener(o,p,"passive"in _?_:_.capture)}static removeEventListener(t,o,p,_={}){t.removeEventListener(o,p,"passive"in _?_:_.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Y.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Y.suppressClickInternal,!0)}),0)}static getScale(t){const o=t.getBoundingClientRect();return{x:o.width/t.offsetWidth||1,y:o.height/t.offsetHeight||1,boundingClientRect:o}}static getPoint(t,o,p){const _=o.boundingClientRect;return new h.P((p.clientX-_.left)/o.x-t.clientLeft,(p.clientY-_.top)/o.y-t.clientTop)}static mousePos(t,o){const p=Y.getScale(t);return Y.getPoint(t,p,o)}static touchPos(t,o){const p=[],_=Y.getScale(t);for(let T=0;T<o.length;T++)p.push(Y.getPoint(t,_,o[T]));return p}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const o=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),p=o.querySelectorAll("script");for(const _ of p)_.remove();return Y.clean(o),o.innerHTML}static isPossiblyDangerous(t,o){const p=o.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!p.includes("javascript:")&&!p.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const o=t.children;for(const p of o)Y.removeAttributes(p),Y.clean(p)}static removeAttributes(t){for(const{name:o,value:p}of t.attributes)Y.isPossiblyDangerous(o,p)&&t.removeAttribute(o)}}Y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Y.selectProp=Y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Y.transformProp=Y.testProp(["transform","WebkitTransform"]);const ve={supported:!1,testSupport:function(b){!Je&&Ee&&(je?He(b):Ce=b)}};let Ce,Ee,Je=!1,je=!1;function He(b){const t=b.createTexture();b.bindTexture(b.TEXTURE_2D,t);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,Ee),b.isContextLost())return;ve.supported=!0}catch{}b.deleteTexture(t),Je=!0}var gt;typeof document<"u"&&(Ee=document.createElement("img"),Ee.onload=()=>{Ce&&He(Ce),Ce=null,je=!0},Ee.onerror=()=>{Je=!0,Ce=null},Ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(b){let t,o,p,_;b.resetRequestQueue=()=>{t=[],o=0,p=0,_={}},b.addThrottleControl=k=>{const L=p++;return _[L]=k,L},b.removeThrottleControl=k=>{delete _[k],E()},b.getImage=(k,L,B=!0)=>new Promise((($,F)=>{ve.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),h.e(k,{type:"image"}),t.push({abortController:L,requestParameters:k,supportImageRefresh:B,state:"queued",onError:Z=>{F(Z)},onSuccess:Z=>{$(Z)}}),E()}));const T=k=>h._(this,void 0,void 0,(function*(){k.state="running";const{requestParameters:L,supportImageRefresh:B,onError:$,onSuccess:F,abortController:Z}=k,te=B===!1&&!h.i(self)&&!h.g(L.url)&&(!L.headers||Object.keys(L.headers).reduce(((ce,he)=>ce&&he==="accept"),!0));o++;const ae=te?R(L,Z):h.m(L,Z);try{const ce=yield ae;delete k.abortController,k.state="completed",ce.data instanceof HTMLImageElement||h.b(ce.data)?F(ce):ce.data&&F({data:yield(oe=ce.data,typeof createImageBitmap=="function"?h.f(oe):h.h(oe)),cacheControl:ce.cacheControl,expires:ce.expires})}catch(ce){delete k.abortController,$(ce)}finally{o--,E()}var oe})),E=()=>{const k=(()=>{for(const L of Object.keys(_))if(_[L]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let L=o;L<k&&t.length>0;L++){const B=t.shift();B.abortController.signal.aborted?L--:T(B)}},R=(k,L)=>new Promise(((B,$)=>{const F=new Image,Z=k.url,te=k.credentials;te&&te==="include"?F.crossOrigin="use-credentials":(te&&te==="same-origin"||!h.d(Z))&&(F.crossOrigin="anonymous"),L.signal.addEventListener("abort",(()=>{F.src="",$(h.c())})),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,B({data:F})},F.onerror=()=>{F.onerror=F.onload=null,L.signal.aborted||$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=Z}))})(gt||(gt={})),gt.resetRequestQueue();class St{constructor(t){this._transformRequestFn=t??null}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Pt(b){const t=[];if(typeof b=="string")t.push({id:"default",url:b});else if(b&&b.length>0){const o=[];for(const{id:p,url:_}of b){const T=`${p}${_}`;o.indexOf(T)===-1&&(o.push(T),t.push({id:p,url:_}))}}return t}function Se(b,t,o){try{const p=new URL(b);return p.pathname+=`${t}${o}`,p.toString()}catch{throw new Error(`Invalid sprite URL "${b}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function pe(b){const{userImage:t}=b;return!!(t&&t.render&&t.render())&&(b.data.replace(new Uint8Array(t.data.buffer)),!0)}class ye extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:o,promiseResolve:p}of this.requestors)p(this._getImagesForIds(o));this.requestors=[]}}getImage(t){const o=this.images[t];if(o&&!o.data&&o.spriteData){const p=o.spriteData;o.data=new h.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),o.spriteData=null}return o}addImage(t,o){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,o)&&(this.images[t]=o)}_validate(t,o){let p=!0;const _=o.data||o.spriteData;return this._validateStretch(o.stretchX,_&&_.width)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(o.stretchY,_&&_.height)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(o.content,o)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,o){if(!t)return!0;let p=0;for(const _ of t){if(_[0]<p||_[1]<_[0]||o<_[1])return!1;p=_[1]}return!0}_validateContent(t,o){if(!t)return!0;if(t.length!==4)return!1;const p=o.spriteData,_=p&&p.width||o.data.width,T=p&&p.height||o.data.height;return!(t[0]<0||_<t[0]||t[1]<0||T<t[1]||t[2]<0||_<t[2]||t[3]<0||T<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,o,p=!0){const _=this.getImage(t);if(p&&(_.data.width!==o.data.width||_.data.height!==o.data.height))throw new Error(`size mismatch between old image (${_.data.width}x${_.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=_.version+1,this.images[t]=o,this.updatedImages[t]=!0}removeImage(t){const o=this.images[t];delete this.images[t],delete this.patterns[t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((o,p)=>{let _=!0;if(!this.isLoaded())for(const T of t)this.images[T]||(_=!1);this.isLoaded()||_?o(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:o})}))}_getImagesForIds(t){const o={};for(const p of t){let _=this.getImage(p);_||(this.fire(new h.l("styleimagemissing",{id:p})),_=this.getImage(p)),_?o[p]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,textFitWidth:_.textFitWidth,textFitHeight:_.textFitHeight,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:h.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:t,height:o}=this.atlasImage;return{width:t,height:o}}getPattern(t){const o=this.patterns[t],p=this.getImage(t);if(!p)return null;if(o&&o.position.version===p.version)return o.position;if(o)o.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},T=new h.I(_,p);this.patterns[t]={bin:_,position:T}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const o=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.T(t,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const T in this.patterns)t.push(this.patterns[T].bin);const{w:o,h:p}=h.p(t),_=this.atlasImage;_.resize({width:o||1,height:p||1});for(const T in this.patterns){const{bin:E}=this.patterns[T],R=E.x+1,k=E.y+1,L=this.getImage(T).data,B=L.width,$=L.height;h.R.copy(L,_,{x:0,y:0},{x:R,y:k},{width:B,height:$}),h.R.copy(L,_,{x:0,y:$-1},{x:R,y:k-1},{width:B,height:1}),h.R.copy(L,_,{x:0,y:0},{x:R,y:k+$},{width:B,height:1}),h.R.copy(L,_,{x:B-1,y:0},{x:R-1,y:k},{width:1,height:$}),h.R.copy(L,_,{x:0,y:0},{x:R+B,y:k},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const o of t){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const p=this.getImage(o);p||h.w(`Image with ID: "${o}" was not found`),pe(p)&&this.updateImage(o,p)}}}const Oe=1e20;function Me(b,t,o,p,_,T,E,R,k){for(let L=t;L<t+p;L++)Ve(b,o*T+L,T,_,E,R,k);for(let L=o;L<o+_;L++)Ve(b,L*T+t,1,p,E,R,k)}function Ve(b,t,o,p,_,T,E){T[0]=0,E[0]=-Oe,E[1]=Oe,_[0]=b[t];for(let R=1,k=0,L=0;R<p;R++){_[R]=b[t+R*o];const B=R*R;do{const $=T[k];L=(_[R]-_[$]+B-$*$)/(R-$)/2}while(L<=E[k]&&--k>-1);k++,T[k]=R,E[k]=L,E[k+1]=Oe}for(let R=0,k=0;R<p;R++){for(;E[k+1]<R;)k++;const L=T[k],B=R-L;b[t+R*o]=_[L]+B*B}}class Te{constructor(t,o,p){this.requestManager=t,this.localIdeographFontFamily=o,this.entries={},this.lang=p}setURL(t){this.url=t}getGlyphs(t){return h._(this,void 0,void 0,(function*(){const o=[];for(const T in t)for(const E of t[T])o.push(this._getAndCacheGlyphsPromise(T,E));const p=yield Promise.all(o),_={};for(const{stack:T,id:E,glyph:R}of p)_[T]||(_[T]={}),_[T][E]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return _}))}_getAndCacheGlyphsPromise(t,o){return h._(this,void 0,void 0,(function*(){let p=this.entries[t];p||(p=this.entries[t]={glyphs:{},requests:{},ranges:{}});let _=p.glyphs[o];if(_!==void 0)return{stack:t,id:o,glyph:_};if(_=this._tinySDF(p,t,o),_)return p.glyphs[o]=_,{stack:t,id:o,glyph:_};const T=Math.floor(o/256);if(256*T>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[T])return{stack:t,id:o,glyph:_};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[T]){const R=Te.loadGlyphRange(t,T,this.url,this.requestManager);p.requests[T]=R}const E=yield p.requests[T];for(const R in E)this._doesCharSupportLocalGlyph(+R)||(p.glyphs[+R]=E[+R]);return p.ranges[T]=!0,{stack:t,id:o,glyph:E[o]||null}}))}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))||h.u["CJK Unified Ideographs"](t)||h.u["Hangul Syllables"](t)||h.u.Hiragana(t)||h.u.Katakana(t)||h.u["CJK Symbols and Punctuation"](t)||h.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,o,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let T=t.tinySDF;if(!T){let R="400";/bold/i.test(o)?R="900":/medium/i.test(o)?R="500":/light/i.test(o)&&(R="200"),T=t.tinySDF=new Te.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:_,fontWeight:R})}const E=T.draw(String.fromCharCode(p));return{id:p,bitmap:new h.q({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}Te.loadGlyphRange=function(b,t,o,p){return h._(this,void 0,void 0,(function*(){const _=256*t,T=_+255,E=p.transformRequest(o.replace("{fontstack}",b).replace("{range}",`${_}-${T}`),"Glyphs"),R=yield h.n(E,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${t}, ${_}-${T}`);const k={};for(const L of h.o(R.data))k[L.id]=L;return k}))},Te.TinySDF=class{constructor({fontSize:b=24,buffer:t=3,radius:o=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:T="normal",fontStyle:E="normal",lang:R=null}={}){this.buffer=t,this.cutoff=p,this.radius=o,this.lang=R;const k=this.size=b+4*t,L=this._createCanvas(k),B=this.ctx=L.getContext("2d",{willReadFrequently:!0});B.font=`${E} ${T} ${b}px ${_}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(b){const t=document.createElement("canvas");return t.width=t.height=b,t}draw(b){const{width:t,actualBoundingBoxAscent:o,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:T}=this.ctx.measureText(b),E=Math.ceil(o),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(T-_))),k=Math.min(this.size-this.buffer,E+Math.ceil(p)),L=R+2*this.buffer,B=k+2*this.buffer,$=Math.max(L*B,0),F=new Uint8ClampedArray($),Z={data:F,width:L,height:B,glyphWidth:R,glyphHeight:k,glyphTop:E,glyphLeft:0,glyphAdvance:t};if(R===0||k===0)return Z;const{ctx:te,buffer:ae,gridInner:oe,gridOuter:ce}=this;this.lang&&(te.lang=this.lang),te.clearRect(ae,ae,R,k),te.fillText(b,ae,ae+E);const he=te.getImageData(ae,ae,R,k);ce.fill(Oe,0,$),oe.fill(0,0,$);for(let ge=0;ge<k;ge++)for(let de=0;de<R;de++){const be=he.data[4*(ge*R+de)+3]/255;if(be===0)continue;const Ie=(ge+ae)*L+de+ae;if(be===1)ce[Ie]=0,oe[Ie]=Oe;else{const fe=.5-be;ce[Ie]=fe>0?fe*fe:0,oe[Ie]=fe<0?fe*fe:0}}Me(ce,0,0,L,B,L,this.f,this.v,this.z),Me(oe,ae,ae,R,k,L,this.f,this.v,this.z);for(let ge=0;ge<$;ge++){const de=Math.sqrt(ce[ge])-Math.sqrt(oe[ge]);F[ge]=Math.round(255-255*(de/this.radius+this.cutoff))}return Z}};class dn{constructor(){this.specification=h.v.light.position}possiblyEvaluate(t,o){return h.B(t.expression.evaluate(o))}interpolate(t,o,p){return{x:h.C.number(t.x,o.x,p),y:h.C.number(t.y,o.y,p),z:h.C.number(t.z,o.z,p)}}}let In;class st extends h.E{constructor(t){super(),In=In||new h.r({anchor:new h.D(h.v.light.anchor),position:new dn,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.t(In,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o={}){if(!this._validate(h.x,t,o))for(const p in t){const _=t[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,p){return(!p||p.validate!==!1)&&h.y(this,t.call(h.z,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}const kt=new h.r({"sky-color":new h.D(h.v.sky["sky-color"]),"horizon-color":new h.D(h.v.sky["horizon-color"]),"fog-color":new h.D(h.v.sky["fog-color"]),"fog-ground-blend":new h.D(h.v.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.v.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.v.sky["atmosphere-blend"])});class Zt extends h.E{constructor(t){super(),this._transitionable=new h.t(kt,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.F(0))}setSky(t,o={}){if(!this._validate(h.G,t,o)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in t){const _=t[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,p={}){return p?.validate!==!1&&h.y(this,t.call(h.z,h.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Wt{constructor(t,o){this.width=t,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,o){const p=t.join(",")+String(o);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(t,o)),this.dashEntry[p]}getDashRanges(t,o,p){const _=[];let T=t.length%2==1?-t[t.length-1]*p:0,E=t[0]*p,R=!0;_.push({left:T,right:E,isDash:R,zeroLength:t[0]===0});let k=t[0];for(let L=1;L<t.length;L++){R=!R;const B=t[L];T=k*p,k+=B,E=k*p,_.push({left:T,right:E,isDash:R,zeroLength:B===0})}return _}addRoundDash(t,o,p){const _=o/2;for(let T=-p;T<=p;T++){const E=this.width*(this.nextRow+p+T);let R=0,k=t[R];for(let L=0;L<this.width;L++){L/k.right>1&&(k=t[++R]);const B=Math.abs(L-k.left),$=Math.abs(L-k.right),F=Math.min(B,$);let Z;const te=T/p*(_+1);if(k.isDash){const ae=_-Math.abs(te);Z=Math.sqrt(F*F+ae*ae)}else Z=_-Math.sqrt(F*F+te*te);this.data[E+L]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(t){for(let R=t.length-1;R>=0;--R){const k=t[R],L=t[R+1];k.zeroLength?t.splice(R,1):L&&L.isDash===k.isDash&&(L.left=k.left,t.splice(R,1))}const o=t[0],p=t[t.length-1];o.isDash===p.isDash&&(o.left=p.left-this.width,p.right=o.right+this.width);const _=this.width*this.nextRow;let T=0,E=t[T];for(let R=0;R<this.width;R++){R/E.right>1&&(E=t[++T]);const k=Math.abs(R-E.left),L=Math.abs(R-E.right),B=Math.min(k,L);this.data[_+R]=Math.max(0,Math.min(255,(E.isDash?B:-B)+128))}}addDash(t,o){const p=o?7:0,_=2*p+1;if(this.nextRow+_>this.height)return h.w("LineAtlas out of space"),null;let T=0;for(let R=0;R<t.length;R++)T+=t[R];if(T!==0){const R=this.width/T,k=this.getDashRanges(t,this.width,R);o?this.addRoundDash(k,R,p):this.addRegularDash(k)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:T};return this.nextRow+=_,this.dirty=!0,E}bind(t){const o=t.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const De="maplibre_preloaded_worker_pool";class ut{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ut.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((o=>{o.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[De]}numActive(){return Object.keys(this.active).length}}const Ot=Math.floor(ee.hardwareConcurrency/2);let Mt,qt;function An(){return Mt||(Mt=new ut),Mt}ut.workerCount=h.H(globalThis)?Math.max(Math.min(Ot,3),1):1;class Ht{constructor(t,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o;const p=this.workerPool.acquire(o);for(let _=0;_<p.length;_++){const T=new h.J(p[_],o);T.name=`Worker ${_}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,o){const p=[];for(const _ of this.actors)p.push(_.sendAsync({type:t,data:o}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((o=>{o.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,o){for(const p of this.actors)p.registerMessageHandler(t,o)}}function Ji(){return qt||(qt=new Ht(An(),h.K),qt.registerMessageHandler("GR",((b,t,o)=>h.m(t,o)))),qt}function On(b,t){const o=h.L();return h.M(o,o,[1,1,0]),h.N(o,o,[.5*b.width,.5*b.height,1]),b.calculatePosMatrix?h.O(o,o,b.calculatePosMatrix(t.toUnwrapped())):o}function ar(b,t,o,p,_,T,E){var R;const k=(function(F,Z,te){if(F)for(const ae of F){const oe=Z[ae];if(oe&&oe.source===te&&oe.type==="fill-extrusion")return!0}else for(const ae in Z){const oe=Z[ae];if(oe.source===te&&oe.type==="fill-extrusion")return!0}return!1})((R=_?.layers)!==null&&R!==void 0?R:null,t,b.id),L=T.maxPitchScaleFactor(),B=b.tilesIn(p,L,k);B.sort(uo);const $=[];for(const F of B)$.push({wrappedTileID:F.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(t,o,b._state,F.queryGeometry,F.cameraQueryGeometry,F.scale,_,T,L,On(b.transform,F.tileID),E?(Z,te)=>E(F.tileID,Z,te):void 0)});return(function(F,Z){for(const te in F)for(const ae of F[te])Na(ae,Z);return F})((function(F){const Z={},te={};for(const ae of F){const oe=ae.queryResults,ce=ae.wrappedTileID,he=te[ce]=te[ce]||{};for(const ge in oe){const de=oe[ge],be=he[ge]=he[ge]||{},Ie=Z[ge]=Z[ge]||[];for(const fe of de)be[fe.featureIndex]||(be[fe.featureIndex]=!0,Ie.push(fe))}}return Z})($),b)}function uo(b,t){const o=b.tileID,p=t.tileID;return o.overscaledZ-p.overscaledZ||o.canonical.y-p.canonical.y||o.wrap-p.wrap||o.canonical.x-p.canonical.x}function Na(b,t){const o=b.feature,p=t.getFeatureState(o.layer["source-layer"],o.id);o.source=o.layer.source,o.layer["source-layer"]&&(o.sourceLayer=o.layer["source-layer"]),o.state=p}function zr(b,t,o){return h._(this,void 0,void 0,(function*(){let p=b;if(b.url?p=(yield h.j(t.transformRequest(b.url,"Source"),o)).data:yield ee.frameAsync(o),!p)return null;const _=h.Q(h.e(p,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(_.vectorLayerIds=p.vector_layers.map((T=>T.id))),_}))}class hi{constructor(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.S?new h.S(t.lng,t.lat):h.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.S?new h.S(t.lng,t.lat):h.S.convert(t),this}extend(t){const o=this._sw,p=this._ne;let _,T;if(t instanceof h.S)_=t,T=t;else{if(!(t instanceof hi))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(hi.convert(t)):this.extend(h.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.S.convert(t)):this;if(_=t._sw,T=t._ne,!_||!T)return this}return o||p?(o.lng=Math.min(_.lng,o.lng),o.lat=Math.min(_.lat,o.lat),p.lng=Math.max(T.lng,p.lng),p.lat=Math.max(T.lat,p.lat)):(this._sw=new h.S(_.lng,_.lat),this._ne=new h.S(T.lng,T.lat)),this}getCenter(){return new h.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.S(this.getWest(),this.getNorth())}getSouthEast(){return new h.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:p}=h.S.convert(t);let _=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&_}static convert(t){return t instanceof hi?t:t&&new hi(t)}static fromLngLat(t,o=0){const p=360*o/40075017,_=p/Math.cos(Math.PI/180*t.lat);return new hi(new h.S(t.lng-_,t.lat-p),new h.S(t.lng+_,t.lat+p))}adjustAntiMeridian(){const t=new h.S(this._sw.lng,this._sw.lat),o=new h.S(this._ne.lng,this._ne.lat);return new hi(t,t.lng>o.lng?new h.S(o.lng+360,o.lat):o)}}class Pi{constructor(t,o,p){this.bounds=hi.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const o=Math.pow(2,t.z),p=Math.floor(h.V(this.bounds.getWest())*o),_=Math.floor(h.U(this.bounds.getNorth())*o),T=Math.ceil(h.V(this.bounds.getEast())*o),E=Math.ceil(h.U(this.bounds.getSouth())*o);return t.x>=p&&t.x<T&&t.y>=_&&t.y<E}}class Xs extends h.E{constructor(t,o,p,_){if(super(),this.id=t,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.Q(o,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield zr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(h.e(this,t),t.bounds&&(this.tileBounds=new Pi(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,this.fire(new h.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(t){return h._(this,void 0,void 0,(function*(){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(o,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};p.request.collectResourceTiming=this._collectResourceTiming;let _="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((T,E)=>{t.reloadPromise={resolve:T,reject:E}}))}else t.actor=this.dispatcher.getActor(),_="LT";t.abortController=new AbortController;try{const T=yield t.actor.sendAsync({type:_,data:p},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,T)}catch(T){if(delete t.abortController,t.aborted)return;if(T&&T.status!==404)throw T;this._afterTileLoadWorkerResponse(t,null)}}))}_afterTileLoadWorkerResponse(t,o){if(o&&o.resourceTiming&&(t.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&t.setExpiryData(o),t.loadVectorData(o,this.map.painter),t.reloadPromise){const p=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(p.resolve).catch(p.reject)}}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Ls extends h.E{constructor(t,o,p,_){super(),this.id=t,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},o),h.e(this,h.Q(o,["url","scheme","tileSize"]))}load(){return h._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield zr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(h.e(this,o),o.bounds&&(this.tileBounds=new Pi(o.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(o){this._tileJSONRequest=null,this._loaded=!0,this.fire(new h.k(o))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return h._(this,void 0,void 0,(function*(){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const p=yield gt.getImage(this.map._requestManager.transformRequest(o,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const _=this.map.painter.context,T=_.gl,E=p.data;t.texture=this.map.painter.getTileTexture(E.width),t.texture?t.texture.update(E,{useMipmap:!0}):(t.texture=new h.T(_,E,T.RGBA,{useMipmap:!0}),t.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class br extends Ls{constructor(t,o,p,_){super(t,o,p,_),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(t){return h._(this,void 0,void 0,(function*(){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(o,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const _=yield gt.getImage(p,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(_&&_.data){const T=_.data;this.map._refreshExpiredTiles&&(_.cacheControl||_.expires)&&t.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const E=h.b(T)&&h.W()?T:yield this.readImageNow(T),R={type:this.type,uid:t.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const k=yield t.actor.sendAsync({type:"LDT",data:R});t.dem=k,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(_){if(delete t.abortController,t.aborted)t.state="unloaded";else if(_)throw t.state="errored",_}}))}readImageNow(t){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.X()){const o=t.width+2,p=t.height+2;try{return new h.R({width:o,height:p},yield h.Y(t,-1,-1,o,p))}catch{}}return ee.getImageData(t,1)}))}_getNeighboringTiles(t){const o=t.canonical,p=Math.pow(2,o.z),_=(o.x-1+p)%p,T=o.x===0?t.wrap-1:t.wrap,E=(o.x+1+p)%p,R=o.x+1===p?t.wrap+1:t.wrap,k={};return k[new h.Z(t.overscaledZ,T,o.z,_,o.y).key]={backfilled:!1},k[new h.Z(t.overscaledZ,R,o.z,E,o.y).key]={backfilled:!1},o.y>0&&(k[new h.Z(t.overscaledZ,T,o.z,_,o.y-1).key]={backfilled:!1},k[new h.Z(t.overscaledZ,t.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},k[new h.Z(t.overscaledZ,R,o.z,E,o.y-1).key]={backfilled:!1}),o.y+1<p&&(k[new h.Z(t.overscaledZ,T,o.z,_,o.y+1).key]={backfilled:!1},k[new h.Z(t.overscaledZ,t.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},k[new h.Z(t.overscaledZ,R,o.z,E,o.y+1).key]={backfilled:!1}),k}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}class Ys extends h.E{constructor(t,o,p,_){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:o.data},this.actor=p.getActor(),this.setEventedParent(_),this._data=o.data,this._options=h.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId,o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(o.buffer!==void 0?o.buffer:128),tolerance:this._pixelsToTileUnits(o.tolerance!==void 0?o.tolerance:.375),extent:h.$,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(o.clusterMaxZoom),minPoints:Math.max(2,o.clusterMinPoints||2),extent:h.$,radius:this._pixelsToTileUnits(o.clusterRadius||50),log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(h.$/this.tileSize)}_getClusterMaxZoom(t){const o=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||h.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${o}"`),o}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._pendingWorkerUpdate={data:t},this._updateWorkerData(),this}updateData(t){return this._pendingWorkerUpdate.diff=h.a0(this._pendingWorkerUpdate.diff,t),this._updateWorkerData(),this}getData(){return h._(this,void 0,void 0,(function*(){const t=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getCoordinatesFromGeometry(t){return t.type==="GeometryCollection"?t.geometries.map((o=>o.coordinates)).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return h._(this,void 0,void 0,(function*(){const t=new hi,o=yield this.getData();let p;switch(o.type){case"FeatureCollection":p=o.features.map((_=>this.getCoordinatesFromGeometry(_.geometry))).flat(1/0);break;case"Feature":p=this.getCoordinatesFromGeometry(o.geometry);break;default:p=this.getCoordinatesFromGeometry(o)}if(p.length==0)return t;for(let _=0;_<p.length-1;_+=2)t.extend([p[_],p[_+1]]);return t}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,o,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:o,offset:p}})}_updateWorkerData(){return h._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:t,diff:o}=this._pendingWorkerUpdate;if(!t&&!o)return void h.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const p=h.e({type:this.type},this.workerOptions);t?(typeof t=="string"?(p.request=this.map._requestManager.transformRequest(ee.resolveURL(t),"Source"),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(t),this._pendingWorkerUpdate.data=void 0):o&&(p.dataDiff=o,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new h.l("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:p});if(this._isUpdatingWorker=!1,this._removed||_.abandoned)return void this.fire(new h.l("dataabort",{dataType:"source"}));this._data=_.data;let T=null;_.resourceTiming&&_.resourceTiming[this.id]&&(T=_.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&T&&T.length>0&&h.e(E,{resourceTiming:T}),this.fire(new h.l("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new h.l("data",Object.assign(Object.assign({},E),{sourceDataType:"content"})))}catch(_){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new h.l("dataabort",{dataType:"source"}));this.fire(new h.k(_))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(t){return h._(this,void 0,void 0,(function*(){const o=t.actor?"RT":"LT";t.actor=this.actor;const p={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const _=yield this.actor.sendAsync({type:o,data:p},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(_,this.map.painter,o==="RT")}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class di extends h.E{constructor(t,o,p,_){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=p,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=o}load(t){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield gt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,t&&(this.coordinates=t),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new h.k(o))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const o=t.map(h.a1.fromLngLat);var p;return this.tileID=(function(_){const T=h.a2.fromPoints(_),E=T.width(),R=T.height(),k=Math.max(E,R),L=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),B=Math.pow(2,L);return new h.a4(L,Math.floor((T.minX+T.maxX)/2*B),Math.floor((T.minY+T.maxY)/2*B))})(o),this.terrainTileRanges=this._getOverlappingTileRanges(o),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=o.map((_=>this.tileID.getTilePoint(_)._round())),this.flippedWindingOrder=((p=this.tileCoords)[1].x-p[0].x)*(p[2].y-p[0].y)-(p[1].y-p[0].y)*(p[2].x-p[0].x)<0,this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,o=t.gl;this.texture||(this.texture=new h.T(t,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let p=!1;for(const _ in this.tiles){const T=this.tiles[_];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,p=!0)}p&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:o,minY:p,maxX:_,maxY:T}=h.a2.fromPoints(t),E={};for(let R=0;R<=h.a3;R++){const k=Math.pow(2,R),L=Math.floor(o*k),B=Math.floor(p*k),$=Math.floor(_*k),F=Math.floor(T*k);E[R]={minTileX:L,minTileY:B,maxTileX:$,maxTileY:F}}return E}}class Wi extends di{constructor(t,o,p,_){super(t,o,p,_),this.roundZoom=!0,this.type="video",this.options=o}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const o of t.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield h.a5(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new h.k(o))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const o=this.video.seekable;t<o.start(0)||t>o.end(0)?this.fire(new h.k(new h.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,o=t.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(t,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let p=!1;for(const _ in this.tiles){const T=this.tiles[_];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,p=!0)}p&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Yr extends di{constructor(t,o,p,_){super(t,o,p,_),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some((T=>!Array.isArray(T)||T.length!==2||T.some((E=>typeof E!="number"))))||this.fire(new h.k(new h.a6(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.k(new h.a6(`sources.${t}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new h.k(new h.a6(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new h.k(new h.a6(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.k(new h.a6(`sources.${t}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,p=o.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.T(o,this.canvas,p.RGBA,{premultiply:!0});let _=!1;for(const T in this.tiles){const E=this.tiles[T];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,_=!0)}_&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const ho={},xa=b=>{switch(b){case"geojson":return Ys;case"image":return di;case"raster":return Ls;case"raster-dem":return br;case"vector":return Xs;case"video":return Wi;case"canvas":return Yr}return ho[b]},Bo="RTLPluginLoaded";class Ns extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ji()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((o=>{throw this.status="error",o}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return h._(this,arguments,void 0,(function*(o,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ee.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.l(Bo))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let gs=null;function Ki(){return gs||(gs=new Ns),gs}class qr{constructor(t,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=h.a7(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const o=t+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,o,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(_,T){const E={};if(!T)return E;for(const R of _){const k=R.layerIds.map((L=>T.getLayer(L))).filter(Boolean);if(k.length!==0){R.layers=k,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map((L=>k.filter((B=>B.id===L))[0])));for(const L of k)E[L.id]=R}}return E})(t.buckets,o?.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const T=this.buckets[_];if(T instanceof h.a9){if(this.hasSymbolBuckets=!0,!p)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const T=this.buckets[_];if(T instanceof h.a9&&T.hasRTLText){this.hasRTLText=!0,Ki().lazyLoad();break}}this.queryPadding=0;for(const _ in this.buckets){const T=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(_).queryRadius(T))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h.a8}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(t)}const o=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new h.T(t,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(t,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,o,p,_,T,E,R,k,L,B,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:T,scale:E,tileSize:this.tileSize,pixelPosMatrix:B,transform:k,params:R,queryPadding:this.queryPadding*L,getElevation:$},t,o,p):{}}querySourceFeatures(t,o){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),T=o&&o.sourceLayer?o.sourceLayer:"",E=_._geojsonTileLayer||_[T];if(!E)return;const R=h.aa(o?.filter,o?.globalState),{z:k,x:L,y:B}=this.tileID.canonical,$={z:k,x:L,y:B};for(let F=0;F<E.length;F++){const Z=E.feature(F);if(R.needGeometry){const oe=h.ab(Z,!0);if(!R.filter(new h.F(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!R.filter(new h.F(this.tileID.overscaledZ),Z))continue;const te=p.getId(Z,T),ae=new h.ac(Z,k,L,B,te);ae.tile=$,t.push(ae)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const p=h.ad(t.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(o)if(this.expirationTime<o)_=!0;else{const T=this.expirationTime-o;T?this.expirationTime=p+Math.max(T,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!o.style.hasLayer(_))continue;const T=this.buckets[_],E=T.layers[0].sourceLayer||"_geojsonTileLayer",R=p[E],k=t[E];if(!R||!k||Object.keys(k).length===0)continue;T.update(k,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});const L=o&&o.style&&o.style.getLayer(_);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ee.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ee.now()+t}setDependencies(t,o){const p={};for(const _ of o)p[_]=!0;this.dependencies[t]=p}hasDependency(t,o){for(const p of t){const _=this.dependencies[p];if(_){for(const T of o)if(_[T])return!0}}return!1}}class Pe{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,p){const _=t.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const T={value:o,timeout:void 0};if(p!==void 0&&(T.timeout=setTimeout((()=>{this.remove(t,T)}),p)),this.data[_].push(T),this.order.push(_),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const p=t.wrapped().key,_=o===void 0?0:this.data[p].indexOf(o),T=this.data[p][_];return this.data[p].splice(_,1),T.timeout&&clearTimeout(T.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(T.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const p in this.data)for(const _ of this.data[p])t(_.value)||o.push(_);for(const p of o)this.remove(p.value.tileID,p)}}class J{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,p){const _=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},h.e(this.stateChanges[t][_],p),this.deletedStates[t]===null){this.deletedStates[t]={};for(const T in this.state[t])T!==_&&(this.deletedStates[t][T]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][_]===null){this.deletedStates[t][_]={};for(const T in this.state[t][_])p[T]||(this.deletedStates[t][_][T]=null)}else for(const T in p)this.deletedStates[t]&&this.deletedStates[t][_]&&this.deletedStates[t][_][T]===null&&delete this.deletedStates[t][_][T]}removeFeatureState(t,o,p){if(this.deletedStates[t]===null)return;const _=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},p&&o!==void 0)this.deletedStates[t][_]!==null&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][p]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][_])for(p in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][p]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,o){const p=String(o),_=h.e({},(this.state[t]||{})[p],(this.stateChanges[t]||{})[p]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const T=this.deletedStates[t][o];if(T===null)return{};for(const E in T)delete _[E]}return _}initializeTileState(t,o){t.setFeatureState(this.state,o)}coalesceChanges(t,o){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const T={};for(const E in this.stateChanges[_])this.state[_][E]||(this.state[_][E]={}),h.e(this.state[_][E],this.stateChanges[_][E]),T[E]=this.state[_][E];p[_]=T}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const T={};if(this.deletedStates[_]===null)for(const E in this.state[_])T[E]={},this.state[_][E]={};else for(const E in this.deletedStates[_]){if(this.deletedStates[_][E]===null)this.state[_][E]={};else for(const R of Object.keys(this.deletedStates[_][E]))delete this.state[_][E][R];T[E]=this.state[_][E]}p[_]=p[_]||{},h.e(p[_],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in t)t[_].setFeatureState(p,o)}}const Q=89.25;function re(b,t){const o=h.ah(t.lat,-h.ai,h.ai);return new h.P(h.V(t.lng)*b,h.U(o)*b)}function me(b,t){return new h.a1(t.x/b,t.y/b).toLngLat()}function xe(b){return b.cameraToCenterDistance*Math.min(.85*Math.tan(h.ae(90-b.pitch)),Math.tan(h.ae(Q-b.pitch)))}function ke(b,t){const o=b.canonical,p=t/h.af(o.z),_=o.x+Math.pow(2,o.z)*b.wrap,T=h.ag(new Float64Array(16));return h.M(T,T,[_*p,o.y*p,0]),h.N(T,T,[p/h.$,p/h.$,1]),T}function Fe(b,t,o,p,_){const T=h.a1.fromLngLat(b,t),E=_*h.aj(1,b.lat),R=E*Math.cos(h.ae(o)),k=Math.sqrt(E*E-R*R),L=k*Math.sin(h.ae(-p)),B=k*Math.cos(h.ae(-p));return new h.a1(T.x+L,T.y+B,T.z+R)}function Le(b,t,o){const p=t.intersectsFrustum(b);if(!o||p===0)return p;const _=t.intersectsPlane(o);return _===0?0:p===2&&_===2?2:1}function nt(b,t,o){let p=0;const _=(o-t)/10;for(let T=0;T<10;T++)p+=_*Math.pow(Math.cos(t+(T+.5)/10*(o-t)),b);return p}function mt(b,t){return function(o,p,_,T,E){const R=2*((b-1)/h.ak(Math.cos(h.ae(Q-E))/Math.cos(h.ae(Q)))-1),k=Math.acos(_/T),L=2*nt(R-1,0,h.ae(E/2)),B=Math.min(h.ae(Q),k+h.ae(E/2)),$=nt(R-1,Math.min(B,k-h.ae(E/2)),B),F=Math.atan(p/_),Z=Math.hypot(p,_);let te=o;return te+=h.ak(T/Z/Math.max(.5,Math.cos(h.ae(E/2)))),te+=R*h.ak(Math.cos(F))/2,te-=h.ak(Math.max(1,$/L/t))/2,te}}const ot=mt(9.314,3);function zt(b,t){const o=(t.roundZoom?Math.round:Math.floor)(b.zoom+h.ak(b.tileSize/t.tileSize));return Math.max(0,o)}function Re(b,t){const o=b.getCameraFrustum(),p=b.getClippingPlane(),_=b.screenPointToMercatorCoordinate(b.getCameraPoint()),T=h.a1.fromLngLat(b.center,b.elevation);_.z=T.z+Math.cos(b.pitchInRadians)*b.cameraToCenterDistance/b.worldSize;const E=b.getCoveringTilesDetailsProvider(),R=E.allowVariableZoom(b,t),k=zt(b,t),L=t.minzoom||0,B=t.maxzoom!==void 0?t.maxzoom:b.maxZoom,$=Math.min(Math.max(0,k),B),F=Math.pow(2,$),Z=[F*_.x,F*_.y,0],te=[F*T.x,F*T.y,0],ae=Math.hypot(T.x-_.x,T.y-_.y),oe=Math.abs(T.z-_.z),ce=Math.hypot(ae,oe),he=be=>({zoom:0,x:0,y:0,wrap:be,fullyVisible:!1}),ge=[],de=[];if(b.renderWorldCopies&&E.allowWorldCopies())for(let be=1;be<=3;be++)ge.push(he(-be)),ge.push(he(be));for(ge.push(he(0));ge.length>0;){const be=ge.pop(),Ie=be.x,fe=be.y;let ze=be.fullyVisible;const Xe={x:Ie,y:fe,z:be.zoom},$e=E.getTileBoundingVolume(Xe,be.wrap,b.elevation,t);if(!ze){const wt=Le(o,$e,p);if(wt===0)continue;ze=wt===2}const Ge=E.distanceToTile2d(_.x,_.y,Xe,$e);let Ye=k;R&&(Ye=(t.calculateTileZoom||ot)(b.zoom+h.ak(b.tileSize/t.tileSize),Ge,oe,ce,b.fov)),Ye=(t.roundZoom?Math.round:Math.floor)(Ye),Ye=Math.max(0,Ye);const Et=Math.min(Ye,B);if(be.wrap=E.getWrap(T,Xe,be.wrap),be.zoom>=Et){if(be.zoom<L)continue;const wt=$-be.zoom,lt=Z[0]-.5-(Ie<<wt),Bt=Z[1]-.5-(fe<<wt),Tn=t.reparseOverscaled?Math.max(be.zoom,Ye):be.zoom;de.push({tileID:new h.Z(be.zoom===B?Tn:be.zoom,be.wrap,be.zoom,Ie,fe),distanceSq:h.al([te[0]-.5-Ie,te[1]-.5-fe]),tileDistanceToCamera:Math.sqrt(lt*lt+Bt*Bt)})}else for(let wt=0;wt<4;wt++)ge.push({zoom:be.zoom+1,x:(Ie<<1)+wt%2,y:(fe<<1)+(wt>>1),wrap:be.wrap,fullyVisible:ze})}return de.sort(((be,Ie)=>be.distanceSq-Ie.distanceSq)).map((be=>be.tileID))}const nn=h.a2.fromPoints([new h.P(0,0),new h.P(h.$,h.$)]);class _n extends h.E{constructor(t,o,p){super(),this.id=t,this.dispatcher=p,this.on("data",(_=>this._dataHandler(_))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((_,T,E,R)=>{const k=new(xa(T.type))(_,T,E,R);if(k.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${k.id}`);return k})(t,o,p,this),this._tiles={},this._cache=new Pe(0,(_=>this._unloadTile(_))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new J,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const o=this._tiles[t];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,o,p){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,o,p)}catch(_){t.state="errored",_.status!==404?this._source.fire(new h.k(_,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new h.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const p=this._tiles[o];p.upload(t),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Nt).map((t=>t.key))}getRenderableIds(t){const o=[];for(const p in this._tiles)this._isIdRenderable(p,t)&&o.push(this._tiles[p]);return t?o.sort(((p,_)=>{const T=p.tileID,E=_.tileID,R=new h.P(T.canonical.x,T.canonical.y)._rotate(-this.transform.bearingInRadians),k=new h.P(E.canonical.x,E.canonical.y)._rotate(-this.transform.bearingInRadians);return T.overscaledZ-E.overscaledZ||k.y-R.y||k.x-R.x})).map((p=>p.tileID.key)):o.map((p=>p.tileID)).sort(Nt).map((p=>p.key))}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)t?this._reloadTile(o,"expired"):this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(t,o){return h._(this,void 0,void 0,(function*(){const p=this._tiles[t];p&&(p.state!=="loading"&&(p.state=o),yield this._loadTile(p,t,o))}))}_tileLoaded(t,o,p){t.timeAdded=ee.now(),p==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const o=this.getRenderableIds();for(let _=0;_<o.length;_++){const T=o[_];if(t.neighboringTiles&&t.neighboringTiles[T]){const E=this.getTileByID(T);p(t,E),p(E,t)}}function p(_,T){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let E=T.tileID.canonical.x-_.tileID.canonical.x;const R=T.tileID.canonical.y-_.tileID.canonical.y,k=Math.pow(2,_.tileID.canonical.z),L=T.tileID.key;E===0&&R===0||Math.abs(R)>1||(Math.abs(E)>1&&(Math.abs(E+k)===1?E+=k:Math.abs(E-k)===1&&(E-=k)),T.dem&&_.dem&&(_.dem.backfillBorder(T.dem,E,R),_.neighboringTiles&&_.neighboringTiles[L]&&(_.neighboringTiles[L].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o){const p=Object.values(t),_=this._getLoadedDescendents(p);for(const T of p){const E=_[T.key];if(!E)continue;const R=T.overscaledZ+_n.maxUnderzooming;let k=1/0;for(const L of E){const B=L.tileID.overscaledZ;B<=R&&B<k&&(k=B)}if(k!==1/0)for(const L of E)L.tileID.overscaledZ===k&&(o[L.tileID.key]=L.tileID)}}_getLoadedDescendents(t){var o;const p={};for(const _ in this._tiles){const T=this._tiles[_];if(T.hasData())for(const E of t)T.tileID.isChildOf(E)&&(p[o=E.key]||(p[o]=[])).push(T)}return p}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const p=this._loadedParentTiles[t.key];return p&&p.tileID.overscaledZ>=o?p:null}for(let p=t.overscaledZ-1;p>=o;p--){const _=t.scaledTo(p),T=this._getLoadedTile(_);if(T)return T}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const o=Math.ceil(t.width/this._source.tileSize)+1,p=Math.ceil(t.height/this._source.tileSize)+1,_=Math.floor(o*p*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(T)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const p={};for(const _ in this._tiles){const T=this._tiles[_];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+o),p[T.tileID.key]=T}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}_updateCoveredAndRetainedTiles(t,o,p,_){const T={},E={},R=Object.keys(t),k=ee.now();for(const L of R){const B=t[L],$=this._tiles[L];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=k)continue;const F=this.findLoadedParent(B,o),Z=this.findLoadedSibling(B),te=F||Z||null;te&&(this._addTile(te.tileID),T[te.tileID.key]=te.tileID),E[L]=B}this._retainLoadedChildren(E,t);for(const L in T)t[L]||(this._coveredTiles[L]=!0,t[L]=T[L]);if(_){const L={},B={};for(const $ of p)this._tiles[$.key].hasData()?L[$.key]=$:B[$.key]=$;for(const $ in B){const F=B[$].children(this._source.maxzoom);this._tiles[F[0].key]&&this._tiles[F[1].key]&&this._tiles[F[2].key]&&this._tiles[F[3].key]&&(L[F[0].key]=t[F[0].key]=F[0],L[F[1].key]=t[F[1].key]=F[1],L[F[2].key]=t[F[2].key]=F[2],L[F[3].key]=t[F[3].key]=F[3],delete B[$])}for(const $ in B){const F=B[$],Z=this.findLoadedParent(F,this._source.minzoom),te=this.findLoadedSibling(F),ae=Z||te||null;if(ae){L[ae.tileID.key]=t[ae.tileID.key]=ae.tileID;for(const oe in L)L[oe].isChildOf(ae.tileID)&&delete L[oe]}}for(const $ in this._tiles)L[$]||(this._coveredTiles[$]=!0)}}update(t,o){if(!this._sourceLoaded||this._paused)return;let p;this.transform=t,this.terrain=o,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((L=>new h.Z(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y))):(p=Re(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(p=p.filter((L=>this._source.hasTile(L))))):p=[];const _=zt(t,this._source),T=Math.max(_-_n.maxOverzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const B of p)if(B.canonical.z>this._source.minzoom){const $=B.scaledTo(B.canonical.z-1);L[$.key]=$;const F=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));L[F.key]=F}p=p.concat(Object.values(L))}const E=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new h.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const R=this._updateRetainedTiles(p,_);cn(this._source.type)&&this._updateCoveredAndRetainedTiles(R,T,p,o);for(const L in R)this._tiles[L].clearFadeHold();const k=h.am(this._tiles,R);for(const L of k){const B=this._tiles[L];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,o){var p;const _={},T={},E=Math.max(o-_n.maxOverzooming,this._source.minzoom),R={};for(const k of t){const L=this._addTile(k);_[k.key]=k,L.hasData()||o<this._source.maxzoom&&(R[k.key]=k)}this._retainLoadedChildren(R,_);for(const k of t){let L=this._tiles[k.key];if(L.hasData())continue;if(o+1>this._source.maxzoom){const $=k.children(this._source.maxzoom)[0],F=this.getTile($);if(F&&F.hasData()){_[$.key]=$;continue}}else{const $=k.children(this._source.maxzoom);if($.length===4&&_[$[0].key]&&_[$[1].key]&&_[$[2].key]&&_[$[3].key]||$.length===1&&_[$[0].key])continue}let B=L.wasRequested();for(let $=k.overscaledZ-1;$>=E;--$){const F=k.scaledTo($);if(T[F.key])break;if(T[F.key]=!0,L=this.getTile(F),!L&&B&&(L=this._addTile(F)),L){const Z=L.hasData();if((Z||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||B)&&(_[F.key]=F),B=L.wasRequested(),Z)break}}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let p,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}o.push(_.key);const T=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(T),p)break;_=T}for(const T of o)this._loadedParentTiles[T]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const o=this._tiles[t].tileID,p=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=p}}_addTile(t){let o=this._tiles[t.key];if(o)return o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const p=o;return o||(o=new qr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(o,t.key,o.state)),o.uses++,this._tiles[t.key]=o,p||this._source.fire(new h.l("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const p=o.getExpiryTimeout();p&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),p))}refreshTiles(t){for(const o in this._tiles)(this._isIdRenderable(o)||this._tiles[o].state=="errored")&&t.some((p=>p.equals(this._tiles[o].tileID.canonical)))&&this._reloadTile(o,"expired")}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(t){const o=t.sourceDataType;t.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&o==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,o,p){const _=[],T=this.transform;if(!T)return _;const E=T.getCoveringTilesDetailsProvider().allowWorldCopies(),R=p?T.getCameraQueryGeometry(t):t,k=Z=>T.screenPointToMercatorCoordinate(Z,this.terrain),L=this.transformBbox(t,k,!E),B=this.transformBbox(R,k,!E),$=this.getIds(),F=h.a2.fromPoints(B);for(let Z=0;Z<$.length;Z++){const te=this._tiles[$[Z]];if(te.holdingForFade())continue;const ae=E?[te.tileID]:[te.tileID.unwrapTo(-1),te.tileID.unwrapTo(0)],oe=Math.pow(2,T.zoom-te.tileID.overscaledZ),ce=o*te.queryPadding*h.$/te.tileSize/oe;for(const he of ae){const ge=F.map((de=>he.getTilePoint(new h.a1(de.x,de.y))));if(ge.expandBy(ce),ge.intersects(nn)){const de=L.map((Ie=>he.getTilePoint(Ie))),be=B.map((Ie=>he.getTilePoint(Ie)));_.push({tile:te,tileID:E?he:he.unwrapTo(0),queryGeometry:de,cameraQueryGeometry:be,scale:oe})}}}return _}transformBbox(t,o,p){let _=t.map(o);if(p){const T=h.a2.fromPoints(t);T.shrinkBy(.001*Math.min(T.width(),T.height()));const E=T.map(o);h.a2.fromPoints(_).covers(E)||(_=_.map((R=>R.x>.5?new h.a1(R.x-1,R.y,R.z):R)))}return _}getVisibleCoordinates(t){const o=this.getRenderableIds(t).map((p=>this._tiles[p].tileID));return this.transform&&this.transform.populateCache(o),o}hasTransition(){if(this._source.hasTransition())return!0;if(cn(this._source.type)){const t=ee.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=t)return!0}return!1}setFeatureState(t,o,p){this._state.updateState(t=t||"_geojsonTileLayer",o,p)}removeFeatureState(t,o,p){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,p)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,p){const _=this._tiles[t];_&&_.setDependencies(o,p)}reloadTilesForDependencies(t,o){for(const p in this._tiles)this._tiles[p].hasDependency(t,o)&&this._reloadTile(p,"reloading");this._cache.filter((p=>!p.hasDependency(t,o)))}}function Nt(b,t){const o=Math.abs(2*b.wrap)-+(b.wrap<0),p=Math.abs(2*t.wrap)-+(t.wrap<0);return b.overscaledZ-t.overscaledZ||p-o||t.canonical.y-b.canonical.y||t.canonical.x-b.canonical.x}function cn(b){return b==="raster"||b==="image"||b==="video"}_n.maxOverzooming=10,_n.maxUnderzooming=3;class Yn{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.ah(t,0,1);let o=1,p=this._distances[o];const _=t*this.paddedLength+this.padding;for(;p<_&&o<this._distances.length;)p=this._distances[++o];const T=o-1,E=this._distances[T],R=p-E,k=R>0?(_-E)/R:0;return this.points[T].mult(1-k).add(this.points[o].mult(k))}}function vi(b,t){let o=!0;return b==="always"||b!=="never"&&t!=="never"||(o=!1),o}class or{constructor(t,o,p){const _=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(o/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,p,_,T){this._forEachCell(o,p,_,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(T)}insertCircle(t,o,p,_){this._forEachCell(o-_,p-_,o+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(p),this.circles.push(_)}_insertBoxCell(t,o,p,_,T,E){this.boxCells[T].push(E)}_insertCircleCell(t,o,p,_,T,E){this.circleCells[T].push(E)}_query(t,o,p,_,T,E,R){if(p<0||t>this.width||_<0||o>this.height)return[];const k=[];if(t<=0&&o<=0&&this.width<=p&&this.height<=_){if(T)return[{key:null,x1:t,y1:o,x2:p,y2:_}];for(let L=0;L<this.boxKeys.length;L++)k.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const B=this.circles[3*L],$=this.circles[3*L+1],F=this.circles[3*L+2];k.push({key:this.circleKeys[L],x1:B-F,y1:$-F,x2:B+F,y2:$+F})}}else this._forEachCell(t,o,p,_,this._queryCell,k,{hitTest:T,overlapMode:E,seenUids:{box:{},circle:{}}},R);return k}query(t,o,p,_){return this._query(t,o,p,_,!1,null)}hitTest(t,o,p,_,T,E){return this._query(t,o,p,_,!0,T,E).length>0}hitTestCircle(t,o,p,_,T){const E=t-p,R=t+p,k=o-p,L=o+p;if(R<0||E>this.width||L<0||k>this.height)return!1;const B=[];return this._forEachCell(E,k,R,L,this._queryCellCircle,B,{hitTest:!0,overlapMode:_,circle:{x:t,y:o,radius:p},seenUids:{box:{},circle:{}}},T),B.length>0}_queryCell(t,o,p,_,T,E,R,k){const{seenUids:L,hitTest:B,overlapMode:$}=R,F=this.boxCells[T];if(F!==null){const te=this.bboxes;for(const ae of F)if(!L.box[ae]){L.box[ae]=!0;const oe=4*ae,ce=this.boxKeys[ae];if(t<=te[oe+2]&&o<=te[oe+3]&&p>=te[oe+0]&&_>=te[oe+1]&&(!k||k(ce))&&(!B||!vi($,ce.overlapMode))&&(E.push({key:ce,x1:te[oe],y1:te[oe+1],x2:te[oe+2],y2:te[oe+3]}),B))return!0}}const Z=this.circleCells[T];if(Z!==null){const te=this.circles;for(const ae of Z)if(!L.circle[ae]){L.circle[ae]=!0;const oe=3*ae,ce=this.circleKeys[ae];if(this._circleAndRectCollide(te[oe],te[oe+1],te[oe+2],t,o,p,_)&&(!k||k(ce))&&(!B||!vi($,ce.overlapMode))){const he=te[oe],ge=te[oe+1],de=te[oe+2];if(E.push({key:ce,x1:he-de,y1:ge-de,x2:he+de,y2:ge+de}),B)return!0}}}return!1}_queryCellCircle(t,o,p,_,T,E,R,k){const{circle:L,seenUids:B,overlapMode:$}=R,F=this.boxCells[T];if(F!==null){const te=this.bboxes;for(const ae of F)if(!B.box[ae]){B.box[ae]=!0;const oe=4*ae,ce=this.boxKeys[ae];if(this._circleAndRectCollide(L.x,L.y,L.radius,te[oe+0],te[oe+1],te[oe+2],te[oe+3])&&(!k||k(ce))&&!vi($,ce.overlapMode))return E.push(!0),!0}}const Z=this.circleCells[T];if(Z!==null){const te=this.circles;for(const ae of Z)if(!B.circle[ae]){B.circle[ae]=!0;const oe=3*ae,ce=this.circleKeys[ae];if(this._circlesCollide(te[oe],te[oe+1],te[oe+2],L.x,L.y,L.radius)&&(!k||k(ce))&&!vi($,ce.overlapMode))return E.push(!0),!0}}}_forEachCell(t,o,p,_,T,E,R,k){const L=this._convertToXCellCoord(t),B=this._convertToYCellCoord(o),$=this._convertToXCellCoord(p),F=this._convertToYCellCoord(_);for(let Z=L;Z<=$;Z++)for(let te=B;te<=F;te++)if(T.call(this,t,o,p,_,this.xCellCount*te+Z,E,R,k))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,p,_,T,E){const R=_-t,k=T-o,L=p+E;return L*L>R*R+k*k}_circleAndRectCollide(t,o,p,_,T,E,R){const k=(E-_)/2,L=Math.abs(t-(_+k));if(L>k+p)return!1;const B=(R-T)/2,$=Math.abs(o-(T+B));if($>B+p)return!1;if(L<=k||$<=B)return!0;const F=L-k,Z=$-B;return F*F+Z*Z<=p*p}}function ei(b,t,o){const p=h.L();if(!b){const{vecSouth:$,vecEast:F}=rn(t),Z=O();Z[0]=F[0],Z[1]=F[1],Z[2]=$[0],Z[3]=$[1],_=Z,(B=(E=(T=Z)[0])*(L=T[3])-(k=T[2])*(R=T[1]))&&(_[0]=L*(B=1/B),_[1]=-R*B,_[2]=-k*B,_[3]=E*B),p[0]=Z[0],p[1]=Z[1],p[4]=Z[2],p[5]=Z[3]}var _,T,E,R,k,L,B;return h.N(p,p,[1/o,1/o,1]),p}function Kt(b,t,o,p){if(b){const _=h.L();if(!t){const{vecSouth:T,vecEast:E}=rn(o);_[0]=E[0],_[1]=E[1],_[4]=T[0],_[5]=T[1]}return h.N(_,_,[p,p,1]),_}return o.pixelsToClipSpaceMatrix}function rn(b){const t=Math.cos(b.rollInRadians),o=Math.sin(b.rollInRadians),p=Math.cos(b.pitchInRadians),_=Math.cos(b.bearingInRadians),T=Math.sin(b.bearingInRadians),E=h.ar();E[0]=-_*p*o-T*t,E[1]=-T*p*o+_*t;const R=h.as(E);R<1e-9?h.at(E):h.au(E,E,1/R);const k=h.ar();k[0]=_*p*t-T*o,k[1]=T*p*t+_*o;const L=h.as(k);return L<1e-9?h.at(k):h.au(k,k,1/L),{vecEast:k,vecSouth:E}}function fi(b,t,o,p){let _;p?(_=[b,t,p(b,t),1],h.aw(_,_,o)):(_=[b,t,0,1],_s(_,_,o));const T=_[3];return{point:new h.P(_[0]/T,_[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}function yt(b,t){return .5+b/t*.5}function er(b,t){return b.x>=-t[0]&&b.x<=t[0]&&b.y>=-t[1]&&b.y<=t[1]}function Ni(b,t,o,p,_,T,E,R,k,L,B,$,F){const Z=o?b.textSizeData:b.iconSizeData,te=h.an(Z,t.transform.zoom),ae=[256/t.width*2+1,256/t.height*2+1],oe=o?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;oe.clear();const ce=b.lineVertexArray,he=o?b.text.placedSymbolArray:b.icon.placedSymbolArray,ge=t.transform.width/t.transform.height;let de=!1;for(let be=0;be<he.length;be++){const Ie=he.get(be);if(Ie.hidden||Ie.writingMode===h.ao.vertical&&!de){Qr(Ie.numGlyphs,oe);continue}de=!1;const fe=new h.P(Ie.anchorX,Ie.anchorY),ze={getElevation:F,pitchedLabelPlaneMatrix:p,lineVertexArray:ce,pitchWithMap:T,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:fe,unwrappedTileID:k,width:L,height:B,translation:$},Xe=pi(Ie.anchorX,Ie.anchorY,ze);if(!er(Xe.point,ae)){Qr(Ie.numGlyphs,oe);continue}const $e=yt(t.transform.cameraToCenterDistance,Xe.signedDistanceFromCamera),Ge=h.ap(Z,te,Ie),Ye=T?Ge*t.transform.getPitchedTextCorrection(Ie.anchorX,Ie.anchorY,k)/$e:Ge*$e,Et=It({projectionContext:ze,pitchedLabelPlaneMatrixInverse:_,symbol:Ie,fontSize:Ye,flip:!1,keepUpright:E,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ge,rotateToLine:R});de=Et.useVertical,(Et.notEnoughRoom||de||Et.needsFlipping&&It({projectionContext:ze,pitchedLabelPlaneMatrixInverse:_,symbol:Ie,fontSize:Ye,flip:!0,keepUpright:E,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ge,rotateToLine:R}).notEnoughRoom)&&Qr(Ie.numGlyphs,oe)}o?b.text.dynamicLayoutVertexBuffer.updateData(oe):b.icon.dynamicLayoutVertexBuffer.updateData(oe)}function Lr(b,t,o,p,_,T,E,R){const k=T.glyphStartIndex+T.numGlyphs,L=T.lineStartIndex,B=T.lineStartIndex+T.lineLength,$=t.getoffsetX(T.glyphStartIndex),F=t.getoffsetX(k-1),Z=Gr(b*$,o,p,_,T.segment,L,B,R,E);if(!Z)return null;const te=Gr(b*F,o,p,_,T.segment,L,B,R,E);return te?R.projectionCache.anyProjectionOccluded?null:{first:Z,last:te}:null}function Qs(b,t,o,p){return b===h.ao.horizontal&&Math.abs(o.y-t.y)>Math.abs(o.x-t.x)*p?{useVertical:!0}:(b===h.ao.vertical?t.y<o.y:t.x>o.x)?{needsFlipping:!0}:null}function It(b){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:o,symbol:p,fontSize:_,flip:T,keepUpright:E,glyphOffsetArray:R,dynamicLayoutVertexArray:k,aspectRatio:L,rotateToLine:B}=b,$=_/24,F=p.lineOffsetX*$,Z=p.lineOffsetY*$;let te;if(p.numGlyphs>1){const ae=p.glyphStartIndex+p.numGlyphs,oe=p.lineStartIndex,ce=p.lineStartIndex+p.lineLength,he=Lr($,R,F,Z,T,p,B,t);if(!he)return{notEnoughRoom:!0};const ge=Bs(he.first.point.x,he.first.point.y,t,o),de=Bs(he.last.point.x,he.last.point.y,t,o);if(E&&!T){const be=Qs(p.writingMode,ge,de,L);if(be)return be}te=[he.first];for(let be=p.glyphStartIndex+1;be<ae-1;be++){const Ie=Gr($*R.getoffsetX(be),F,Z,T,p.segment,oe,ce,t,B);if(!Ie)return{notEnoughRoom:!0};te.push(Ie)}te.push(he.last)}else{if(E&&!T){const oe=$i(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,ce=p.lineStartIndex+p.segment+1,he=new h.P(t.lineVertexArray.getx(ce),t.lineVertexArray.gety(ce)),ge=$i(he.x,he.y,t),de=ge.signedDistanceFromCamera>0?ge.point:un(t.tileAnchorPoint,he,oe,1,t),be=Bs(oe.x,oe.y,t,o),Ie=Bs(de.x,de.y,t,o),fe=Qs(p.writingMode,be,Ie,L);if(fe)return fe}const ae=Gr($*R.getoffsetX(p.glyphStartIndex),F,Z,T,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,t,B);if(!ae||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};te=[ae]}for(const ae of te)h.av(k,ae.point,ae.angle);return{}}function un(b,t,o,p,_){const T=b.add(b.sub(t)._unit()),E=$i(T.x,T.y,_).point,R=o.sub(E);return o.add(R._mult(p/R.mag()))}function sn(b,t,o){const p=t.projectionCache;if(p.projections[b])return p.projections[b];const _=new h.P(t.lineVertexArray.getx(b),t.lineVertexArray.gety(b)),T=$i(_.x,_.y,t);if(T.signedDistanceFromCamera>0)return p.projections[b]=T.point,p.anyProjectionOccluded=p.anyProjectionOccluded||T.isOccluded,T.point;const E=b-o.direction;return un(o.distanceFromAnchor===0?t.tileAnchorPoint:new h.P(t.lineVertexArray.getx(E),t.lineVertexArray.gety(E)),_,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,t)}function $i(b,t,o){const p=b+o.translation[0],_=t+o.translation[1];let T;return o.pitchWithMap?(T=fi(p,_,o.pitchedLabelPlaneMatrix,o.getElevation),T.isOccluded=!1):(T=o.transform.projectTileCoordinates(p,_,o.unwrappedTileID,o.getElevation),T.point.x=(.5*T.point.x+.5)*o.width,T.point.y=(.5*-T.point.y+.5)*o.height),T}function Bs(b,t,o,p){if(o.pitchWithMap){const _=[b,t,0,1];return h.aw(_,_,p),o.transform.projectTileCoordinates(_[0]/_[3],_[1]/_[3],o.unwrappedTileID,o.getElevation).point}return{x:b/o.width*2-1,y:1-t/o.height*2}}function pi(b,t,o){return o.transform.projectTileCoordinates(b,t,o.unwrappedTileID,o.getElevation)}function pn(b,t,o){return b._unit()._perp()._mult(t*o)}function fo(b,t,o,p,_,T,E,R,k){if(R.projectionCache.offsets[b])return R.projectionCache.offsets[b];const L=o.add(t);if(b+k.direction<p||b+k.direction>=_)return R.projectionCache.offsets[b]=L,L;const B=sn(b+k.direction,R,k),$=pn(B.sub(o),E,k.direction),F=o.add($),Z=B.add($);return R.projectionCache.offsets[b]=h.ax(T,L,F,Z)||L,R.projectionCache.offsets[b]}function Gr(b,t,o,p,_,T,E,R,k){const L=p?b-t:b+t;let B=L>0?1:-1,$=0;p&&(B*=-1,$=Math.PI),B<0&&($+=Math.PI);let F,Z=B>0?T+_:T+_+1;R.projectionCache.cachedAnchorPoint?F=R.projectionCache.cachedAnchorPoint:(F=$i(R.tileAnchorPoint.x,R.tileAnchorPoint.y,R).point,R.projectionCache.cachedAnchorPoint=F);let te,ae,oe=F,ce=F,he=0,ge=0;const de=Math.abs(L),be=[];let Ie;for(;he+ge<=de;){if(Z+=B,Z<T||Z>=E)return null;he+=ge,ce=oe,ae=te;const Xe={absOffsetX:de,direction:B,distanceFromAnchor:he,previousVertex:ce};if(oe=sn(Z,R,Xe),o===0)be.push(ce),Ie=oe.sub(ce);else{let $e;const Ge=oe.sub(ce);$e=Ge.mag()===0?pn(sn(Z+B,R,Xe).sub(oe),o,B):pn(Ge,o,B),ae||(ae=ce.add($e)),te=fo(Z,$e,oe,T,E,ae,o,R,Xe),be.push(ae),Ie=te.sub(ae)}ge=Ie.mag()}const fe=Ie._mult((de-he)/ge)._add(ae||ce),ze=$+Math.atan2(oe.y-ce.y,oe.x-ce.x);return be.push(fe),{point:fe,angle:k?ze:0,path:be}}const Js=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qr(b,t){for(let o=0;o<b;o++){const p=t.length;t.resize(p+4),t.float32.set(Js,3*p)}}function _s(b,t,o){const p=t[0],_=t[1];return b[0]=o[0]*p+o[4]*_+o[12],b[1]=o[1]*p+o[5]*_+o[13],b[3]=o[3]*p+o[7]*_+o[15],b}const bi=100;class Cc{constructor(t,o=new or(t.width+200,t.height+200,25),p=new or(t.width+200,t.height+200,25)){this.transform=t,this.grid=o,this.ignoredGrid=p,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+bi,this.screenBottomBoundary=t.height+bi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,o,p,_,T,E,R,k,L,B,$,F){const Z=this.projectAndGetPerspectiveRatio(t.anchorPointX+k[0],t.anchorPointY+k[1],T,B,F),te=p*Z.perspectiveRatio;let ae;if(E||R)ae=this._projectCollisionBox(t,te,_,T,E,R,k,Z,B,$,F);else{const Ie=Z.x+($?$.x*te:0),fe=Z.y+($?$.y*te:0);ae={allPointsOccluded:!1,box:[Ie+t.x1*te,fe+t.y1*te,Ie+t.x2*te,fe+t.y2*te]}}const[oe,ce,he,ge]=ae.box,de=E?ae.allPointsOccluded:Z.isOccluded;let be=de;return be||(be=Z.perspectiveRatio<this.perspectiveRatioCutoff),be||(be=!this.isInsideGrid(oe,ce,he,ge)),be||o!=="always"&&this.grid.hitTest(oe,ce,he,ge,o,L)?{box:[oe,ce,he,ge],placeable:!1,offscreen:!1,occluded:de}:{box:[oe,ce,he,ge],placeable:!0,offscreen:this.isOffscreen(oe,ce,he,ge),occluded:de}}placeCollisionCircles(t,o,p,_,T,E,R,k,L,B,$,F,Z,te){const ae=[],oe=new h.P(o.anchorX,o.anchorY),ce=this.getPerspectiveRatio(oe.x,oe.y,E,te),he=(L?T*this.transform.getPitchedTextCorrection(o.anchorX,o.anchorY,E)/ce:T*ce)/h.aB,ge={getElevation:te,pitchedLabelPlaneMatrix:R,lineVertexArray:p,pitchWithMap:L,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:oe,unwrappedTileID:E,width:this.transform.width,height:this.transform.height,translation:Z},de=Lr(he,_,o.lineOffsetX*he,o.lineOffsetY*he,!1,o,!1,ge);let be=!1,Ie=!1,fe=!0;if(de){const ze=.5*$*ce+F,Xe=new h.P(-100,-100),$e=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Ge=new Yn,Ye=de.first,Et=de.last;let wt=[];for(let Tn=Ye.path.length-1;Tn>=1;Tn--)wt.push(Ye.path[Tn]);for(let Tn=1;Tn<Et.path.length;Tn++)wt.push(Et.path[Tn]);const lt=2.5*ze;if(L){const Tn=this.projectPathToScreenSpace(wt,ge);wt=Tn.some((Fn=>Fn.signedDistanceFromCamera<=0))?[]:Tn.map((Fn=>Fn.point))}let Bt=[];if(wt.length>0){const Tn=wt[0].clone(),Fn=wt[0].clone();for(let Di=1;Di<wt.length;Di++)Tn.x=Math.min(Tn.x,wt[Di].x),Tn.y=Math.min(Tn.y,wt[Di].y),Fn.x=Math.max(Fn.x,wt[Di].x),Fn.y=Math.max(Fn.y,wt[Di].y);Bt=Tn.x>=Xe.x&&Fn.x<=$e.x&&Tn.y>=Xe.y&&Fn.y<=$e.y?[wt]:Fn.x<Xe.x||Tn.x>$e.x||Fn.y<Xe.y||Tn.y>$e.y?[]:h.ay([wt],Xe.x,Xe.y,$e.x,$e.y)}for(const Tn of Bt){Ge.reset(Tn,.25*ze);let Fn=0;Fn=Ge.length<=.5*ze?1:Math.ceil(Ge.paddedLength/lt)+1;for(let Di=0;Di<Fn;Di++){const li=Di/Math.max(Fn-1,1),ci=Ge.lerp(li),Ti=ci.x+bi,_i=ci.y+bi;ae.push(Ti,_i,ze,0);const ui=Ti-ze,Ln=_i-ze,Er=Ti+ze,fr=_i+ze;if(fe=fe&&this.isOffscreen(ui,Ln,Er,fr),Ie=Ie||this.isInsideGrid(ui,Ln,Er,fr),t!=="always"&&this.grid.hitTestCircle(Ti,_i,ze,t,B)&&(be=!0,!k))return{circles:[],offscreen:!1,collisionDetected:be}}}}return{circles:!k&&be||!Ie||ce<this.perspectiveRatioCutoff?[]:ae,offscreen:fe,collisionDetected:be}}projectPathToScreenSpace(t,o){const p=(function(_,T){const E=h.L();return h.aq(E,T.pitchedLabelPlaneMatrix),_.map((R=>{const k=fi(R.x,R.y,E,T.getElevation),L=T.transform.projectTileCoordinates(k.point.x,k.point.y,T.unwrappedTileID,T.getElevation);return L.point.x=(.5*L.point.x+.5)*T.width,L.point.y=(.5*-L.point.y+.5)*T.height,L}))})(t,o);return(function(_){let T=0,E=0,R=0,k=0;for(let L=0;L<_.length;L++)_[L].isOccluded?(R=L+1,k=0):(k++,k>E&&(E=k,T=R));return _.slice(T,T+E)})(p)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[],p=new h.a2;for(const $ of t){const F=new h.P($.x+bi,$.y+bi);p.extend(F),o.push(F)}const{minX:_,minY:T,maxX:E,maxY:R}=p,k=this.grid.query(_,T,E,R).concat(this.ignoredGrid.query(_,T,E,R)),L={},B={};for(const $ of k){const F=$.key;if(L[F.bucketInstanceId]===void 0&&(L[F.bucketInstanceId]={}),L[F.bucketInstanceId][F.featureIndex])continue;const Z=[new h.P($.x1,$.y1),new h.P($.x2,$.y1),new h.P($.x2,$.y2),new h.P($.x1,$.y2)];h.az(o,Z)&&(L[F.bucketInstanceId][F.featureIndex]=!0,B[F.bucketInstanceId]===void 0&&(B[F.bucketInstanceId]=[]),B[F.bucketInstanceId].push(F.featureIndex))}return B}insertCollisionBox(t,o,p,_,T,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:T,collisionGroupID:E,overlapMode:o},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,p,_,T,E){const R=p?this.ignoredGrid:this.grid,k={bucketInstanceId:_,featureIndex:T,collisionGroupID:E,overlapMode:o};for(let L=0;L<t.length;L+=4)R.insertCircle(k,t[L],t[L+1],t[L+2])}projectAndGetPerspectiveRatio(t,o,p,_,T){if(T){let E;_?(E=[t,o,_(t,o),1],h.aw(E,E,T)):(E=[t,o,0,1],_s(E,E,T));const R=E[3];return{x:(E[0]/R+1)/2*this.transform.width+bi,y:(-E[1]/R+1)/2*this.transform.height+bi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/R*.5,isOccluded:!1,signedDistanceFromCamera:R}}{const E=this.transform.projectTileCoordinates(t,o,p,_);return{x:(E.point.x+1)/2*this.transform.width+bi,y:(1-E.point.y)/2*this.transform.height+bi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5,isOccluded:E.isOccluded,signedDistanceFromCamera:E.signedDistanceFromCamera}}}getPerspectiveRatio(t,o,p,_){const T=this.transform.projectTileCoordinates(t,o,p,_);return .5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5}isOffscreen(t,o,p,_){return p<bi||t>=this.screenRightBoundary||_<bi||o>this.screenBottomBoundary}isInsideGrid(t,o,p,_){return p>=0&&t<this.gridRightBoundary&&_>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=h.ag([]);return h.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,o,p,_,T,E,R,k,L,B,$){let F=1,Z=0,te=0,ae=1;const oe=t.anchorPointX+R[0],ce=t.anchorPointY+R[1];if(E&&!T){const wt=this.projectAndGetPerspectiveRatio(oe+1,ce,_,L,$),lt=wt.x-k.x,Bt=Math.atan((wt.y-k.y)/lt)+(lt<0?Math.PI:0),Tn=Math.sin(Bt),Fn=Math.cos(Bt);F=Fn,Z=Tn,te=-Tn,ae=Fn}else if(!E&&T){const wt=rn(this.transform);F=wt.vecEast[0],Z=wt.vecEast[1],te=wt.vecSouth[0],ae=wt.vecSouth[1]}let he=k.x,ge=k.y,de=o;T&&(he=oe,ge=ce,de=Math.pow(2,-(this.transform.zoom-p.overscaledZ)),de*=this.transform.getPitchedTextCorrection(oe,ce,_),B||(de*=h.ah(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),B&&(he+=F*B.x*de+te*B.y*de,ge+=Z*B.x*de+ae*B.y*de);const be=t.x1*de,Ie=t.x2*de,fe=(be+Ie)/2,ze=t.y1*de,Xe=t.y2*de,$e=(ze+Xe)/2,Ge=[{offsetX:be,offsetY:ze},{offsetX:fe,offsetY:ze},{offsetX:Ie,offsetY:ze},{offsetX:Ie,offsetY:$e},{offsetX:Ie,offsetY:Xe},{offsetX:fe,offsetY:Xe},{offsetX:be,offsetY:Xe},{offsetX:be,offsetY:$e}];let Ye=[];for(const{offsetX:wt,offsetY:lt}of Ge)Ye.push(new h.P(he+F*wt+te*lt,ge+Z*wt+ae*lt));let Et=!1;if(T){const wt=Ye.map((lt=>this.projectAndGetPerspectiveRatio(lt.x,lt.y,_,L,$)));Et=wt.some((lt=>!lt.isOccluded)),Ye=wt.map((lt=>new h.P(lt.x,lt.y)))}else Et=!0;return{box:h.aA(Ye),allPointsOccluded:!Et}}}class xr{constructor(t,o,p,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class qn{constructor(t,o,p,_,T){this.text=new xr(t?t.text:null,o,p,T),this.icon=new xr(t?t.icon:null,o,_,T)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ea{constructor(t,o,p){this.text=t,this.icon=o,this.skipFade=p}}class Ba{constructor(t,o,p,_,T){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=T}}class fl{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:p=>p.collisionGroupID===o}}return this.collisionGroups[t]}}function Jr(b,t,o,p,_){const{horizontalAlign:T,verticalAlign:E}=h.aH(b);return new h.P(-(T-.5)*t+p[0]*_,-(E-.5)*o+p[1]*_)}class ta{constructor(t,o,p,_,T){this.transform=t.clone(),this.terrain=o,this.collisionIndex=new Cc(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new fl(_),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const o=this.terrain;return o?(p,_)=>o.getElevation(t,p,_):null}getBucketParts(t,o,p,_){const T=p.getBucket(o),E=p.latestFeatureIndex;if(!T||!E||o.id!==T.layerIds[0])return;const R=p.collisionBoxArray,k=T.layers[0].layout,L=T.layers[0].paint,B=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),$=p.tileSize/h.$,F=p.tileID.toUnwrapped(),Z=k.get("text-rotation-alignment")==="map",te=h.aC(p,1,this.transform.zoom),ae=h.aD(this.collisionIndex.transform,p,L.get("text-translate"),L.get("text-translate-anchor")),oe=h.aD(this.collisionIndex.transform,p,L.get("icon-translate"),L.get("icon-translate-anchor")),ce=ei(Z,this.transform,te);this.retainedQueryData[T.bucketInstanceId]=new Ba(T.bucketInstanceId,E,T.sourceLayerIndex,T.index,p.tileID);const he={bucket:T,layout:k,translationText:ae,translationIcon:oe,unwrappedTileID:F,pitchedLabelPlaneMatrix:ce,scale:B,textPixelRatio:$,holdingForFade:p.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:h.an(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(_)for(const ge of T.sortKeyRanges){const{sortKey:de,symbolInstanceStart:be,symbolInstanceEnd:Ie}=ge;t.push({sortKey:de,symbolInstanceStart:be,symbolInstanceEnd:Ie,parameters:he})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:he})}attemptAnchorPlacement(t,o,p,_,T,E,R,k,L,B,$,F,Z,te,ae,oe,ce,he,ge,de){const be=h.aE[t.textAnchor],Ie=[t.textOffset0,t.textOffset1],fe=Jr(be,p,_,Ie,T),ze=this.collisionIndex.placeCollisionBox(o,F,k,L,B,R,E,oe,$.predicate,ge,fe,de);if((!he||this.collisionIndex.placeCollisionBox(he,F,k,L,B,R,E,ce,$.predicate,ge,fe,de).placeable)&&ze.placeable){let Xe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(Xe=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:Ie,width:p,height:_,anchor:be,textBoxScale:T,prevAnchor:Xe},this.markUsedJustification(te,be,Z,ae),te.allowVerticalPlacement&&(this.markUsedOrientation(te,ae,Z),this.placedOrientations[Z.crossTileID]=ae),{shift:fe,placedGlyphBoxes:ze}}}placeLayerBucketPart(t,o,p){const{bucket:_,layout:T,translationText:E,translationIcon:R,unwrappedTileID:k,pitchedLabelPlaneMatrix:L,textPixelRatio:B,holdingForFade:$,collisionBoxArray:F,partiallyEvaluatedTextSize:Z,collisionGroup:te}=t.parameters,ae=T.get("text-optional"),oe=T.get("icon-optional"),ce=h.aF(T,"text-overlap","text-allow-overlap"),he=ce==="always",ge=h.aF(T,"icon-overlap","icon-allow-overlap"),de=ge==="always",be=T.get("text-rotation-alignment")==="map",Ie=T.get("text-pitch-alignment")==="map",fe=T.get("icon-text-fit")!=="none",ze=T.get("symbol-z-order")==="viewport-y",Xe=he&&(de||!_.hasIconData()||oe),$e=de&&(he||!_.hasTextData()||ae);!_.collisionArrays&&F&&_.deserializeCollisionBoxes(F);const Ge=this.retainedQueryData[_.bucketInstanceId].tileID,Ye=this._getTerrainElevationFunc(Ge),Et=this.transform.getFastPathSimpleProjectionMatrix(Ge),wt=(lt,Bt,Tn)=>{var Fn,Di;if(o[lt.crossTileID])return;if($)return void(this.placements[lt.crossTileID]=new ea(!1,!1,!1));let li=!1,ci=!1,Ti=!0,_i=null,ui={box:null,placeable:!1,offscreen:null,occluded:!1},Ln={placeable:!1},Er=null,fr=null,Is=null,zl=0,el=0,Cs=0;Bt.textFeatureIndex?zl=Bt.textFeatureIndex:lt.useRuntimeCollisionCircles&&(zl=lt.featureIndex),Bt.verticalTextFeatureIndex&&(el=Bt.verticalTextFeatureIndex);const tl=Bt.textBox;if(tl){const jr=Zn=>{let Ui=h.ao.horizontal;if(_.allowVerticalPlacement&&!Zn&&this.prevPlacement){const ss=this.prevPlacement.placedOrientations[lt.crossTileID];ss&&(this.placedOrientations[lt.crossTileID]=ss,Ui=ss,this.markUsedOrientation(_,Ui,lt))}return Ui},Co=(Zn,Ui)=>{if(_.allowVerticalPlacement&&lt.numVerticalGlyphVertices>0&&Bt.verticalTextBox){for(const ss of _.writingModes)if(ss===h.ao.vertical?(ui=Ui(),Ln=ui):ui=Zn(),ui&&ui.placeable)break}else ui=Zn()},Po=lt.textAnchorOffsetStartIndex,Nl=lt.textAnchorOffsetEndIndex;if(Nl===Po){const Zn=(Ui,ss)=>{const Yi=this.collisionIndex.placeCollisionBox(Ui,ce,B,Ge,k,Ie,be,E,te.predicate,Ye,void 0,Et);return Yi&&Yi.placeable&&(this.markUsedOrientation(_,ss,lt),this.placedOrientations[lt.crossTileID]=ss),Yi};Co((()=>Zn(tl,h.ao.horizontal)),(()=>{const Ui=Bt.verticalTextBox;return _.allowVerticalPlacement&&lt.numVerticalGlyphVertices>0&&Ui?Zn(Ui,h.ao.vertical):{box:null,offscreen:null}})),jr(ui&&ui.placeable)}else{let Zn=h.aE[(Di=(Fn=this.prevPlacement)===null||Fn===void 0?void 0:Fn.variableOffsets[lt.crossTileID])===null||Di===void 0?void 0:Di.anchor];const Ui=(Yi,Lh,Nh)=>{const Yc=Yi.x2-Yi.x1,so=Yi.y2-Yi.y1,Ro=lt.textBoxScale,tr=fe&&ge==="never"?Lh:null;let Qi=null,Mo=ce==="never"?1:2,il="never";Zn&&Mo++;for(let rl=0;rl<Mo;rl++){for(let Pa=Po;Pa<Nl;Pa++){const nr=_.textAnchorOffsets.get(Pa);if(Zn&&nr.textAnchor!==Zn)continue;const sc=this.attemptAnchorPlacement(nr,Yi,Yc,so,Ro,be,Ie,B,Ge,k,te,il,lt,_,Nh,E,R,tr,Ye);if(sc&&(Qi=sc.placedGlyphBoxes,Qi&&Qi.placeable))return li=!0,_i=sc.shift,Qi}Zn?Zn=null:il=ce}return p&&!Qi&&(Qi={box:this.collisionIndex.placeCollisionBox(tl,"always",B,Ge,k,Ie,be,E,te.predicate,Ye,void 0,Et).box,offscreen:!1,placeable:!1,occluded:!1}),Qi};Co((()=>Ui(tl,Bt.iconBox,h.ao.horizontal)),(()=>{const Yi=Bt.verticalTextBox;return _.allowVerticalPlacement&&(!ui||!ui.placeable)&&lt.numVerticalGlyphVertices>0&&Yi?Ui(Yi,Bt.verticalIconBox,h.ao.vertical):{box:null,occluded:!0,offscreen:null}})),ui&&(li=ui.placeable,Ti=ui.offscreen);const ss=jr(ui&&ui.placeable);if(!li&&this.prevPlacement){const Yi=this.prevPlacement.variableOffsets[lt.crossTileID];Yi&&(this.variableOffsets[lt.crossTileID]=Yi,this.markUsedJustification(_,Yi.anchor,lt,ss))}}}if(Er=ui,li=Er&&Er.placeable,Ti=Er&&Er.offscreen,lt.useRuntimeCollisionCircles){const jr=_.text.placedSymbolArray.get(lt.centerJustifiedTextSymbolIndex),Co=h.ap(_.textSizeData,Z,jr),Po=T.get("text-padding");fr=this.collisionIndex.placeCollisionCircles(ce,jr,_.lineVertexArray,_.glyphOffsetArray,Co,k,L,p,Ie,te.predicate,lt.collisionCircleDiameter,Po,E,Ye),fr.circles.length&&fr.collisionDetected&&!p&&h.w("Collisions detected, but collision boxes are not shown"),li=he||fr.circles.length>0&&!fr.collisionDetected,Ti=Ti&&fr.offscreen}if(Bt.iconFeatureIndex&&(Cs=Bt.iconFeatureIndex),Bt.iconBox){const jr=Co=>this.collisionIndex.placeCollisionBox(Co,ge,B,Ge,k,Ie,be,R,te.predicate,Ye,fe&&_i?_i:void 0,Et);Ln&&Ln.placeable&&Bt.verticalIconBox?(Is=jr(Bt.verticalIconBox),ci=Is.placeable):(Is=jr(Bt.iconBox),ci=Is.placeable),Ti=Ti&&Is.offscreen}const Ll=ae||lt.numHorizontalGlyphVertices===0&&lt.numVerticalGlyphVertices===0,$u=oe||lt.numIconVertices===0;Ll||$u?$u?Ll||(ci=ci&&li):li=ci&&li:ci=li=ci&&li;const nl=ci&&Is.placeable;if(li&&Er.placeable&&this.collisionIndex.insertCollisionBox(Er.box,ce,T.get("text-ignore-placement"),_.bucketInstanceId,Ln&&Ln.placeable&&el?el:zl,te.ID),nl&&this.collisionIndex.insertCollisionBox(Is.box,ge,T.get("icon-ignore-placement"),_.bucketInstanceId,Cs,te.ID),fr&&li&&this.collisionIndex.insertCollisionCircles(fr.circles,ce,T.get("text-ignore-placement"),_.bucketInstanceId,zl,te.ID),p&&this.storeCollisionData(_.bucketInstanceId,Tn,Bt,Er,Is,fr),lt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[lt.crossTileID]=new ea((li||Xe)&&!Er?.occluded,(ci||$e)&&!Is?.occluded,Ti||_.justReloaded),o[lt.crossTileID]=!0};if(ze){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const lt=_.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Bt=lt.length-1;Bt>=0;--Bt){const Tn=lt[Bt];wt(_.symbolInstances.get(Tn),_.collisionArrays[Tn],Tn)}}else for(let lt=t.symbolInstanceStart;lt<t.symbolInstanceEnd;lt++)wt(_.symbolInstances.get(lt),_.collisionArrays[lt],lt);_.justReloaded=!1}storeCollisionData(t,o,p,_,T,E){if(p.textBox||p.iconBox){let R,k;this.collisionBoxArrays.has(t)?R=this.collisionBoxArrays.get(t):(R=new Map,this.collisionBoxArrays.set(t,R)),R.has(o)?k=R.get(o):(k={text:null,icon:null},R.set(o,k)),p.textBox&&(k.text=_.box),p.iconBox&&(k.icon=T.box)}if(E){let R=this.collisionCircleArrays[t];R===void 0&&(R=this.collisionCircleArrays[t]=[]);for(let k=0;k<E.circles.length;k+=4)R.push(E.circles[k+0]-bi),R.push(E.circles[k+1]-bi),R.push(E.circles[k+2]),R.push(E.collisionDetected?1:0)}}markUsedJustification(t,o,p,_){let T;T=_===h.ao.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[h.aG(o)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const R of E)R>=0&&(t.text.placedSymbolArray.get(R).crossTileID=T>=0&&R!==T?0:p.crossTileID)}markUsedOrientation(t,o,p){const _=o===h.ao.horizontal||o===h.ao.horizontalOnly?o:0,T=o===h.ao.vertical?o:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const R of E)t.text.placedSymbolArray.get(R).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let p=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const _=o?o.symbolFadeChange(t):1,T=o?o.opacities:{},E=o?o.variableOffsets:{},R=o?o.placedOrientations:{};for(const k in this.placements){const L=this.placements[k],B=T[k];B?(this.opacities[k]=new qn(B,_,L.text,L.icon),p=p||L.text!==B.text.placed||L.icon!==B.icon.placed):(this.opacities[k]=new qn(null,_,L.text,L.icon,L.skipFade),p=p||L.text||L.icon)}for(const k in T){const L=T[k];if(!this.opacities[k]){const B=new qn(L,_,!1,!1);B.isHidden()||(this.opacities[k]=B,p=p||L.text.placed||L.icon.placed)}}for(const k in E)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=E[k]);for(const k in R)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=R[k]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o){const p={};for(const _ of o){const T=_.getBucket(t);T&&_.latestFeatureIndex&&t.id===T.layerIds[0]&&this.updateBucketOpacities(T,_.tileID,p,_.collisionBoxArray)}}updateBucketOpacities(t,o,p,_){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const T=t.layers[0],E=T.layout,R=new qn(null,0,!1,!1,!0),k=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),B=T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=E.get("text-rotation-alignment")==="map",F=E.get("text-pitch-alignment")==="map",Z=E.get("icon-text-fit")!=="none",te=new qn(null,0,k&&(L||!t.hasIconData()||E.get("icon-optional")),L&&(k||!t.hasTextData()||E.get("text-optional")),!0);!t.collisionArrays&&_&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(_);const ae=(ce,he,ge)=>{for(let de=0;de<he/4;de++)ce.opacityVertexArray.emplaceBack(ge);ce.hasVisibleVertices=ce.hasVisibleVertices||ge!==Ta},oe=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ce=0;ce<t.symbolInstances.length;ce++){const he=t.symbolInstances.get(ce),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:de,crossTileID:be}=he;let Ie=this.opacities[be];p[be]?Ie=R:Ie||(Ie=te,this.opacities[be]=Ie),p[be]=!0;const fe=he.numIconVertices>0,ze=this.placedOrientations[he.crossTileID],Xe=ze===h.ao.vertical,$e=ze===h.ao.horizontal||ze===h.ao.horizontalOnly;if(ge>0||de>0){const Ye=Va(Ie.text);ae(t.text,ge,Xe?Ta:Ye),ae(t.text,de,$e?Ta:Ye);const Et=Ie.text.isHidden();[he.rightJustifiedTextSymbolIndex,he.centerJustifiedTextSymbolIndex,he.leftJustifiedTextSymbolIndex].forEach((Bt=>{Bt>=0&&(t.text.placedSymbolArray.get(Bt).hidden=Et||Xe?1:0)})),he.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(he.verticalPlacedTextSymbolIndex).hidden=Et||$e?1:0);const wt=this.variableOffsets[he.crossTileID];wt&&this.markUsedJustification(t,wt.anchor,he,ze);const lt=this.placedOrientations[he.crossTileID];lt&&(this.markUsedJustification(t,"left",he,lt),this.markUsedOrientation(t,lt,he))}if(fe){const Ye=Va(Ie.icon),Et=!(Z&&he.verticalPlacedIconSymbolIndex&&Xe);he.placedIconSymbolIndex>=0&&(ae(t.icon,he.numIconVertices,Et?Ye:Ta),t.icon.placedSymbolArray.get(he.placedIconSymbolIndex).hidden=Ie.icon.isHidden()),he.verticalPlacedIconSymbolIndex>=0&&(ae(t.icon,he.numVerticalIconVertices,Et?Ta:Ye),t.icon.placedSymbolArray.get(he.verticalPlacedIconSymbolIndex).hidden=Ie.icon.isHidden())}const Ge=oe&&oe.has(ce)?oe.get(ce):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ye=t.collisionArrays[ce];if(Ye){let Et=new h.P(0,0);if(Ye.textBox||Ye.verticalTextBox){let wt=!0;if(B){const lt=this.variableOffsets[be];lt?(Et=Jr(lt.anchor,lt.width,lt.height,lt.textOffset,lt.textBoxScale),$&&Et._rotate(F?-this.transform.bearingInRadians:this.transform.bearingInRadians)):wt=!1}if(Ye.textBox||Ye.verticalTextBox){let lt;Ye.textBox&&(lt=Xe),Ye.verticalTextBox&&(lt=$e),pl(t.textCollisionBox.collisionVertexArray,Ie.text.placed,!wt||lt,Ge.text,Et.x,Et.y)}}if(Ye.iconBox||Ye.verticalIconBox){const wt=!!(!$e&&Ye.verticalIconBox);let lt;Ye.iconBox&&(lt=wt),Ye.verticalIconBox&&(lt=!wt),pl(t.iconCollisionBox.collisionVertexArray,Ie.icon.placed,lt,Ge.icon,Z?Et.x:0,Z?Et.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const p=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function pl(b,t,o,p,_,T){p&&p.length!==0||(p=[0,0,0,0]);const E=p[0]-bi,R=p[1]-bi,k=p[2]-bi,L=p[3]-bi;b.emplaceBack(t?1:0,o?1:0,_||0,T||0,E,R),b.emplaceBack(t?1:0,o?1:0,_||0,T||0,k,R),b.emplaceBack(t?1:0,o?1:0,_||0,T||0,k,L),b.emplaceBack(t?1:0,o?1:0,_||0,T||0,E,L)}const mh=Math.pow(2,25),wa=Math.pow(2,24),mi=Math.pow(2,17),Vo=Math.pow(2,16),Ul=Math.pow(2,9),ml=Math.pow(2,8),gi=Math.pow(2,1);function Va(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const t=b.placed?1:0,o=Math.floor(127*b.opacity);return o*mh+t*wa+o*mi+t*Vo+o*Ul+t*ml+o*gi+t}const Ta=0;class wr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,o,p,_,T){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(E,_,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort(((R,k)=>R.sortKey-k.sortKey)));this._currentPartIndex<E.length;)if(o.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,T())return!0;return!1}}class Fl{constructor(t,o,p,_,T,E,R,k){this.placement=new ta(t,o,E,R,k),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(t,o,p){const _=ee.now(),T=()=>!this._forceFullPlacement&&ee.now()-_>2;for(;this._currentPlacementIndex>=0;){const E=o[t[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=R)&&(!E.maxzoom||E.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new wr(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const po=512/h.$/2;class $l{constructor(t,o,p){this.tileID=t,this.bucketInstanceId=p,this._symbolsByKey={};const _=new Map;for(let T=0;T<o.length;T++){const E=o.get(T),R=E.key,k=_.get(R);k?k.push(E):_.set(R,[E])}for(const[T,E]of _){const R={positions:E.map((k=>({x:Math.floor(k.anchorX*po),y:Math.floor(k.anchorY*po)}))),crossTileIDs:E.map((k=>k.crossTileID))};if(R.positions.length>128){const k=new h.aI(R.positions.length,16,Uint16Array);for(const{x:L,y:B}of R.positions)k.add(L,B);k.finish(),delete R.positions,R.index=k}this._symbolsByKey[T]=R}}getScaledCoordinates(t,o){const{x:p,y:_,z:T}=this.tileID.canonical,{x:E,y:R,z:k}=o.canonical,L=po/Math.pow(2,k-T),B=(R*h.$+t.anchorY)*L,$=_*h.$*po;return{x:Math.floor((E*h.$+t.anchorX)*L-p*h.$*po),y:Math.floor(B-$)}}findMatches(t,o,p){const _=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let T=0;T<t.length;T++){const E=t.get(T);if(E.crossTileID)continue;const R=this._symbolsByKey[E.key];if(!R)continue;const k=this.getScaledCoordinates(E,o);if(R.index){const L=R.index.range(k.x-_,k.y-_,k.x+_,k.y+_).sort();for(const B of L){const $=R.crossTileIDs[B];if(!p[$]){p[$]=!0,E.crossTileID=$;break}}}else if(R.positions)for(let L=0;L<R.positions.length;L++){const B=R.positions[L],$=R.crossTileIDs[L];if(Math.abs(B.x-k.x)<=_&&Math.abs(B.y-k.y)<=_&&!p[$]){p[$]=!0,E.crossTileID=$;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class mo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const p in this.indexes){const _=this.indexes[p],T={};for(const E in _){const R=_[E];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+o),T[R.tileID.key]=R}this.indexes[p]=T}this.lng=t}addBucket(t,o,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let T=0;T<o.symbolInstances.length;T++)o.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const _=this.usedCrossTileIDs[t.overscaledZ];for(const T in this.indexes){const E=this.indexes[T];if(Number(T)>t.overscaledZ)for(const R in E){const k=E[R];k.tileID.isChildOf(t)&&k.findMatches(o.symbolInstances,t,_)}else{const R=E[t.scaledTo(Number(T)).key];R&&R.findMatches(o.symbolInstances,t,_)}}for(let T=0;T<o.symbolInstances.length;T++){const E=o.symbolInstances.get(T);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new $l(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const p of o.getCrossTileIDsLists())for(const _ of p)delete this.usedCrossTileIDs[t][_]}removeStaleBuckets(t){let o=!1;for(const p in this.indexes){const _=this.indexes[p];for(const T in _)t[_[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[T]),delete _[T],o=!0)}return o}}class jo{constructor(){this.layerIndexes={},this.crossTileIDs=new mo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,p){let _=this.layerIndexes[t.id];_===void 0&&(_=this.layerIndexes[t.id]=new gh);let T=!1;const E={};_.handleWrapJump(p);for(const R of o){const k=R.getBucket(t);k&&t.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(R.tileID,k,this.crossTileIDs)&&(T=!0),E[k.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(T=!0),T}pruneUnusedLayers(t){const o={};t.forEach((p=>{o[p]=!0}));for(const p in this.layerIndexes)o[p]||delete this.layerIndexes[p]}}var es="void main() {fragColor=vec4(1.0);}";const Ar={prelude:xn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:xn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:xn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:xn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:xn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:xn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:xn(es,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:xn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:xn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:xn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:xn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:xn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:xn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:xn(es,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:xn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:xn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:xn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:xn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:xn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:xn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:xn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:xn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:xn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:xn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:xn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:xn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:xn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:xn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:xn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:xn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:xn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:xn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:xn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:xn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:xn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function xn(b,t){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=t.match(/in ([\w]+) ([\w]+)/g),_=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=T?T.concat(_):_,R={};return{fragmentSource:b=b.replace(o,((k,L,B,$,F)=>(R[F]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${B} ${$} ${F};
#else
uniform ${B} ${$} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${B} ${$} ${F} = u_${F};
#endif
`))),vertexSource:t=t.replace(o,((k,L,B,$,F)=>{const Z=$==="float"?"vec2":"vec4",te=F.match(/color/)?"color":Z;return R[F]?L==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${B} ${Z} a_${F};
out ${B} ${$} ${F};
#else
uniform ${B} ${$} u_${F};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${B} ${$} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${te}(a_${F}, u_${F}_t);
#else
    ${B} ${$} ${F} = u_${F};
#endif
`:L==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${B} ${Z} a_${F};
#else
uniform ${B} ${$} u_${F};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${B} ${$} ${F} = a_${F};
#else
    ${B} ${$} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${B} ${$} ${F} = unpack_mix_${te}(a_${F}, u_${F}_t);
#else
    ${B} ${$} ${F} = u_${F};
#endif
`})),staticAttributes:p,staticUniforms:E}}class ja{constructor(t,o,p){this.vertexBuffer=t,this.indexBuffer=o,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var na=h.aJ([{name:"a_pos",type:"Int16",components:2}]);const Sa="#define PROJECTION_MERCATOR",go="mercator";class on{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return go}get shaderDefine(){return Sa}get shaderPreludeCode(){return Ar.projectionMercator}get vertexShaderPreludeCode(){return Ar.projectionMercator.vertexSource}get subdivisionGranularity(){return h.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,o,p,_,T){if(this._cachedMesh)return this._cachedMesh;const E=new h.aL;E.emplaceBack(0,0),E.emplaceBack(h.$,0),E.emplaceBack(0,h.$),E.emplaceBack(h.$,h.$);const R=t.createVertexBuffer(E,na.members),k=h.aM.simpleSegment(0,0,4,2),L=new h.aN;L.emplaceBack(1,0,2),L.emplaceBack(1,2,3);const B=t.createIndexBuffer(L);return this._cachedMesh=new ja(R,B,k),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Ua{constructor(t=0,o=0,p=0,_=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=p,this.right=_}interpolate(t,o,p){return o.top!=null&&t.top!=null&&(this.top=h.C.number(t.top,o.top,p)),o.bottom!=null&&t.bottom!=null&&(this.bottom=h.C.number(t.bottom,o.bottom,p)),o.left!=null&&t.left!=null&&(this.left=h.C.number(t.left,o.left,p)),o.right!=null&&t.right!=null&&(this.right=h.C.number(t.right,o.right,p)),this}getCenter(t,o){const p=h.ah((this.left+t-this.right)/2,0,t),_=h.ah((this.top+o-this.bottom)/2,0,o);return new h.P(p,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ua(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function gl(b,t){if(!b.renderWorldCopies||b.lngRange)return;const o=t.lng-b.center.lng;t.lng+=o>180?-360:o<-180?360:0}function Fa(b){return Math.max(0,Math.floor(b))}class si{constructor(t,o,p,_,T,E){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=E===void 0||!!E,this._minZoom=o||0,this._maxZoom=p||22,this._minPitch=_??0,this._maxPitch=T??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new h.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Fa(this._zoom),this._scale=h.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ua,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,o,p){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Fa(this._zoom),this._scale=h.af(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Ua(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!p&&t.autoCalculateNearFarZ,o&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const o=h.aO(t,-180,180)*Math.PI/180;var p,_,T,E,R,k,L,B,$;this._bearingInRadians!==o&&(this._unmodified=!1,this._bearingInRadians=o,this._calcMatrices(),this._rotationMatrix=O(),p=this._rotationMatrix,T=-this._bearingInRadians,E=(_=this._rotationMatrix)[0],R=_[1],k=_[2],L=_[3],B=Math.sin(T),$=Math.cos(T),p[0]=E*$+k*B,p[1]=R*$+L*B,p[2]=E*-B+k*$,p[3]=R*-B+L*$)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const o=h.ah(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==o&&(this._unmodified=!1,this._pitchInRadians=o,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const o=t/180*Math.PI;this._rollInRadians!==o&&(this._unmodified=!1,this._rollInRadians=o,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return h.aP(this._fovInRadians)}setFov(t){t=h.ah(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=h.ae(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const o=this.getConstrained(this._center,t).zoom;this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this._tileZoom=Math.max(0,Math.floor(o)),this._scale=h.af(o),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,o){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=o,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,p){this._unmodified=!1,this._edgeInsets.interpolate(t,o,p),this._constrain(),this._calcMatrices()}resize(t,o,p=!0){this._width=t,this._height=o,p&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new hi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-h.ai,h.ai])}getConstrained(t,o){return this._callbacks.getConstrained(t,o)}getCameraQueryGeometry(t,o){if(o.length===1)return[o[0],t];{const{minX:p,minY:_,maxX:T,maxY:E}=h.a2.fromPoints(o).extend(t);return[new h.P(p,_),new h.P(T,_),new h.P(T,E),new h.P(p,E),new h.P(p,_)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:o,zoom:p}=this.getConstrained(this.center,this.zoom);this.setCenter(o),this.setZoom(p),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=h.ag(new Float64Array(16));h.N(t,t,[this._width/2,-this._height/2,1]),h.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=h.ag(new Float64Array(16)),h.N(t,t,[1,-1,1]),h.M(t,t,[-1,-1,0]),h.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,o,p,_){const T=p!==void 0?p:this.bearing,E=_=_!==void 0?_:this.pitch,R=h.a1.fromLngLat(t,o),k=-Math.cos(h.ae(E)),L=Math.sin(h.ae(E)),B=L*Math.sin(h.ae(T)),$=-L*Math.cos(h.ae(T));let F=this.elevation;const Z=o-F;let te;k*Z>=0||Math.abs(k)<.1?(te=1e4,F=o+te*k):te=-Z/k;let ae,oe,ce=h.aQ(1,R.y),he=0;do{if(he+=1,he>10)break;oe=te/ce,ae=new h.a1(R.x+B*oe,R.y+$*oe),ce=1/ae.meterInMercatorCoordinateUnits()}while(Math.abs(te-oe*ce)>1e-12);return{center:ae.toLngLat(),elevation:F,zoom:h.ak(this.height/2/Math.tan(this.fovInRadians/2)/oe/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const o=h.aj(1,this.center.lat)*this.worldSize,p=this.cameraToCenterDistance/o,_=h.a1.fromLngLat(this.center,this.elevation),T=Fe(this.center,this.elevation,this.pitch,this.bearing,p);this._elevation=t;const E=this.calculateCenterFromCameraLngLatAlt(T.toLngLat(),h.aQ(T.z,_.y),this.bearing,this.pitch);this._elevation=E.elevation,this._center=E.center,this.setZoom(E.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=h.aj(1,this.center.lat)*this.worldSize;return Fe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const o=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/o,t.canonical.y/o,1/o/h.$,1/o/h.$]}}class lr{constructor(t,o){this.min=t,this.max=o,this.center=h.aR([],h.aS([],this.min,this.max),.5)}quadrant(t){const o=[t%2==0,t<2],p=h.aT(this.min),_=h.aT(this.max);for(let T=0;T<o.length;T++)p[T]=o[T]?this.min[T]:this.center[T],_[T]=o[T]?this.center[T]:this.max[T];return _[2]=this.max[2],new lr(p,_)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let o=!0;for(let p=0;p<t.planes.length;p++){const _=this.intersectsPlane(t.planes[p]);if(_===0)return 0;_===1&&(o=!1)}return o?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let o=t[3],p=t[3];for(let _=0;_<3;_++)t[_]>0?(o+=t[_]*this.min[_],p+=t[_]*this.max[_]):(p+=t[_]*this.min[_],o+=t[_]*this.max[_]);return o>=0?2:p<0?0:1}}class cr{distanceToTile2d(t,o,p,_){const T=_.distanceX([t,o]),E=_.distanceY([t,o]);return Math.hypot(T,E)}getWrap(t,o,p){return p}getTileBoundingVolume(t,o,p,_){var T,E;let R=0,k=0;if(_?.terrain){const B=new h.Z(t.z,o,t.z,t.x,t.y),$=_.terrain.getMinMaxElevation(B);R=(T=$.minElevation)!==null&&T!==void 0?T:Math.min(0,p),k=(E=$.maxElevation)!==null&&E!==void 0?E:Math.max(0,p)}const L=1<<t.z;return new lr([o+t.x/L,t.y/L,R],[o+(t.x+1)/L,(t.y+1)/L,k])}allowVariableZoom(t,o){const p=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,_=h.ah(78.5-p/2,0,60);return!!o.terrain||t.pitch>_}allowWorldCopies(){return!0}prepareNextFrame(){}}class Ri{constructor(t,o,p){this.points=t,this.planes=o,this.aabb=p}static fromInvProjectionMatrix(t,o=1,p=0,_,T){const E=T?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],R=Math.pow(2,p),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((F=>(function(Z,te,ae,oe){const ce=h.aw([],Z,te),he=1/ce[3]/ae*oe;return h.aY(ce,ce,[he,he,1/ce[3],he])})(F,t,o,R)));_&&(function(F,Z,te,ae){const oe=ae?4:0,ce=ae?0:4;let he=0;const ge=[],de=[];for(let fe=0;fe<4;fe++){const ze=h.aU([],F[fe+ce],F[fe+oe]),Xe=h.aZ(ze);h.aR(ze,ze,1/Xe),ge.push(Xe),de.push(ze)}for(let fe=0;fe<4;fe++){const ze=h.a_(F[fe+oe],de[fe],te);he=ze!==null&&ze>=0?Math.max(he,ze):Math.max(he,ge[fe])}const be=(function(fe,ze){const Xe=h.aU([],fe[ze[0]],fe[ze[1]]),$e=h.aU([],fe[ze[2]],fe[ze[1]]),Ge=[0,0,0,0];return h.aV(Ge,h.aW([],Xe,$e)),Ge[3]=-h.aX(Ge,fe[ze[0]]),Ge})(F,Z),Ie=(function(fe,ze){const Xe=h.a$(fe),$e=h.b0([],fe,1/Xe),Ge=h.aU([],ze,h.aR([],$e,h.aX(ze,$e))),Ye=h.a$(Ge);if(Ye>0){const Et=Math.sqrt(1-$e[3]*$e[3]),wt=h.aR([],$e,-$e[3]),lt=h.aS([],wt,h.aR([],Ge,Et/Ye));return h.b1(ze,lt)}return null})(te,be);if(Ie!==null){const fe=Ie/h.aX(de[0],be);he=Math.min(he,fe)}for(let fe=0;fe<4;fe++){const ze=Math.min(he,ge[fe]);F[fe+ce]=[F[fe+oe][0]+de[fe][0]*ze,F[fe+oe][1]+de[fe][1]*ze,F[fe+oe][2]+de[fe][2]*ze,1]}})(k,E[0],_,T);const L=E.map((F=>{const Z=h.aU([],k[F[0]],k[F[1]]),te=h.aU([],k[F[2]],k[F[1]]),ae=h.aV([],h.aW([],Z,te)),oe=-h.aX(ae,k[F[1]]);return ae.concat(oe)})),B=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],$=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const F of k)for(let Z=0;Z<3;Z++)B[Z]=Math.min(B[Z],F[Z]),$[Z]=Math.max($[Z],F[Z]);return new Ri(k,L,new lr(B,$))}}class Vn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,o,p){return this._helper.interpolatePadding(t,o,p)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,o,p=!0){this._helper.resize(t,o,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,o){this._helper.overrideNearFarZ(t,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,o){}constructor(t,o,p,_,T){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new si({calcMatrices:()=>{this._calcMatrices()},getConstrained:(E,R)=>this.getConstrained(E,R)},t,o,p,_,T),this._coveringTilesDetailsProvider=new cr}clone(){const t=new Vn;return t.apply(this),t}apply(t,o,p){this._helper.apply(t,o,p)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const o=[new h.b2(0,t)];if(this._helper._renderWorldCopies){const p=this.screenPointToMercatorCoordinate(new h.P(0,0)),_=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,0)),T=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,this._helper._height)),E=this.screenPointToMercatorCoordinate(new h.P(0,this._helper._height)),R=Math.floor(Math.min(p.x,_.x,T.x,E.x)),k=Math.floor(Math.max(p.x,_.x,T.x,E.x)),L=1;for(let B=R-L;B<=k+L;B++)B!==0&&o.push(new h.b2(B,t))}return o}getCameraFrustum(){return Ri.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const o=this.screenPointToLocation(this.centerPoint,t),p=t?t.getElevationForLngLatZoom(o,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(p)}setLocationAtPoint(t,o){const p=h.aj(this.elevation,this.center.lat),_=this.screenPointToMercatorCoordinateAtZ(o,p),T=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,p),E=h.a1.fromLngLat(t),R=new h.a1(E.x-(_.x-T.x),E.y-(_.y-T.y));this.setCenter(R?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,o){return o?this.coordinatePoint(h.a1.fromLngLat(t),o.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(h.a1.fromLngLat(t))}screenPointToLocation(t,o){var p;return(p=this.screenPointToMercatorCoordinate(t,o))===null||p===void 0?void 0:p.toLngLat()}screenPointToMercatorCoordinate(t,o){if(o){const p=o.pointCoordinate(t);if(p!=null)return p}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,o){const p=o||0,_=[t.x,t.y,0,1],T=[t.x,t.y,1,1];h.aw(_,_,this._pixelMatrixInverse),h.aw(T,T,this._pixelMatrixInverse);const E=_[3],R=T[3],k=_[1]/E,L=T[1]/R,B=_[2]/E,$=T[2]/R,F=B===$?0:(p-B)/($-B);return new h.a1(h.C.number(_[0]/E,T[0]/R,F)/this.worldSize,h.C.number(k,L,F)/this.worldSize,p)}coordinatePoint(t,o=0,p=this._pixelMatrix){const _=[t.x*this.worldSize,t.y*this.worldSize,o,1];return h.aw(_,_,p),new h.P(_[0]/_[3],_[1]/_[3])}getBounds(){const t=Math.max(0,this._helper._height/2-xe(this));return new hi().extend(this.screenPointToLocation(new h.P(0,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new h.P(0,this._helper._height)))}isPointOnMapSurface(t,o){return o?o.pointCoordinate(t)!=null:t.y>this.height/2-xe(this)}calculatePosMatrix(t,o=!1,p){var _;const T=(_=t.key)!==null&&_!==void 0?_:h.b3(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),E=o?this._alignedPosMatrixCache:this._posMatrixCache;if(E.has(T)){const L=E.get(T);return p?L.f32:L.f64}const R=ke(t,this.worldSize);h.O(R,o?this._alignedProjMatrix:this._viewProjMatrix,R);const k={f64:R,f32:new Float32Array(R)};return E.set(T,k),p?k.f32:k.f64}calculateFogMatrix(t){const o=t.key,p=this._fogMatrixCacheF32;if(p.has(o))return p.get(o);const _=ke(t,this.worldSize);return h.O(_,this._fogMatrix,_),p.set(o,new Float32Array(_)),p.get(o)}getConstrained(t,o){o=h.ah(+o,this.minZoom,this.maxZoom);const p={center:new h.S(t.lng,t.lat),zoom:o};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const ge=179.9999999999;_=[-ge,ge]}const T=this.tileSize*h.af(p.zoom);let E=0,R=T,k=0,L=T,B=0,$=0;const{x:F,y:Z}=this.size;if(this._helper._latRange){const ge=this._helper._latRange;E=h.U(ge[1])*T,R=h.U(ge[0])*T,R-E<Z&&(B=Z/(R-E))}_&&(k=h.aO(h.V(_[0])*T,0,T),L=h.aO(h.V(_[1])*T,0,T),L<k&&(L+=T),L-k<F&&($=F/(L-k)));const{x:te,y:ae}=re(T,t);let oe,ce;const he=Math.max($||0,B||0);if(he){const ge=new h.P($?(L+k)/2:te,B?(R+E)/2:ae);return p.center=me(T,ge).wrap(),p.zoom+=h.ak(he),p}if(this._helper._latRange){const ge=Z/2;ae-ge<E&&(ce=E+ge),ae+ge>R&&(ce=R-ge)}if(_){const ge=(k+L)/2;let de=te;this._helper._renderWorldCopies&&(de=h.aO(te,ge-T/2,ge+T/2));const be=F/2;de-be<k&&(oe=k+be),de+be>L&&(oe=L-be)}if(oe!==void 0||ce!==void 0){const ge=new h.P(oe??te,ce??ae);p.center=me(T,ge).wrap()}return p}calculateCenterFromCameraLngLatAlt(t,o,p,_){return this._helper.calculateCenterFromCameraLngLatAlt(t,o,p,_)}_calculateNearFarZIfNeeded(t,o,p){if(!this._helper.autoCalculateNearFarZ)return;const _=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),T=t-_*this._helper._pixelPerMeter/Math.cos(o),E=_<0?T:t,R=Math.PI/2+this.pitchInRadians,k=h.ae(this.fov)*(Math.abs(Math.cos(h.ae(this.roll)))*this.height+Math.abs(Math.sin(h.ae(this.roll)))*this.width)/this.height*(.5+p.y/this.height),L=Math.sin(k)*E/Math.sin(h.ah(Math.PI-R-k,.01,Math.PI-.01)),B=xe(this),$=Math.atan(B/this._helper.cameraToCenterDistance),F=h.ae(.75),Z=$>F?2*$*(.5+p.y/(2*B)):F,te=Math.sin(Z)*E/Math.sin(h.ah(Math.PI-R-Z,.01,Math.PI-.01)),ae=Math.min(L,te);this._helper._farZ=1.01*(Math.cos(Math.PI/2-o)*ae+E),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,o=re(this.worldSize,this.center),p=o.x,_=o.y;this._helper._pixelPerMeter=h.aj(1,this.center.lat)*this.worldSize;const T=h.ae(Math.min(this.pitch,Q)),E=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(T));let R;this._calculateNearFarZIfNeeded(E,T,t),R=new Float64Array(16),h.b4(R,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),h.aq(this._invProjMatrix,R),R[8]=2*-t.x/this._helper._width,R[9]=2*t.y/this._helper._height,this._projectionMatrix=h.b5(R),h.N(R,R,[1,-1,1]),h.M(R,R,[0,0,-this._helper.cameraToCenterDistance]),h.b6(R,R,-this.rollInRadians),h.b7(R,R,this.pitchInRadians),h.b6(R,R,-this.bearingInRadians),h.M(R,R,[-p,-_,0]),this._mercatorMatrix=h.N([],R,[this.worldSize,this.worldSize,this.worldSize]),h.N(R,R,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=h.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R),h.M(R,R,[0,0,-this.elevation]),this._viewProjMatrix=R,this._invViewProjMatrix=h.aq([],R);const k=[0,0,-1,1];h.aw(k,k,this._invViewProjMatrix),this._cameraPosition=[k[0]/k[3],k[1]/k[3],k[2]/k[3]],this._fogMatrix=new Float64Array(16),h.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,E,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,h.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),h.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),h.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),h.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),h.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),h.M(this._fogMatrix,this._fogMatrix,[-p,-_,0]),h.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),h.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=h.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R);const L=this._helper._width%2/2,B=this._helper._height%2/2,$=Math.cos(this.bearingInRadians),F=Math.sin(-this.bearingInRadians),Z=p-Math.round(p)+$*L+F*B,te=_-Math.round(_)+$*B+F*L,ae=new Float64Array(R);if(h.M(ae,ae,[Z>.5?Z-1:Z,te>.5?te-1:te,0]),this._alignedProjMatrix=ae,R=h.aq(new Float64Array(16),this._pixelMatrix),!R)throw new Error("failed to invert matrix");this._pixelMatrixInverse=R,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new h.P(0,0)),o=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.aw(o,o,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=h.aj(1,this.center.lat)*this.worldSize;return Fe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,o){const p=h.a1.fromLngLat(t),_=[p.x*this.worldSize,p.y*this.worldSize,o,1];return h.aw(_,_,this._viewProjMatrix),_[2]/_[3]}getProjectionData(t){const{overscaledTileID:o,aligned:p,applyTerrainMatrix:_}=t,T=this._helper.getMercatorTileCoordinates(o),E=o?this.calculatePosMatrix(o,p,!0):null;let R;return R=o&&o.terrainRttPosMatrix32f&&_?o.terrainRttPosMatrix32f:E||h.b8(),{mainMatrix:R,tileMercatorCoords:T,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:R}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,o,p){return 1}transformLightDirection(t){return h.aT(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,o,p,_){const T=this.calculatePosMatrix(p);let E;_?(E=[t,o,_(t,o),1],h.aw(E,E,T)):(E=[t,o,0,1],_s(E,E,T));const R=E[3];return{point:new h.P(E[0]/R,E[1]/R),signedDistanceFromCamera:R,isOccluded:!1}}populateCache(t){for(const o of t)this.calculatePosMatrix(o)}getMatrixForModel(t,o){const p=h.a1.fromLngLat(t,o),_=p.meterInMercatorCoordinateUnits(),T=h.b9();return h.M(T,T,[p.x,p.y,p.z]),h.b6(T,T,Math.PI),h.b7(T,T,Math.PI/2),h.N(T,T,[-_,_,_]),T}getProjectionDataForCustomLayer(t=!0){const o=new h.Z(0,0,0,0,0),p=this.getProjectionData({overscaledTileID:o,applyGlobeMatrix:t}),_=ke(o,this.worldSize);h.O(_,this._viewProjMatrix,_),p.tileMercatorCoords=[0,0,1,1];const T=[h.$,h.$,this.worldSize/this._helper.pixelsPerMeter],E=h.ba();return h.N(E,_,T),p.fallbackMatrix=E,p.mainMatrix=E,p}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function ts(){h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Xi(b){if(b.useSlerp)if(b.k<1){const t=h.bb(b.startEulerAngles.roll,b.startEulerAngles.pitch,b.startEulerAngles.bearing),o=h.bb(b.endEulerAngles.roll,b.endEulerAngles.pitch,b.endEulerAngles.bearing),p=new Float64Array(4);h.bc(p,t,o,b.k);const _=h.bd(p);b.tr.setRoll(_.roll),b.tr.setPitch(_.pitch),b.tr.setBearing(_.bearing)}else b.tr.setRoll(b.endEulerAngles.roll),b.tr.setPitch(b.endEulerAngles.pitch),b.tr.setBearing(b.endEulerAngles.bearing);else b.tr.setRoll(h.C.number(b.startEulerAngles.roll,b.endEulerAngles.roll,b.k)),b.tr.setPitch(h.C.number(b.startEulerAngles.pitch,b.endEulerAngles.pitch,b.k)),b.tr.setBearing(h.C.number(b.startEulerAngles.bearing,b.endEulerAngles.bearing,b.k))}function Tr(b,t,o,p,_){const T=_.padding,E=re(_.worldSize,o.getNorthWest()),R=re(_.worldSize,o.getNorthEast()),k=re(_.worldSize,o.getSouthEast()),L=re(_.worldSize,o.getSouthWest()),B=h.ae(-p),$=E.rotate(B),F=R.rotate(B),Z=k.rotate(B),te=L.rotate(B),ae=new h.P(Math.max($.x,F.x,te.x,Z.x),Math.max($.y,F.y,te.y,Z.y)),oe=new h.P(Math.min($.x,F.x,te.x,Z.x),Math.min($.y,F.y,te.y,Z.y)),ce=ae.sub(oe),he=(_.width-(T.left+T.right+t.left+t.right))/ce.x,ge=(_.height-(T.top+T.bottom+t.top+t.bottom))/ce.y;if(ge<0||he<0)return void ts();const de=Math.min(h.ak(_.scale*Math.min(he,ge)),b.maxZoom),be=h.P.convert(b.offset),Ie=new h.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(h.ae(p)),fe=be.add(Ie).mult(_.scale/h.af(de));return{center:me(_.worldSize,E.add(k).div(2).sub(fe)),zoom:de,bearing:p}}class xi{get useGlobeControls(){return!1}handlePanInertia(t,o){const p=t.mag(),_=Math.abs(xe(o));return{easingOffset:t.mult(Math.min(.75*_/p,1)),easingCenter:o.center}}handleMapControlsRollPitchBearingZoom(t,o){t.bearingDelta&&o.setBearing(o.bearing+t.bearingDelta),t.pitchDelta&&o.setPitch(o.pitch+t.pitchDelta),t.rollDelta&&o.setRoll(o.roll+t.rollDelta),t.zoomDelta&&o.setZoom(o.zoom+t.zoomDelta)}handleMapControlsPan(t,o,p){t.around.distSqr(o.centerPoint)<.01||o.setLocationAtPoint(p,t.around)}cameraForBoxAndBearing(t,o,p,_,T){return Tr(t,o,p,_,T)}handleJumpToCenterZoom(t,o){t.zoom!==(o.zoom!==void 0?+o.zoom:t.zoom)&&t.setZoom(+o.zoom),o.center!==void 0&&t.setCenter(h.S.convert(o.center))}handleEaseTo(t,o){const p=t.zoom,_=t.padding,T={roll:t.roll,pitch:t.pitch,bearing:t.bearing},E={roll:o.roll===void 0?t.roll:o.roll,pitch:o.pitch===void 0?t.pitch:o.pitch,bearing:o.bearing===void 0?t.bearing:o.bearing},R=o.zoom!==void 0,k=!t.isPaddingEqual(o.padding);let L=!1;const B=R?+o.zoom:t.zoom;let $=t.centerPoint.add(o.offsetAsPoint);const F=t.screenPointToLocation($),{center:Z,zoom:te}=t.getConstrained(h.S.convert(o.center||F),B??p);gl(t,Z);const ae=re(t.worldSize,F),oe=re(t.worldSize,Z).sub(ae),ce=h.af(te-p);return L=te!==p,{easeFunc:he=>{if(L&&t.setZoom(h.C.number(p,te,he)),h.be(T,E)||Xi({startEulerAngles:T,endEulerAngles:E,tr:t,k:he,useSlerp:T.roll!=E.roll}),k&&(t.interpolatePadding(_,o.padding,he),$=t.centerPoint.add(o.offsetAsPoint)),o.around)t.setLocationAtPoint(o.around,o.aroundPoint);else{const ge=h.af(t.zoom-p),de=te>p?Math.min(2,ce):Math.max(.5,ce),be=Math.pow(de,1-he),Ie=me(t.worldSize,ae.add(oe.mult(he*be)).mult(ge));t.setLocationAtPoint(t.renderWorldCopies?Ie.wrap():Ie,$)}},isZooming:L,elevationCenter:Z}}handleFlyTo(t,o){const p=o.zoom!==void 0,_=t.zoom,T=t.getConstrained(h.S.convert(o.center||o.locationAtOffset),p?+o.zoom:_),E=T.center,R=T.zoom;gl(t,E);const k=re(t.worldSize,o.locationAtOffset),L=re(t.worldSize,E).sub(k),B=L.mag(),$=h.af(R-_);let F;if(o.minZoom!==void 0){const Z=Math.min(+o.minZoom,_,R),te=t.getConstrained(E,Z).zoom;F=h.af(te-_)}return{easeFunc:(Z,te,ae,oe)=>{t.setZoom(Z===1?R:_+h.ak(te));const ce=Z===1?E:me(t.worldSize,k.add(L.mult(ae)).mult(te));t.setLocationAtPoint(t.renderWorldCopies?ce.wrap():ce,oe)},scaleOfZoom:$,targetCenter:E,scaleOfMinZoom:F,pixelPathLength:B}}}class ln{constructor(t,o,p){this.blendFunction=t,this.blendColor=o,this.mask=p}}ln.Replace=[1,0],ln.disabled=new ln(ln.Replace,h.bf.transparent,[!1,!1,!1,!1]),ln.unblended=new ln(ln.Replace,h.bf.transparent,[!0,!0,!0,!0]),ln.alphaBlended=new ln([1,771],h.bf.transparent,[!0,!0,!0,!0]);const Ea=2305;class Qt{constructor(t,o,p){this.enable=t,this.mode=o,this.frontFace=p}}Qt.disabled=new Qt(!1,1029,Ea),Qt.backCCW=new Qt(!0,1029,Ea),Qt.frontCCW=new Qt(!0,1028,Ea);class an{constructor(t,o,p){this.func=t,this.mask=o,this.range=p}}an.ReadOnly=!1,an.ReadWrite=!0,an.disabled=new an(519,an.ReadOnly,[0,1]);const ys=7680;class Cn{constructor(t,o,p,_,T,E){this.test=t,this.ref=o,this.mask=p,this.fail=_,this.depthFail=T,this.pass=E}}Cn.disabled=new Cn({func:519,mask:0},0,0,ys,ys,ys);const Qn=new WeakMap;function Bi(b){var t;if(Qn.has(b))return Qn.get(b);{const o=(t=b.getParameter(b.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Qn.set(b,o),o}}class ns{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const o=t.context,p=o.gl;this._texFormat=p.RGBA,this._texType=p.UNSIGNED_BYTE;const _=new h.aL;_.emplaceBack(-1,-1),_.emplaceBack(2,-1),_.emplaceBack(-1,2);const T=new h.aN;T.emplaceBack(0,1,2),this._fullscreenTriangle=new ja(o.createVertexBuffer(_,na.members),o.createIndexBuffer(T),h.aM.simpleSegment(0,0,_.length,T.length)),this._resultBuffer=new Uint8Array(4),o.activeTexture.set(p.TEXTURE1);const E=p.createTexture();p.bindTexture(p.TEXTURE_2D,E),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texImage2D(p.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=o.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(E),Bi(p)&&(this._pbo=p.createBuffer(),p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.bufferData(p.PIXEL_PACK_BUFFER,4,p.STREAM_READ),p.bindBuffer(p.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,o){const p=this._updateCount;return this._readbackQueue?p>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():p>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,o),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,o=t.gl;t.activeTexture.set(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,o){const p=this._cachedRenderContext.context,_=p.gl;if(this._bindFramebuffer(),p.viewport.set([0,0,this._texWidth,this._texHeight]),p.clear({color:h.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(p,_.TRIANGLES,an.disabled,Cn.disabled,ln.unblended,Qt.disabled,((T,E)=>({u_input:T,u_output_expected:E}))(t,o),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Bi(_)){_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.readBuffer(_.COLOR_ATTACHMENT0),_.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,null);const T=_.fenceSync(_.SYNC_GPU_COMMANDS_COMPLETE,0);_.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:T}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Bi(t)){const o=t.clientWaitSync(this._readbackQueue.sync,0,0);if(o===t.WAIT_FAILED)return h.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(o===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ns._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let o=0;return o+=t[0]/256,o+=t[1]/65536,o+=t[2]/16777216,t[3]<127&&(o=-o),o/128}}const _o=h.$/128;function Uo(b,t){const o=b.granularity!==void 0?Math.max(b.granularity,1):1,p=o+(b.generateBorders?2:0),_=o+(b.extendToNorthPole||b.generateBorders?1:0)+(b.extendToSouthPole||b.generateBorders?1:0),T=p+1,E=_+1,R=b.generateBorders?-1:0,k=b.generateBorders||b.extendToNorthPole?-1:0,L=o+(b.generateBorders?1:0),B=o+(b.generateBorders||b.extendToSouthPole?1:0),$=T*E,F=p*_*6,Z=T*E>65536;if(Z&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const te=Z||t==="32bit",ae=new Int16Array(2*$);let oe=0;for(let ge=k;ge<=B;ge++)for(let de=R;de<=L;de++){let be=de/o*h.$;de===-1&&(be=-_o),de===o+1&&(be=h.$+_o);let Ie=ge/o*h.$;ge===-1&&(Ie=b.extendToNorthPole?h.bh:-_o),ge===o+1&&(Ie=b.extendToSouthPole?h.bi:h.$+_o),ae[oe++]=be,ae[oe++]=Ie}const ce=te?new Uint32Array(F):new Uint16Array(F);let he=0;for(let ge=0;ge<_;ge++)for(let de=0;de<p;de++){const be=de+1+ge*T,Ie=de+(ge+1)*T,fe=de+1+(ge+1)*T;ce[he++]=de+ge*T,ce[he++]=Ie,ce[he++]=be,ce[he++]=be,ce[he++]=Ie,ce[he++]=fe}return{vertices:ae.buffer.slice(0),indices:ce.buffer.slice(0),uses32bitIndices:te}}const $a=new h.aK({fill:new h.bj(128,2),line:new h.bj(512,0),tile:new h.bj(128,32),stencil:new h.bj(128,1),circle:3});class qa{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ar.projectionGlobe}get vertexShaderPreludeCode(){return Ar.projectionMercator.vertexSource}get subdivisionGranularity(){return $a}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new ns(t));const o=h.U(this._errorQueryLatitudeDegrees),p=2*Math.atan(Math.exp(Math.PI-o*Math.PI*2))-.5*Math.PI,_=this._errorMeasurement.updateErrorLoop(o,p),T=ee.now();_!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=_,this._errorMeasurementLastChangeTime=T);const E=Math.min(Math.max((T-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=h.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,h.bl(E))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,o,p,_,T){const E=(T==="stencil"?$a.stencil:$a.tile).getGranularityForZoomLevel(o.z);return this._getMesh(t,{granularity:E,generateBorders:p,extendToNorthPole:o.y===0&&_,extendToSouthPole:o.y===(1<<o.z)-1&&_})}_getMesh(t,o){const p=this._getMeshKey(o);if(p in this._tileMeshCache)return this._tileMeshCache[p];const _=(function(T,E){const R=Uo(E,"16bit"),k=h.aL.deserialize({arrayBuffer:R.vertices,length:R.vertices.byteLength/2/2}),L=h.aN.deserialize({arrayBuffer:R.indices,length:R.indices.byteLength/2/3});return new ja(T.createVertexBuffer(k,na.members),T.createIndexBuffer(L),h.aM.simpleSegment(0,0,k.length,L.length))})(t,o);return this._tileMeshCache[p]=_,_}recalculate(t){}hasTransition(){const t=ee.now();let o=!1;return o=o||(t-this._errorMeasurementLastChangeTime)/1e3<.7,o=o||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,o}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const ia=new h.r({type:new h.D(h.v.projection.type)});class yo extends h.E{constructor(t){super(),this._transitionable=new h.t(ia,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.F(0)),this._mercatorProjection=new on,this._verticalPerspectiveProjection=new qa}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof h.bm){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,o,p,_,T){return this.currentProjection.getMeshFromTileID(t,o,p,_,T)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function vo(b){const t=Aa(b.worldSize,b.center.lat);return 2*Math.PI*t}function ra(b,t,o,p,_){const T=1/(1<<_),E=t/h.$*T+p*T,R=h.bo((b/h.$*T+o*T)*Math.PI*2+Math.PI,2*Math.PI),k=2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI,L=Math.cos(k),B=new Float64Array(3);return B[0]=Math.sin(R)*L,B[1]=Math.sin(k),B[2]=Math.cos(R)*L,B}function ur(b){return(function(t,o){const p=Math.cos(o),_=new Float64Array(3);return _[0]=Math.sin(t)*p,_[1]=Math.sin(o),_[2]=Math.cos(t)*p,_})(b.lng*Math.PI/180,b.lat*Math.PI/180)}function Aa(b,t){return b/(2*Math.PI)/Math.cos(t*Math.PI/180)}function bo(b){const t=Math.asin(b[1])/Math.PI*180,o=Math.sqrt(b[0]*b[0]+b[2]*b[2]);if(o>1e-6){const p=b[0]/o,_=Math.acos(b[2]/o),T=(p>0?_:-_)/Math.PI*180;return new h.S(h.aO(T,-180,180),t)}return new h.S(0,t)}function xo(b){return Math.cos(b*Math.PI/180)}function Mi(b,t){const o=xo(b),p=xo(t);return h.ak(p/o)}function Pc(b,t){const o=b.rotate(t.bearingInRadians),p=t.zoom+Mi(t.center.lat,0),_=h.bk(1/xo(t.center.lat),1/xo(Math.min(Math.abs(t.center.lat),60)),h.bn(p,7,3,0,1)),T=360/vo({worldSize:t.worldSize,center:{lat:t.center.lat}});return new h.S(t.center.lng-o.x*T*_,h.ah(t.center.lat+o.y*T,-h.ai,h.ai))}function _l(b){const t=.5*b,o=Math.sin(t),p=Math.cos(t);return Math.log(o+p)-Math.log(p-o)}function yl(b,t,o,p){const _=b.lat+o*p;if(Math.abs(o)>1){const T=(Math.sign(b.lat+o)!==Math.sign(b.lat)?-Math.abs(b.lat):Math.abs(b.lat))*Math.PI/180,E=Math.abs(b.lat+o)*Math.PI/180,R=_l(T+p*(E-T)),k=_l(T),L=_l(E);return new h.S(b.lng+t*((R-k)/(L-k)),_)}return new h.S(b.lng+t*p,_)}class Tu{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,o,p,_){const T=`${t.z}_${t.x}_${t.y}_${_?.terrain?"t":""}`,E=this._cache.get(T);if(E)return E;const R=this._cachePrevious.get(T);if(R)return this._cache.set(T,R),R;const k=this._boundingVolumeFactory(t,o,p,_);return this._cache.set(T,k),this._hadAnyChanges=!0,k}}class Fo{constructor(t,o,p,_){this.min=p,this.max=_,this.points=t,this.planes=o}static fromAabb(t,o){const p=[];for(let _=0;_<8;_++)p.push([1&~_?t[0]:o[0],(_>>1&1)==1?o[1]:t[1],(_>>2&1)==1?o[2]:t[2]]);return new Fo(p,[[-1,0,0,o[0]],[1,0,0,-t[0]],[0,-1,0,o[1]],[0,1,0,-t[1]],[0,0,-1,o[2]],[0,0,1,-t[2]]],t,o)}static fromCenterSizeAngles(t,o,p){const _=h.br([],p[0],p[1],p[2]),T=h.bs([],[o[0],0,0],_),E=h.bs([],[0,o[1],0],_),R=h.bs([],[0,0,o[2]],_),k=[...t],L=[...t];for(let $=0;$<8;$++)for(let F=0;F<3;F++){const Z=t[F]+T[F]*(1&~$?-1:1)+E[F]*(($>>1&1)==1?1:-1)+R[F]*(($>>2&1)==1?1:-1);k[F]=Math.min(k[F],Z),L[F]=Math.max(L[F],Z)}const B=[];for(let $=0;$<8;$++){const F=[...t];h.aS(F,F,h.aR([],T,1&~$?-1:1)),h.aS(F,F,h.aR([],E,($>>1&1)==1?1:-1)),h.aS(F,F,h.aR([],R,($>>2&1)==1?1:-1)),B.push(F)}return new Fo(B,[[...T,-h.aX(T,B[0])],[...E,-h.aX(E,B[0])],[...R,-h.aX(R,B[0])],[-T[0],-T[1],-T[2],-h.aX(T,B[7])],[-E[0],-E[1],-E[2],-h.aX(E,B[7])],[-R[0],-R[1],-R[2],-h.aX(R,B[7])]],k,L)}intersectsFrustum(t){let o=!0;const p=this.points.length,_=this.planes.length,T=t.planes.length,E=t.points.length;for(let R=0;R<T;R++){const k=t.planes[R];let L=0;for(let B=0;B<p;B++){const $=this.points[B];k[0]*$[0]+k[1]*$[1]+k[2]*$[2]+k[3]>=0&&L++}if(L===0)return 0;L<p&&(o=!1)}if(o)return 2;for(let R=0;R<_;R++){const k=this.planes[R];let L=0;for(let B=0;B<E;B++){const $=t.points[B];k[0]*$[0]+k[1]*$[1]+k[2]*$[2]+k[3]>=0&&L++}if(L===0)return 0}return 1}intersectsPlane(t){const o=this.points.length;let p=0;for(let _=0;_<o;_++){const T=this.points[_];t[0]*T[0]+t[1]*T[1]+t[2]*T[2]+t[3]>=0&&p++}return p===o?2:p===0?0:1}}function Vi(b,t,o){const p=b-t;return p<0?-p:Math.max(0,p-o)}function vl(b,t,o,p,_){const T=b-o;let E;return E=T<0?Math.min(-T,1+T-_):T>1?Math.min(Math.max(T-_,0),1-T):0,Math.max(E,Vi(t,p,_))}class sa{constructor(){this._boundingVolumeCache=new Tu(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,o,p,_){const T=1<<p.z,E=1/T,R=p.x/T,k=p.y/T;let L=2;return L=Math.min(L,vl(t,o,R,k,E)),L=Math.min(L,vl(t,o,R+.5,-k-E,E)),L=Math.min(L,vl(t,o,R+.5,2-k-E,E)),L}getWrap(t,o,p){const _=1<<o.z,T=1/_,E=o.x/_,R=Vi(t.x,E,T),k=Vi(t.x,E-1,T),L=Vi(t.x,E+1,T),B=Math.min(R,k,L);return B===L?1:B===k?-1:0}allowVariableZoom(t,o){return zt(t,o)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,o,p,_){return this._boundingVolumeCache.getTileBoundingVolume(t,o,p,_)}_computeTileBoundingVolume(t,o,p,_){var T,E;let R=0,k=0;if(_?.terrain){const L=new h.Z(t.z,o,t.z,t.x,t.y),B=_.terrain.getMinMaxElevation(L);R=(T=B.minElevation)!==null&&T!==void 0?T:Math.min(0,p),k=(E=B.maxElevation)!==null&&E!==void 0?E:Math.max(0,p)}if(R/=h.bu,k/=h.bu,R+=1,k+=1,t.z<=0)return Fo.fromAabb([-k,-k,-k],[k,k,k]);if(t.z===1)return Fo.fromAabb([t.x===0?-k:0,t.y===0?0:-k,-k],[t.x===0?0:k,t.y===0?k:0,k]);{const L=[ra(0,0,t.x,t.y,t.z),ra(h.$,0,t.x,t.y,t.z),ra(h.$,h.$,t.x,t.y,t.z),ra(0,h.$,t.x,t.y,t.z)],B=[];for(const Ge of L)B.push(h.aR([],Ge,k));if(k!==R)for(const Ge of L)B.push(h.aR([],Ge,R));t.y===0&&B.push([0,1,0]),t.y===(1<<t.z)-1&&B.push([0,-1,0]);const $=[1,1,1],F=[-1,-1,-1];for(const Ge of B)for(let Ye=0;Ye<3;Ye++)$[Ye]=Math.min($[Ye],Ge[Ye]),F[Ye]=Math.max(F[Ye],Ge[Ye]);const Z=ra(h.$/2,h.$/2,t.x,t.y,t.z),te=h.aW([],[0,1,0],Z);h.aV(te,te);const ae=h.aW([],Z,te);h.aV(ae,ae);const oe=h.aW([],L[2],L[1]);h.aV(oe,oe);const ce=h.aW([],L[0],L[3]);h.aV(ce,ce),B.push(h.aR([],Z,k)),t.y>=(1<<t.z)/2&&B.push(h.aR([],ra(h.$/2,0,t.x,t.y,t.z),k)),t.y<(1<<t.z)/2&&B.push(h.aR([],ra(h.$/2,h.$,t.x,t.y,t.z),k));const he=wo(Z,B),ge=wo(ae,B),de=[-Z[0],-Z[1],-Z[2],he.max],be=[Z[0],Z[1],Z[2],-he.min],Ie=[-ae[0],-ae[1],-ae[2],ge.max],fe=[ae[0],ae[1],ae[2],-ge.min],ze=[...oe,0],Xe=[...ce,0],$e=[];return t.y===0?$e.push(h.bt(Xe,ze,de),h.bt(Xe,ze,be)):$e.push(h.bt(Ie,ze,de),h.bt(Ie,ze,be),h.bt(Ie,Xe,de),h.bt(Ie,Xe,be)),t.y===(1<<t.z)-1?$e.push(h.bt(Xe,ze,de),h.bt(Xe,ze,be)):$e.push(h.bt(fe,ze,de),h.bt(fe,ze,be),h.bt(fe,Xe,de),h.bt(fe,Xe,be)),new Fo($e,[de,be,Ie,fe,ze,Xe],$,F)}}}function wo(b,t){let o=1/0,p=-1/0;for(const _ of t){const T=h.aX(b,_);o=Math.min(o,T),p=Math.max(p,T)}return{min:o,max:p}}class bl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,o,p){return this._helper.interpolatePadding(t,o,p)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,o){this._helper.resize(t,o)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,o){this._helper.overrideNearFarZ(t,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=h.bv(),this._projectionMatrix=h.b9(),this._globeViewProjMatrix32f=h.b8(),this._globeViewProjMatrixNoCorrection=h.b9(),this._globeViewProjMatrixNoCorrectionInverted=h.b9(),this._globeProjMatrixInverted=h.b9(),this._cameraPosition=h.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new si({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,o)=>this.getConstrained(t,o)}),this._coveringTilesDetailsProvider=new sa}clone(){const t=new bl;return t.apply(this),t}apply(t,o){this._globeLatitudeErrorCorrectionRadians=o||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=h.bp();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:o,applyGlobeMatrix:p}=t,_=this._helper.getMercatorTileCoordinates(o);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:_,clippingPlane:this._cachedClippingPlane,projectionTransition:p?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const o=this.pitchInRadians,p=this.cameraToCenterDistance/t,_=Math.sin(o)*p,T=Math.cos(o)*p+1,E=1/Math.sqrt(_*_+T*T)*1;let R=-_,k=T;const L=Math.sqrt(R*R+k*k);R/=L,k/=L;const B=[0,R,k];h.bw(B,B,[0,0,0],-this.bearingInRadians),h.bx(B,B,[0,0,0],-1*this.center.lat*Math.PI/180),h.by(B,B,[0,0,0],this.center.lng*Math.PI/180);const $=1/h.aZ(B);return h.aR(B,B,$),[...B,-E*$]}isLocationOccluded(t){return!this.isSurfacePointVisible(ur(t))}transformLightDirection(t){const o=this._helper._center.lng*Math.PI/180,p=this._helper._center.lat*Math.PI/180,_=Math.cos(p),T=[Math.sin(o)*_,Math.sin(p),Math.cos(o)*_],E=[T[2],0,-T[0]],R=[0,0,0];h.aW(R,E,T),h.aV(E,E),h.aV(R,R);const k=[0,0,0];return h.aV(k,[E[0]*t[0]+R[0]*t[1]+T[0]*t[2],E[1]*t[0]+R[1]*t[1]+T[1]*t[2],E[2]*t[0]+R[2]*t[1]+T[2]*t[2]]),k}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,o,p){const _=(function(R,k,L){const B=1/(1<<L.z);return new h.a1(R/h.$*B+L.x*B,k/h.$*B+L.y*B)})(t,o,p.canonical),T=(E=_.y,[h.bo(_.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI]);var E;return this.getCircleRadiusCorrection()/Math.cos(T[1])}projectTileCoordinates(t,o,p,_){const T=p.canonical,E=ra(t,o,T.x,T.y,T.z),R=1+(_?_(t,o):0)/h.bu,k=[E[0]*R,E[1]*R,E[2]*R,1];h.aw(k,k,this._globeViewProjMatrixNoCorrection);const L=this._cachedClippingPlane,B=L[0]*E[0]+L[1]*E[1]+L[2]*E[2]+L[3]<0;return{point:new h.P(k[0]/k[3],k[1]/k[3]),signedDistanceFromCamera:k[3],isOccluded:B}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Aa(this.worldSize,this.center.lat),o=h.ba(),p=h.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),h.b4(o,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const _=this.centerOffset;o[8]=2*-_.x/this._helper._width,o[9]=2*_.y/this._helper._height,this._projectionMatrix=h.b5(o),this._globeProjMatrixInverted=h.ba(),h.aq(this._globeProjMatrixInverted,o),h.M(o,o,[0,0,-this.cameraToCenterDistance]),h.b6(o,o,this.rollInRadians),h.b7(o,o,-this.pitchInRadians),h.b6(o,o,this.bearingInRadians),h.M(o,o,[0,0,-t]);const T=h.bp();T[0]=t,T[1]=t,T[2]=t,h.b7(p,o,this.center.lat*Math.PI/180),h.bz(p,p,-this.center.lng*Math.PI/180),h.N(p,p,T),this._globeViewProjMatrixNoCorrection=p,h.b7(o,o,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),h.bz(o,o,-this.center.lng*Math.PI/180),h.N(o,o,T),this._globeViewProjMatrix32f=new Float32Array(o),this._globeViewProjMatrixNoCorrectionInverted=h.ba(),h.aq(this._globeViewProjMatrixNoCorrectionInverted,p);const E=h.bp();this._cameraPosition=h.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/t,h.bw(this._cameraPosition,this._cameraPosition,E,-this.rollInRadians),h.bx(this._cameraPosition,this._cameraPosition,E,this.pitchInRadians),h.bw(this._cameraPosition,this._cameraPosition,E,-this.bearingInRadians),h.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),h.bx(this._cameraPosition,this._cameraPosition,E,-this.center.lat*Math.PI/180),h.by(this._cameraPosition,this._cameraPosition,E,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const R=h.b5(this._globeViewProjMatrixNoCorrectionInverted);h.N(R,R,[1,1,-1]),this._cachedFrustum=Ri.fromInvProjectionMatrix(R,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){h.w("calculateFogMatrix is not supported on globe projection.");const o=h.ba();return h.ag(o),o}getVisibleUnwrappedCoordinates(t){return[new h.b2(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&h.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,o){if(!this._globeViewProjMatrixNoCorrection)return 1;const p=ur(t);h.aR(p,p,1+o/h.bu);const _=h.bv();return h.aw(_,[p[0],p[1],p[2],1],this._globeViewProjMatrixNoCorrection),_[2]/_[3]}populateCache(t){}getBounds(){const t=.5*this.width,o=.5*this.height,p=[new h.P(0,0),new h.P(t,0),new h.P(this.width,0),new h.P(this.width,o),new h.P(this.width,this.height),new h.P(t,this.height),new h.P(0,this.height),new h.P(0,o)],_=[];for(const $ of p)_.push(this.unprojectScreenPoint($));let T=0,E=0,R=0,k=0;const L=this.center;for(const $ of _){const F=h.bA(L.lng,$.lng),Z=h.bA(L.lat,$.lat);F<E&&(E=F),F>T&&(T=F),Z<k&&(k=Z),Z>R&&(R=Z)}const B=[L.lng+E,L.lat+k,L.lng+T,L.lat+R];return this.isSurfacePointOnScreen([0,1,0])&&(B[3]=90,B[0]=-180,B[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(B[1]=-90,B[0]=-180,B[2]=180),new hi(B)}getConstrained(t,o){const p=h.ah(t.lat,-h.ai,h.ai),_=h.ah(+o,this.minZoom+Mi(0,p),this.maxZoom);return{center:new h.S(t.lng,p),zoom:_}}calculateCenterFromCameraLngLatAlt(t,o,p,_){return this._helper.calculateCenterFromCameraLngLatAlt(t,o,p,_)}setLocationAtPoint(t,o){const p=ur(this.unprojectScreenPoint(o)),_=ur(t),T=h.bp();h.bB(T);const E=h.bp();h.by(E,p,T,-this.center.lng*Math.PI/180),h.bx(E,E,T,this.center.lat*Math.PI/180);const R=_[0]*_[0]+_[2]*_[2],k=E[0]*E[0];if(R<k)return;const L=Math.sqrt(R-k),B=-L,$=h.bC(_[0],_[2],E[0],L),F=h.bC(_[0],_[2],E[0],B),Z=h.bp();h.by(Z,_,T,-$);const te=h.bC(Z[1],Z[2],E[1],E[2]),ae=h.bp();h.by(ae,_,T,-F);const oe=h.bC(ae[1],ae[2],E[1],E[2]),ce=.5*Math.PI,he=te>=-ce&&te<=ce,ge=oe>=-ce&&oe<=ce;let de,be;if(he&&ge){const Xe=this.center.lng*Math.PI/180,$e=this.center.lat*Math.PI/180;h.bD($,Xe)+h.bD(te,$e)<h.bD(F,Xe)+h.bD(oe,$e)?(de=$,be=te):(de=F,be=oe)}else if(he)de=$,be=te;else{if(!ge)return;de=F,be=oe}const Ie=de/Math.PI*180,fe=be/Math.PI*180,ze=this.center.lat;this.setCenter(new h.S(Ie,h.ah(fe,-90,90))),this.setZoom(this.zoom+Mi(ze,this.center.lat))}locationToScreenPoint(t,o){const p=ur(t);if(o){const _=o.getElevationForLngLatZoom(t,this._helper._tileZoom);h.aR(p,p,1+_/h.bu)}return this._projectSurfacePointToScreen(p)}_projectSurfacePointToScreen(t){const o=h.bv();return h.aw(o,[...t,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],new h.P((.5*o[0]+.5)*this.width,(.5*-o[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,o){if(o){const p=o.pointCoordinate(t);if(p)return p}return h.a1.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,o){var p;return(p=this.screenPointToMercatorCoordinate(t,o))===null||p===void 0?void 0:p.toLngLat()}isPointOnMapSurface(t,o){const p=this._cameraPosition,_=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(p,_)}getRayDirectionFromPixel(t){const o=h.bv();o[0]=t.x/this.width*2-1,o[1]=-1*(t.y/this.height*2-1),o[2]=1,o[3]=1,h.aw(o,o,this._globeViewProjMatrixNoCorrectionInverted),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3];const p=h.bp();p[0]=o[0]-this._cameraPosition[0],p[1]=o[1]-this._cameraPosition[1],p[2]=o[2]-this._cameraPosition[2];const _=h.bp();return h.aV(_,p),_}isSurfacePointVisible(t){const o=this._cachedClippingPlane;return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]+o[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const o=h.bv();return h.aw(o,[...t,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3],o[0]>-1&&o[0]<1&&o[1]>-1&&o[1]<1&&o[2]>-1&&o[2]<1}rayPlanetIntersection(t,o){const p=h.aX(t,o),_=h.bp(),T=h.bp();h.aR(T,o,p),h.aU(_,t,T);const E=1-h.aX(_,_);if(E<0)return null;const R=h.aX(t,t)-1,k=-p+(p<0?1:-1)*Math.sqrt(E),L=R/k,B=k;return{tMin:Math.min(L,B),tMax:Math.max(L,B)}}unprojectScreenPoint(t){const o=this._cameraPosition,p=this.getRayDirectionFromPixel(t),_=this.rayPlanetIntersection(o,p);if(_){const B=h.bp();h.aS(B,o,[p[0]*_.tMin,p[1]*_.tMin,p[2]*_.tMin]);const $=h.bp();return h.aV($,B),bo($)}const T=this._cachedClippingPlane,E=T[0]*p[0]+T[1]*p[1]+T[2]*p[2],R=-h.b1(T,o)/E,k=h.bp();if(R>0)h.aS(k,o,[p[0]*R,p[1]*R,p[2]*R]);else{const B=h.bp();h.aS(B,o,[2*p[0],2*p[1],2*p[2]]);const $=h.b1(this._cachedClippingPlane,B);h.aU(k,B,[this._cachedClippingPlane[0]*$,this._cachedClippingPlane[1]*$,this._cachedClippingPlane[2]*$])}const L=(function(B){const $=h.bp();return $[0]=B[0]*-B[3],$[1]=B[1]*-B[3],$[2]=B[2]*-B[3],{center:$,radius:Math.sqrt(1-B[3]*B[3])}})(T);return bo((function(B,$,F){const Z=h.bp();h.aU(Z,F,B);const te=h.bp();return h.bq(te,B,Z,$/h.a$(Z)),te})(L.center,L.radius,k))}getMatrixForModel(t,o){const p=h.S.convert(t),_=1/h.bu,T=h.b9();return h.bz(T,T,p.lng/180*Math.PI),h.b7(T,T,-p.lat/180*Math.PI),h.M(T,T,[0,0,1+o/h.bu]),h.b7(T,T,.5*Math.PI),h.N(T,T,[_,_,_]),T}getProjectionDataForCustomLayer(t=!0){const o=this.getProjectionData({overscaledTileID:new h.Z(0,0,0,0,0),applyGlobeMatrix:t});return o.tileMercatorCoords=[0,0,1,1],o}getFastPathSimpleProjectionMatrix(t){}}class To{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,o,p){return this._helper.interpolatePadding(t,o,p)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,o,p=!0){this._helper.resize(t,o,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,o){this._helper.overrideNearFarZ(t,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,o){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=o,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new si({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,o)=>this.getConstrained(t,o)}),this._globeness=1,this._mercatorTransform=new Vn,this._verticalPerspectiveTransform=new bl}clone(){const t=new To;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const o=this._mercatorTransform.getProjectionData(t),p=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?p.mainMatrix:o.mainMatrix,clippingPlane:p.clippingPlane,tileMercatorCoords:p.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:o.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return h.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return h.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,o,p){const _=this._mercatorTransform.getPitchedTextCorrection(t,o,p),T=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,o,p);return h.bk(_,T,this._globeness)}projectTileCoordinates(t,o,p,_){return this.currentTransform.projectTileCoordinates(t,o,p,_)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,o){return this.currentTransform.lngLatToCameraDepth(t,o)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,o){return this.currentTransform.getConstrained(t,o)}calculateCenterFromCameraLngLatAlt(t,o,p,_){return this._helper.calculateCenterFromCameraLngLatAlt(t,o,p,_)}setLocationAtPoint(t,o){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,o),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,o),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,o){return this.currentTransform.locationToScreenPoint(t,o)}screenPointToMercatorCoordinate(t,o){return this.currentTransform.screenPointToMercatorCoordinate(t,o)}screenPointToLocation(t,o){return this.currentTransform.screenPointToLocation(t,o)}isPointOnMapSurface(t,o){return this.currentTransform.isPointOnMapSurface(t,o)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,o){return this.currentTransform.getMatrixForModel(t,o)}getProjectionDataForCustomLayer(t=!0){const o=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return o;const p=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return p.fallbackMatrix=o.mainMatrix,p}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class ti{get useGlobeControls(){return!0}handlePanInertia(t,o){const p=Pc(t,o);return Math.abs(p.lng-o.center.lng)>180&&(p.lng=o.center.lng+179.5*Math.sign(p.lng-o.center.lng)),{easingCenter:p,easingOffset:new h.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,o){const p=t.around,_=o.screenPointToLocation(p);t.bearingDelta&&o.setBearing(o.bearing+t.bearingDelta),t.pitchDelta&&o.setPitch(o.pitch+t.pitchDelta),t.rollDelta&&o.setRoll(o.roll+t.rollDelta);const T=o.zoom;t.zoomDelta&&o.setZoom(o.zoom+t.zoomDelta);const E=o.zoom-T;if(E===0)return;const R=h.bA(o.center.lng,_.lng),k=R/(Math.abs(R/180)+1),L=h.bA(o.center.lat,_.lat),B=o.getRayDirectionFromPixel(p),$=o.cameraPosition,F=-1*h.aX($,B),Z=h.bp();h.aS(Z,$,[B[0]*F,B[1]*F,B[2]*F]);const te=h.aZ(Z)-1,ae=Math.exp(.5*-Math.max(te-.3,0)),oe=Aa(o.worldSize,o.center.lat)/Math.min(o.width,o.height),ce=h.bn(oe,.9,.5,1,.25),he=(1-h.af(-E))*Math.min(ae,ce),ge=o.center.lat,de=o.zoom,be=new h.S(o.center.lng+k*he,h.ah(o.center.lat+L*he,-h.ai,h.ai));o.setLocationAtPoint(_,p);const Ie=o.center,fe=h.bn(Math.abs(R),45,85,0,1),ze=h.bn(oe,.75,.35,0,1),Xe=Math.pow(Math.max(fe,ze),.25),$e=h.bA(Ie.lng,be.lng),Ge=h.bA(Ie.lat,be.lat);o.setCenter(new h.S(Ie.lng+$e*Xe,Ie.lat+Ge*Xe).wrap()),o.setZoom(de+Mi(ge,o.center.lat))}handleMapControlsPan(t,o,p){if(!t.panDelta)return;const _=o.center.lat,T=o.zoom;o.setCenter(Pc(t.panDelta,o).wrap()),o.setZoom(T+Mi(_,o.center.lat))}cameraForBoxAndBearing(t,o,p,_,T){const E=Tr(t,o,p,_,T),R=o.left/T.width*2-1,k=(T.width-o.right)/T.width*2-1,L=o.top/T.height*-2+1,B=(T.height-o.bottom)/T.height*-2+1,$=h.bA(p.getWest(),p.getEast())<0,F=$?p.getEast():p.getWest(),Z=$?p.getWest():p.getEast(),te=Math.max(p.getNorth(),p.getSouth()),ae=Math.min(p.getNorth(),p.getSouth()),oe=F+.5*h.bA(F,Z),ce=te+.5*h.bA(te,ae),he=T.clone();he.setCenter(E.center),he.setBearing(E.bearing),he.setPitch(0),he.setRoll(0),he.setZoom(E.zoom);const ge=he.modelViewProjectionMatrix,de=[ur(p.getNorthWest()),ur(p.getNorthEast()),ur(p.getSouthWest()),ur(p.getSouthEast()),ur(new h.S(Z,ce)),ur(new h.S(F,ce)),ur(new h.S(oe,te)),ur(new h.S(oe,ae))],be=ur(E.center);let Ie=Number.POSITIVE_INFINITY;for(const fe of de)R<0&&(Ie=ti.getLesserNonNegativeNonNull(Ie,ti.solveVectorScale(fe,be,ge,"x",R))),k>0&&(Ie=ti.getLesserNonNegativeNonNull(Ie,ti.solveVectorScale(fe,be,ge,"x",k))),L>0&&(Ie=ti.getLesserNonNegativeNonNull(Ie,ti.solveVectorScale(fe,be,ge,"y",L))),B<0&&(Ie=ti.getLesserNonNegativeNonNull(Ie,ti.solveVectorScale(fe,be,ge,"y",B)));if(Number.isFinite(Ie)&&Ie!==0)return E.zoom=he.zoom+h.ak(Ie),E;ts()}handleJumpToCenterZoom(t,o){const p=t.center.lat,_=t.getConstrained(o.center?h.S.convert(o.center):t.center,t.zoom).center;t.setCenter(_.wrap());const T=o.zoom!==void 0?+o.zoom:t.zoom+Mi(p,_.lat);t.zoom!==T&&t.setZoom(T)}handleEaseTo(t,o){const p=t.zoom,_=t.center,T=t.padding,E={roll:t.roll,pitch:t.pitch,bearing:t.bearing},R={roll:o.roll===void 0?t.roll:o.roll,pitch:o.pitch===void 0?t.pitch:o.pitch,bearing:o.bearing===void 0?t.bearing:o.bearing},k=o.zoom!==void 0,L=!t.isPaddingEqual(o.padding);let B=!1;const $=o.center?h.S.convert(o.center):_,F=t.getConstrained($,p).center;gl(t,F);const Z=t.clone();Z.setCenter(F),Z.setZoom(k?+o.zoom:p+Mi(_.lat,$.lat)),Z.setBearing(o.bearing);const te=new h.P(h.ah(t.centerPoint.x+o.offsetAsPoint.x,0,t.width),h.ah(t.centerPoint.y+o.offsetAsPoint.y,0,t.height));Z.setLocationAtPoint(F,te);const ae=(o.offset&&o.offsetAsPoint.mag())>0?Z.center:F,oe=k?+o.zoom:p+Mi(_.lat,ae.lat),ce=p+Mi(_.lat,0),he=oe+Mi(ae.lat,0),ge=h.bA(_.lng,ae.lng),de=h.bA(_.lat,ae.lat),be=h.af(he-ce);return B=oe!==p,{easeFunc:Ie=>{if(h.be(E,R)||Xi({startEulerAngles:E,endEulerAngles:R,tr:t,k:Ie,useSlerp:E.roll!=R.roll}),L&&t.interpolatePadding(T,o.padding,Ie),o.around)h.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(o.around,o.aroundPoint);else{const fe=he>ce?Math.min(2,be):Math.max(.5,be),ze=Math.pow(fe,1-Ie),Xe=yl(_,ge,de,Ie*ze);t.setCenter(Xe.wrap())}if(B){const fe=h.C.number(ce,he,Ie)+Mi(0,t.center.lat);t.setZoom(fe)}},isZooming:B,elevationCenter:ae}}handleFlyTo(t,o){const p=o.zoom!==void 0,_=t.center,T=t.zoom,E=t.padding,R=!t.isPaddingEqual(o.padding),k=t.getConstrained(h.S.convert(o.center||o.locationAtOffset),T).center,L=p?+o.zoom:t.zoom+Mi(t.center.lat,k.lat),B=t.clone();B.setCenter(k),B.setZoom(L),B.setBearing(o.bearing);const $=new h.P(h.ah(t.centerPoint.x+o.offsetAsPoint.x,0,t.width),h.ah(t.centerPoint.y+o.offsetAsPoint.y,0,t.height));B.setLocationAtPoint(k,$);const F=B.center;gl(t,F);const Z=(function(de,be,Ie){const fe=ur(be),ze=ur(Ie),Xe=h.aX(fe,ze),$e=Math.acos(Xe),Ge=vo(de);return $e/(2*Math.PI)*Ge})(t,_,F),te=T+Mi(_.lat,0),ae=L+Mi(F.lat,0),oe=h.af(ae-te);let ce;if(typeof o.minZoom=="number"){const de=+o.minZoom+Mi(F.lat,0),be=Math.min(de,te,ae)+Mi(0,F.lat),Ie=t.getConstrained(F,be).zoom+Mi(F.lat,0);ce=h.af(Ie-te)}const he=h.bA(_.lng,F.lng),ge=h.bA(_.lat,F.lat);return{easeFunc:(de,be,Ie,fe)=>{const ze=yl(_,he,ge,Ie);R&&t.interpolatePadding(E,o.padding,de);const Xe=de===1?F:ze;t.setCenter(Xe.wrap());const $e=te+h.ak(be);t.setZoom(de===1?L:$e+Mi(0,Xe.lat))},scaleOfZoom:oe,targetCenter:F,scaleOfMinZoom:ce,pixelPathLength:Z}}static solveVectorScale(t,o,p,_,T){const E=_==="x"?[p[0],p[4],p[8],p[12]]:[p[1],p[5],p[9],p[13]],R=[p[3],p[7],p[11],p[15]],k=t[0]*E[0]+t[1]*E[1]+t[2]*E[2],L=t[0]*R[0]+t[1]*R[1]+t[2]*R[2],B=o[0]*E[0]+o[1]*E[1]+o[2]*E[2],$=o[0]*R[0]+o[1]*R[1]+o[2]*R[2];return B+T*L===k+T*$||R[3]*(k-B)+E[3]*($-L)+k*$==B*L?null:(B+E[3]-T*$-T*R[3])/(B-k-T*$+T*L)}static getLesserNonNegativeNonNull(t,o){return o!==null&&o>=0&&o<t?o:t}}class Rc{constructor(t){this._globe=t,this._mercatorCameraHelper=new xi,this._verticalPerspectiveCameraHelper=new ti}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,o){return this.currentHelper.handlePanInertia(t,o)}handleMapControlsRollPitchBearingZoom(t,o){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,o)}handleMapControlsPan(t,o,p){this.currentHelper.handleMapControlsPan(t,o,p)}cameraForBoxAndBearing(t,o,p,_,T){return this.currentHelper.cameraForBoxAndBearing(t,o,p,_,T)}handleJumpToCenterZoom(t,o){this.currentHelper.handleJumpToCenterZoom(t,o)}handleEaseTo(t,o){return this.currentHelper.handleEaseTo(t,o)}handleFlyTo(t,o){return this.currentHelper.handleFlyTo(t,o)}}const ql=(b,t)=>h.y(b,t&&t.filter((o=>o.identifier!=="source.canvas"))),xl=h.bE();class I extends h.E{constructor(t,o={}){var p,_;super(),this._rtlPluginLoaded=()=>{for(const E in this.sourceCaches){const R=this.sourceCaches[E].getSource().type;R!=="vector"&&R!=="geojson"||this.sourceCaches[E].reload()}},this.map=t,this.dispatcher=new Ht(An(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((E,R)=>this.getGlyphs(E,R))),this.dispatcher.registerMessageHandler("GI",((E,R)=>this.getImages(E,R))),this.imageManager=new ye,this.imageManager.setEventedParent(this);const T=((p=t._container)===null||p===void 0?void 0:p.lang)||typeof document<"u"&&((_=document.documentElement)===null||_===void 0?void 0:_.lang)||void 0;this.glyphManager=new Te(t._requestManager,o.localIdeographFontFamily,T),this.lineAtlas=new Wt(256,512),this.crossTileSymbolIndex=new jo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",h.bG()),Ki().on(Bo,this._rtlPluginLoaded),this.on("data",(E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const R=this.sourceCaches[E.sourceId];if(!R)return;const k=R.getSource();if(k&&k.vectorLayerIds)for(const L in this._layers){const B=this._layers[L];B.source===k.id&&this._validateLayer(B)}}))}setGlobalStateProperty(t,o){var p,_,T;this._checkLoaded();const E=o===null?(T=(_=(p=this.stylesheet.state)===null||p===void 0?void 0:p[t])===null||_===void 0?void 0:_.default)!==null&&T!==void 0?T:null:o;if(h.bH(E,this._globalState[t]))return this;this._globalState[t]=E,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const o=[];for(const p in t)!h.bH(this._globalState[p],t[p].default)&&(o.push(p),this._globalState[p]=t[p].default);this._applyGlobalStateChanges(o)}_applyGlobalStateChanges(t){if(t.length===0)return;const o=new Set,p={};for(const _ of t){p[_]=this._globalState[_];for(const T in this._layers){const E=this._layers[T],R=E.getLayoutAffectingGlobalStateRefs(),k=E.getPaintAffectingGlobalStateRefs();if(R.has(_)&&o.add(E.source),k.has(_))for(const{name:L,value:B}of k.get(_))this._updatePaintProperty(E,L,B)}}this.dispatcher.broadcast("UGS",p);for(const _ in this.sourceCaches)o.has(_)&&(this._reloadSource(_),this._changed=!0)}loadURL(t,o={},p){this.fire(new h.l("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const _=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const T=this._loadStyleRequest;h.j(_,this._loadStyleRequest).then((E=>{this._loadStyleRequest=null,this._load(E.data,o,p)})).catch((E=>{this._loadStyleRequest=null,E&&!T.signal.aborted&&this.fire(new h.k(E))}))}loadJSON(t,o={},p){this.fire(new h.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ee.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(t,o,p)})).catch((()=>{}))}loadEmpty(){this.fire(new h.l("dataloading",{dataType:"style"})),this._load(xl,{validate:!1})}_load(t,o,p){var _,T;let E=o.transformStyle?o.transformStyle(p,t):t;if(!o.validate||!ql(this,h.z(E))){E=Object.assign({},E),this._loaded=!0,this.stylesheet=E;for(const R in E.sources)this.addSource(R,E.sources[R],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new st(this.stylesheet.light),this._setProjectionInternal(((_=this.stylesheet.projection)===null||_===void 0?void 0:_.type)||"mercator"),this.sky=new Zt(this.stylesheet.sky),this.map.setTerrain((T=this.stylesheet.terrain)!==null&&T!==void 0?T:null),this.fire(new h.l("data",{dataType:"style"})),this.fire(new h.l("style.load"))}}_createLayers(){var t;const o=h.bI(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",o),this._order=o.map((p=>p.id)),this._layers={},this._serializedLayers=null;for(const p of o){const _=h.bJ(p,this._globalState);_.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=_}}_loadSprite(t,o=!1,p=void 0){let _;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(T,E,R,k){return h._(this,void 0,void 0,(function*(){const L=Pt(T),B=R>1?"@2x":"",$={},F={};for(const{id:Z,url:te}of L){const ae=E.transformRequest(Se(te,B,".json"),"SpriteJSON");$[Z]=h.j(ae,k);const oe=E.transformRequest(Se(te,B,".png"),"SpriteImage");F[Z]=gt.getImage(oe,k)}return yield Promise.all([...Object.values($),...Object.values(F)]),(function(Z,te){return h._(this,void 0,void 0,(function*(){const ae={};for(const oe in Z){ae[oe]={};const ce=ee.getImageCanvasContext((yield te[oe]).data),he=(yield Z[oe]).data;for(const ge in he){const{width:de,height:be,x:Ie,y:fe,sdf:ze,pixelRatio:Xe,stretchX:$e,stretchY:Ge,content:Ye,textFitWidth:Et,textFitHeight:wt}=he[ge];ae[oe][ge]={data:null,pixelRatio:Xe,sdf:ze,stretchX:$e,stretchY:Ge,content:Ye,textFitWidth:Et,textFitHeight:wt,spriteData:{width:de,height:be,x:Ie,y:fe,context:ce}}}}return ae}))})($,F)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((T=>{if(this._spriteRequest=null,T)for(const E in T){this._spritesImagesIds[E]=[];const R=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter((k=>!(k in T))):[];for(const k of R)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in T[E]){const L=E==="default"?k:`${E}:${k}`;this._spritesImagesIds[E].push(L),L in this.imageManager.images?this.imageManager.updateImage(L,T[E][k],!1):this.imageManager.addImage(L,T[E][k]),o&&(this._changedImages[L]=!0)}}})).catch((T=>{this._spriteRequest=null,_=T,this.fire(new h.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"})),p&&p(_)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}_validateLayer(t){const o=this.sourceCaches[t.source];if(!o)return;const p=t.sourceLayer;if(!p)return;const _=o.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new h.k(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,o=!1){const p=this._serializedAllLayers();if(!t||t.length===0)return Object.values(o?h.bK(p):p);const _=[];for(const T of t)if(p[T]){const E=o?h.bK(p[T]):p[T];_.push(E)}return _}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const o=Object.keys(this._layers);for(const p of o){const _=this._layers[p];_.type!=="custom"&&(t[p]=_.serialize())}return t}hasTransitions(){var t,o,p;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((o=this.sky)===null||o===void 0)&&o.hasTransition()||!((p=this.projection)===null||p===void 0)&&p.hasTransition())return!0;for(const _ in this.sourceCaches)if(this.sourceCaches[_].hasTransition())return!0;for(const _ in this._layers)if(this._layers[_].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const o=this._changed;if(o){const _=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(_.length||T.length)&&this._updateWorkerLayers(_,T);for(const E in this._updatedSources){const R=this._updatedSources[E];if(R==="reload")this._reloadSource(E);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const T=this.sourceCaches[_];p[_]=T.used,T.used=!1}for(const _ of this._order){const T=this._layers[_];T.recalculate(t,this._availableImages),!T.isHidden(t.zoom)&&T.source&&(this.sourceCaches[T.source].used=!0)}for(const _ in p){const T=this.sourceCaches[_];!!p[_]!=!!T.used&&T.fire(new h.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,o&&this.fire(new h.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,o={}){var p;this._checkLoaded();const _=this.serialize();if(t=o.transformStyle?o.transformStyle(_,t):t,((p=o.validate)===null||p===void 0||p)&&ql(this,h.z(t)))return!1;(t=h.bK(t)).layers=h.bI(t.layers);const T=h.bL(_,t),E=this._getOperationsToPerform(T);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const R of E.operations)R();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const o=[],p=[];for(const _ of t)switch(_.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":o.push((()=>this.addLayer.apply(this,_.args)));break;case"removeLayer":o.push((()=>this.removeLayer.apply(this,_.args)));break;case"setPaintProperty":o.push((()=>this.setPaintProperty.apply(this,_.args)));break;case"setLayoutProperty":o.push((()=>this.setLayoutProperty.apply(this,_.args)));break;case"setFilter":o.push((()=>this.setFilter.apply(this,_.args)));break;case"addSource":o.push((()=>this.addSource.apply(this,_.args)));break;case"removeSource":o.push((()=>this.removeSource.apply(this,_.args)));break;case"setLayerZoomRange":o.push((()=>this.setLayerZoomRange.apply(this,_.args)));break;case"setLight":o.push((()=>this.setLight.apply(this,_.args)));break;case"setGeoJSONSourceData":o.push((()=>this.setGeoJSONSourceData.apply(this,_.args)));break;case"setGlyphs":o.push((()=>this.setGlyphs.apply(this,_.args)));break;case"setSprite":o.push((()=>this.setSprite.apply(this,_.args)));break;case"setTerrain":o.push((()=>this.map.setTerrain.apply(this,_.args)));break;case"setSky":o.push((()=>this.setSky.apply(this,_.args)));break;case"setProjection":this.setProjection.apply(this,_.args);break;case"setGlobalState":o.push((()=>this.setGlobalState.apply(this,_.args)));break;case"setTransition":o.push((()=>{}));break;default:p.push(_.command)}return{operations:o,unimplemented:p}}addImage(t,o){if(this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,o),this._afterImageUpdated(t)}updateImage(t,o){this.imageManager.updateImage(t,o)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,o,p={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(h.z.source,`sources.${t}`,o,null,p))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const _=this.sourceCaches[t]=new _n(t,o,this.dispatcher);_.style=this,_.setEventedParent(this,(()=>({isSourceLoaded:_.loaded(),source:_.serialize(),sourceId:t}))),_.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new h.k(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));const o=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],o.fire(new h.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,o){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const p=this.sourceCaches[t].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(o),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,o,p={}){this._checkLoaded();const _=t.id;if(this.getLayer(_))return void this.fire(new h.k(new Error(`Layer "${_}" already exists on this map.`)));let T;if(t.type==="custom"){if(ql(this,h.bM(t)))return;T=h.bJ(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(_,t.source),t=h.bK(t),t=h.e(t,{source:_})),this._validate(h.z.layer,`layers.${_}`,t,{arrayIndex:-1},p))return;T=h.bJ(t,this._globalState),this._validateLayer(T),T.setEventedParent(this,{layer:{id:_}})}const E=o?this._order.indexOf(o):this._order.length;if(o&&E===-1)this.fire(new h.k(new Error(`Cannot add layer "${_}" before non-existing layer "${o}".`)));else{if(this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=T,this._removedLayers[_]&&T.source&&T.type!=="custom"){const R=this._removedLayers[_];delete this._removedLayers[_],R.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}moveLayer(t,o){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===o)return;const p=this._order.indexOf(t);this._order.splice(p,1);const _=o?this._order.indexOf(o):this._order.length;o&&_===-1?this.fire(new h.k(new Error(`Cannot move layer "${t}" before non-existing layer "${o}".`))):(this._order.splice(_,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const o=this._layers[t];if(!o)return void this.fire(new h.k(new Error(`Cannot remove non-existing layer "${t}".`)));o.setEventedParent(null);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=o,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],o.onRemove&&o.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,o,p){this._checkLoaded();const _=this.getLayer(t);_?_.minzoom===o&&_.maxzoom===p||(o!=null&&(_.minzoom=o),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new h.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,o,p={}){this._checkLoaded();const _=this.getLayer(t);if(_){if(!h.bH(_.filter,o))return o==null?(_.setFilter(void 0),void this._updateLayer(_)):void(this._validate(h.z.filter,`layers.${_.id}.filter`,o,null,p)||(_.setFilter(h.bK(o)),this._updateLayer(_)))}else this.fire(new h.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.bK(this.getLayer(t).filter)}setLayoutProperty(t,o,p,_={}){this._checkLoaded();const T=this.getLayer(t);T?h.bH(T.getLayoutProperty(o),p)||(T.setLayoutProperty(o,p,_),this._updateLayer(T)):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,o){const p=this.getLayer(t);if(p)return p.getLayoutProperty(o);this.fire(new h.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,o,p,_={}){this._checkLoaded();const T=this.getLayer(t);T?h.bH(T.getPaintProperty(o),p)||this._updatePaintProperty(T,o,p,_):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,o,p,_={}){t.setPaintProperty(o,p,_)&&this._updateLayer(t),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,o){return this.getLayer(t).getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();const p=t.source,_=t.sourceLayer,T=this.sourceCaches[p];if(T===void 0)return void this.fire(new h.k(new Error(`The source '${p}' does not exist in the map's style.`)));const E=T.getSource().type;E==="geojson"&&_?this.fire(new h.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||_?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),T.setFeatureState(_,t.id,o)):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,o){this._checkLoaded();const p=t.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new h.k(new Error(`The source '${p}' does not exist in the map's style.`)));const T=_.getSource().type,E=T==="vector"?t.sourceLayer:void 0;T!=="vector"||E?o&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.k(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(E,t.id,o):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const o=t.source,p=t.sourceLayer,_=this.sourceCaches[o];if(_!==void 0)return _.getSource().type!=="vector"||p?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,t.id)):void this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.k(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.bN(this.sourceCaches,(T=>T.serialize())),o=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,_=this.stylesheet;return h.bO({version:_.version,name:_.name,metadata:_.metadata,light:_.light,sky:_.sky,center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,sprite:_.sprite,glyphs:_.glyphs,transition:_.transition,projection:_.projection,sources:t,layers:o,terrain:p},(T=>T!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const o=E=>this._layers[E].type==="fill-extrusion",p={},_=[];for(let E=this._order.length-1;E>=0;E--){const R=this._order[E];if(o(R)){p[R]=E;for(const k of t){const L=k[R];if(L)for(const B of L)_.push(B)}}}_.sort(((E,R)=>R.intersectionZ-E.intersectionZ));const T=[];for(let E=this._order.length-1;E>=0;E--){const R=this._order[E];if(o(R))for(let k=_.length-1;k>=0;k--){const L=_[k].feature;if(p[L.layer.id]<E)break;T.push(L),_.pop()}else for(const k of t){const L=k[R];if(L)for(const B of L)T.push(B.feature)}}return T}queryRenderedFeatures(t,o,p){o&&o.filter&&this._validate(h.z.filter,"queryRenderedFeatures.filter",o.filter,null,o);const _={};if(o&&o.layers){if(!(Array.isArray(o.layers)||o.layers instanceof Set))return this.fire(new h.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const L of o.layers){const B=this._layers[L];if(!B)return this.fire(new h.k(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];_[B.source]=!0}}const T=[];o.availableImages=this._availableImages;const E=this._serializedAllLayers(),R=o.layers instanceof Set?o.layers:Array.isArray(o.layers)?new Set(o.layers):null,k=Object.assign(Object.assign({},o),{layers:R,globalState:this._globalState});for(const L in this.sourceCaches)o.layers&&!_[L]||T.push(ar(this.sourceCaches[L],this._layers,E,t,k,p,this.map.terrain?(B,$,F)=>this.map.terrain.getElevation(B,$,F):void 0));return this.placement&&T.push((function(L,B,$,F,Z,te,ae){const oe={},ce=te.queryRenderedSymbols(F),he=[];for(const ge of Object.keys(ce).map(Number))he.push(ae[ge]);he.sort(uo);for(const ge of he){const de=ge.featureIndex.lookupSymbolFeatures(ce[ge.bucketInstanceId],B,ge.bucketIndex,ge.sourceLayerIndex,{filterSpec:Z.filter,globalState:Z.globalState},Z.layers,Z.availableImages,L);for(const be in de){const Ie=oe[be]=oe[be]||[],fe=de[be];fe.sort(((ze,Xe)=>{const $e=ge.featureSortOrder;if($e){const Ge=$e.indexOf(ze.featureIndex);return $e.indexOf(Xe.featureIndex)-Ge}return Xe.featureIndex-ze.featureIndex}));for(const ze of fe)Ie.push(ze)}}return(function(ge,de,be){for(const Ie in ge)for(const fe of ge[Ie])Na(fe,be[de[Ie].source]);return ge})(oe,L,$)})(this._layers,E,this.sourceCaches,t,k,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(t,o){o?.filter&&this._validate(h.z.filter,"querySourceFeatures.filter",o.filter,null,o);const p=this.sourceCaches[t];return p?(function(_,T){const E=_.getRenderableIds().map((L=>_.getTileByID(L))),R=[],k={};for(let L=0;L<E.length;L++){const B=E[L],$=B.tileID.canonical.key;k[$]||(k[$]=!0,B.querySourceFeatures(R,T))}return R})(p,o?Object.assign(Object.assign({},o),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,o={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in t)if(!h.bH(t[E],p[E])){_=!0;break}if(!_)return;const T={now:ee.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,o),this.light.updateTransitions(T)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,o={}){this._checkLoaded();const p=this.getSky();let _=!1;if(!t&&!p)return;if(t&&!p)_=!0;else if(!t&&p)_=!0;else for(const E in t)if(!h.bH(t[E],p[E])){_=!0;break}if(!_)return;const T={now:ee.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,o),this.sky.updateTransitions(T)}_setProjectionInternal(t){const o=(function(p){if(Array.isArray(p)){const _=new yo({type:p});return{projection:_,transform:new To,cameraHelper:new Rc(_)}}switch(p){case"mercator":return{projection:new on,transform:new Vn,cameraHelper:new xi};case"globe":{const _=new yo({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:_,transform:new To,cameraHelper:new Rc(_)}}case"vertical-perspective":return{projection:new qa,transform:new bl,cameraHelper:new ti};default:return h.w(`Unknown projection name: ${p}. Falling back to mercator projection.`),{projection:new on,transform:new Vn,cameraHelper:new xi}}})(t);this.projection=o.projection,this.map.migrateProjection(o.transform,o.cameraHelper);for(const p in this.sourceCaches)this.sourceCaches[p].reload()}_validate(t,o,p,_,T={}){return(!T||T.validate!==!1)&&ql(this,t.call(h.z,h.e({key:o,style:this.serialize(),value:p,styleSpec:h.v},_)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ki().off(Bo,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const p=this.sourceCaches[o];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const o in this.sourceCaches)this.sourceCaches[o].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,o,p,_,T=!1){let E=!1,R=!1;const k={};for(const L of this._order){const B=this._layers[L];if(B.type!=="symbol")continue;if(!k[B.source]){const F=this.sourceCaches[B.source];k[B.source]=F.getRenderableIds(!0).map((Z=>F.getTileByID(Z))).sort(((Z,te)=>te.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(te.tileID)?-1:1)))}const $=this.crossTileSymbolIndex.addLayer(B,k[B.source],t.center.lng);E=E||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ee.now(),t.zoom))&&(this.pauseablePlacement=new Fl(t,this.map.terrain,this._order,T,o,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ee.now()),R=!0),E&&this.pauseablePlacement.placement.setStale()),R||E)for(const L of this._order){const B=this._layers[L];B.type==="symbol"&&this.placement.updateLayerOpacities(B,k[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ee.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,o){return h._(this,void 0,void 0,(function*(){const p=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const _=this.sourceCaches[o.source];return _&&_.setDependencies(o.tileID.key,o.type,o.icons),p}))}getGlyphs(t,o){return h._(this,void 0,void 0,(function*(){const p=yield this.glyphManager.getGlyphs(o.stacks),_=this.sourceCaches[o.source];return _&&_.setDependencies(o.tileID.key,o.type,[""]),p}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,o={}){this._checkLoaded(),t&&this._validate(h.z.glyphs,"glyphs",t,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,o,p={},_){this._checkLoaded();const T=[{id:t,url:o}],E=[...Pt(this.stylesheet.sprite),...T];this._validate(h.z.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(T,!0,_))}removeSprite(t){this._checkLoaded();const o=Pt(this.stylesheet.sprite);if(o.find((p=>p.id===t))){if(this._spritesImagesIds[t])for(const p of this._spritesImagesIds[t])this.imageManager.removeImage(p),this._changedImages[p]=!0;o.splice(o.findIndex((p=>p.id===t)),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}else this.fire(new h.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Pt(this.stylesheet.sprite)}setSprite(t,o={},p){this._checkLoaded(),t&&this._validate(h.z.sprite,"sprite",t,null,o)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,p):(this._unloadSprite(),p&&p(null)))}}var U=h.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class G{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,o,p,_,T,E,R,k,L){this.context=t;let B=this.boundPaintVertexBuffers.length!==_.length;for(let $=0;!B&&$<_.length;$++)this.boundPaintVertexBuffers[$]!==_[$]&&(B=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==p||B||this.boundIndexBuffer!==T||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==L?this.freshBind(o,p,_,T,E,R,k,L):(t.bindVertexArray.set(this.vao),R&&R.bind(),T&&T.dynamicDraw&&T.bind(),k&&k.bind(),L&&L.bind())}freshBind(t,o,p,_,T,E,R,k){const L=t.numAttributes,B=this.context,$=B.gl;this.vao&&this.destroy(),this.vao=B.createVertexArray(),B.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=k,o.enableAttributes($,t);for(const F of p)F.enableAttributes($,t);E&&E.enableAttributes($,t),R&&R.enableAttributes($,t),k&&k.enableAttributes($,t),o.bind(),o.setVertexAttribPointers($,t,T);for(const F of p)F.bind(),F.setVertexAttribPointers($,t,T);E&&(E.bind(),E.setVertexAttribPointers($,t,T)),_&&_.bind(),R&&(R.bind(),R.setVertexAttribPointers($,t,T)),k&&(k.bind(),k.setVertexAttribPointers($,t,T)),B.currentNumAttributes=L}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const le=(b,t,o,p,_)=>({u_texture:0,u_ele_delta:b,u_fog_matrix:t,u_fog_color:o?o.properties.get("fog-color"):h.bf.white,u_fog_ground_blend:o?o.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?0:o?o.calculateFogBlendOpacity(p):0,u_horizon_color:o?o.properties.get("horizon-color"):h.bf.white,u_horizon_fog_blend:o?o.properties.get("horizon-fog-blend"):1,u_is_globe_mode:_?1:0}),We={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function tt(b){const t=[];for(let o=0;o<b.length;o++){if(b[o]===null)continue;const p=b[o].split(" ");t.push(p.pop())}return t}class Rt{constructor(t,o,p,_,T,E,R,k,L=[]){const B=t.gl;this.program=B.createProgram();const $=tt(o.staticAttributes),F=p?p.getBinderAttributes():[],Z=$.concat(F),te=Ar.prelude.staticUniforms?tt(Ar.prelude.staticUniforms):[],ae=R.staticUniforms?tt(R.staticUniforms):[],oe=o.staticUniforms?tt(o.staticUniforms):[],ce=p?p.getBinderUniforms():[],he=te.concat(ae).concat(oe).concat(ce),ge=[];for(const $e of he)ge.indexOf($e)<0&&ge.push($e);const de=p?p.defines():[];Bi(B)&&de.unshift("#version 300 es"),T&&de.push("#define OVERDRAW_INSPECTOR;"),E&&de.push("#define TERRAIN3D;"),k&&de.push(k),L&&de.push(...L);let be=de.concat(Ar.prelude.fragmentSource,R.fragmentSource,o.fragmentSource).join(`
`),Ie=de.concat(Ar.prelude.vertexSource,R.vertexSource,o.vertexSource).join(`
`);Bi(B)||(be=(function($e){return $e.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(be),Ie=(function($e){return $e.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ie));const fe=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(fe,be),B.compileShader(fe),!B.getShaderParameter(fe,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(fe)}`);B.attachShader(this.program,fe);const ze=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(ze,Ie),B.compileShader(ze),!B.getShaderParameter(ze,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(ze)}`);B.attachShader(this.program,ze),this.attributes={};const Xe={};this.numAttributes=Z.length;for(let $e=0;$e<this.numAttributes;$e++)Z[$e]&&(B.bindAttribLocation(this.program,$e,Z[$e]),this.attributes[Z[$e]]=$e);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(ze),B.deleteShader(fe);for(let $e=0;$e<ge.length;$e++){const Ge=ge[$e];if(Ge&&!Xe[Ge]){const Ye=B.getUniformLocation(this.program,Ge);Ye&&(Xe[Ge]=Ye)}}this.fixedUniforms=_(t,Xe),this.terrainUniforms=(($e,Ge)=>({u_depth:new h.bP($e,Ge.u_depth),u_terrain:new h.bP($e,Ge.u_terrain),u_terrain_dim:new h.bg($e,Ge.u_terrain_dim),u_terrain_matrix:new h.bR($e,Ge.u_terrain_matrix),u_terrain_unpack:new h.bS($e,Ge.u_terrain_unpack),u_terrain_exaggeration:new h.bg($e,Ge.u_terrain_exaggeration)}))(t,Xe),this.projectionUniforms=(($e,Ge)=>({u_projection_matrix:new h.bR($e,Ge.u_projection_matrix),u_projection_tile_mercator_coords:new h.bS($e,Ge.u_projection_tile_mercator_coords),u_projection_clipping_plane:new h.bS($e,Ge.u_projection_clipping_plane),u_projection_transition:new h.bg($e,Ge.u_projection_transition),u_projection_fallback_matrix:new h.bR($e,Ge.u_projection_fallback_matrix)}))(t,Xe),this.binderUniforms=p?p.getUniforms(t,Xe):[]}draw(t,o,p,_,T,E,R,k,L,B,$,F,Z,te,ae,oe,ce,he,ge){const de=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(_),t.setColorMode(T),t.setCullFace(E),k){t.activeTexture.set(de.TEXTURE2),de.bindTexture(de.TEXTURE_2D,k.depthTexture),t.activeTexture.set(de.TEXTURE3),de.bindTexture(de.TEXTURE_2D,k.texture);for(const Ie in this.terrainUniforms)this.terrainUniforms[Ie].set(k[Ie])}if(L)for(const Ie in L)this.projectionUniforms[We[Ie]].set(L[Ie]);if(R)for(const Ie in this.fixedUniforms)this.fixedUniforms[Ie].set(R[Ie]);oe&&oe.setUniforms(t,this.binderUniforms,te,{zoom:ae});let be=0;switch(o){case de.LINES:be=2;break;case de.TRIANGLES:be=3;break;case de.LINE_STRIP:be=1}for(const Ie of Z.get()){const fe=Ie.vaos||(Ie.vaos={});(fe[B]||(fe[B]=new G)).bind(t,this,$,oe?oe.getPaintVertexBuffers():[],F,Ie.vertexOffset,ce,he,ge),de.drawElements(o,Ie.primitiveLength*be,de.UNSIGNED_SHORT,Ie.primitiveOffset*be*2)}}}function yn(b,t,o){const p=1/h.aC(o,1,t.transform.tileZoom),_=Math.pow(2,o.tileID.overscaledZ),T=o.tileSize*Math.pow(2,t.transform.tileZoom)/_,E=T*(o.tileID.canonical.x+o.tileID.wrap*_),R=T*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[p,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[E>>16,R>>16],u_pixel_coord_lower:[65535&E,65535&R]}}const jn=(b,t,o,p)=>{const _=b.style.light,T=_.properties.get("position"),E=[T.x,T.y,T.z],R=h.bV();_.properties.get("anchor")==="viewport"&&h.bW(R,b.transform.bearingInRadians),h.bX(E,E,R);const k=b.transform.transformLightDirection(E),L=_.properties.get("color");return{u_lightpos:E,u_lightpos_globe:k,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+t,u_opacity:o,u_fill_translate:p}},ai=(b,t,o,p,_,T,E)=>h.e(jn(b,t,o,p),yn(T,b,E),{u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8}),qi=(b,t,o,p)=>h.e(yn(t,b,o),{u_fill_translate:p}),Hr=(b,t)=>({u_world:b,u_fill_translate:t}),Vs=(b,t,o,p,_)=>h.e(qi(b,t,o,_),{u_world:p}),Ga=(b,t,o,p,_)=>{const T=b.transform;let E,R,k=0;if(o.paint.get("circle-pitch-alignment")==="map"){const L=h.aC(t,1,T.zoom);E=!0,R=[L,L],k=L/(h.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*_}else E=!1,R=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+E,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:R,u_globe_extrude_scale:k,u_translate:p}},js=b=>({u_pixel_extrude_scale:[1/b.width,1/b.height]}),Ha=b=>({u_viewport_size:[b.width,b.height]}),Za=(b,t=1)=>({u_color:b,u_overlay:0,u_overlay_scale:t}),Zf=(b,t,o,p)=>{const _=h.aC(b,1,t)/(h.$*Math.pow(2,b.tileID.overscaledZ))*2*Math.PI*p;return{u_extrude_scale:h.aC(b,1,t),u_intensity:o,u_globe_extrude_scale:_}},Cd=(b,t,o,p)=>{const _=h.L();h.bY(_,0,b.width,b.height,0,0,1);const T=b.context.gl;return{u_matrix:_,u_world:[T.drawingBufferWidth,T.drawingBufferHeight],u_image:o,u_color_ramp:p,u_opacity:t.paint.get("heatmap-opacity")}},Wf=(b,t,o)=>{const p=o.paint.get("hillshade-accent-color");let _;switch(o.paint.get("hillshade-method")){case"basic":_=4;break;case"combined":_=1;break;case"igor":_=2;break;case"multidirectional":_=3;break;default:_=0}const T=o.getIlluminationProperties();for(let E=0;E<T.directionRadians.length;E++)o.paint.get("hillshade-illumination-anchor")==="viewport"&&(T.directionRadians[E]+=b.transform.bearingInRadians);return{u_image:0,u_latrange:Gl(0,t.tileID),u_exaggeration:o.paint.get("hillshade-exaggeration"),u_altitudes:T.altitudeRadians,u_azimuths:T.directionRadians,u_accent:p,u_method:_,u_highlights:T.highlightColor,u_shadows:T.shadowColor}},Pd=(b,t)=>{const o=t.stride,p=h.L();return h.bY(p,0,h.$,-h.$,0,0,1),h.M(p,p,[0,-h.$,0]),{u_matrix:p,u_image:1,u_dimension:[o,o],u_zoom:b.overscaledZ,u_unpack:t.getUnpackVector()}};function Gl(b,t){const o=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new h.a1(0,p/o).toLngLat().lat,new h.a1(0,(p+1)/o).toLngLat().lat]}const Mc=(b,t,o=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:o,u_opacity:b.paint.get("color-relief-opacity")}),_h=(b,t,o,p)=>{const _=b.transform;return{u_translation:Au(b,t,o),u_ratio:p/h.aC(t,1,_.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Su=(b,t,o,p,_)=>h.e(_h(b,t,o,p),{u_image:0,u_image_height:_}),Rd=(b,t,o,p,_)=>{const T=b.transform,E=Eu(t,T);return{u_translation:Au(b,t,o),u_texsize:t.imageAtlasTexture.size,u_ratio:p/h.aC(t,1,T.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[E,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},wl=(b,t,o,p,_,T)=>{const E=b.lineAtlas,R=Eu(t,b.transform),k=o.layout.get("line-cap")==="round",L=E.getDash(_.from,k),B=E.getDash(_.to,k),$=L.width*T.fromScale,F=B.width*T.toScale;return h.e(_h(b,t,o,p),{u_patternscale_a:[R/$,-L.height/2],u_patternscale_b:[R/F,-B.height/2],u_sdfgamma:E.width/(256*Math.min($,F)*b.pixelRatio)/2,u_image:0,u_tex_y_a:L.y,u_tex_y_b:B.y,u_mix:T.t})};function Eu(b,t){return 1/h.aC(b,1,t.tileZoom)}function Au(b,t,o){return h.aD(b.transform,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const kc=(b,t,o,p,_)=>{return{u_tl_parent:b,u_scale_parent:t,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(E=p.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(T=p.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Kf(p.paint.get("raster-hue-rotate")),u_coords_top:[_[0].x,_[0].y,_[1].x,_[1].y],u_coords_bottom:[_[3].x,_[3].y,_[2].x,_[2].y]};var T,E};function Kf(b){b*=Math.PI/180;const t=Math.sin(b),o=Math.cos(b);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const Dc=(b,t,o,p,_,T,E,R,k,L,B,$,F)=>{const Z=E.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:Z.width/Z.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_label_plane_matrix:R,u_coord_matrix:k,u_is_text:+B,u_pitch_with_map:+p,u_is_along_line:_,u_is_variable_anchor:T,u_texsize:$,u_texture:0,u_translation:L,u_pitched_scale:F}},Xf=(b,t,o,p,_,T,E,R,k,L,B,$,F,Z)=>{const te=E.transform;return h.e(Dc(b,t,o,p,_,T,E,R,k,L,B,$,Z),{u_gamma_scale:p?Math.cos(te.pitch*Math.PI/180)*te.cameraToCenterDistance:1,u_device_pixel_ratio:E.pixelRatio,u_is_halo:1})},_m=(b,t,o,p,_,T,E,R,k,L,B,$,F)=>h.e(Xf(b,t,o,p,_,T,E,R,k,L,!0,B,0,F),{u_texsize_icon:$,u_texture_icon:1}),Yf=(b,t)=>({u_opacity:b,u_color:t}),Qf=(b,t,o,p,_)=>h.e((function(T,E,R,k){const L=R.imageManager.getPattern(T.from.toString()),B=R.imageManager.getPattern(T.to.toString()),{width:$,height:F}=R.imageManager.getPixelSize(),Z=Math.pow(2,k.tileID.overscaledZ),te=k.tileSize*Math.pow(2,R.transform.tileZoom)/Z,ae=te*(k.tileID.canonical.x+k.tileID.wrap*Z),oe=te*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[$,F],u_mix:E.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/h.aC(k,1,R.transform.tileZoom),u_pixel_coord_upper:[ae>>16,oe>>16],u_pixel_coord_lower:[65535&ae,65535&oe]}})(o,_,t,p),{u_opacity:b}),Md=(b,t)=>{},vs={fillExtrusion:(b,t)=>({u_lightpos:new h.bT(b,t.u_lightpos),u_lightpos_globe:new h.bT(b,t.u_lightpos_globe),u_lightintensity:new h.bg(b,t.u_lightintensity),u_lightcolor:new h.bT(b,t.u_lightcolor),u_vertical_gradient:new h.bg(b,t.u_vertical_gradient),u_opacity:new h.bg(b,t.u_opacity),u_fill_translate:new h.bU(b,t.u_fill_translate)}),fillExtrusionPattern:(b,t)=>({u_lightpos:new h.bT(b,t.u_lightpos),u_lightpos_globe:new h.bT(b,t.u_lightpos_globe),u_lightintensity:new h.bg(b,t.u_lightintensity),u_lightcolor:new h.bT(b,t.u_lightcolor),u_vertical_gradient:new h.bg(b,t.u_vertical_gradient),u_height_factor:new h.bg(b,t.u_height_factor),u_opacity:new h.bg(b,t.u_opacity),u_fill_translate:new h.bU(b,t.u_fill_translate),u_image:new h.bP(b,t.u_image),u_texsize:new h.bU(b,t.u_texsize),u_pixel_coord_upper:new h.bU(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.bU(b,t.u_pixel_coord_lower),u_scale:new h.bT(b,t.u_scale),u_fade:new h.bg(b,t.u_fade)}),fill:(b,t)=>({u_fill_translate:new h.bU(b,t.u_fill_translate)}),fillPattern:(b,t)=>({u_image:new h.bP(b,t.u_image),u_texsize:new h.bU(b,t.u_texsize),u_pixel_coord_upper:new h.bU(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.bU(b,t.u_pixel_coord_lower),u_scale:new h.bT(b,t.u_scale),u_fade:new h.bg(b,t.u_fade),u_fill_translate:new h.bU(b,t.u_fill_translate)}),fillOutline:(b,t)=>({u_world:new h.bU(b,t.u_world),u_fill_translate:new h.bU(b,t.u_fill_translate)}),fillOutlinePattern:(b,t)=>({u_world:new h.bU(b,t.u_world),u_image:new h.bP(b,t.u_image),u_texsize:new h.bU(b,t.u_texsize),u_pixel_coord_upper:new h.bU(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.bU(b,t.u_pixel_coord_lower),u_scale:new h.bT(b,t.u_scale),u_fade:new h.bg(b,t.u_fade),u_fill_translate:new h.bU(b,t.u_fill_translate)}),circle:(b,t)=>({u_camera_to_center_distance:new h.bg(b,t.u_camera_to_center_distance),u_scale_with_map:new h.bP(b,t.u_scale_with_map),u_pitch_with_map:new h.bP(b,t.u_pitch_with_map),u_extrude_scale:new h.bU(b,t.u_extrude_scale),u_device_pixel_ratio:new h.bg(b,t.u_device_pixel_ratio),u_globe_extrude_scale:new h.bg(b,t.u_globe_extrude_scale),u_translate:new h.bU(b,t.u_translate)}),collisionBox:(b,t)=>({u_pixel_extrude_scale:new h.bU(b,t.u_pixel_extrude_scale)}),collisionCircle:(b,t)=>({u_viewport_size:new h.bU(b,t.u_viewport_size)}),debug:(b,t)=>({u_color:new h.bQ(b,t.u_color),u_overlay:new h.bP(b,t.u_overlay),u_overlay_scale:new h.bg(b,t.u_overlay_scale)}),depth:Md,clippingMask:Md,heatmap:(b,t)=>({u_extrude_scale:new h.bg(b,t.u_extrude_scale),u_intensity:new h.bg(b,t.u_intensity),u_globe_extrude_scale:new h.bg(b,t.u_globe_extrude_scale)}),heatmapTexture:(b,t)=>({u_matrix:new h.bR(b,t.u_matrix),u_world:new h.bU(b,t.u_world),u_image:new h.bP(b,t.u_image),u_color_ramp:new h.bP(b,t.u_color_ramp),u_opacity:new h.bg(b,t.u_opacity)}),hillshade:(b,t)=>({u_image:new h.bP(b,t.u_image),u_latrange:new h.bU(b,t.u_latrange),u_exaggeration:new h.bg(b,t.u_exaggeration),u_altitudes:new h.b_(b,t.u_altitudes),u_azimuths:new h.b_(b,t.u_azimuths),u_accent:new h.bQ(b,t.u_accent),u_method:new h.bP(b,t.u_method),u_shadows:new h.bZ(b,t.u_shadows),u_highlights:new h.bZ(b,t.u_highlights)}),hillshadePrepare:(b,t)=>({u_matrix:new h.bR(b,t.u_matrix),u_image:new h.bP(b,t.u_image),u_dimension:new h.bU(b,t.u_dimension),u_zoom:new h.bg(b,t.u_zoom),u_unpack:new h.bS(b,t.u_unpack)}),colorRelief:(b,t)=>({u_image:new h.bP(b,t.u_image),u_unpack:new h.bS(b,t.u_unpack),u_dimension:new h.bU(b,t.u_dimension),u_elevation_stops:new h.bP(b,t.u_elevation_stops),u_color_stops:new h.bP(b,t.u_color_stops),u_color_ramp_size:new h.bP(b,t.u_color_ramp_size),u_opacity:new h.bg(b,t.u_opacity)}),line:(b,t)=>({u_translation:new h.bU(b,t.u_translation),u_ratio:new h.bg(b,t.u_ratio),u_device_pixel_ratio:new h.bg(b,t.u_device_pixel_ratio),u_units_to_pixels:new h.bU(b,t.u_units_to_pixels)}),lineGradient:(b,t)=>({u_translation:new h.bU(b,t.u_translation),u_ratio:new h.bg(b,t.u_ratio),u_device_pixel_ratio:new h.bg(b,t.u_device_pixel_ratio),u_units_to_pixels:new h.bU(b,t.u_units_to_pixels),u_image:new h.bP(b,t.u_image),u_image_height:new h.bg(b,t.u_image_height)}),linePattern:(b,t)=>({u_translation:new h.bU(b,t.u_translation),u_texsize:new h.bU(b,t.u_texsize),u_ratio:new h.bg(b,t.u_ratio),u_device_pixel_ratio:new h.bg(b,t.u_device_pixel_ratio),u_image:new h.bP(b,t.u_image),u_units_to_pixels:new h.bU(b,t.u_units_to_pixels),u_scale:new h.bT(b,t.u_scale),u_fade:new h.bg(b,t.u_fade)}),lineSDF:(b,t)=>({u_translation:new h.bU(b,t.u_translation),u_ratio:new h.bg(b,t.u_ratio),u_device_pixel_ratio:new h.bg(b,t.u_device_pixel_ratio),u_units_to_pixels:new h.bU(b,t.u_units_to_pixels),u_patternscale_a:new h.bU(b,t.u_patternscale_a),u_patternscale_b:new h.bU(b,t.u_patternscale_b),u_sdfgamma:new h.bg(b,t.u_sdfgamma),u_image:new h.bP(b,t.u_image),u_tex_y_a:new h.bg(b,t.u_tex_y_a),u_tex_y_b:new h.bg(b,t.u_tex_y_b),u_mix:new h.bg(b,t.u_mix)}),raster:(b,t)=>({u_tl_parent:new h.bU(b,t.u_tl_parent),u_scale_parent:new h.bg(b,t.u_scale_parent),u_buffer_scale:new h.bg(b,t.u_buffer_scale),u_fade_t:new h.bg(b,t.u_fade_t),u_opacity:new h.bg(b,t.u_opacity),u_image0:new h.bP(b,t.u_image0),u_image1:new h.bP(b,t.u_image1),u_brightness_low:new h.bg(b,t.u_brightness_low),u_brightness_high:new h.bg(b,t.u_brightness_high),u_saturation_factor:new h.bg(b,t.u_saturation_factor),u_contrast_factor:new h.bg(b,t.u_contrast_factor),u_spin_weights:new h.bT(b,t.u_spin_weights),u_coords_top:new h.bS(b,t.u_coords_top),u_coords_bottom:new h.bS(b,t.u_coords_bottom)}),symbolIcon:(b,t)=>({u_is_size_zoom_constant:new h.bP(b,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bP(b,t.u_is_size_feature_constant),u_size_t:new h.bg(b,t.u_size_t),u_size:new h.bg(b,t.u_size),u_camera_to_center_distance:new h.bg(b,t.u_camera_to_center_distance),u_pitch:new h.bg(b,t.u_pitch),u_rotate_symbol:new h.bP(b,t.u_rotate_symbol),u_aspect_ratio:new h.bg(b,t.u_aspect_ratio),u_fade_change:new h.bg(b,t.u_fade_change),u_label_plane_matrix:new h.bR(b,t.u_label_plane_matrix),u_coord_matrix:new h.bR(b,t.u_coord_matrix),u_is_text:new h.bP(b,t.u_is_text),u_pitch_with_map:new h.bP(b,t.u_pitch_with_map),u_is_along_line:new h.bP(b,t.u_is_along_line),u_is_variable_anchor:new h.bP(b,t.u_is_variable_anchor),u_texsize:new h.bU(b,t.u_texsize),u_texture:new h.bP(b,t.u_texture),u_translation:new h.bU(b,t.u_translation),u_pitched_scale:new h.bg(b,t.u_pitched_scale)}),symbolSDF:(b,t)=>({u_is_size_zoom_constant:new h.bP(b,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bP(b,t.u_is_size_feature_constant),u_size_t:new h.bg(b,t.u_size_t),u_size:new h.bg(b,t.u_size),u_camera_to_center_distance:new h.bg(b,t.u_camera_to_center_distance),u_pitch:new h.bg(b,t.u_pitch),u_rotate_symbol:new h.bP(b,t.u_rotate_symbol),u_aspect_ratio:new h.bg(b,t.u_aspect_ratio),u_fade_change:new h.bg(b,t.u_fade_change),u_label_plane_matrix:new h.bR(b,t.u_label_plane_matrix),u_coord_matrix:new h.bR(b,t.u_coord_matrix),u_is_text:new h.bP(b,t.u_is_text),u_pitch_with_map:new h.bP(b,t.u_pitch_with_map),u_is_along_line:new h.bP(b,t.u_is_along_line),u_is_variable_anchor:new h.bP(b,t.u_is_variable_anchor),u_texsize:new h.bU(b,t.u_texsize),u_texture:new h.bP(b,t.u_texture),u_gamma_scale:new h.bg(b,t.u_gamma_scale),u_device_pixel_ratio:new h.bg(b,t.u_device_pixel_ratio),u_is_halo:new h.bP(b,t.u_is_halo),u_translation:new h.bU(b,t.u_translation),u_pitched_scale:new h.bg(b,t.u_pitched_scale)}),symbolTextAndIcon:(b,t)=>({u_is_size_zoom_constant:new h.bP(b,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bP(b,t.u_is_size_feature_constant),u_size_t:new h.bg(b,t.u_size_t),u_size:new h.bg(b,t.u_size),u_camera_to_center_distance:new h.bg(b,t.u_camera_to_center_distance),u_pitch:new h.bg(b,t.u_pitch),u_rotate_symbol:new h.bP(b,t.u_rotate_symbol),u_aspect_ratio:new h.bg(b,t.u_aspect_ratio),u_fade_change:new h.bg(b,t.u_fade_change),u_label_plane_matrix:new h.bR(b,t.u_label_plane_matrix),u_coord_matrix:new h.bR(b,t.u_coord_matrix),u_is_text:new h.bP(b,t.u_is_text),u_pitch_with_map:new h.bP(b,t.u_pitch_with_map),u_is_along_line:new h.bP(b,t.u_is_along_line),u_is_variable_anchor:new h.bP(b,t.u_is_variable_anchor),u_texsize:new h.bU(b,t.u_texsize),u_texsize_icon:new h.bU(b,t.u_texsize_icon),u_texture:new h.bP(b,t.u_texture),u_texture_icon:new h.bP(b,t.u_texture_icon),u_gamma_scale:new h.bg(b,t.u_gamma_scale),u_device_pixel_ratio:new h.bg(b,t.u_device_pixel_ratio),u_is_halo:new h.bP(b,t.u_is_halo),u_translation:new h.bU(b,t.u_translation),u_pitched_scale:new h.bg(b,t.u_pitched_scale)}),background:(b,t)=>({u_opacity:new h.bg(b,t.u_opacity),u_color:new h.bQ(b,t.u_color)}),backgroundPattern:(b,t)=>({u_opacity:new h.bg(b,t.u_opacity),u_image:new h.bP(b,t.u_image),u_pattern_tl_a:new h.bU(b,t.u_pattern_tl_a),u_pattern_br_a:new h.bU(b,t.u_pattern_br_a),u_pattern_tl_b:new h.bU(b,t.u_pattern_tl_b),u_pattern_br_b:new h.bU(b,t.u_pattern_br_b),u_texsize:new h.bU(b,t.u_texsize),u_mix:new h.bg(b,t.u_mix),u_pattern_size_a:new h.bU(b,t.u_pattern_size_a),u_pattern_size_b:new h.bU(b,t.u_pattern_size_b),u_scale_a:new h.bg(b,t.u_scale_a),u_scale_b:new h.bg(b,t.u_scale_b),u_pixel_coord_upper:new h.bU(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.bU(b,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.bg(b,t.u_tile_units_to_pixels)}),terrain:(b,t)=>({u_texture:new h.bP(b,t.u_texture),u_ele_delta:new h.bg(b,t.u_ele_delta),u_fog_matrix:new h.bR(b,t.u_fog_matrix),u_fog_color:new h.bQ(b,t.u_fog_color),u_fog_ground_blend:new h.bg(b,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.bg(b,t.u_fog_ground_blend_opacity),u_horizon_color:new h.bQ(b,t.u_horizon_color),u_horizon_fog_blend:new h.bg(b,t.u_horizon_fog_blend),u_is_globe_mode:new h.bg(b,t.u_is_globe_mode)}),terrainDepth:(b,t)=>({u_ele_delta:new h.bg(b,t.u_ele_delta)}),terrainCoords:(b,t)=>({u_texture:new h.bP(b,t.u_texture),u_terrain_coords_id:new h.bg(b,t.u_terrain_coords_id),u_ele_delta:new h.bg(b,t.u_ele_delta)}),projectionErrorMeasurement:(b,t)=>({u_input:new h.bg(b,t.u_input),u_output_expected:new h.bg(b,t.u_output_expected)}),atmosphere:(b,t)=>({u_sun_pos:new h.bT(b,t.u_sun_pos),u_atmosphere_blend:new h.bg(b,t.u_atmosphere_blend),u_globe_position:new h.bT(b,t.u_globe_position),u_globe_radius:new h.bg(b,t.u_globe_radius),u_inv_proj_matrix:new h.bR(b,t.u_inv_proj_matrix)}),sky:(b,t)=>({u_sky_color:new h.bQ(b,t.u_sky_color),u_horizon_color:new h.bQ(b,t.u_horizon_color),u_horizon:new h.bU(b,t.u_horizon),u_horizon_normal:new h.bU(b,t.u_horizon_normal),u_sky_horizon_blend:new h.bg(b,t.u_sky_horizon_blend),u_sky_blend:new h.bg(b,t.u_sky_blend)})};class Oc{constructor(t,o,p){this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Iu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class So{constructor(t,o,p,_){this.length=o.length,this.attributes=p,this.itemSize=o.bytesPerElement,this.dynamicDraw=_,this.context=t;const T=t.gl;this.buffer=T.createBuffer(),t.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let p=0;p<this.attributes.length;p++){const _=o.attributes[this.attributes[p].name];_!==void 0&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,o,p){for(let _=0;_<this.attributes.length;_++){const T=this.attributes[_],E=o.attributes[T.name];E!==void 0&&t.vertexAttribPointer(E,T.components,t[Iu[T.type]],!1,this.itemSize,T.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Un{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yh extends Un{getDefault(){return h.bf.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Cu extends Un{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Jf extends Un{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Tl extends Un{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $o extends Un{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Hl extends Un{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class kd extends Un{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ep extends Un{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Zl extends Un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class zc extends Un{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class vh extends Un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class tp extends Un{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Sl extends Un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class Pu extends Un{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ru extends Un{getDefault(){return h.bf.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Mu extends Un{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Dd extends Un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class Wl extends Un{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ku extends Un{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Kl extends Un{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class aa extends Un{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class bh extends Un{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ia extends Un{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class xh extends Un{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Nr extends Un{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class bs extends Un{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class qo extends Un{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xl extends Un{getDefault(){return null}set(t){var o;if(t===this.current&&!this.dirty)return;const p=this.gl;Bi(p)?p.bindVertexArray(t):(o=p.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Yl extends Un{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Du extends Un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class El extends Un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class oa extends Un{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Od extends oa{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Lc extends oa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wn extends oa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Ou="Framebuffer is not complete";class la{constructor(t,o,p,_,T){this.context=t,this.width=o,this.height=p;const E=t.gl,R=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new Od(t,R),_)this.depthAttachment=T?new wn(t,R):new Lc(t,R);else if(T)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error(Ou)}destroy(){const t=this.context.gl,o=this.colorAttachment.get();if(o&&t.deleteTexture(o),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class wh{constructor(t){var o,p;if(this.gl=t,this.clearColor=new yh(this),this.clearDepth=new Cu(this),this.clearStencil=new Jf(this),this.colorMask=new Tl(this),this.depthMask=new $o(this),this.stencilMask=new Hl(this),this.stencilFunc=new kd(this),this.stencilOp=new ep(this),this.stencilTest=new Zl(this),this.depthRange=new zc(this),this.depthTest=new vh(this),this.depthFunc=new tp(this),this.blend=new Sl(this),this.blendFunc=new Pu(this),this.blendColor=new Ru(this),this.blendEquation=new Mu(this),this.cullFace=new Dd(this),this.cullFaceSide=new Wl(this),this.frontFace=new ku(this),this.program=new Kl(this),this.activeTexture=new aa(this),this.viewport=new bh(this),this.bindFramebuffer=new Ia(this),this.bindRenderbuffer=new xh(this),this.bindTexture=new Nr(this),this.bindVertexBuffer=new bs(this),this.bindElementBuffer=new qo(this),this.bindVertexArray=new Xl(this),this.pixelStoreUnpack=new Yl(this),this.pixelStoreUnpackPremultiplyAlpha=new Du(this),this.pixelStoreUnpackFlipY=new El(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Bi(t)){this.HALF_FLOAT=t.HALF_FLOAT;const _=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=t.RGBA16F)!==null&&o!==void 0?o:_?.RGBA16F_EXT,this.RGB16F=(p=t.RGB16F)!==null&&p!==void 0?p:_?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const _=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=_?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o){return new Oc(this,t,o)}createVertexBuffer(t,o,p){return new So(this,t,o,p)}createRenderbuffer(t,o,p){const _=this.gl,T=_.createRenderbuffer();return this.bindRenderbuffer.set(T),_.renderbufferStorage(_.RENDERBUFFER,t,o,p),this.bindRenderbuffer.set(null),T}createFramebuffer(t,o,p,_){return new la(this,t,o,p,_)}clear({color:t,depth:o,stencil:p}){const _=this.gl;let T=0;t&&(T|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(T|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),p!==void 0&&(T|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(T)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.bH(t.blendFunction,ln.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Bi(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var o;return Bi(this.gl)?this.gl.deleteVertexArray(t):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let is;function zd(b,t,o,p,_){const T=b.context,E=b.transform,R=T.gl,k=b.useProgram("collisionBox"),L=[];let B=0,$=0;for(let ce=0;ce<p.length;ce++){const he=p[ce],ge=t.getTile(he).getBucket(o);if(!ge)continue;const de=_?ge.textCollisionBox:ge.iconCollisionBox,be=ge.collisionCircleArray;be.length>0&&(L.push({circleArray:be,circleOffset:$,coord:he}),B+=be.length/4,$=B),de&&k.draw(T,R.LINES,an.disabled,Cn.disabled,b.colorModeForRenderPass(),Qt.disabled,js(b.transform),b.style.map.terrain&&b.style.map.terrain.getTerrainData(he),E.getProjectionData({overscaledTileID:he,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),o.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,b.transform.zoom,null,null,de.collisionVertexBuffer)}if(!_||!L.length)return;const F=b.useProgram("collisionCircle"),Z=new h.b$;Z.resize(4*B),Z._trim();let te=0;for(const ce of L)for(let he=0;he<ce.circleArray.length/4;he++){const ge=4*he,de=ce.circleArray[ge+0],be=ce.circleArray[ge+1],Ie=ce.circleArray[ge+2],fe=ce.circleArray[ge+3];Z.emplace(te++,de,be,Ie,fe,0),Z.emplace(te++,de,be,Ie,fe,1),Z.emplace(te++,de,be,Ie,fe,2),Z.emplace(te++,de,be,Ie,fe,3)}(!is||is.length<2*B)&&(is=(function(ce){const he=2*ce,ge=new h.c1;ge.resize(he),ge._trim();for(let de=0;de<he;de++){const be=6*de;ge.uint16[be+0]=4*de+0,ge.uint16[be+1]=4*de+1,ge.uint16[be+2]=4*de+2,ge.uint16[be+3]=4*de+2,ge.uint16[be+4]=4*de+3,ge.uint16[be+5]=4*de+0}return ge})(B));const ae=T.createIndexBuffer(is,!0),oe=T.createVertexBuffer(Z,h.c0.members,!0);for(const ce of L){const he=Ha(b.transform);F.draw(T,R.TRIANGLES,an.disabled,Cn.disabled,b.colorModeForRenderPass(),Qt.disabled,he,b.style.map.terrain&&b.style.map.terrain.getTerrainData(ce.coord),null,o.id,oe,ae,h.aM.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,b.transform.zoom,null,null,null)}oe.destroy(),ae.destroy()}const Th=h.ag(new Float32Array(16));function Al(b,t,o,p,_,T){const{horizontalAlign:E,verticalAlign:R}=h.aH(b);return new h.P((-(E-.5)*t/_+p[0])*T,(-(R-.5)*o/_+p[1])*T)}function Ld(b,t,o,p,_,T){const E=t.tileAnchorPoint.add(new h.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let R=p.mult(T);o||(R=R.rotate(-_));const k=E.add(R);return fi(k.x,k.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(o){const R=$i(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(b),k=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return b.add(p.rotate(k))}return b.add(p)}function zu(b,t,o,p,_,T,E,R,k,L,B,$){const F=b.text.placedSymbolArray,Z=b.text.dynamicLayoutVertexArray,te=b.icon.dynamicLayoutVertexArray,ae={};Z.clear();for(let oe=0;oe<F.length;oe++){const ce=F.get(oe),he=ce.hidden||!ce.crossTileID||b.allowVerticalPlacement&&!ce.placedOrientation?null:p[ce.crossTileID];if(he){const ge=new h.P(ce.anchorX,ce.anchorY),de={getElevation:$,width:_.width,height:_.height,pitchedLabelPlaneMatrix:T,pitchWithMap:o,transform:_,tileAnchorPoint:ge,translation:L,unwrappedTileID:B},be=o?pi(ge.x,ge.y,de):$i(ge.x,ge.y,de),Ie=yt(_.cameraToCenterDistance,be.signedDistanceFromCamera);let fe=h.ap(b.textSizeData,R,ce)*Ie/h.aB;o&&(fe*=b.tilePixelRatio/E);const{width:ze,height:Xe,anchor:$e,textOffset:Ge,textBoxScale:Ye}=he,Et=Al($e,ze,Xe,Ge,Ye,fe),wt=_.getPitchedTextCorrection(ge.x+L[0],ge.y+L[1],B),lt=Ld(be.point,de,t,Et,-_.bearingInRadians,wt),Bt=b.allowVerticalPlacement&&ce.placedOrientation===h.ao.vertical?Math.PI/2:0;for(let Tn=0;Tn<ce.numGlyphs;Tn++)h.av(Z,lt,Bt);k&&ce.associatedIconIndex>=0&&(ae[ce.associatedIconIndex]={shiftedAnchor:lt,angle:Bt})}else Qr(ce.numGlyphs,Z)}if(k){te.clear();const oe=b.icon.placedSymbolArray;for(let ce=0;ce<oe.length;ce++){const he=oe.get(ce);if(he.hidden)Qr(he.numGlyphs,te);else{const ge=ae[ce];if(ge)for(let de=0;de<he.numGlyphs;de++)h.av(te,ge.shiftedAnchor,ge.angle);else Qr(he.numGlyphs,te)}}b.icon.dynamicLayoutVertexBuffer.updateData(te)}b.text.dynamicLayoutVertexBuffer.updateData(Z)}function Go(b,t,o){return o.iconsInText&&t?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function Eo(b,t,o,p,_,T,E,R,k,L,B,$,F){const Z=b.context,te=Z.gl,ae=b.transform,oe=R==="map",ce=k==="map",he=R!=="viewport"&&o.layout.get("symbol-placement")!=="point",ge=oe&&!ce&&!he,de=!o.layout.get("symbol-sort-key").isConstant();let be=!1;const Ie=b.getDepthModeForSublayer(0,an.ReadOnly),fe=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ze=[],Xe=ae.getCircleRadiusCorrection();for(const $e of p){const Ge=t.getTile($e),Ye=Ge.getBucket(o);if(!Ye)continue;const Et=_?Ye.text:Ye.icon;if(!Et||!Et.segments.get().length||!Et.hasVisibleVertices)continue;const wt=Et.programConfigurations.get(o.id),lt=_||Ye.sdfIcons,Bt=_?Ye.textSizeData:Ye.iconSizeData,Tn=ce||ae.pitch!==0,Fn=b.useProgram(Go(lt,_,Ye),wt),Di=h.an(Bt,ae.zoom),li=b.style.map.terrain&&b.style.map.terrain.getTerrainData($e);let ci,Ti,_i,ui,Ln=[0,0],Er=null;if(_)Ti=Ge.glyphAtlasTexture,_i=te.LINEAR,ci=Ge.glyphAtlasTexture.size,Ye.iconsInText&&(Ln=Ge.imageAtlasTexture.size,Er=Ge.imageAtlasTexture,ui=Tn||b.options.rotating||b.options.zooming||Bt.kind==="composite"||Bt.kind==="camera"?te.LINEAR:te.NEAREST);else{const Zn=o.layout.get("icon-size").constantOr(0)!==1||Ye.iconsNeedLinear;Ti=Ge.imageAtlasTexture,_i=lt||b.options.rotating||b.options.zooming||Zn||Tn?te.LINEAR:te.NEAREST,ci=Ge.imageAtlasTexture.size}const fr=h.aC(Ge,1,b.transform.zoom),Is=ei(oe,b.transform,fr),zl=h.L();h.aq(zl,Is);const el=Kt(ce,oe,b.transform,fr),Cs=h.aD(ae,Ge,T,E),tl=ae.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),Ll=fe&&Ye.hasTextData(),$u=o.layout.get("icon-text-fit")!=="none"&&Ll&&Ye.hasIconData();if(he){const Zn=b.style.map.terrain?(ss,Yi)=>b.style.map.terrain.getElevation($e,ss,Yi):null,Ui=o.layout.get("text-rotation-alignment")==="map";Ni(Ye,b,_,Is,zl,ce,L,Ui,$e.toUnwrapped(),ae.width,ae.height,Cs,Zn)}const nl=_&&fe||$u,jr=he||nl?Th:ce?Is:b.transform.clipSpaceToPixelsMatrix,Co=lt&&o.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Po;Po=lt?Ye.iconsInText?_m(Bt.kind,Di,ge,ce,he,nl,b,jr,el,Cs,ci,Ln,Xe):Xf(Bt.kind,Di,ge,ce,he,nl,b,jr,el,Cs,_,ci,0,Xe):Dc(Bt.kind,Di,ge,ce,he,nl,b,jr,el,Cs,_,ci,Xe);const Nl={program:Fn,buffers:Et,uniformValues:Po,projectionData:tl,atlasTexture:Ti,atlasTextureIcon:Er,atlasInterpolation:_i,atlasInterpolationIcon:ui,isSDF:lt,hasHalo:Co};if(de&&Ye.canOverlap){be=!0;const Zn=Et.segments.get();for(const Ui of Zn)ze.push({segments:new h.aM([Ui]),sortKey:Ui.sortKey,state:Nl,terrainData:li})}else ze.push({segments:Et.segments,sortKey:0,state:Nl,terrainData:li})}be&&ze.sort((($e,Ge)=>$e.sortKey-Ge.sortKey));for(const $e of ze){const Ge=$e.state;if(Z.activeTexture.set(te.TEXTURE0),Ge.atlasTexture.bind(Ge.atlasInterpolation,te.CLAMP_TO_EDGE),Ge.atlasTextureIcon&&(Z.activeTexture.set(te.TEXTURE1),Ge.atlasTextureIcon&&Ge.atlasTextureIcon.bind(Ge.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Ge.isSDF){const Ye=Ge.uniformValues;Ge.hasHalo&&(Ye.u_is_halo=1,Il(Ge.buffers,$e.segments,o,b,Ge.program,Ie,B,$,Ye,Ge.projectionData,$e.terrainData)),Ye.u_is_halo=0}Il(Ge.buffers,$e.segments,o,b,Ge.program,Ie,B,$,Ge.uniformValues,Ge.projectionData,$e.terrainData)}}function Il(b,t,o,p,_,T,E,R,k,L,B){const $=p.context;_.draw($,$.gl.TRIANGLES,T,E,R,Qt.backCCW,k,B,L,o.id,b.layoutVertexBuffer,b.indexBuffer,t,o.paint,p.transform.zoom,b.programConfigurations.get(o.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function Nc(b,t,o,p,_){const T=b.context,E=T.gl,R=Cn.disabled,k=new ln([E.ONE,E.ONE],h.bf.transparent,[!0,!0,!0,!0]),L=t.getBucket(o);if(!L)return;const B=p.key;let $=o.heatmapFbos.get(B);$||($=rs(T,t.tileSize,t.tileSize),o.heatmapFbos.set(B,$)),T.bindFramebuffer.set($.framebuffer),T.viewport.set([0,0,t.tileSize,t.tileSize]),T.clear({color:h.bf.transparent});const F=L.programConfigurations.get(o.id),Z=b.useProgram("heatmap",F,!_),te=b.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ae=b.style.map.terrain.getTerrainData(p);Z.draw(T,E.TRIANGLES,an.disabled,R,k,Qt.disabled,Zf(t,b.transform.zoom,o.paint.get("heatmap-intensity"),1),ae,te,o.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,o.paint,b.transform.zoom,F)}function ca(b,t,o,p,_){const T=b.context,E=T.gl,R=b.transform;T.setColorMode(b.colorModeForRenderPass());const k=Wa(T,t),L=o.key,B=t.heatmapFbos.get(L);if(!B)return;T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,B.colorAttachment.get()),T.activeTexture.set(E.TEXTURE1),k.bind(E.LINEAR,E.CLAMP_TO_EDGE);const $=R.getProjectionData({overscaledTileID:o,applyTerrainMatrix:_,applyGlobeMatrix:!p});b.useProgram("heatmapTexture").draw(T,E.TRIANGLES,an.disabled,Cn.disabled,b.colorModeForRenderPass(),Qt.disabled,Cd(b,t,0,1),null,$,t.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments,t.paint,R.zoom),B.destroy(),t.heatmapFbos.delete(L)}function rs(b,t,o){var p,_;const T=b.gl,E=T.createTexture();T.bindTexture(T.TEXTURE_2D,E),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR);const R=(p=b.HALF_FLOAT)!==null&&p!==void 0?p:T.UNSIGNED_BYTE,k=(_=b.RGBA16F)!==null&&_!==void 0?_:T.RGBA;T.texImage2D(T.TEXTURE_2D,0,k,t,o,0,T.RGBA,R,null);const L=b.createFramebuffer(t,o,!1,!1);return L.colorAttachment.set(E),L}function Wa(b,t){return t.colorRampTexture||(t.colorRampTexture=new h.T(b,t.colorRamp,b.gl.RGBA)),t.colorRampTexture}function ua(b,t,o,p,_){if(!o||!p||!p.imageAtlas)return;const T=p.imageAtlas.patternPositions;let E=T[o.to.toString()],R=T[o.from.toString()];if(!E&&R&&(E=R),!R&&E&&(R=E),!E||!R){const k=_.getPaintProperty(t);E=T[k],R=T[k]}E&&R&&b.setConstantPatternPositions(E,R)}function xs(b,t,o,p,_,T,E,R){const k=b.context.gl,L="fill-pattern",B=o.paint.get(L),$=B&&B.constantOr(1),F=o.getCrossfadeParameters();let Z,te,ae,oe,ce;const he=b.transform,ge=o.paint.get("fill-translate"),de=o.paint.get("fill-translate-anchor");E?(te=$&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=k.LINES):(te=$?"fillPattern":"fill",Z=k.TRIANGLES);const be=B.constantOr(null);for(const Ie of p){const fe=t.getTile(Ie);if($&&!fe.patternsLoaded())continue;const ze=fe.getBucket(o);if(!ze)continue;const Xe=ze.programConfigurations.get(o.id),$e=b.useProgram(te,Xe),Ge=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ie);$&&(b.context.activeTexture.set(k.TEXTURE0),fe.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Xe.updatePaintBuffers(F)),ua(Xe,L,be,fe,o);const Ye=he.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Et=h.aD(he,fe,ge,de);if(E){oe=ze.indexBuffer2,ce=ze.segments2;const lt=[k.drawingBufferWidth,k.drawingBufferHeight];ae=te==="fillOutlinePattern"&&$?Vs(b,F,fe,lt,Et):Hr(lt,Et)}else oe=ze.indexBuffer,ce=ze.segments,ae=$?qi(b,F,fe,Et):{u_fill_translate:Et};const wt=b.stencilModeForClipping(Ie);$e.draw(b.context,Z,_,wt,T,Qt.backCCW,ae,Ge,Ye,o.id,ze.layoutVertexBuffer,oe,ce,o.paint,b.transform.zoom,Xe)}}function Ka(b,t,o,p,_,T,E,R){const k=b.context,L=k.gl,B="fill-extrusion-pattern",$=o.paint.get(B),F=$.constantOr(1),Z=o.getCrossfadeParameters(),te=o.paint.get("fill-extrusion-opacity"),ae=$.constantOr(null),oe=b.transform;for(const ce of p){const he=t.getTile(ce),ge=he.getBucket(o);if(!ge)continue;const de=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ce),be=ge.programConfigurations.get(o.id),Ie=b.useProgram(F?"fillExtrusionPattern":"fillExtrusion",be);F&&(b.context.activeTexture.set(L.TEXTURE0),he.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),be.updatePaintBuffers(Z));const fe=oe.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!R,applyTerrainMatrix:!0});ua(be,B,ae,he,o);const ze=h.aD(oe,he,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Xe=o.paint.get("fill-extrusion-vertical-gradient"),$e=F?ai(b,Xe,te,ze,ce,Z,he):jn(b,Xe,te,ze);Ie.draw(k,k.gl.TRIANGLES,_,T,E,Qt.backCCW,$e,de,fe,o.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,o.paint,b.transform.zoom,be,b.style.map.terrain&&ge.centroidVertexBuffer)}}function Sh(b,t,o,p,_,T,E,R,k){var L;const B=b.style.projection,$=b.context,F=b.transform,Z=$.gl,te=[`#define NUM_ILLUMINATION_SOURCES ${o.paint.get("hillshade-highlight-color").values.length}`],ae=b.useProgram("hillshade",null,!1,te),oe=!b.options.moving;for(const ce of p){const he=t.getTile(ce),ge=he.fbo;if(!ge)continue;const de=B.getMeshFromTileID($,ce.canonical,R,!0,"raster"),be=(L=b.style.map.terrain)===null||L===void 0?void 0:L.getTerrainData(ce);$.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,ge.colorAttachment.get());const Ie=F.getProjectionData({overscaledTileID:ce,aligned:oe,applyGlobeMatrix:!k,applyTerrainMatrix:!0});ae.draw($,Z.TRIANGLES,T,_[ce.overscaledZ],E,Qt.backCCW,Wf(b,he,o),be,Ie,o.id,de.vertexBuffer,de.indexBuffer,de.segments)}}function Ho(b,t,o,p,_,T,E,R,k){var L;const B=b.style.projection,$=b.context,F=b.transform,Z=$.gl,te=b.useProgram("colorRelief"),ae=!b.options.moving;let oe=!0,ce=0;for(const he of p){const ge=t.getTile(he),de=ge.dem;if(oe){const $e=Z.getParameter(Z.MAX_TEXTURE_SIZE),{elevationTexture:Ge,colorTexture:Ye}=o.getColorRampTextures($,$e,de.getUnpackVector());$.activeTexture.set(Z.TEXTURE1),Ge.bind(Z.NEAREST,Z.CLAMP_TO_EDGE),$.activeTexture.set(Z.TEXTURE4),Ye.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),oe=!1,ce=Ge.size[0]}if(!de||!de.data)continue;const be=de.stride,Ie=de.getPixels();if($.activeTexture.set(Z.TEXTURE0),$.pixelStoreUnpackPremultiplyAlpha.set(!1),ge.demTexture=ge.demTexture||b.getTileTexture(be),ge.demTexture){const $e=ge.demTexture;$e.update(Ie,{premultiply:!1}),$e.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}else ge.demTexture=new h.T($,Ie,Z.RGBA,{premultiply:!1}),ge.demTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const fe=B.getMeshFromTileID($,he.canonical,R,!0,"raster"),ze=(L=b.style.map.terrain)===null||L===void 0?void 0:L.getTerrainData(he),Xe=F.getProjectionData({overscaledTileID:he,aligned:ae,applyGlobeMatrix:!k,applyTerrainMatrix:!0});te.draw($,Z.TRIANGLES,T,_[he.overscaledZ],E,Qt.backCCW,Mc(o,ge.dem,ce),ze,Xe,o.id,fe.vertexBuffer,fe.indexBuffer,fe.segments)}}const Lu=[new h.P(0,0),new h.P(h.$,0),new h.P(h.$,h.$),new h.P(0,h.$)];function Ir(b,t,o,p,_,T,E,R,k=!1,L=!1){const B=p[p.length-1].overscaledZ,$=b.context,F=$.gl,Z=b.useProgram("raster"),te=b.transform,ae=b.style.projection,oe=b.colorModeForRenderPass(),ce=!b.options.moving;for(const he of p){const ge=b.getDepthModeForSublayer(he.overscaledZ-B,o.paint.get("raster-opacity")===1?an.ReadWrite:an.ReadOnly,F.LESS),de=t.getTile(he);de.registerFadeDuration(o.paint.get("raster-fade-duration"));const be=t.findLoadedParent(he,0),Ie=t.findLoadedSibling(he),fe=ji(de,be||Ie||null,t,o,b.transform,b.style.map.terrain);let ze,Xe;const $e=o.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;$.activeTexture.set(F.TEXTURE0),de.texture.bind($e,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),$.activeTexture.set(F.TEXTURE1),be?(be.texture.bind($e,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,be.tileID.overscaledZ-de.tileID.overscaledZ),Xe=[de.tileID.canonical.x*ze%1,de.tileID.canonical.y*ze%1]):de.texture.bind($e,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),de.texture.useMipmap&&$.extTextureFilterAnisotropic&&b.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const Ge=b.style.map.terrain&&b.style.map.terrain.getTerrainData(he),Ye=te.getProjectionData({overscaledTileID:he,aligned:ce,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),Et=kc(Xe||[0,0],ze||1,fe,o,R),wt=ae.getMeshFromTileID($,he.canonical,T,E,"raster");Z.draw($,F.TRIANGLES,ge,_?_[he.overscaledZ]:Cn.disabled,oe,k?Qt.frontCCW:Qt.backCCW,Et,Ge,Ye,o.id,wt.vertexBuffer,wt.indexBuffer,wt.segments)}}function ji(b,t,o,p,_,T){const E=p.paint.get("raster-fade-duration");if(!T&&E>0){const R=ee.now(),k=(R-b.timeAdded)/E,L=t?(R-t.timeAdded)/E:-1,B=o.getSource(),$=zt(_,{tileSize:B.tileSize,roundZoom:B.roundZoom}),F=!t||Math.abs(t.tileID.overscaledZ-$)>Math.abs(b.tileID.overscaledZ-$),Z=F&&b.refreshedUponExpiration?1:h.ah(F?k:1-L,0,1);return b.refreshedUponExpiration&&k>=1&&(b.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const Hn=new h.bf(1,0,0,1),Cl=new h.bf(0,1,0,1),Xa=new h.bf(0,0,1,1),Bc=new h.bf(1,0,1,1),Zo=new h.bf(0,1,1,1);function Nd(b,t,o,p){oi(b,0,t+o/2,b.transform.width,o,p)}function Eh(b,t,o,p){oi(b,t-o/2,0,o,b.transform.height,p)}function oi(b,t,o,p,_,T){const E=b.context,R=E.gl;R.enable(R.SCISSOR_TEST),R.scissor(t*b.pixelRatio,o*b.pixelRatio,p*b.pixelRatio,_*b.pixelRatio),E.clear({color:T}),R.disable(R.SCISSOR_TEST)}function Ya(b,t,o){const p=b.context,_=p.gl,T=b.useProgram("debug"),E=an.disabled,R=Cn.disabled,k=b.colorModeForRenderPass(),L="$debug",B=b.style.map.terrain&&b.style.map.terrain.getTerrainData(o);p.activeTexture.set(_.TEXTURE0);const $=t.getTileByID(o.key).latestRawTileData,F=Math.floor(($&&$.byteLength||0)/1024),Z=t.getTile(o).tileSize,te=512/Math.min(Z,512)*(o.overscaledZ/b.transform.zoom)*.5;let ae=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(ae+=` => ${o.overscaledZ}`),(function(ce,he){ce.initDebugOverlayCanvas();const ge=ce.debugOverlayCanvas,de=ce.context.gl,be=ce.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,ge.width,ge.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(he,5,5),be.strokeText(he,5,5),ce.debugOverlayTexture.update(ge),ce.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)})(b,`${ae} ${F}kB`);const oe=b.transform.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(p,_.TRIANGLES,E,R,ln.alphaBlended,Qt.disabled,Za(h.bf.transparent,te),null,oe,L,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),T.draw(p,_.LINE_STRIP,E,R,k,Qt.disabled,Za(h.bf.red),B,oe,L,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function Us(b,t,o,p){const{isRenderingGlobe:_}=p,T=b.context,E=T.gl,R=b.transform,k=b.colorModeForRenderPass(),L=b.getDepthModeFor3D(),B=b.useProgram("terrain");T.bindFramebuffer.set(null),T.viewport.set([0,0,b.width,b.height]);for(const $ of o){const F=t.getTerrainMesh($.tileID),Z=b.renderToTexture.getTexture($),te=t.getTerrainData($.tileID);T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,Z.texture);const ae=t.getMeshFrameDelta(R.zoom),oe=R.calculateFogMatrix($.tileID.toUnwrapped()),ce=le(ae,oe,b.style.sky,R.pitch,_),he=R.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});B.draw(T,E.TRIANGLES,L,Cn.disabled,k,Qt.backCCW,ce,te,he,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}}function Pl(b,t){if(!t.mesh){const o=new h.aL;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(1,1),o.emplaceBack(-1,1);const p=new h.aN;p.emplaceBack(0,1,2),p.emplaceBack(0,2,3),t.mesh=new ja(b.createVertexBuffer(o,na.members),b.createIndexBuffer(p),h.aM.simpleSegment(0,0,o.length,p.length))}return t.mesh}class Vc{constructor(t,o){this.context=new wh(t),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=_n.maxUnderzooming+_n.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new jo}resize(t,o,p){if(this.width=Math.floor(t*p),this.height=Math.floor(o*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const t=this.context,o=new h.aL;o.emplaceBack(0,0),o.emplaceBack(h.$,0),o.emplaceBack(0,h.$),o.emplaceBack(h.$,h.$),this.tileExtentBuffer=t.createVertexBuffer(o,na.members),this.tileExtentSegments=h.aM.simpleSegment(0,0,4,2);const p=new h.aL;p.emplaceBack(0,0),p.emplaceBack(h.$,0),p.emplaceBack(0,h.$),p.emplaceBack(h.$,h.$),this.debugBuffer=t.createVertexBuffer(p,na.members),this.debugSegments=h.aM.simpleSegment(0,0,4,5);const _=new h.c6;_.emplaceBack(0,0,0,0),_.emplaceBack(h.$,0,h.$,0),_.emplaceBack(0,h.$,0,h.$),_.emplaceBack(h.$,h.$,h.$,h.$),this.rasterBoundsBuffer=t.createVertexBuffer(_,U.members),this.rasterBoundsSegments=h.aM.simpleSegment(0,0,4,2);const T=new h.aL;T.emplaceBack(0,0),T.emplaceBack(h.$,0),T.emplaceBack(0,h.$),T.emplaceBack(h.$,h.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(T,na.members),this.rasterBoundsSegmentsPosOnly=h.aM.simpleSegment(0,0,4,5);const E=new h.aL;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(E,na.members),this.viewportSegments=h.aM.simpleSegment(0,0,4,2);const R=new h.c7;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(R);const k=new h.aN;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(k);const L=this.context.gl;this.stencilClearMode=new Cn({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.tileExtentMesh=new ja(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,o=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=h.L();h.bY(p,0,this.width,this.height,0,0,1),h.N(p,p,[o.drawingBufferWidth,o.drawingBufferHeight,0]);const _={mainMatrix:p,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:p};this.useProgram("clippingMask",null,!0).draw(t,o.TRIANGLES,an.disabled,this.stencilClearMode,ln.disabled,Qt.disabled,null,null,_,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,o,p){if(this.currentStencilSource===t.source||!t.isTileClipped()||!o||!o.length)return;this.currentStencilSource=t.source,this.nextStencilID+o.length>256&&this.clearStencil();const _=this.context;_.setColorMode(ln.disabled),_.setDepthMode(an.disabled);const T={};for(const E of o)T[E.key]=this.nextStencilID++;this._renderTileMasks(T,o,p,!0),this._renderTileMasks(T,o,p,!1),this._tileClippingMaskIDs=T}_renderTileMasks(t,o,p,_){const T=this.context,E=T.gl,R=this.style.projection,k=this.transform,L=this.useProgram("clippingMask");for(const B of o){const $=t[B.key],F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B),Z=R.getMeshFromTileID(this.context,B.canonical,_,!0,"stencil"),te=k.getProjectionData({overscaledTileID:B,applyGlobeMatrix:!p,applyTerrainMatrix:!0});L.draw(T,E.TRIANGLES,an.disabled,new Cn({func:E.ALWAYS,mask:0},$,255,E.KEEP,E.KEEP,E.REPLACE),ln.disabled,p?Qt.disabled:Qt.backCCW,null,F,te,"$clipping",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}_renderTilesDepthBuffer(){const t=this.context,o=t.gl,p=this.style.projection,_=this.transform,T=this.useProgram("depth"),E=this.getDepthModeFor3D(),R=Re(_,{tileSize:_.tileSize});for(const k of R){const L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),B=p.getMeshFromTileID(this.context,k.canonical,!0,!0,"raster"),$=_.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(t,o.TRIANGLES,E,Cn.disabled,ln.disabled,Qt.backCCW,null,L,$,"$clipping",B.vertexBuffer,B.indexBuffer,B.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new Cn({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){const o=this.context.gl;return new Cn({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const o=this.context.gl,p=t.sort(((E,R)=>R.overscaledZ-E.overscaledZ)),_=p[p.length-1].overscaledZ,T=p[0].overscaledZ-_+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const E={};for(let R=0;R<T;R++)E[R+_]=new Cn({func:o.GEQUAL,mask:255},R+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=T,[E,p]}return[{[_]:Cn.disabled},p]}stencilConfigForOverlapTwoPass(t){const o=this.context.gl,p=t.sort(((E,R)=>R.overscaledZ-E.overscaledZ)),_=p[p.length-1].overscaledZ,T=p[0].overscaledZ-_+1;if(this.clearStencil(),T>1){const E={},R={};for(let k=0;k<T;k++)E[k+_]=new Cn({func:o.GREATER,mask:255},T+1+k,255,o.KEEP,o.KEEP,o.REPLACE),R[k+_]=new Cn({func:o.GREATER,mask:255},1+k,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID=2*T+1,[E,R,p]}return this.nextStencilID=3,[{[_]:new Cn({func:o.GREATER,mask:255},2,255,o.KEEP,o.KEEP,o.REPLACE)},{[_]:new Cn({func:o.GREATER,mask:255},1,255,o.KEEP,o.KEEP,o.REPLACE)},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ln([t.CONSTANT_COLOR,t.ONE],new h.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ln.unblended:ln.alphaBlended}getDepthModeForSublayer(t,o,p){if(!this.opaquePassEnabledForLayer())return an.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new an(p||this.context.gl.LEQUAL,o,[_,_])}getDepthModeFor3D(){return new an(this.context.gl.LEQUAL,an.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,o){var p,_;this.style=t,this.options=o,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(ee.now()),this.imageManager.beginFrame();const T=this.style._order,E=this.style.sourceCaches,R={},k={},L={},B={isRenderingToTexture:!1,isRenderingGlobe:((p=t.projection)===null||p===void 0?void 0:p.transitionState)>0};for(const F in E){const Z=E[F];Z.used&&Z.prepare(this.context),R[F]=Z.getVisibleCoordinates(!1),k[F]=R[F].slice().reverse(),L[F]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<T.length;F++)if(this.style._layers[T[F]].is3D()){this.opaquePassCutoff=F;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const F of T){const Z=this.style._layers[F];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const te=k[Z.source];(Z.type==="custom"||te.length)&&this.renderLayer(this,E[Z.source],Z,te,B)}if((_=this.style.projection)===null||_===void 0||_.updateGPUdependent({context:this.context,useProgram:F=>this.useProgram(F)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?h.bf.black:h.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(F,Z){const te=F.context,ae=te.gl,oe=((Ie,fe,ze)=>{const Xe=Math.cos(fe.rollInRadians),$e=Math.sin(fe.rollInRadians),Ge=xe(fe),Ye=fe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ie.properties.get("sky-color"),u_horizon_color:Ie.properties.get("horizon-color"),u_horizon:[(fe.width/2-Ge*$e)*ze,(fe.height/2+Ge*Xe)*ze],u_horizon_normal:[-$e,Xe],u_sky_horizon_blend:Ie.properties.get("sky-horizon-blend")*fe.height/2*ze,u_sky_blend:Ye}})(Z,F.style.map.transform,F.pixelRatio),ce=new an(ae.LEQUAL,an.ReadWrite,[0,1]),he=Cn.disabled,ge=F.colorModeForRenderPass(),de=F.useProgram("sky"),be=Pl(te,Z);de.draw(te,ae.TRIANGLES,ce,he,ge,Qt.disabled,oe,null,void 0,"sky",be.vertexBuffer,be.indexBuffer,be.segments)})(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[T[this.currentLayer]],Z=E[F.source],te=R[F.source];this._renderTileClippingMasks(F,te,!1),this.renderLayer(this,Z,F,te,B)}this.renderPass="translucent";let $=!1;for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const F=this.style._layers[T[this.currentLayer]],Z=E[F.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(F,B))continue;this.opaquePassEnabledForLayer()||$||($=!0,B.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const te=(F.type==="symbol"?L:k)[F.source];this._renderTileClippingMasks(F,R[F.source],!!this.renderToTexture),this.renderLayer(this,Z,F,te,B)}if(B.isRenderingGlobe&&(function(F,Z,te){const ae=F.context,oe=ae.gl,ce=F.useProgram("atmosphere"),he=new an(oe.LEQUAL,an.ReadOnly,[0,1]),ge=F.transform,de=(function(Ye,Et){const wt=Ye.properties.get("position"),lt=[-wt.x,-wt.y,-wt.z],Bt=h.ag(new Float64Array(16));return Ye.properties.get("anchor")==="map"&&(h.b6(Bt,Bt,Et.rollInRadians),h.b7(Bt,Bt,-Et.pitchInRadians),h.b6(Bt,Bt,Et.bearingInRadians),h.b7(Bt,Bt,Et.center.lat*Math.PI/180),h.bz(Bt,Bt,-Et.center.lng*Math.PI/180)),h.c5(lt,lt,Bt),lt})(te,F.transform),be=ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ie=Z.properties.get("atmosphere-blend")*be.projectionTransition;if(Ie===0)return;const fe=Aa(ge.worldSize,ge.center.lat),ze=ge.inverseProjectionMatrix,Xe=new Float64Array(4);Xe[3]=1,h.aw(Xe,Xe,ge.modelViewProjectionMatrix),Xe[0]/=Xe[3],Xe[1]/=Xe[3],Xe[2]/=Xe[3],Xe[3]=1,h.aw(Xe,Xe,ze),Xe[0]/=Xe[3],Xe[1]/=Xe[3],Xe[2]/=Xe[3],Xe[3]=1;const $e=((Ye,Et,wt,lt,Bt)=>({u_sun_pos:Ye,u_atmosphere_blend:Et,u_globe_position:wt,u_globe_radius:lt,u_inv_proj_matrix:Bt}))(de,Ie,[Xe[0],Xe[1],Xe[2]],fe,ze),Ge=Pl(ae,Z);ce.draw(ae,oe.TRIANGLES,he,Cn.disabled,ln.alphaBlended,Qt.disabled,$e,null,null,"atmosphere",Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const F=(function(Z,te){let ae=null;const oe=Object.values(Z._layers).flatMap((de=>de.source&&!de.isHidden(te)?[Z.sourceCaches[de.source]]:[])),ce=oe.filter((de=>de.getSource().type==="vector")),he=oe.filter((de=>de.getSource().type!=="vector")),ge=de=>{(!ae||ae.getSource().maxzoom<de.getSource().maxzoom)&&(ae=de)};return ce.forEach((de=>ge(de))),ae||he.forEach((de=>ge(de))),ae})(this.style,this.transform.zoom);F&&(function(Z,te,ae){for(let oe=0;oe<ae.length;oe++)Ya(Z,te,ae[oe])})(this,F,F.getVisibleCoordinates())}this.options.showPadding&&(function(F){const Z=F.transform.padding;Nd(F,F.transform.height-(Z.top||0),3,Hn),Nd(F,Z.bottom||0,3,Cl),Eh(F,Z.left||0,3,Xa),Eh(F,F.transform.width-(Z.right||0),3,Bc);const te=F.transform.centerPoint;(function(ae,oe,ce,he){oi(ae,oe-1,ce-10,2,20,he),oi(ae,oe-10,ce-1,20,2,he)})(F,te.x,F.transform.height-te.y,Zo)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let _=this.terrainFacilitator.dirty;_||(_=t?!h.c8(o,p):!h.c9(o,p)),_||(_=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),_&&(h.ca(o,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(T,E){const R=T.context,k=R.gl,L=T.transform,B=ln.unblended,$=new an(k.LEQUAL,an.ReadWrite,[0,1]),F=E.sourceCache.getRenderableTiles(),Z=T.useProgram("terrainDepth");R.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),R.clear({color:h.bf.transparent,depth:1});for(const te of F){const ae=E.getTerrainMesh(te.tileID),oe=E.getTerrainData(te.tileID),ce=L.getProjectionData({overscaledTileID:te.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),he={u_ele_delta:E.getMeshFrameDelta(L.zoom)};Z.draw(R,k.TRIANGLES,$,Cn.disabled,B,Qt.backCCW,he,oe,ce,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,T.width,T.height])})(this,this.style.map.terrain),(function(T,E){const R=T.context,k=R.gl,L=T.transform,B=ln.unblended,$=new an(k.LEQUAL,an.ReadWrite,[0,1]),F=E.getCoordsTexture(),Z=E.sourceCache.getRenderableTiles(),te=T.useProgram("terrainCoords");R.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),R.clear({color:h.bf.transparent,depth:1}),E.coordsIndex=[];for(const ae of Z){const oe=E.getTerrainMesh(ae.tileID),ce=E.getTerrainData(ae.tileID);R.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,F.texture);const he={u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(L.zoom)},ge=L.getProjectionData({overscaledTileID:ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});te.draw(R,k.TRIANGLES,$,Cn.disabled,B,Qt.backCCW,he,ce,ge,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments),E.coordsIndex.push(ae.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,T.width,T.height])})(this,this.style.map.terrain))}renderLayer(t,o,p,_,T){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,h.cb(p)?(function(E,R,k,L,B,$){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:F}=$,Z=Cn.disabled,te=E.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ae,oe,ce,he,ge,de,be,Ie,fe){const ze=oe.transform,Xe=oe.style.map.terrain,$e=ge==="map",Ge=de==="map";for(const Ye of ae){const Et=he.getTile(Ye),wt=Et.getBucket(ce);if(!wt||!wt.text||!wt.text.segments.get().length)continue;const lt=h.an(wt.textSizeData,ze.zoom),Bt=h.aC(Et,1,oe.transform.zoom),Tn=ei($e,oe.transform,Bt),Fn=ce.layout.get("icon-text-fit")!=="none"&&wt.hasIconData();if(lt){const Di=Math.pow(2,ze.zoom-Et.tileID.overscaledZ),li=Xe?(ci,Ti)=>Xe.getElevation(Ye,ci,Ti):null;zu(wt,$e,Ge,fe,ze,Tn,Di,lt,Fn,h.aD(ze,Et,be,Ie),Ye.toUnwrapped(),li)}}})(L,E,k,R,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),B),k.paint.get("icon-opacity").constantOr(1)!==0&&Eo(E,R,k,L,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),Z,te,F),k.paint.get("text-opacity").constantOr(1)!==0&&Eo(E,R,k,L,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),Z,te,F),R.map.showCollisionBoxes&&(zd(E,R,k,L,!0),zd(E,R,k,L,!1))})(t,o,p,_,this.style.placement.variableOffsets,T):h.cc(p)?(function(E,R,k,L,B){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:$}=B,F=k.paint.get("circle-opacity"),Z=k.paint.get("circle-stroke-width"),te=k.paint.get("circle-stroke-opacity"),ae=!k.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(Z.constantOr(1)===0||te.constantOr(1)===0))return;const oe=E.context,ce=oe.gl,he=E.transform,ge=E.getDepthModeForSublayer(0,an.ReadOnly),de=Cn.disabled,be=E.colorModeForRenderPass(),Ie=[],fe=he.getCircleRadiusCorrection();for(let ze=0;ze<L.length;ze++){const Xe=L[ze],$e=R.getTile(Xe),Ge=$e.getBucket(k);if(!Ge)continue;const Ye=k.paint.get("circle-translate"),Et=k.paint.get("circle-translate-anchor"),wt=h.aD(he,$e,Ye,Et),lt=Ge.programConfigurations.get(k.id),Bt=E.useProgram("circle",lt),Tn=Ge.layoutVertexBuffer,Fn=Ge.indexBuffer,Di=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Xe),li={programConfiguration:lt,program:Bt,layoutVertexBuffer:Tn,indexBuffer:Fn,uniformValues:Ga(E,$e,k,wt,fe),terrainData:Di,projectionData:he.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!$,applyTerrainMatrix:!0})};if(ae){const ci=Ge.segments.get();for(const Ti of ci)Ie.push({segments:new h.aM([Ti]),sortKey:Ti.sortKey,state:li})}else Ie.push({segments:Ge.segments,sortKey:0,state:li})}ae&&Ie.sort(((ze,Xe)=>ze.sortKey-Xe.sortKey));for(const ze of Ie){const{programConfiguration:Xe,program:$e,layoutVertexBuffer:Ge,indexBuffer:Ye,uniformValues:Et,terrainData:wt,projectionData:lt}=ze.state;$e.draw(oe,ce.TRIANGLES,ge,de,be,Qt.backCCW,Et,wt,lt,k.id,Ge,Ye,ze.segments,k.paint,E.transform.zoom,Xe)}})(t,o,p,_,T):h.cd(p)?(function(E,R,k,L,B){if(k.paint.get("heatmap-opacity")===0)return;const $=E.context,{isRenderingToTexture:F,isRenderingGlobe:Z}=B;if(E.style.map.terrain){for(const te of L){const ae=R.getTile(te);R.hasRenderableParent(te)||(E.renderPass==="offscreen"?Nc(E,ae,k,te,Z):E.renderPass==="translucent"&&ca(E,k,te,F,Z))}$.viewport.set([0,0,E.width,E.height])}else E.renderPass==="offscreen"?(function(te,ae,oe,ce){const he=te.context,ge=he.gl,de=te.transform,be=Cn.disabled,Ie=new ln([ge.ONE,ge.ONE],h.bf.transparent,[!0,!0,!0,!0]);(function(fe,ze,Xe){const $e=fe.gl;fe.activeTexture.set($e.TEXTURE1),fe.viewport.set([0,0,ze.width/4,ze.height/4]);let Ge=Xe.heatmapFbos.get(h.c2);Ge?($e.bindTexture($e.TEXTURE_2D,Ge.colorAttachment.get()),fe.bindFramebuffer.set(Ge.framebuffer)):(Ge=rs(fe,ze.width/4,ze.height/4),Xe.heatmapFbos.set(h.c2,Ge))})(he,te,oe),he.clear({color:h.bf.transparent});for(let fe=0;fe<ce.length;fe++){const ze=ce[fe];if(ae.hasRenderableParent(ze))continue;const Xe=ae.getTile(ze),$e=Xe.getBucket(oe);if(!$e)continue;const Ge=$e.programConfigurations.get(oe.id),Ye=te.useProgram("heatmap",Ge),Et=de.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),wt=de.getCircleRadiusCorrection();Ye.draw(he,ge.TRIANGLES,an.disabled,be,Ie,Qt.backCCW,Zf(Xe,de.zoom,oe.paint.get("heatmap-intensity"),wt),null,Et,oe.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,oe.paint,de.zoom,Ge)}he.viewport.set([0,0,te.width,te.height])})(E,R,k,L):E.renderPass==="translucent"&&(function(te,ae){const oe=te.context,ce=oe.gl;oe.setColorMode(te.colorModeForRenderPass());const he=ae.heatmapFbos.get(h.c2);he&&(oe.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_2D,he.colorAttachment.get()),oe.activeTexture.set(ce.TEXTURE1),Wa(oe,ae).bind(ce.LINEAR,ce.CLAMP_TO_EDGE),te.useProgram("heatmapTexture").draw(oe,ce.TRIANGLES,an.disabled,Cn.disabled,te.colorModeForRenderPass(),Qt.disabled,Cd(te,ae,0,1),null,null,ae.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments,ae.paint,te.transform.zoom))})(E,k)})(t,o,p,_,T):h.ce(p)?(function(E,R,k,L,B){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:$}=B,F=k.paint.get("line-opacity"),Z=k.paint.get("line-width");if(F.constantOr(1)===0||Z.constantOr(1)===0)return;const te=E.getDepthModeForSublayer(0,an.ReadOnly),ae=E.colorModeForRenderPass(),oe=k.paint.get("line-dasharray"),ce=k.paint.get("line-pattern"),he=ce.constantOr(1),ge=k.paint.get("line-gradient"),de=k.getCrossfadeParameters(),be=he?"linePattern":oe?"lineSDF":ge?"lineGradient":"line",Ie=E.context,fe=Ie.gl,ze=E.transform;let Xe=!0;for(const $e of L){const Ge=R.getTile($e);if(he&&!Ge.patternsLoaded())continue;const Ye=Ge.getBucket(k);if(!Ye)continue;const Et=Ye.programConfigurations.get(k.id),wt=E.context.program.get(),lt=E.useProgram(be,Et),Bt=Xe||lt.program!==wt,Tn=E.style.map.terrain&&E.style.map.terrain.getTerrainData($e),Fn=ce.constantOr(null);if(Fn&&Ge.imageAtlas){const _i=Ge.imageAtlas,ui=_i.patternPositions[Fn.to.toString()],Ln=_i.patternPositions[Fn.from.toString()];ui&&Ln&&Et.setConstantPatternPositions(ui,Ln)}const Di=ze.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),li=ze.getPixelScale(),ci=he?Rd(E,Ge,k,li,de):oe?wl(E,Ge,k,li,oe,de):ge?Su(E,Ge,k,li,Ye.lineClipsArray.length):_h(E,Ge,k,li);if(he)Ie.activeTexture.set(fe.TEXTURE0),Ge.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),Et.updatePaintBuffers(de);else if(oe&&(Bt||E.lineAtlas.dirty))Ie.activeTexture.set(fe.TEXTURE0),E.lineAtlas.bind(Ie);else if(ge){const _i=Ye.gradients[k.id];let ui=_i.texture;if(k.gradientVersion!==_i.version){let Ln=256;if(k.stepInterpolant){const Er=R.getSource().maxzoom,fr=$e.canonical.z===Er?Math.ceil(1<<E.transform.maxZoom-$e.canonical.z):1;Ln=h.ah(h.c3(Ye.maxLineLength/h.$*1024*fr),256,Ie.maxTextureSize)}_i.gradient=h.c4({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:Ln,image:_i.gradient||void 0,clips:Ye.lineClipsArray}),_i.texture?_i.texture.update(_i.gradient):_i.texture=new h.T(Ie,_i.gradient,fe.RGBA),_i.version=k.gradientVersion,ui=_i.texture}Ie.activeTexture.set(fe.TEXTURE0),ui.bind(k.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}const Ti=E.stencilModeForClipping($e);lt.draw(Ie,fe.TRIANGLES,te,Ti,ae,Qt.disabled,ci,Tn,Di,k.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,k.paint,E.transform.zoom,Et,Ye.layoutVertexBuffer2),Xe=!1}})(t,o,p,_,T):h.cf(p)?(function(E,R,k,L,B){const $=k.paint.get("fill-color"),F=k.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const{isRenderingToTexture:Z}=B,te=E.colorModeForRenderPass(),ae=k.paint.get("fill-pattern"),oe=E.opaquePassEnabledForLayer()&&!ae.constantOr(1)&&$.constantOr(h.bf.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===oe){const ce=E.getDepthModeForSublayer(1,E.renderPass==="opaque"?an.ReadWrite:an.ReadOnly);xs(E,R,k,L,ce,te,!1,Z)}if(E.renderPass==="translucent"&&k.paint.get("fill-antialias")){const ce=E.getDepthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,an.ReadOnly);xs(E,R,k,L,ce,te,!0,Z)}})(t,o,p,_,T):h.cg(p)?(function(E,R,k,L,B){const $=k.paint.get("fill-extrusion-opacity");if($===0)return;const{isRenderingToTexture:F}=B;if(E.renderPass==="translucent"){const Z=new an(E.context.gl.LEQUAL,an.ReadWrite,E.depthRangeFor3D);if($!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))Ka(E,R,k,L,Z,Cn.disabled,ln.disabled,F),Ka(E,R,k,L,Z,E.stencilModeFor3D(),E.colorModeForRenderPass(),F);else{const te=E.colorModeForRenderPass();Ka(E,R,k,L,Z,Cn.disabled,te,F)}}})(t,o,p,_,T):h.ch(p)?(function(E,R,k,L,B){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;const{isRenderingToTexture:$}=B,F=E.context,Z=E.style.projection.useSubdivision,te=E.getDepthModeForSublayer(0,an.ReadOnly),ae=E.colorModeForRenderPass();if(E.renderPass==="offscreen")(function(oe,ce,he,ge,de,be,Ie){const fe=oe.context,ze=fe.gl;for(const Xe of he){const $e=ce.getTile(Xe),Ge=$e.dem;if(!Ge||!Ge.data||!$e.needsHillshadePrepare)continue;const Ye=Ge.dim,Et=Ge.stride,wt=Ge.getPixels();if(fe.activeTexture.set(ze.TEXTURE1),fe.pixelStoreUnpackPremultiplyAlpha.set(!1),$e.demTexture=$e.demTexture||oe.getTileTexture(Et),$e.demTexture){const Bt=$e.demTexture;Bt.update(wt,{premultiply:!1}),Bt.bind(ze.NEAREST,ze.CLAMP_TO_EDGE)}else $e.demTexture=new h.T(fe,wt,ze.RGBA,{premultiply:!1}),$e.demTexture.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);fe.activeTexture.set(ze.TEXTURE0);let lt=$e.fbo;if(!lt){const Bt=new h.T(fe,{width:Ye,height:Ye,data:null},ze.RGBA);Bt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),lt=$e.fbo=fe.createFramebuffer(Ye,Ye,!0,!1),lt.colorAttachment.set(Bt.texture)}fe.bindFramebuffer.set(lt.framebuffer),fe.viewport.set([0,0,Ye,Ye]),oe.useProgram("hillshadePrepare").draw(fe,ze.TRIANGLES,de,be,Ie,Qt.disabled,Pd($e.tileID,Ge),null,null,ge.id,oe.rasterBoundsBuffer,oe.quadTriangleIndexBuffer,oe.rasterBoundsSegments),$e.needsHillshadePrepare=!1}})(E,R,L,k,te,Cn.disabled,ae),F.viewport.set([0,0,E.width,E.height]);else if(E.renderPass==="translucent")if(Z){const[oe,ce,he]=E.stencilConfigForOverlapTwoPass(L);Sh(E,R,k,he,oe,te,ae,!1,$),Sh(E,R,k,he,ce,te,ae,!0,$)}else{const[oe,ce]=E.getStencilConfigForOverlapAndUpdateStencilID(L);Sh(E,R,k,ce,oe,te,ae,!1,$)}})(t,o,p,_,T):h.ci(p)?(function(E,R,k,L,B){if(E.renderPass!=="translucent"||!L.length)return;const{isRenderingToTexture:$}=B,F=E.style.projection.useSubdivision,Z=E.getDepthModeForSublayer(0,an.ReadOnly),te=E.colorModeForRenderPass();if(F){const[ae,oe,ce]=E.stencilConfigForOverlapTwoPass(L);Ho(E,R,k,ce,ae,Z,te,!1,$),Ho(E,R,k,ce,oe,Z,te,!0,$)}else{const[ae,oe]=E.getStencilConfigForOverlapAndUpdateStencilID(L);Ho(E,R,k,oe,ae,Z,te,!1,$)}})(t,o,p,_,T):h.cj(p)?(function(E,R,k,L,B){if(E.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!L.length)return;const{isRenderingToTexture:$}=B,F=R.getSource(),Z=E.style.projection.useSubdivision;if(F instanceof di)Ir(E,R,k,L,null,!1,!1,F.tileCoords,F.flippedWindingOrder,$);else if(Z){const[te,ae,oe]=E.stencilConfigForOverlapTwoPass(L);Ir(E,R,k,oe,te,!1,!0,Lu,!1,$),Ir(E,R,k,oe,ae,!0,!0,Lu,!1,$)}else{const[te,ae]=E.getStencilConfigForOverlapAndUpdateStencilID(L);Ir(E,R,k,ae,te,!1,!0,Lu,!1,$)}})(t,o,p,_,T):h.ck(p)?(function(E,R,k,L,B){const $=k.paint.get("background-color"),F=k.paint.get("background-opacity");if(F===0)return;const{isRenderingToTexture:Z}=B,te=E.context,ae=te.gl,oe=E.style.projection,ce=E.transform,he=ce.tileSize,ge=k.paint.get("background-pattern");if(E.isPatternMissing(ge))return;const de=!ge&&$.a===1&&F===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==de)return;const be=Cn.disabled,Ie=E.getDepthModeForSublayer(0,de==="opaque"?an.ReadWrite:an.ReadOnly),fe=E.colorModeForRenderPass(),ze=E.useProgram(ge?"backgroundPattern":"background"),Xe=L||Re(ce,{tileSize:he,terrain:E.style.map.terrain});ge&&(te.activeTexture.set(ae.TEXTURE0),E.imageManager.bind(E.context));const $e=k.getCrossfadeParameters();for(const Ge of Xe){const Ye=ce.getProjectionData({overscaledTileID:Ge,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Et=ge?Qf(F,E,ge,{tileID:Ge,tileSize:he},$e):Yf(F,$),wt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ge),lt=oe.getMeshFromTileID(te,Ge.canonical,!1,!0,"raster");ze.draw(te,ae.TRIANGLES,Ie,be,fe,Qt.backCCW,Et,wt,Ye,k.id,lt.vertexBuffer,lt.indexBuffer,lt.segments)}})(t,0,p,_,T):h.cl(p)&&(function(E,R,k,L){const{isRenderingGlobe:B}=L,$=E.context,F=k.implementation,Z=E.style.projection,te=E.transform,ae=te.getProjectionDataForCustomLayer(B),oe={farZ:te.farZ,nearZ:te.nearZ,fov:te.fov*Math.PI/180,modelViewProjectionMatrix:te.modelViewProjectionMatrix,projectionMatrix:te.projectionMatrix,shaderData:{variantName:Z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Z.shaderPreludeCode.vertexSource}`,define:Z.shaderDefine},defaultProjectionData:ae},ce=F.renderingMode?F.renderingMode:"2d";if(E.renderPass==="offscreen"){const he=F.prerender;he&&(E.setCustomLayerDefaults(),$.setColorMode(E.colorModeForRenderPass()),he.call(F,$.gl,oe),$.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),$.setColorMode(E.colorModeForRenderPass()),$.setStencilMode(Cn.disabled);const he=ce==="3d"?E.getDepthModeFor3D():E.getDepthModeForSublayer(0,an.ReadOnly);$.setDepthMode(he),F.render($.gl,oe),$.setDirty(),E.setBaseState(),$.bindFramebuffer.set(null)}})(t,0,p,T))}saveTileTexture(t){const o=this._tileTextures[t.size[0]];o?o.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const o=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!o||!p}useProgram(t,o,p=!1,_=[]){this.cache=this.cache||{};const T=!!this.style.map.terrain,E=this.style.projection,R=p?Ar.projectionMercator:E.shaderPreludeCode,k=p?Sa:E.shaderDefine,L=t+(o?o.cacheKey:"")+`/${p?go:E.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(T?"/terrain":"")+(_?`/${_.join("/")}`:"");return this.cache[L]||(this.cache[L]=new Rt(this.context,Ar[t],o,vs[t],this._showOverdrawInspector,T,R,k,_)),this.cache[L]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:o}=this.context.gl;return this.width!==t||this.height!==o}}function Wo(b,t){let o,p=!1,_=null,T=null;const E=()=>{_=null,p&&(b.apply(T,o),_=setTimeout(E,t),p=!1)};return(...R)=>(p=!0,T=this,o=R,_||E(),_)}class ws{constructor(t){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let p;return o.split("&").map((_=>_.split("="))).forEach((_=>{_[0]===this._hashName&&(p=_)})),(p&&p[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(!this._isValidHash(o))return!1;const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:p,pitch:+(o[4]||0)}),!0},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const p=o.join("/");let _=p;_.split("&").length>0&&(_=_.split("&")[0]),this._hashName&&(_=`${this._hashName}=${p}`);let T=window.location.hash.replace(_,"");T.startsWith("#&")?T=T.slice(0,1)+T.slice(2):T==="#"&&(T="");let E=window.location.href.replace(/(#.+)?$/,T);E=E.replace("&&","&"),window.history.replaceState(window.history.state,null,E)},this._updateHash=Wo(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const o=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,_),E=Math.round(o.lng*T)/T,R=Math.round(o.lat*T)/T,k=this._map.getBearing(),L=this._map.getPitch();let B="";if(B+=t?`/${E}/${R}/${p}`:`${p}/${R}/${E}`,(k||L)&&(B+="/"+Math.round(10*k)/10),L&&(B+=`/${Math.round(L)}`),this._hashName){const $=this._hashName;let F=!1;const Z=window.location.hash.slice(1).split("&").map((te=>{const ae=te.split("=")[0];return ae===$?(F=!0,`${ae}=${B}`):te})).filter((te=>te));return F||Z.push(`${$}=${B}`),`#${Z.join("&")}`}return`#${B}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new h.S(+t[2],+t[1])}catch{return!1}const o=+t[0],p=+(t[3]||0),_=+(t[4]||0);return o>=this._map.getMinZoom()&&o<=this._map.getMaxZoom()&&p>=-180&&p<=180&&_>=this._map.getMinPitch()&&_<=this._map.getMaxPitch()}}const Fs={linearity:.3,easing:h.cm(0,0,.3,1)},ha=h.e({deceleration:2500,maxSpeed:1400},Fs),Nu=h.e({deceleration:20,maxSpeed:1400},Fs),Ah=h.e({deceleration:1e3,maxSpeed:360},Fs),jc=h.e({deceleration:1e3,maxSpeed:90},Fs),Bu=h.e({deceleration:1e3,maxSpeed:360},Fs);class Rl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ee.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=ee.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,roll:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)o.zoom+=T.zoomDelta||0,o.bearing+=T.bearingDelta||0,o.pitch+=T.pitchDelta||0,o.roll+=T.rollDelta||0,T.panDelta&&o.pan._add(T.panDelta),T.around&&(o.around=T.around),T.pinchAround&&(o.pinchAround=T.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(o.pan.mag()){const T=$s(o.pan.mag(),p,h.e({},ha,t||{})),E=o.pan.mult(T.amount/o.pan.mag()),R=this._map.cameraHelper.handlePanInertia(E,this._map.transform);_.center=R.easingCenter,_.offset=R.easingOffset,hr(_,T)}if(o.zoom){const T=$s(o.zoom,p,Nu);_.zoom=this._map.transform.zoom+T.amount,hr(_,T)}if(o.bearing){const T=$s(o.bearing,p,Ah);_.bearing=this._map.transform.bearing+h.ah(T.amount,-179,179),hr(_,T)}if(o.pitch){const T=$s(o.pitch,p,jc);_.pitch=this._map.transform.pitch+T.amount,hr(_,T)}if(o.roll){const T=$s(o.roll,p,Bu);_.roll=this._map.transform.roll+h.ah(T.amount,-179,179),hr(_,T)}if(_.zoom||_.bearing){const T=o.pinchAround===void 0?o.around:o.pinchAround;_.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),h.e(_,{noMoveStart:!0})}}function hr(b,t){(!b.duration||b.duration<t.duration)&&(b.duration=t.duration,b.easing=t.easing)}function $s(b,t,o){const{maxSpeed:p,linearity:_,deceleration:T}=o,E=h.ah(b*_/(t/1e3),-p,p),R=Math.abs(E)/(T*_);return{easing:o.easing,duration:1e3*R,amount:E*(R/2)}}class Ts extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p,_={}){p=p instanceof MouseEvent?p:new MouseEvent(t,p);const T=Y.mousePos(o.getCanvas(),p),E=o.unproject(T);super(t,h.e({point:T,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=o}}class Uc extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p){const _=t==="touchend"?p.changedTouches:p.touches,T=Y.touchPos(o.getCanvasContainer(),_),E=T.map((k=>o.unproject(k))),R=T.reduce(((k,L,B,$)=>k.add(L.div($.length))),new h.P(0,0));super(t,{points:T,point:R,lngLats:E,lngLat:o.unproject(R),originalEvent:p}),this._defaultPrevented=!1}}class Bd extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class np{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Bd(t.type,this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new Ts(t.type,this._map,t))}mouseup(t){this._map.fire(new Ts(t.type,this._map,t))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Ts(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ts(t.type,this._map,t))}mouseover(t){this._map.fire(new Ts(t.type,this._map,t))}mouseout(t){this._map.fire(new Ts(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Uc(t.type,this._map,t))}touchmove(t){this._map.fire(new Uc(t.type,this._map,t))}touchend(t){this._map.fire(new Uc(t.type,this._map,t))}touchcancel(t){this._map.fire(new Uc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ts(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ts("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ts(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ml{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(h.P.convert(t),this._map.terrain)}}class Ql{constructor(t,o){this._map=t,this._tr=new Ml(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(Y.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const p=o;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=Y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const T=Math.min(_.x,p.x),E=Math.max(_.x,p.x),R=Math.min(_.y,p.y),k=Math.max(_.y,p.y);Y.setTransform(this._box,`translate(${T}px,${R}px)`),this._box.style.width=E-T+"px",this._box.style.height=k-R+"px"}mouseupWindow(t,o){if(!this._active||t.button!==0)return;const p=this._startPos,_=o;if(this.reset(),Y.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new h.l("boxzoomend",{originalEvent:t})),{cameraAnimation:T=>T.fitScreenCoordinates(p,_,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Y.remove(this._box),this._box=null),Y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new h.l(t,{originalEvent:o}))}}function kl(b,t){if(b.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${t.length}`);const o={};for(let p=0;p<b.length;p++)o[b[p].identifier]=t[p];return o}class Fc{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,o,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=(function(_){const T=new h.P(0,0);for(const E of _)T._add(E);return T.div(_.length)})(o),this.touches=kl(p,o)))}touchmove(t,o,p){if(this.aborted||!this.centroid)return;const _=kl(p,o);for(const T in this.touches){const E=_[T];(!E||E.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(t,o,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Ko{constructor(t){this.singleTap=new Fc(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,o,p){this.singleTap.touchstart(t,o,p)}touchmove(t,o,p){this.singleTap.touchmove(t,o,p)}touchend(t,o,p){const _=this.singleTap.touchend(t,o,p);if(_){const T=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(T&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Zr{constructor(t){this._tr=new Ml(t),this._zoomIn=new Ko({numTouches:1,numTaps:2}),this._zoomOut=new Ko({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,p){this._zoomIn.touchstart(t,o,p),this._zoomOut.touchstart(t,o,p)}touchmove(t,o,p){this._zoomIn.touchmove(t,o,p),this._zoomOut.touchmove(t,o,p)}touchend(t,o,p){const _=this._zoomIn.touchend(t,o,p),T=this._zoomOut.touchend(t,o,p),E=this._tr;return _?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(_)},{originalEvent:t})}):T?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(T)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ss{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const o=this._moveFunction(...t);if(o.bearingDelta||o.pitchDelta||o.rollDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(t,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(o)?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,o){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const _=Array.isArray(o)?o[0]:o;return!this._moved&&_.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=_,this._move(p,_))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Y.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Vd=0,Qa=2,Jl={[Vd]:1,[Qa]:2};class Ja{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const o=Y.mouseButton(t);this._eventButton=o}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(o,p){const _=Jl[p];return o.buttons===void 0||(o.buttons&_)!==_})(t,this._eventButton)}isValidEndEvent(t){return Y.mouseButton(t)===this._eventButton}}class jd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Ih{constructor(t=new Ja({checkCorrectEvent:()=>!0}),o=new jd){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=o}_executeRelevantHandler(t,o,p){return t instanceof MouseEvent?o(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?p(t):void 0}startMove(t){this._executeRelevantHandler(t,(o=>this.mouseMoveStateManager.startMove(o)),(o=>this.oneFingerTouchMoveStateManager.startMove(o)))}endMove(t){this._executeRelevantHandler(t,(o=>this.mouseMoveStateManager.endMove(o)),(o=>this.oneFingerTouchMoveStateManager.endMove(o)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(o=>this.mouseMoveStateManager.isValidStartEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidStartEvent(o)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(o=>this.mouseMoveStateManager.isValidMoveEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(o)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(o=>this.mouseMoveStateManager.isValidEndEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidEndEvent(o)))}}const Vu=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=t=>{t.preventDefault()}};class $c{constructor(t,o){this._clickTolerance=t.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,o,p){return this._calculateTransform(t,o,p)}touchmove(t,o,p){if(this._active){if(!this._shouldBePrevented(p.length))return t.preventDefault(),this._calculateTransform(t,o,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,o,p){this._calculateTransform(t,o,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,p){p.length>0&&(this._active=!0);const _=kl(p,o),T=new h.P(0,0),E=new h.P(0,0);let R=0;for(const L in _){const B=_[L],$=this._touches[L];$&&(T._add(B),E._add(B.sub($)),R++,_[L]=B)}if(this._touches=_,this._shouldBePrevented(R)||!E.mag())return;const k=E.div(R);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(R),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,o,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,p){if(!this._firstTwoTouches)return;t.preventDefault();const[_,T]=this._firstTwoTouches,E=Es(p,o,_),R=Es(p,o,T);if(!E||!R)return;const k=this._aroundCenter?null:E.add(R).div(2);return this._move([E,R],k,t)}touchend(t,o,p){if(!this._firstTwoTouches)return;const[_,T]=this._firstTwoTouches,E=Es(p,o,_),R=Es(p,o,T);E&&R||(this._active&&Y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Es(b,t,o){for(let p=0;p<b.length;p++)if(b[p].identifier===o)return t[p]}function Dt(b,t){return Math.log(b/t)/Math.LN2}class Ch extends Dl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Dt(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Dt(this._distance,p),pinchAround:o}}}function ec(b,t){return 180*b.angleWith(t)/Math.PI}class Ph extends Dl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o,p){const _=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ec(this._vector,_),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,p=ec(t,this._startVector);return Math.abs(p)<o}}function eo(b){return Math.abs(b.y)>Math.abs(b.x)}class tc extends Dl{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,o,p){super.touchstart(t,o,p),this._currentTouchCount=p.length}_start(t){this._lastPoints=t,eo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const _=t[0].sub(this._lastPoints[0]),T=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,T,p.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+T.y)/2*-.5}):void 0}gestureBeginsVertically(t,o,p){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,T=o.mag()>=2;if(!_&&!T)return;if(!_||!T)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=t.y>0==o.y>0;return eo(t)&&eo(o)&&E}}const Rh={panStep:100,bearingStep:15,pitchStep:10};class vn{constructor(t){this._tr=new Ml(t);const o=Rh;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,p=0,_=0,T=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),T=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),T=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:R=>{const k=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:ju,zoom:o?Math.round(k.zoom)+o*(t.shiftKey?2:1):k.zoom,bearing:k.bearing+p*this._bearingStep,pitch:k.pitch+_*this._pitchStep,offset:[-T*this._panStep,-E*this._panStep],center:k.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ju(b){return b*(2-b)}const Mh=4.000244140625,Ao=1/450;class Xo{constructor(t,o){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=t,this._tr=new Ml(t),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ao}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=ee.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,o!==0&&o%Mh==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Y.mousePos(this._map.getCanvas(),t),p=this._tr;this._aroundPoint=this._aroundCenter?p.transform.locationToScreenPoint(h.S.convert(p.center)):o,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const R=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=R),typeof this._targetZoom=="number"&&(this._targetZoom+=R)}if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>Mh?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&k!==0&&(k=1/k);const L=typeof this._targetZoom!="number"?t.scale:h.af(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),h.ak(L*k)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,p=this._startZoom,_=this._easing;let T,E=!1;if(this._type==="wheel"&&p&&_){const R=ee.now()-this._lastWheelEventTime,k=Math.min((R+5)/200,1),L=_(k);T=h.C.number(p,o,L),k<1?this._frameId||(this._frameId=!0):E=!0}else T=o,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=T,{noInertia:!0,needsRenderFrame:!E,zoomDelta:T-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=h.co;if(this._prevEase){const p=this._prevEase,_=(ee.now()-p.start)/p.duration,T=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(T*T+1e-4)*.01,R=Math.sqrt(.0729-E*E);o=h.cm(E,R,.25,1)}return this._prevEase={start:ee.now(),duration:t,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class qc{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class kh{constructor(t){this._tr=new Ml(t),this.reset()}reset(){this._active=!1}dblclick(t,o){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uu{constructor(){this._tap=new Ko({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,o,p){if(!this._swipePoint)if(this._tapTime){const _=o[0],T=t.timeStamp-this._tapTime<500,E=this._tapPoint.dist(_)<30;T&&E?p.length>0&&(this._swipePoint=_,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(t,o,p)}touchmove(t,o,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=o[0],T=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(t,o,p)}touchend(t,o,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const _=this._tap.touchend(t,o,p);_&&(this._tapTime=t.timeStamp,this._tapPoint=_)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nc{constructor(t,o,p){this._el=t,this._mousePan=o,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gc{constructor(t,o,p,_){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=o,this._mousePitch=p,this._mouseRoll=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Dh{constructor(t,o,p,_){this._el=t,this._touchZoom=o,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ud{constructor(t,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Y.create("div","maplibregl-cooperative-gesture-screen",t);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),_=document.createElement("div");_.className="maplibregl-desktop-message",_.textContent=o,this._container.appendChild(_);const T=document.createElement("div");T.className="maplibregl-mobile-message",T.textContent=p,this._container.appendChild(T),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Y.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,o){this._enabled&&(this._map.fire(new h.l("cooperativegestureprevented",{gestureType:t,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Yo=b=>b.zoom||b.drag||b.roll||b.pitch||b.rotate;class to extends h.l{}function Jn(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta||b.rollDelta}class Fd{constructor(t,o){this.handleWindowEvent=_=>{this.handleEvent(_,`${_.type}Window`)},this.handleEvent=(_,T)=>{if(_.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=_.type==="renderFrame"?void 0:_,R={needsRenderFrame:!1},k={},L={};for(const{handlerName:F,handler:Z,allowed:te}of this._handlers){if(!Z.isEnabled())continue;let ae;if(this._blockedByActive(L,te,F))Z.reset();else if(Z[T||_.type]){if(h.cp(_,T||_.type)){const oe=Y.mousePos(this._map.getCanvas(),_);ae=Z[T||_.type](_,oe)}else if(h.cq(_,T||_.type)){const oe=this._getMapTouches(_.touches),ce=Y.touchPos(this._map.getCanvas(),oe);ae=Z[T||_.type](_,ce,oe)}else h.cr(T||_.type)||(ae=Z[T||_.type](_));this.mergeHandlerResult(R,k,ae,F,E),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()}(ae||Z.isActive())&&(L[F]=Z)}const B={};for(const F in this._previousActiveHandlers)L[F]||(B[F]=E);this._previousActiveHandlers=L,(Object.keys(B).length||Jn(R))&&(this._changes.push([R,k,B]),this._triggerRenderFrame()),(Object.keys(L).length||Jn(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=R;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rl(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,T,E]of this._listeners)Y.addEventListener(_,T,_===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[t,o,p]of this._listeners)Y.removeEventListener(t,o,t===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const o=this._map,p=o.getCanvasContainer();this._add("mapEvent",new np(o,t));const _=o.boxZoom=new Ql(o,t);this._add("boxZoom",_),t.interactive&&t.boxZoom&&_.enable();const T=o.cooperativeGestures=new Ud(o,t.cooperativeGestures);this._add("cooperativeGestures",T),t.cooperativeGestures&&T.enable();const E=new Zr(o),R=new kh(o);o.doubleClickZoom=new qc(R,E),this._add("tapZoom",E),this._add("clickZoom",R),t.interactive&&t.doubleClickZoom&&o.doubleClickZoom.enable();const k=new Uu;this._add("tapDragZoom",k);const L=o.touchPitch=new tc(o);this._add("touchPitch",L),t.interactive&&t.touchPitch&&o.touchPitch.enable(t.touchPitch);const B=()=>o.project(o.getCenter()),$=(function({enable:de,clickTolerance:be,aroundCenter:Ie=!0,minPixelCenterThreshold:fe=100,rotateDegreesPerPixelMoved:ze=.8},Xe){const $e=new Ja({checkCorrectEvent:Ge=>Y.mouseButton(Ge)===0&&Ge.ctrlKey||Y.mouseButton(Ge)===2&&!Ge.ctrlKey});return new Ss({clickTolerance:be,move:(Ge,Ye)=>{const Et=Xe();if(Ie&&Math.abs(Et.y-Ge.y)>fe)return{bearingDelta:h.cn(new h.P(Ge.x,Ye.y),Ye,Et)};let wt=(Ye.x-Ge.x)*ze;return Ie&&Ye.y<Et.y&&(wt=-wt),{bearingDelta:wt}},moveStateManager:$e,enable:de,assignEvents:Vu})})(t,B),F=(function({enable:de,clickTolerance:be,pitchDegreesPerPixelMoved:Ie=-.5}){const fe=new Ja({checkCorrectEvent:ze=>Y.mouseButton(ze)===0&&ze.ctrlKey||Y.mouseButton(ze)===2});return new Ss({clickTolerance:be,move:(ze,Xe)=>({pitchDelta:(Xe.y-ze.y)*Ie}),moveStateManager:fe,enable:de,assignEvents:Vu})})(t),Z=(function({enable:de,clickTolerance:be,rollDegreesPerPixelMoved:Ie=.3},fe){const ze=new Ja({checkCorrectEvent:Xe=>Y.mouseButton(Xe)===2&&Xe.ctrlKey});return new Ss({clickTolerance:be,move:(Xe,$e)=>{const Ge=fe();let Ye=($e.x-Xe.x)*Ie;return $e.y<Ge.y&&(Ye=-Ye),{rollDelta:Ye}},moveStateManager:ze,enable:de,assignEvents:Vu})})(t,B);o.dragRotate=new Gc(t,$,F,Z),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",F,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Z,["mousePitch"]),t.interactive&&t.dragRotate&&o.dragRotate.enable();const te=(function({enable:de,clickTolerance:be}){const Ie=new Ja({checkCorrectEvent:fe=>Y.mouseButton(fe)===0&&!fe.ctrlKey});return new Ss({clickTolerance:be,move:(fe,ze)=>({around:ze,panDelta:ze.sub(fe)}),activateOnStart:!0,moveStateManager:Ie,enable:de,assignEvents:Vu})})(t),ae=new $c(t,o);o.dragPan=new nc(p,te,ae),this._add("mousePan",te),this._add("touchPan",ae,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&o.dragPan.enable(t.dragPan);const oe=new Ph,ce=new Ch;o.touchZoomRotate=new Dh(p,ce,oe,k),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&o.touchZoomRotate.enable(t.touchZoomRotate);const he=o.scrollZoom=new Xo(o,(()=>this._triggerRenderFrame()));this._add("scrollZoom",he,["mousePan"]),t.interactive&&t.scrollZoom&&o.scrollZoom.enable(t.scrollZoom);const ge=o.keyboard=new vn(o);this._add("keyboard",ge),t.interactive&&t.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Sr(o))}_add(t,o,p){this._handlers.push({handlerName:t,handler:o,allowed:p}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yo(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,o,p){for(const _ in t)if(_!==p&&(!o||o.indexOf(_)<0))return!0;return!1}_getMapTouches(t){const o=[];for(const p of t)this._el.contains(p.target)&&o.push(p);return o}mergeHandlerResult(t,o,p,_,T){if(!p)return;h.e(t,p);const E={handlerName:_,originalEvent:p.originalEvent||T};p.zoomDelta!==void 0&&(o.zoom=E),p.panDelta!==void 0&&(o.drag=E),p.rollDelta!==void 0&&(o.roll=E),p.pitchDelta!==void 0&&(o.pitch=E),p.bearingDelta!==void 0&&(o.rotate=E)}_applyChanges(){const t={},o={},p={};for(const[_,T,E]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.rollDelta&&(t.rollDelta=(t.rollDelta||0)+_.rollDelta),_.around!==void 0&&(t.around=_.around),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),h.e(o,T),h.e(p,E);this._updateMapTransform(t,o,p),this._changes=[]}_updateMapTransform(t,o,p){const _=this._map,T=_._getTransformForUpdate(),E=_.terrain;if(!(Jn(t)||E&&this._terrainMovement))return this._fireEvents(o,p,!0);_._stop(!0);let{panDelta:R,zoomDelta:k,bearingDelta:L,pitchDelta:B,rollDelta:$,around:F,pinchAround:Z}=t;Z!==void 0&&(F=Z),F=F||_.transform.centerPoint,E&&!T.isPointOnMapSurface(F)&&(F=T.centerPoint);const te={panDelta:R,zoomDelta:k,rollDelta:$,pitchDelta:B,bearingDelta:L,around:F};this._map.cameraHelper.useGlobeControls&&!T.isPointOnMapSurface(F)&&(F=T.centerPoint);const ae=F.distSqr(T.centerPoint)<.01?T.center:T.screenPointToLocation(R?F.sub(R):F);E?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(te,T),this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?T.setCenter(T.screenPointToLocation(T.centerPoint.sub(R))):this._map.cameraHelper.handleMapControlsPan(te,T,ae):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(te,T,ae))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(te,T),this._map.cameraHelper.handleMapControlsPan(te,T,ae)),_._applyUpdatedTransform(T),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,p,!0)}_fireEvents(t,o,p){const _=Yo(this._eventsInProgress),T=Yo(t),E={};for(const $ in t){const{originalEvent:F}=t[$];this._eventsInProgress[$]||(E[`${$}start`]=F),this._eventsInProgress[$]=t[$]}!_&&T&&this._fireEvent("movestart",T.originalEvent);for(const $ in E)this._fireEvent($,E[$]);T&&this._fireEvent("move",T.originalEvent);for(const $ in t){const{originalEvent:F}=t[$];this._fireEvent($,F)}const R={};let k;for(const $ in this._eventsInProgress){const{handlerName:F,originalEvent:Z}=this._eventsInProgress[$];this._handlersById[F].isActive()||(delete this._eventsInProgress[$],k=o[F]||Z,R[`${$}end`]=k)}for(const $ in R)this._fireEvent($,R[$]);const L=Yo(this._eventsInProgress),B=(_||T)&&!L;if(B&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const $=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&$.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform($)}if(p&&B){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!$||!$.essential&&ee.prefersReducedMotion?(this._map.fire(new h.l("moveend",{originalEvent:k})),F(this._map.getBearing())&&this._map.resetNorth()):(F($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new h.l(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new to("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Hc extends h.E{constructor(t,o,p){super(),this._renderFrameCallback=()=>{const _=Math.min((ee.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=p.bearingSnap,this.cameraHelper=o,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,o){t.apply(this.transform),this.transform=t,this.cameraHelper=o}getCenter(){return new h.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,o){return this.jumpTo({elevation:t},o),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,o,p){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},o),p)}panTo(t,o,p){return this.easeTo(h.e({center:t},o),p)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,p){return this.easeTo(h.e({zoom:t},o),p)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,o){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new h.l("movestart",o)).fire(new h.l("move",o)).fire(new h.l("moveend",o))),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,p){return this.easeTo(h.e({bearing:t},o),p)}resetNorth(t,o){return this.rotateTo(0,h.e({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(h.e({bearing:0,pitch:0,roll:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}getRoll(){return this.transform.roll}setRoll(t,o){return this.jumpTo({roll:t},o),this}cameraForBounds(t,o){t=hi.convert(t).adjustAntiMeridian();const p=o&&o.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,o)}_cameraForBoxAndBearing(t,o,p,_){const T={top:0,bottom:0,right:0,left:0};if(typeof(_=h.e({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const L=_.padding;_.padding={top:L,bottom:L,right:L,left:L}}const E=h.e(T,_.padding);_.padding=E;const R=this.transform,k=new hi(t,o);return this.cameraHelper.cameraForBoxAndBearing(_,E,k,p,R)}fitBounds(t,o,p){return this._fitInternal(this.cameraForBounds(t,o),o,p)}fitScreenCoordinates(t,o,p,_,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(h.P.convert(t)),this.transform.screenPointToLocation(h.P.convert(o)),p,_),_,T)}_fitInternal(t,o,p){return t?(delete(o=h.e(t,o)).padding,o.linear?this.easeTo(o,p):this.flyTo(o,p)):this}jumpTo(t,o){this.stop();const p=this._getTransformForUpdate();let _=!1,T=!1,E=!1;const R=p.zoom;this.cameraHelper.handleJumpToCenterZoom(p,t);const k=p.zoom!==R;return"elevation"in t&&p.elevation!==+t.elevation&&p.setElevation(+t.elevation),"bearing"in t&&p.bearing!==+t.bearing&&(_=!0,p.setBearing(+t.bearing)),"pitch"in t&&p.pitch!==+t.pitch&&(T=!0,p.setPitch(+t.pitch)),"roll"in t&&p.roll!==+t.roll&&(E=!0,p.setRoll(+t.roll)),t.padding==null||p.isPaddingEqual(t.padding)||p.setPadding(t.padding),this._applyUpdatedTransform(p),this.fire(new h.l("movestart",o)).fire(new h.l("move",o)),k&&this.fire(new h.l("zoomstart",o)).fire(new h.l("zoom",o)).fire(new h.l("zoomend",o)),_&&this.fire(new h.l("rotatestart",o)).fire(new h.l("rotate",o)).fire(new h.l("rotateend",o)),T&&this.fire(new h.l("pitchstart",o)).fire(new h.l("pitch",o)).fire(new h.l("pitchend",o)),E&&this.fire(new h.l("rollstart",o)).fire(new h.l("roll",o)).fire(new h.l("rollend",o)),this.fire(new h.l("moveend",o))}calculateCameraOptionsFromTo(t,o,p,_=0){const T=h.a1.fromLngLat(t,o),E=h.a1.fromLngLat(p,_),R=E.x-T.x,k=E.y-T.y,L=E.z-T.z,B=Math.hypot(R,k,L);if(B===0)throw new Error("Can't calculate camera options with same From and To");const $=Math.hypot(R,k),F=h.ak(this.transform.cameraToCenterDistance/B/this.transform.tileSize),Z=180*Math.atan2(R,-k)/Math.PI;let te=180*Math.acos($/B)/Math.PI;return te=L<0?90-te:90+te,{center:E.toLngLat(),elevation:_,zoom:F,pitch:te,bearing:Z}}calculateCameraOptionsFromCameraLngLatAltRotation(t,o,p,_,T){const E=this.transform.calculateCenterFromCameraLngLatAlt(t,o,p,_);return{center:E.center,elevation:E.elevation,zoom:E.zoom,bearing:p,pitch:_,roll:T}}easeTo(t,o){this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.co},t)).animate===!1||!t.essential&&ee.prefersReducedMotion)&&(t.duration=0);const p=this._getTransformForUpdate(),_=this.getBearing(),T=p.pitch,E=p.roll,R="bearing"in t?this._normalizeBearing(t.bearing,_):_,k="pitch"in t?+t.pitch:T,L="roll"in t?this._normalizeBearing(t.roll,E):E,B="padding"in t?t.padding:p.padding,$=h.P.convert(t.offset);let F,Z;t.around&&(F=h.S.convert(t.around),Z=p.locationToScreenPoint(F));const te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ae=this.cameraHelper.handleEaseTo(p,{bearing:R,pitch:k,roll:L,padding:B,around:F,aroundPoint:Z,offsetAsPoint:$,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||_!==R,this._pitching=this._pitching||k!==T,this._rolling=this._rolling||L!==E,this._padding=!p.isPaddingEqual(B),this._zooming=this._zooming||ae.isZooming,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,te),this.terrain&&this._prepareElevation(ae.elevationCenter),this._ease((oe=>{ae.easeFunc(oe),this.terrain&&!t.freezeElevation&&this._updateElevation(oe),this._applyUpdatedTransform(p),this._fireMoveEvents(o)}),(oe=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(o,oe)}),t),this}_prepareEase(t,o,p={}){this._moving=!0,o||p.moving||this.fire(new h.l("movestart",t)),this._zooming&&!p.zooming&&this.fire(new h.l("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new h.l("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new h.l("pitchstart",t)),this._rolling&&!p.rolling&&this.fire(new h.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&o!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(p-(o-(p*t+this._elevationStart))/(1-t)),this._elevationTarget=o}this.transform.setElevation(h.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const o=t.getCameraLngLat(),p=t.getCameraAltitude(),_=this.terrain?this.terrain.getElevationForLngLatZoom(o,t.zoom):0;if(p<_){const T=this.calculateCameraOptionsFromTo(o,_,t.center,t.elevation);return{pitch:T.pitch,zoom:T.zoom}}return{}}_applyUpdatedTransform(t){const o=[];if(o.push((_=>this._elevateCameraIfInsideTerrain(_))),this.transformCameraUpdate&&o.push((_=>this.transformCameraUpdate(_))),!o.length)return;const p=t.clone();for(const _ of o){const T=p.clone(),{center:E,zoom:R,roll:k,pitch:L,bearing:B,elevation:$}=_(T);E&&T.setCenter(E),$!==void 0&&T.setElevation($),R!==void 0&&T.setZoom(R),k!==void 0&&T.setRoll(k),L!==void 0&&T.setPitch(L),B!==void 0&&T.setBearing(B),p.apply(T)}this.transform.apply(p)}_fireMoveEvents(t){this.fire(new h.l("move",t)),this._zooming&&this.fire(new h.l("zoom",t)),this._rotating&&this.fire(new h.l("rotate",t)),this._pitching&&this.fire(new h.l("pitch",t)),this._rolling&&this.fire(new h.l("roll",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const p=this._zooming,_=this._rotating,T=this._pitching,E=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,p&&this.fire(new h.l("zoomend",t)),_&&this.fire(new h.l("rotateend",t)),T&&this.fire(new h.l("pitchend",t)),E&&this.fire(new h.l("rollend",t)),this.fire(new h.l("moveend",t))}flyTo(t,o){if(!t.essential&&ee.prefersReducedMotion){const Ye=h.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ye,o)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.co},t);const p=this._getTransformForUpdate(),_=p.bearing,T=p.pitch,E=p.roll,R=p.padding,k="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:T,B="roll"in t?this._normalizeBearing(t.roll,E):E,$="padding"in t?t.padding:p.padding,F=h.P.convert(t.offset);let Z=p.centerPoint.add(F);const te=p.screenPointToLocation(Z),ae=this.cameraHelper.handleFlyTo(p,{bearing:k,pitch:L,roll:B,padding:$,locationAtOffset:te,offsetAsPoint:F,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let oe=t.curve;const ce=Math.max(p.width,p.height),he=ce/ae.scaleOfZoom,ge=ae.pixelPathLength;typeof ae.scaleOfMinZoom=="number"&&(oe=Math.sqrt(ce/ae.scaleOfMinZoom/ge*2));const de=oe*oe;function be(Ye){const Et=(he*he-ce*ce+(Ye?-1:1)*de*de*ge*ge)/(2*(Ye?he:ce)*de*ge);return Math.log(Math.sqrt(Et*Et+1)-Et)}function Ie(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function fe(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const ze=be(!1);let Xe=function(Ye){return fe(ze)/fe(ze+oe*Ye)},$e=function(Ye){return ce*((fe(ze)*(Ie(Et=ze+oe*Ye)/fe(Et))-Ie(ze))/de)/ge;var Et},Ge=(be(!0)-ze)/oe;if(Math.abs(ge)<2e-6||!isFinite(Ge)){if(Math.abs(ce-he)<1e-6)return this.easeTo(t,o);const Ye=he<ce?-1:1;Ge=Math.abs(Math.log(he/ce))/oe,$e=()=>0,Xe=Et=>Math.exp(Ye*oe*Et)}return t.duration="duration"in t?+t.duration:1e3*Ge/("screenSpeed"in t?+t.screenSpeed/oe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=_!==k,this._pitching=L!==T,this._rolling=B!==E,this._padding=!p.isPaddingEqual($),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(ae.targetCenter),this._ease((Ye=>{const Et=Ye*Ge,wt=1/Xe(Et),lt=$e(Et);this._rotating&&p.setBearing(h.C.number(_,k,Ye)),this._pitching&&p.setPitch(h.C.number(T,L,Ye)),this._rolling&&p.setRoll(h.C.number(E,B,Ye)),this._padding&&(p.interpolatePadding(R,$,Ye),Z=p.centerPoint.add(F)),ae.easeFunc(Ye,wt,lt,Z),this.terrain&&!t.freezeElevation&&this._updateElevation(Ye),this._applyUpdatedTransform(p),this._fireMoveEvents(o)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(o)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,o){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,o)}return t||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(t,o,p){p.animate===!1||p.duration===0?(t(1),o()):(this._easeStart=ee.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,o){t=h.aO(t,-180,180);const p=Math.abs(t-o);return Math.abs(t-360-o)<p&&(t-=360),Math.abs(t+360-o)<p&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(h.S.convert(t),this.transform.tileZoom):null}}const no={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Pn{constructor(t=no){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,o){const p=this._map._getUIString(`AttributionControl.${o}`);t.title=p,t.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((_=>typeof _!="string"?"":_))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const o=this._map.style.sourceCaches;for(const _ in o){const T=o[_];if(T.used||T.usedForTerrain){const E=T.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t=t.filter((_=>String(_).trim())),t.sort(((_,T)=>_.length-T.length)),t=t.filter(((_,T)=>{for(let E=T+1;E<t.length;E++)if(t[E].indexOf(_)>=0)return!1;return!0}));const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=Y.sanitize(p),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ni{constructor(t={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const p=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Y.create("div","maplibregl-ctrl");const o=Y.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class dr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,p=o?this._queue.concat(o):this._queue;for(const _ of p)if(_.id===t)return void(_.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const p of o)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Oh=h.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class As extends h.E{constructor(t){super(),this._lastTilesetChange=ee.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,o){this.sourceCache.update(t,o),this._renderableTilesKeys=[];const p={};for(const _ of Re(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))p[_.key]=!0,this._renderableTilesKeys.push(_.key),this._tiles[_.key]||(_.terrainRttPosMatrix32f=new Float64Array(16),h.bY(_.terrainRttPosMatrix32f,0,h.$,h.$,0,0,1),this._tiles[_.key]=new qr(_,this.tileSize),this._lastTilesetChange=ee.now());for(const _ in this._tiles)p[_]||delete this._tiles[_]}freeRtt(t){for(const o in this._tiles){const p=this._tiles[o];(!t||p.tileID.equals(t)||p.tileID.isChildOf(t)||t.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,o){return o?this._getTerrainCoordsForTileRanges(t,o):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const o={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID,T=t.clone(),E=h.ba();if(_.canonical.equals(t.canonical))h.bY(E,0,h.$,h.$,0,0,1);else if(_.canonical.isChildOf(t.canonical)){const R=_.canonical.z-t.canonical.z,k=_.canonical.x-(_.canonical.x>>R<<R),L=_.canonical.y-(_.canonical.y>>R<<R),B=h.$>>R;h.bY(E,0,B,B,0,0,1),h.M(E,E,[-k*B,-L*B,0])}else{if(!t.canonical.isChildOf(_.canonical))continue;{const R=t.canonical.z-_.canonical.z,k=t.canonical.x-(t.canonical.x>>R<<R),L=t.canonical.y-(t.canonical.y>>R<<R),B=h.$>>R;h.bY(E,0,h.$,h.$,0,0,1),h.M(E,E,[k*B,L*B,0]),h.N(E,E,[1/2**R,1/2**R,0])}}T.terrainRttPosMatrix32f=new Float32Array(E),o[p]=T}return o}_getTerrainCoordsForTileRanges(t,o){const p={};for(const _ of this._renderableTilesKeys){const T=this._tiles[_].tileID;if(!this._isWithinTileRanges(T,o))continue;const E=t.clone(),R=h.ba();if(T.canonical.z===t.canonical.z){const k=t.canonical.x-T.canonical.x,L=t.canonical.y-T.canonical.y;h.bY(R,0,h.$,h.$,0,0,1),h.M(R,R,[k*h.$,L*h.$,0])}else if(T.canonical.z>t.canonical.z){const k=T.canonical.z-t.canonical.z,L=T.canonical.x-(T.canonical.x>>k<<k),B=T.canonical.y-(T.canonical.y>>k<<k),$=t.canonical.x-(T.canonical.x>>k),F=t.canonical.y-(T.canonical.y>>k),Z=h.$>>k;h.bY(R,0,Z,Z,0,0,1),h.M(R,R,[-L*Z+$*h.$,-B*Z+F*h.$,0])}else{const k=t.canonical.z-T.canonical.z,L=t.canonical.x-(t.canonical.x>>k<<k),B=t.canonical.y-(t.canonical.y>>k<<k),$=(t.canonical.x>>k)-T.canonical.x,F=(t.canonical.y>>k)-T.canonical.y,Z=h.$<<k;h.bY(R,0,Z,Z,0,0,1),h.M(R,R,[L*h.$+$*Z,B*h.$+F*Z,0])}E.terrainRttPosMatrix32f=new Float32Array(R),p[_]=E}return p}getSourceTile(t,o){const p=this.sourceCache._source;let _=t.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(_).key);let T=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!T||!T.dem)&&o)for(;_>=p.minzoom&&(!T||!T.dem);)T=this.sourceCache.getTileByID(t.scaledTo(_--).key);return T}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,o){return o[t.canonical.z]&&t.canonical.x>=o[t.canonical.z].minTileX&&t.canonical.x<=o[t.canonical.z].maxTileX&&t.canonical.y>=o[t.canonical.z].minTileY&&t.canonical.y<=o[t.canonical.z].maxTileY}}class Io{constructor(t,o,p){this._meshCache={},this.painter=t,this.sourceCache=new As(o),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,o,p,_=h.$){var T;if(!(o>=0&&o<_&&p>=0&&p<_))return 0;const E=this.getTerrainData(t),R=(T=E.tile)===null||T===void 0?void 0:T.dem;if(!R)return 0;const k=h.cs([],[o/_*h.$,p/_*h.$],E.u_terrain_matrix),L=[k[0]*R.dim,k[1]*R.dim],B=Math.floor(L[0]),$=Math.floor(L[1]),F=L[0]-B,Z=L[1]-$;return R.get(B,$)*(1-F)*(1-Z)+R.get(B+1,$)*F*(1-Z)+R.get(B,$+1)*(1-F)*Z+R.get(B+1,$+1)*F*Z}getElevationForLngLatZoom(t,o){if(!h.ct(o,t.wrap()))return 0;const{tileID:p,mercatorX:_,mercatorY:T}=this._getOverscaledTileIDFromLngLatZoom(t,o);return this.getElevation(p,_%h.$,T%h.$,h.$)}getElevation(t,o,p,_=h.$){return this.getDEMElevation(t,o,p,_)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const _=this.painter.context,T=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new h.T(_,T,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new h.T(_,new h.R({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ag([])}const o=this.sourceCache.getSourceTile(t,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const _=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new h.T(_,o.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),o.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const p=o&&o+o.tileID.key+t.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let T=t.canonical.z-o.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=_?T=t.canonical.z-_:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=t.canonical.x-(t.canonical.x>>T<<T),R=t.canonical.y-(t.canonical.y>>T<<T),k=h.cu(new Float64Array(16),[1/(h.$<<T),1/(h.$<<T),0]);h.M(k,k,[E*h.$,R*h.$,0]),this._demMatrixCache[t.key]={matrix:k,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(t){const o=this.painter,p=o.width/devicePixelRatio,_=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new h.T(o.context,{width:p,height:_,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new h.T(o.context,{width:p,height:_,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(p,_,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let T=0,E=0;T<this._coordsTextureSize;T++)for(let R=0;R<this._coordsTextureSize;R++,E+=4)o[E+0]=255&R,o[E+1]=255&T,o[E+2]=R>>8<<4|T>>8,o[E+3]=0;const p=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),_=new h.T(t,p,t.gl.RGBA,{premultiply:!1});return _.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),p=this.painter.context,_=p.gl,T=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(T,R-E-1,1,1,_.RGBA,_.UNSIGNED_BYTE,o),p.bindFramebuffer.set(null);const k=o[0]+(o[2]>>4<<8),L=o[1]+((15&o[2])<<8),B=this.coordsIndex[255-o[3]],$=B&&this.sourceCache.getTileByID(B);if(!$)return null;const F=this._coordsTextureSize,Z=(1<<$.tileID.canonical.z)*F;return new h.a1(($.tileID.canonical.x*F+k)/Z+$.tileID.wrap,($.tileID.canonical.y*F+L)/Z,this.getElevation($.tileID,k,L,F))}depthAtPoint(t){const o=new Uint8Array(4),p=this.painter.context,_=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),_.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,o),p.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(t){var o;const p=((o=this.painter.style.projection)===null||o===void 0?void 0:o.transitionState)>0,_=p&&t.canonical.y===0,T=p&&t.canonical.y===(1<<t.canonical.z)-1,E=`m_${_?"n":""}_${T?"s":""}`;if(this._meshCache[E])return this._meshCache[E];const R=this.painter.context,k=new h.cv,L=new h.aN,B=this.meshSize,$=h.$/B,F=B*B;for(let fe=0;fe<=B;fe++)for(let ze=0;ze<=B;ze++)k.emplaceBack(ze*$,fe*$,0);for(let fe=0;fe<F;fe+=B+1)for(let ze=0;ze<B;ze++)L.emplaceBack(ze+fe,B+ze+fe+1,B+ze+fe+2),L.emplaceBack(ze+fe,B+ze+fe+2,ze+fe+1);const Z=k.length,te=Z+(B+1),ae=(B+1)*B,oe=_?h.bh:0,ce=_?0:1,he=T?h.bi:h.$,ge=T?0:1;for(let fe=0;fe<=B;fe++)k.emplaceBack(fe*$,oe,ce);for(let fe=0;fe<=B;fe++)k.emplaceBack(fe*$,he,ge);for(let fe=0;fe<B;fe++)L.emplaceBack(ae+fe,te+fe,te+fe+1),L.emplaceBack(ae+fe,te+fe+1,ae+fe+1),L.emplaceBack(0+fe,Z+fe+1,Z+fe),L.emplaceBack(0+fe,0+fe+1,Z+fe+1);const de=k.length,be=de+2*(B+1);for(const fe of[0,1])for(let ze=0;ze<=B;ze++)for(const Xe of[0,1])k.emplaceBack(fe*h.$,ze*$,Xe);for(let fe=0;fe<2*B;fe+=2)L.emplaceBack(de+fe,de+fe+1,de+fe+3),L.emplaceBack(de+fe,de+fe+3,de+fe+2),L.emplaceBack(be+fe,be+fe+3,be+fe+1),L.emplaceBack(be+fe,be+fe+2,be+fe+3);const Ie=new ja(R.createVertexBuffer(k,Oh.members),R.createIndexBuffer(L),h.aM.simpleSegment(0,0,k.length,L.length));return this._meshCache[E]=Ie,Ie}getMeshFrameDelta(t){return 2*Math.PI*h.bu/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,o){var p;const{tileID:_}=this._getOverscaledTileIDFromLngLatZoom(t,o);return(p=this.getMinMaxElevation(_).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(t){const o=this.getTerrainData(t).tile,p={minElevation:null,maxElevation:null};return o&&o.dem&&(p.minElevation=o.dem.min*this.exaggeration,p.maxElevation=o.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(t,o){const p=h.a1.fromLngLat(t.wrap()),_=(1<<o)*h.$,T=p.x*_,E=p.y*_,R=Math.floor(T/h.$),k=Math.floor(E/h.$);return{tileID:new h.Z(o,0,o,R,k),mercatorX:T,mercatorY:E}}}class Lt{constructor(t,o,p){this._context=t,this._size=o,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new h.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(p.texture),{id:t,fbo:o,texture:p,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((o=>t.id!==o)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Ft={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Qo{constructor(t,o){this.painter=t,this.terrain=o,this.pool=new Lt(t.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter((p=>!t._layers[p].isHidden(o))),this._coordsAscending={};for(const p in t.sourceCaches){this._coordsAscending[p]={};const _=t.sourceCaches[p].getVisibleCoordinates(),T=t.sourceCaches[p].getSource(),E=T instanceof di?T.terrainTileRanges:null;for(const R of _){const k=this.terrain.sourceCache.getTerrainCoords(R,E);for(const L in k)this._coordsAscending[p][L]||(this._coordsAscending[p][L]=[]),this._coordsAscending[p][L].push(k[L])}}this._coordsAscendingStr={};for(const p of t._order){const _=t._layers[p],T=_.source;if(Ft[_.type]&&!this._coordsAscendingStr[T]){this._coordsAscendingStr[T]={};for(const E in this._coordsAscending[T])this._coordsAscendingStr[T][E]=this._coordsAscending[T][E].map((R=>R.key)).sort().join()}}for(const p of this._renderableTiles)for(const _ in this._coordsAscendingStr){const T=this._coordsAscendingStr[_][p.tileID.key];T&&T!==p.rttCoords[_]&&(p.rtt=[])}}renderLayer(t,o){if(t.isHidden(this.painter.transform.zoom))return!1;const p=Object.assign(Object.assign({},o),{isRenderingToTexture:!0}),_=t.type,T=this.painter,E=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ft[_]&&(this._prevType&&Ft[this._prevType]||this._stacks.push([]),this._prevType=_,this._stacks[this._stacks.length-1].push(t.id),!E))return!0;if(Ft[this._prevType]||Ft[_]&&E){this._prevType=_;const R=this._stacks.length-1,k=this._stacks[R]||[];for(const L of this._renderableTiles){if(this.pool.isFull()&&(Us(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(L),L.rtt[R]){const $=this.pool.getObjectForId(L.rtt[R].id);if($.stamp===L.rtt[R].stamp){this.pool.useObject($);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),L.rtt[R]={id:B.id,stamp:B.stamp},T.context.bindFramebuffer.set(B.fbo.framebuffer),T.context.clear({color:h.bf.transparent,stencil:0}),T.currentStencilSource=void 0;for(let $=0;$<k.length;$++){const F=T.style._layers[k[$]],Z=F.source?this._coordsAscending[F.source][L.tileID.key]:[L.tileID];T.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),T._renderTileClippingMasks(F,Z,!0),T.renderLayer(T,T.style.sourceCaches[F.source],F,Z,p),F.source&&(L.rttCoords[F.source]=this._coordsAscendingStr[F.source][L.tileID.key])}}return Us(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects(),Ft[_]}return!1}}const $d={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gi=M,Br={hash:!1,interactive:!0,bearingSnap:7,attributionControl:no,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},zh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ca{constructor(t,o,p=!1){this.mousedown=T=>{this.startMove(T,Y.mousePos(this.element,T)),Y.addEventListener(window,"mousemove",this.mousemove),Y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.move(T,Y.mousePos(this.element,T))},this.mouseup=T=>{this._rotatePitchHandler.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Y.touchPos(this.element,T.targetTouches)[0],this.startMove(T,this._startPos),Y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=Y.touchPos(this.element,T.targetTouches)[0],this.move(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=o;const _=new Ih;this._rotatePitchHandler=new Ss({clickTolerance:3,move:(T,E)=>{const R=o.getBoundingClientRect(),k=new h.P((R.bottom-R.top)/2,(R.right-R.left)/2);return{bearingDelta:h.cn(new h.P(T.x,E.y),E,k),pitchDelta:p?-.5*(E.y-T.y):void 0}},moveStateManager:_,enable:!0,assignEvents:()=>{}}),this.map=t,Y.addEventListener(o,"mousedown",this.mousedown),Y.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),Y.addEventListener(o,"touchcancel",this.reset)}startMove(t,o){this._rotatePitchHandler.dragStart(t,o),Y.disableDrag()}move(t,o){const p=this.map,{bearingDelta:_,pitchDelta:T}=this._rotatePitchHandler.dragMove(t,o)||{};_&&p.setBearing(p.getBearing()+_),T&&p.setPitch(p.getPitch()+T)}off(){const t=this.element;Y.removeEventListener(t,"mousedown",this.mousedown),Y.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend),Y.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Y.enableDrag(),Y.removeEventListener(window,"mousemove",this.mousemove),Y.removeEventListener(window,"mouseup",this.mouseup),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend)}}let Ol;function Zc(b,t,o,p=!1){if(p||!o.getCoveringTilesDetailsProvider().allowWorldCopies())return b?.wrap();const _=new h.S(b.lng,b.lat);if(b=new h.S(b.lng,b.lat),t){const T=new h.S(b.lng-360,b.lat),E=new h.S(b.lng+360,b.lat),R=o.locationToScreenPoint(b).distSqr(t);o.locationToScreenPoint(T).distSqr(t)<R?b=T:o.locationToScreenPoint(E).distSqr(t)<R&&(b=E)}for(;Math.abs(b.lng-o.center.lng)>180;){const T=o.locationToScreenPoint(b);if(T.x>=0&&T.y>=0&&T.x<=o.width&&T.y<=o.height)break;b.lng>o.center.lng?b.lng-=360:b.lng+=360}return b.lng!==_.lng&&o.isPointOnMapSurface(o.locationToScreenPoint(b))?b:_}const wi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hi(b,t,o){const p=b.classList;for(const _ in wi)p.remove(`maplibregl-${o}-anchor-${_}`);p.add(`maplibregl-${o}-anchor-${t}`)}class Wc extends h.E{constructor(t){if(super(),this._onKeyPress=o=>{const p=o.code,_=o.charCode||o.keyCode;p!=="Space"&&p!=="Enter"&&_!==32&&_!==13||this.togglePopup()},this._onMapClick=o=>{const p=o.originalEvent.target,_=this._element;this._popup&&(p===_||_.contains(p))&&this.togglePopup()},this._update=o=>{if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();(o?.type==="terrain"||o?.type==="render"&&!p)&&this._map.once("render",this._update),this._lngLat=Zc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),Y.setTransform(this._element,`${wi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${T} ${_}`),ee.frameAsync(new AbortController).then((()=>{this._updateOpacity(o&&o.type==="moveend")})).catch((()=>{}))},this._onMove=o=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.l("dragstart"))),this.fire(new h.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.l("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y.create("div");const o=Y.createNS("http://www.w3.org/2000/svg","svg"),p=41,_=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${p}px`),o.setAttributeNS(null,"width",`${_}px`),o.setAttributeNS(null,"viewBox",`0 0 ${_} ${p}`);const T=Y.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const E=Y.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const R=Y.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ce of k){const he=Y.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",ce.rx),he.setAttributeNS(null,"ry",ce.ry),R.appendChild(he)}const L=Y.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"fill",this._color);const B=Y.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),L.appendChild(B);const $=Y.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const F=Y.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(F);const Z=Y.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const te=Y.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ae=Y.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#000000"),ae.setAttributeNS(null,"opacity","0.25"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962");const oe=Y.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#FFFFFF"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962"),te.appendChild(ae),te.appendChild(oe),E.appendChild(R),E.appendChild(L),E.appendChild($),E.appendChild(Z),E.appendChild(te),o.appendChild(E),o.setAttributeNS(null,"height",p*this._scale+"px"),o.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(o),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(o=>{o.preventDefault()})),this._element.addEventListener("mousedown",(o=>{o.preventDefault()})),Hi(this._element,this._anchor,"marker"),t&&t.className)for(const o of t.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var o,p;const _=(o=this._map)===null||o===void 0?void 0:o.terrain,T=this._map.transform.isLocationOccluded(this._lngLat);if(!_||T){const Z=T?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Z&&(this._element.style.opacity=Z))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const E=this._map,R=E.terrain.depthAtPoint(this._pos),k=E.terrain.getElevationForLngLatZoom(this._lngLat,E.transform.tileZoom);if(E.transform.lngLatToCameraDepth(this._lngLat,k)-R<.006)return void(this._element.style.opacity=this._opacity);const L=-this._offset.y/E.transform.pixelsPerMeter,B=Math.sin(E.getPitch()*Math.PI/180)*L,$=E.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),F=E.transform.lngLatToCameraDepth(this._lngLat,k+B)-$>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,o){return(this._opacity===void 0||t===void 0&&o===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Vr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ki=0,Jo=!1;const ic={maxWidth:100,unit:"metric"};function rc(b,t,o){const p=o&&o.maxWidth||100,_=b._container.clientHeight/2,T=b._container.clientWidth/2,E=b.unproject([T-p/2,_]),R=b.unproject([T+p/2,_]),k=Math.round(b.project(R).x-b.project(E).x),L=Math.min(p,k,b._container.clientWidth),B=E.distanceTo(R);if(o&&o.unit==="imperial"){const $=3.2808*B;$>5280?io(t,L,$/5280,b._getUIString("ScaleControl.Miles")):io(t,L,$,b._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?io(t,L,B/1852,b._getUIString("ScaleControl.NauticalMiles")):B>=1e3?io(t,L,B/1e3,b._getUIString("ScaleControl.Kilometers")):io(t,L,B,b._getUIString("ScaleControl.Meters"))}function io(b,t,o,p){const _=(function(T){const E=Math.pow(10,`${Math.floor(T)}`.length-1);let R=T/E;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:(function(k){const L=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*L)/L})(R),E*R})(o);b.style.width=t*(_/o)+"px",b.innerHTML=`${_}&nbsp;${p}`}const ro={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Kc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xc(b){if(b){if(typeof b=="number"){const t=Math.round(Math.abs(b)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,b),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-b),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(b,0),right:new h.P(-b,0)}}if(b instanceof h.P||Array.isArray(b)){const t=h.P.convert(b);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(b.center||[0,0]),top:h.P.convert(b.top||[0,0]),"top-left":h.P.convert(b["top-left"]||[0,0]),"top-right":h.P.convert(b["top-right"]||[0,0]),bottom:h.P.convert(b.bottom||[0,0]),"bottom-left":h.P.convert(b["bottom-left"]||[0,0]),"bottom-right":h.P.convert(b["bottom-right"]||[0,0]),left:h.P.convert(b.left||[0,0]),right:h.P.convert(b.right||[0,0])}}return Xc(new h.P(0,0))}const Fu=M;y.AJAXError=h.cz,y.Event=h.l,y.Evented=h.E,y.LngLat=h.S,y.MercatorCoordinate=h.a1,y.Point=h.P,y.addProtocol=h.cA,y.config=h.a,y.removeProtocol=h.cB,y.AttributionControl=Pn,y.BoxZoomHandler=Ql,y.CanvasSource=Yr,y.CooperativeGesturesHandler=Ud,y.DoubleClickZoomHandler=qc,y.DragPanHandler=nc,y.DragRotateHandler=Gc,y.EdgeInsets=Ua,y.FullscreenControl=class extends h.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var t;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=o?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=Y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Y.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},y.GeoJSONSource=Ys,y.GeolocateControl=class extends h.E{constructor(b){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const o=new h.S(t.coords.longitude,t.coords.latitude),p=t.coords.accuracy,_=this._map.getBearing(),T=h.e({bearing:_},this.options.fitBoundsOptions),E=hi.fromLngLat(o,p);this._map.fitBounds(E,T,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const o=new h.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Jo)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Y.create("button","maplibregl-ctrl-geolocate",this._container),Y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Wc({element:this._dotElement}),this._circleElement=Y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(o=>{const p=o?.[0]instanceof ResizeObserverEntry;o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.l("trackuserlocationend")),this.fire(new h.l("userlocationlostfocus")))}))}},this.options=h.e({},Vr,b)}onAdd(b){return this._map=b,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(t=!1){if(Ol!==void 0&&!t)return Ol;if(window.navigator.permissions===void 0)return Ol=!!window.navigator.geolocation,Ol;try{Ol=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ol=!!window.navigator.geolocation}return Ol}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Y.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,ki=0,Jo=!1}_isOutOfMapMaxBounds(b){const t=this._map.getMaxBounds(),o=b.coords;return t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const b=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&b))return;const t=this._map.project(b),o=this._map.unproject([t.x+100,t.y]),p=b.distanceTo(o)/100,_=2*this._accuracy/p;this._circleElement.style.width=`${_.toFixed(2)}px`,this._circleElement.style.height=`${_.toFixed(2)}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ki--,Jo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.l("trackuserlocationstart")),this.fire(new h.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ki++,ki>1?(b={maximumAge:6e5,timeout:0},Jo=!0):(b=this.options.positionOptions,Jo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},y.GlobeControl=class{constructor(){this._toggleProjection=()=>{var b;const t=(b=this._map.getProjection())===null||b===void 0?void 0:b.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var b;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((b=this._map.getProjection())===null||b===void 0?void 0:b.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(b){return this._map=b,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Y.create("button","maplibregl-ctrl-globe",this._container),Y.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},y.Hash=ws,y.ImageSource=di,y.KeyboardHandler=vn,y.LngLatBounds=hi,y.LogoControl=ni,y.Map=class extends Hc{constructor(b){var t,o;h.cw.mark(h.cx.create);const p=Object.assign(Object.assign(Object.assign({},Br),b),{canvasContextAttributes:Object.assign(Object.assign({},Br.canvasContextAttributes),b.canvasContextAttributes)});if(p.minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const _=new Vn,T=new xi;if(p.minZoom!==void 0&&_.setMinZoom(p.minZoom),p.maxZoom!==void 0&&_.setMaxZoom(p.maxZoom),p.minPitch!==void 0&&_.setMinPitch(p.minPitch),p.maxPitch!==void 0&&_.setMaxPitch(p.maxPitch),p.renderWorldCopies!==void 0&&_.setRenderWorldCopies(p.renderWorldCopies),super(_,T,{bearingSnap:p.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new dr,this._controls=[],this._mapId=h.a7(),this._contextLost=R=>{R.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.l("webglcontextlost",{originalEvent:R}))},this._contextRestored=R=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.l("webglcontextrestored",{originalEvent:R}))},this._onMapScroll=R=>{if(R.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},p.canvasContextAttributes),this._trackResize=p.trackResize===!0,this._bearingSnap=p.bearingSnap,this._centerClampedToGround=p.centerClampedToGround,this._refreshExpiredTiles=p.refreshExpiredTiles===!0,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions===!0,this._collectResourceTiming=p.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},$d),p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=p.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=gt.addThrottleControl((()=>this.isMoving())),this._requestManager=new St(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let R=!1;const k=Wo((L=>{this._trackResize&&!this._removed&&(this.resize(L),this.redraw())}),50);this._resizeObserver=new ResizeObserver((L=>{R?k(L):R=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Fd(this,p),this._hash=p.hash&&new ws(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,elevation:p.elevation,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,roll:p.roll}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,h.e({},p.fitBoundsOptions,{duration:0}))));const E=typeof p.style=="string"||((o=(t=p.style)===null||t===void 0?void 0:t.projection)===null||o===void 0?void 0:o.type)!=="globe";this.resize(null,E),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Pn(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new ni,p.logoPosition),this.on("style.load",(()=>{if(E||this._resizeTransform(),this.transform.unmodified){const R=h.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(R)}})),this.on("data",(R=>{this._update(R.dataType==="style"),this.fire(new h.l(`${R.dataType}data`,R))})),this.on("dataloading",(R=>{this.fire(new h.l(`${R.dataType}dataloading`,R))})),this.on("dataabort",(R=>{this.fire(new h.l("sourcedataabort",R))}))}_getMapId(){return this._mapId}setGlobalStateProperty(b,t){return this.style.setGlobalStateProperty(b,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(b,t){if(t===void 0&&(t=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new h.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=b.onAdd(this);this._controls.push(b);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(o,p.firstChild):p.appendChild(o),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new h.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(b);return t>-1&&this._controls.splice(t,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}coveringTiles(b){return Re(this.transform,b)}calculateCameraOptionsFromTo(b,t,o,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,t,o,p)}resize(b,t=!0){const[o,p]=this._containerDimensions(),_=this._getClampedPixelRatio(o,p);if(this._resizeCanvas(o,p,_),this.painter.resize(o,p,_),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const R=this._getClampedPixelRatio(o,p);this._resizeCanvas(o,p,R),this.painter.resize(o,p,R)}this._resizeTransform(t);const T=!this._moving;return T&&(this.stop(),this.fire(new h.l("movestart",b)).fire(new h.l("move",b))),this.fire(new h.l("resize",b)),T&&this.fire(new h.l("moveend",b)),this}_resizeTransform(b=!0){var t;const[o,p]=this._containerDimensions();this.transform.resize(o,p,b),(t=this._requestedCameraState)===null||t===void 0||t.resize(o,p,b)}_getClampedPixelRatio(b,t){const{0:o,1:p}=this._maxCanvasSize,_=this.getPixelRatio(),T=b*_,E=t*_;return Math.min(T>o?o/T:1,E>p?p/E:1)*_}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(hi.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.setMinZoom(b),this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.setMaxZoom(b),this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.setMinPitch(b),this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(b>=this.transform.minPitch)return this.transform.setMaxPitch(b),this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.setRenderWorldCopies(b),this._update()}project(b){return this.transform.locationToScreenPoint(h.S.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.screenPointToLocation(h.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,t,o){if(b==="mouseenter"||b==="mouseover"){let p=!1;return{layers:t,listener:o,delegates:{mousemove:T=>{const E=t.filter((k=>this.getLayer(k))),R=E.length!==0?this.queryRenderedFeatures(T.point,{layers:E}):[];R.length?p||(p=!0,o.call(this,new Ts(b,this,T.originalEvent,{features:R}))):p=!1},mouseout:()=>{p=!1}}}}if(b==="mouseleave"||b==="mouseout"){let p=!1;return{layers:t,listener:o,delegates:{mousemove:E=>{const R=t.filter((k=>this.getLayer(k)));(R.length!==0?this.queryRenderedFeatures(E.point,{layers:R}):[]).length?p=!0:p&&(p=!1,o.call(this,new Ts(b,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,o.call(this,new Ts(b,this,E.originalEvent)))}}}}{const p=_=>{const T=t.filter((R=>this.getLayer(R))),E=T.length!==0?this.queryRenderedFeatures(_.point,{layers:T}):[];E.length&&(_.features=E,o.call(this,_),delete _.features)};return{layers:t,listener:o,delegates:{[b]:p}}}}_saveDelegatedListener(b,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(t)}_removeDelegatedListener(b,t,o){if(!this._delegatedListeners||!this._delegatedListeners[b])return;const p=this._delegatedListeners[b];for(let _=0;_<p.length;_++){const T=p[_];if(T.listener===o&&T.layers.length===t.length&&T.layers.every((E=>t.includes(E)))){for(const E in T.delegates)this.off(E,T.delegates[E]);return void p.splice(_,1)}}}on(b,t,o){if(o===void 0)return super.on(b,t);const p=typeof t=="string"?[t]:t,_=this._createDelegatedListener(b,p,o);this._saveDelegatedListener(b,_);for(const T in _.delegates)this.on(T,_.delegates[T]);return{unsubscribe:()=>{this._removeDelegatedListener(b,p,o)}}}once(b,t,o){if(o===void 0)return super.once(b,t);const p=typeof t=="string"?[t]:t,_=this._createDelegatedListener(b,p,o);for(const T in _.delegates){const E=_.delegates[T];_.delegates[T]=(...R)=>{this._removeDelegatedListener(b,p,o),E(...R)}}this._saveDelegatedListener(b,_);for(const T in _.delegates)this.once(T,_.delegates[T]);return this}off(b,t,o){return o===void 0?super.off(b,t):(this._removeDelegatedListener(b,typeof t=="string"?[t]:t,o),this)}queryRenderedFeatures(b,t){if(!this.style)return[];let o;const p=b instanceof h.P||Array.isArray(b),_=p?b:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(p?{}:b)||{},_ instanceof h.P||typeof _[0]=="number")o=[h.P.convert(_)];else{const T=h.P.convert(_[0]),E=h.P.convert(_[1]);o=[T,new h.P(E.x,T.y),E,new h.P(T.x,E.y),T]}return this.style.queryRenderedFeatures(o,t,this.transform)}querySourceFeatures(b,t){return this.style.querySourceFeatures(b,t)}setStyle(b,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(b,t))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const t=this._locale[b];if(t==null)throw new Error(`Missing UI string '${b}'`);return t}_updateStyle(b,t){var o,p;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(b,t)));const _=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new I(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,t,_):this.style.loadJSON(b,t,_),this):((p=(o=this.style)===null||o===void 0?void 0:o.projection)===null||p===void 0||p.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new I(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,t){if(typeof b=="string"){const o=this._requestManager.transformRequest(b,"Style");h.j(o,new AbortController).then((p=>{this._updateDiff(p.data,t)})).catch((p=>{p&&this.fire(new h.k(p))}))}else typeof b=="object"&&this._updateDiff(b,t)}_updateDiff(b,t){try{this.style.setState(b,t)&&this._update(!0)}catch(o){h.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(b,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(b,t){return this._lazyInitEmptyStyle(),this.style.addSource(b,t),this._update(!0)}isSourceLoaded(b){const t=this.style&&this.style.sourceCaches[b];if(t!==void 0)return t.loaded();this.fire(new h.k(new Error(`There is no source with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const t=this.style.sourceCaches[b.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&t.reload();for(const o in this.style._layers){const p=this.style._layers[o];p.type==="hillshade"&&p.source===b.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),p.type==="color-relief"&&p.source===b.source&&h.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Io(this.painter,t,b),this.painter.renderToTexture=new Qo(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=o=>{var p;o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==b.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((p=o.source)===null||p===void 0?void 0:p.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new h.l("terrain",{terrain:b})),this}getTerrain(){var b,t;return(t=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const t in b){const o=b[t]._tiles;for(const p in o){const _=o[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}setSourceTileLodParams(b,t,o){if(o){const p=this.getSource(o);if(!p)throw new Error(`There is no source with ID "${o}", cannot set LOD parameters`);p.calculateTileZoom=mt(Math.max(1,b),Math.max(1,t))}else for(const p in this.style.sourceCaches)this.style.sourceCaches[p].getSource().calculateTileZoom=mt(Math.max(1,b),Math.max(1,t));return this._update(!0),this}refreshTiles(b,t){const o=this.style.sourceCaches[b];if(!o)throw new Error(`There is no source cache with ID "${b}", cannot refresh tile`);t===void 0?o.reload(!0):o.refreshTiles(t.map((p=>new h.a4(p.z,p.x,p.y))))}addImage(b,t,o={}){const{pixelRatio:p=1,sdf:_=!1,stretchX:T,stretchY:E,content:R,textFitWidth:k,textFitHeight:L}=o;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:$,data:F}=t,Z=t;return this.style.addImage(b,{data:new h.R({width:B,height:$},new Uint8Array(F)),pixelRatio:p,stretchX:T,stretchY:E,content:R,textFitWidth:k,textFitHeight:L,sdf:_,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,b),this}}{const{width:B,height:$,data:F}=ee.getImageData(t);this.style.addImage(b,{data:new h.R({width:B,height:$},F),pixelRatio:p,stretchX:T,stretchY:E,content:R,textFitWidth:k,textFitHeight:L,sdf:_,version:0})}}updateImage(b,t){const o=this.style.getImage(b);if(!o)return this.fire(new h.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||h.b(t)?ee.getImageData(t):t,{width:_,height:T,data:E}=p;if(_===void 0||T===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==o.data.width||T!==o.data.height)return this.fire(new h.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(t instanceof HTMLImageElement||h.b(t));return o.data.replace(E,R),this.style.updateImage(b,o),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new h.k(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return gt.getImage(this._requestManager.transformRequest(b,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,t){return this._lazyInitEmptyStyle(),this.style.addLayer(b,t),this._update(!0)}moveLayer(b,t){return this.style.moveLayer(b,t),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,t,o){return this.style.setLayerZoomRange(b,t,o),this._update(!0)}setFilter(b,t,o={}){return this.style.setFilter(b,t,o),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,t,o,p={}){return this.style.setPaintProperty(b,t,o,p),this._update(!0)}getPaintProperty(b,t){return this.style.getPaintProperty(b,t)}setLayoutProperty(b,t,o,p={}){return this.style.setLayoutProperty(b,t,o,p),this._update(!0)}getLayoutProperty(b,t){return this.style.getLayoutProperty(b,t)}setGlyphs(b,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,t,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,t,o,(p=>{p||this._update(!0)})),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,t,(o=>{o||this._update(!0)})),this}setLight(b,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(b,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(b,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(b,t){return this.style.setFeatureState(b,t),this._update()}removeFeatureState(b,t){return this.style.removeFeatureState(b,t),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,t=0;return this._container&&(b=this._container.clientWidth||400,t=this._container.clientHeight||300),[b,t]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const t=this._canvasContainer=Y.create("div","maplibregl-canvas-container",b);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Y.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),p=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],p);const _=this._controlContainer=Y.create("div","maplibregl-control-container",b),T=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((E=>{T[E]=Y.create("div",`maplibregl-ctrl-${E} `,_)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,t,o){this._canvas.width=Math.floor(o*b),this._canvas.height=Math.floor(o*t),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const b=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(p=>{t={requestedAttributes:b},p&&(t.statusMessage=p.statusMessage,t.type=p.type)}),{once:!0});let o=null;if(o=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,b):this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b),!o){const p="Failed to initialize WebGL";throw t?(t.message=p,new Error(JSON.stringify(t))):new Error(p)}this.painter=new Vc(o,this.transform),ve.testSupport(o)}migrateProjection(b,t){super.migrateProjection(b,t),this.painter.transform=b,this.fire(new h.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){var t,o,p,_,T;const E=this._idleTriggered?this._fadeDuration:0,R=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const $=this.transform.zoom,F=ee.now();this.style.zoomHistory.update($,F);const Z=new h.F($,{now:F,fadeDuration:E,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),te=Z.crossFadingFactor();te===1&&te===this._crossFadingFactor||(k=!0,this._crossFadingFactor=te),this.style.update(Z)}const L=((o=this.style.projection)===null||o===void 0?void 0:o.transitionState)>0!==R;(p=this.style.projection)===null||p===void 0||p.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((_=this.style.projection)===null||_===void 0?void 0:_.transitionState,(T=this.style.projection)===null||T===void 0?void 0:T.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||L)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,L),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,showPadding:this.showPadding}),this.fire(new h.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.cw.mark(h.cx.load),this.fire(new h.l("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const B=this._sourcesDirty||this._styleDirty||this._placementDirty;return B||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.l("idle")),!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,h.cw.mark(h.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),gt.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Y.remove(this._canvasContainer),Y.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),h.cw.clearMetrics(),this._removed=!0,this.fire(new h.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ee.frame(this._frameRequest,(b=>{h.cw.frame(b),this._frameRequest=null;try{this._render(b)}catch(t){if(!h.cy(t)&&!(function(o){return o.message===Ou})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return Gi}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(b){return this._lazyInitEmptyStyle(),this.style.setProjection(b),this._update(!0)}},y.MapMouseEvent=Ts,y.MapTouchEvent=Uc,y.MapWheelEvent=Bd,y.Marker=Wc,y.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const t=this._map.getZoom(),o=t===this._map.getMaxZoom(),p=t===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,o)=>{const p=this._map._getUIString(`NavigationControl.${o}`);t.title=p,t.setAttribute("aria-label",p)},this.options=h.e({},zh,b),this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),Y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),Y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=Y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ca(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,t){const o=Y.create("button",b,this._container);return o.type="button",o.addEventListener("click",t),o}},y.Popup=class extends h.E{constructor(b){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Y.remove(this._content),this._container&&(Y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Zc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const o=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let p=this.options.anchor;const _=Xc(this.options.offset);if(!p){const E=this._container.offsetWidth,R=this._container.offsetHeight;let k;k=o.y+_.bottom.y<R?["top"]:o.y>this._map.transform.height-R?["bottom"]:[],o.x<E/2?k.push("left"):o.x>this._map.transform.width-E/2&&k.push("right"),p=k.length===0?"bottom":k.join("-")}let T=o.add(_[p]);this.options.subpixelPositioning||(T=T.round()),Y.setTransform(this._container,`${wi[p]} translate(${T.x}px,${T.y}px)`),Hi(this._container,p,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(ro),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=h.S.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const t=document.createDocumentFragment(),o=document.createElement("body");let p;for(o.innerHTML=b;p=o.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){return this._container&&this._container.classList.add(b),this}removeClassName(b){return this._container&&this._container.classList.remove(b),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=Y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(Kc);b&&b.focus()}},y.RasterDEMTileSource=br,y.RasterTileSource=Ls,y.ScaleControl=class{constructor(b){this._onMove=()=>{rc(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,rc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ic),b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},y.ScrollZoomHandler=Xo,y.Style=I,y.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Y.create("button","maplibregl-ctrl-terrain",this._container),Y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},y.TwoFingersTouchPitchHandler=tc,y.TwoFingersTouchRotateHandler=Ph,y.TwoFingersTouchZoomHandler=Ch,y.TwoFingersTouchZoomRotateHandler=Dh,y.VectorTileSource=Xs,y.VideoSource=Wi,y.addSourceType=(b,t)=>h._(void 0,void 0,void 0,(function*(){if(xa(b))throw new Error(`A source type called "${b}" already exists.`);((o,p)=>{ho[o]=p})(b,t)})),y.clearPrewarmedResources=function(){const b=Mt;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(De),Mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},y.createTileMesh=Uo,y.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},y.getRTLTextPluginStatus=function(){return Ki().getRTLTextPluginStatus()},y.getVersion=function(){return Fu},y.getWorkerCount=function(){return ut.workerCount},y.getWorkerUrl=function(){return h.a.WORKER_URL},y.importScriptInWorkers=function(b){return Ji().broadcast("IS",b)},y.prewarm=function(){An().acquire(De)},y.setMaxParallelImageRequests=function(b){h.a.MAX_PARALLEL_IMAGE_REQUESTS=b},y.setRTLTextPlugin=function(b,t){return Ki().setRTLTextPlugin(b,t)},y.setWorkerCount=function(b){ut.workerCount=b},y.setWorkerUrl=function(b){h.a.WORKER_URL=b}}));var v=i;return v}))})(xy)),xy.exports}var DI=kI();const OI=Q0(DI);function Np(c){if(c<=50){const e=c/50,i=Math.round(0+255*e),l=Math.round(200+55*e);return`rgb(${i}, ${l}, 0)`}else{const e=(c-50)/50,i=255,l=Math.round(255-255*e);return`rgb(${i}, ${l}, 0)`}}function zI(c){const e=Math.floor((Date.now()-c)/1e3);if(e<60)return`${e} seconde${e>1?"s":""}`;const i=Math.floor(e/60);if(i<60)return`${i} minute${i>1?"s":""}`;const l=Math.floor(i/60);if(l<24)return`${l} heure${l>1?"s":""}`;const f=Math.floor(l/24);return`${f} jour${f>1?"s":""}`}const G1="sp_cooldown_";function LI(c,e,i){document.cookie=`${encodeURIComponent(c)}=${encodeURIComponent(e)}; Max-Age=${i}; Path=/; SameSite=Lax`}function NI(c){const e=encodeURIComponent(c)+"=";return document.cookie.split("; ").find(i=>i.startsWith(e))?.slice(e.length)??null}function BI(c,e){const i=Date.now()+e*6e4;LI(G1+c,String(i),e*60)}function wy(c){const e=NI(G1+c),i=e?Number(e):0,l=Date.now(),f=Math.max(0,i-l);return{allowed:f<=0,remainingMs:f,until:i}}function p0(c){const e=Math.ceil(c/1e3),i=Math.floor(e/60).toString().padStart(2,"0"),l=(e%60).toString().padStart(2,"0");return`${i}:${l}`}const VI=()=>{};var xx={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H1=function(c){const e=[];let i=0;for(let l=0;l<c.length;l++){let f=c.charCodeAt(l);f<128?e[i++]=f:f<2048?(e[i++]=f>>6|192,e[i++]=f&63|128):(f&64512)===55296&&l+1<c.length&&(c.charCodeAt(l+1)&64512)===56320?(f=65536+((f&1023)<<10)+(c.charCodeAt(++l)&1023),e[i++]=f>>18|240,e[i++]=f>>12&63|128,e[i++]=f>>6&63|128,e[i++]=f&63|128):(e[i++]=f>>12|224,e[i++]=f>>6&63|128,e[i++]=f&63|128)}return e},jI=function(c){const e=[];let i=0,l=0;for(;i<c.length;){const f=c[i++];if(f<128)e[l++]=String.fromCharCode(f);else if(f>191&&f<224){const v=c[i++];e[l++]=String.fromCharCode((f&31)<<6|v&63)}else if(f>239&&f<365){const v=c[i++],y=c[i++],h=c[i++],M=((f&7)<<18|(v&63)<<12|(y&63)<<6|h&63)-65536;e[l++]=String.fromCharCode(55296+(M>>10)),e[l++]=String.fromCharCode(56320+(M&1023))}else{const v=c[i++],y=c[i++];e[l++]=String.fromCharCode((f&15)<<12|(v&63)<<6|y&63)}}return e.join("")},Z1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(c,e){if(!Array.isArray(c))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,l=[];for(let f=0;f<c.length;f+=3){const v=c[f],y=f+1<c.length,h=y?c[f+1]:0,M=f+2<c.length,O=M?c[f+2]:0,V=v>>2,K=(v&3)<<4|h>>4;let ee=(h&15)<<2|O>>6,Y=O&63;M||(Y=64,y||(ee=64)),l.push(i[V],i[K],i[ee],i[Y])}return l.join("")},encodeString(c,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(c):this.encodeByteArray(H1(c),e)},decodeString(c,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(c):jI(this.decodeStringToByteArray(c,e))},decodeStringToByteArray(c,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,l=[];for(let f=0;f<c.length;){const v=i[c.charAt(f++)],h=f<c.length?i[c.charAt(f)]:0;++f;const O=f<c.length?i[c.charAt(f)]:64;++f;const K=f<c.length?i[c.charAt(f)]:64;if(++f,v==null||h==null||O==null||K==null)throw new UI;const ee=v<<2|h>>4;if(l.push(ee),O!==64){const Y=h<<4&240|O>>2;if(l.push(Y),K!==64){const ve=O<<6&192|K;l.push(ve)}}}return l},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let c=0;c<this.ENCODED_VALS.length;c++)this.byteToCharMap_[c]=this.ENCODED_VALS.charAt(c),this.charToByteMap_[this.byteToCharMap_[c]]=c,this.byteToCharMapWebSafe_[c]=this.ENCODED_VALS_WEBSAFE.charAt(c),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[c]]=c,c>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(c)]=c,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(c)]=c)}}};class UI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const FI=function(c){const e=H1(c);return Z1.encodeByteArray(e,!0)},Ly=function(c){return FI(c).replace(/\./g,"")},W1=function(c){try{return Z1.decodeString(c,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $I(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qI=()=>$I().__FIREBASE_DEFAULTS__,GI=()=>{if(typeof process>"u"||typeof xx>"u")return;const c=xx.__FIREBASE_DEFAULTS__;if(c)return JSON.parse(c)},HI=()=>{if(typeof document>"u")return;let c;try{c=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=c&&W1(c[1]);return e&&JSON.parse(e)},av=()=>{try{return VI()||qI()||GI()||HI()}catch(c){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${c}`);return}},K1=c=>av()?.emulatorHosts?.[c],ZI=c=>{const e=K1(c);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const l=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),l]:[e.substring(0,i),l]},X1=()=>av()?.config,Y1=c=>av()?.[`_${c}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let WI=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,l)=>{i?this.reject(i):this.resolve(l),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,l))}}};/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(c){try{return(c.startsWith("http://")||c.startsWith("https://")?new URL(c).hostname:c).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Q1(c){return(await fetch(c,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KI(c,e){if(c.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},l=e||"demo-project",f=c.iat||0,v=c.sub||c.user_id;if(!v)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const y={iss:`https://securetoken.google.com/${l}`,aud:l,iat:f,exp:f+3600,auth_time:f,sub:v,user_id:v,firebase:{sign_in_provider:"custom",identities:{}},...c};return[Ly(JSON.stringify(i)),Ly(JSON.stringify(y)),""].join(".")}const Cg={};function XI(){const c={prod:[],emulator:[]};for(const e of Object.keys(Cg))Cg[e]?c.emulator.push(e):c.prod.push(e);return c}function YI(c){let e=document.getElementById(c),i=!1;return e||(e=document.createElement("div"),e.setAttribute("id",c),i=!0),{created:i,element:e}}let wx=!1;function J1(c,e){if(typeof window>"u"||typeof document>"u"||!cm(window.location.host)||Cg[c]===e||Cg[c]||wx)return;Cg[c]=e;function i(ee){return`__firebase__banner__${ee}`}const l="__firebase__banner",v=XI().prod.length>0;function y(){const ee=document.getElementById(l);ee&&ee.remove()}function h(ee){ee.style.display="flex",ee.style.background="#7faaf0",ee.style.position="fixed",ee.style.bottom="5px",ee.style.left="5px",ee.style.padding=".5em",ee.style.borderRadius="5px",ee.style.alignItems="center"}function M(ee,Y){ee.setAttribute("width","24"),ee.setAttribute("id",Y),ee.setAttribute("height","24"),ee.setAttribute("viewBox","0 0 24 24"),ee.setAttribute("fill","none"),ee.style.marginLeft="-6px"}function O(){const ee=document.createElement("span");return ee.style.cursor="pointer",ee.style.marginLeft="16px",ee.style.fontSize="24px",ee.innerHTML=" &times;",ee.onclick=()=>{wx=!0,y()},ee}function V(ee,Y){ee.setAttribute("id",Y),ee.innerText="Learn more",ee.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",ee.setAttribute("target","__blank"),ee.style.paddingLeft="5px",ee.style.textDecoration="underline"}function K(){const ee=YI(l),Y=i("text"),ve=document.getElementById(Y)||document.createElement("span"),Ce=i("learnmore"),Ee=document.getElementById(Ce)||document.createElement("a"),Je=i("preprendIcon"),je=document.getElementById(Je)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(ee.created){const He=ee.element;h(He),V(Ee,Ce);const gt=O();M(je,Je),He.append(je,ve,Ee,gt),document.body.appendChild(He)}v?(ve.innerText="Preview backend disconnected.",je.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(je.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,ve.innerText="Preview backend running in this workspace."),ve.setAttribute("id",Y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",K):K()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function La(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function QI(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(La())}function JI(){const c=av()?.forceEnvironment;if(c==="node")return!0;if(c==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function eC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function tC(){const c=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof c=="object"&&c.id!==void 0}function nC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function iC(){const c=La();return c.indexOf("MSIE ")>=0||c.indexOf("Trident/")>=0}function rC(){return!JI()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function sC(){try{return typeof indexedDB=="object"}catch{return!1}}function aC(){return new Promise((c,e)=>{try{let i=!0;const l="validate-browser-context-for-indexeddb-analytics-module",f=self.indexedDB.open(l);f.onsuccess=()=>{f.result.close(),i||self.indexedDB.deleteDatabase(l),c(!0)},f.onupgradeneeded=()=>{i=!1},f.onerror=()=>{e(f.error?.message||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oC="FirebaseError";class ph extends Error{constructor(e,i,l){super(i),this.code=e,this.customData=l,this.name=oC,Object.setPrototypeOf(this,ph.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jg.prototype.create)}}class Jg{constructor(e,i,l){this.service=e,this.serviceName=i,this.errors=l}create(e,...i){const l=i[0]||{},f=`${this.service}/${e}`,v=this.errors[e],y=v?lC(v,l):"Error",h=`${this.serviceName}: ${y} (${f}).`;return new ph(f,h,l)}}function lC(c,e){return c.replace(cC,(i,l)=>{const f=e[l];return f!=null?String(f):`<${l}?>`})}const cC=/\{\$([^}]+)}/g;function uC(c){for(const e in c)if(Object.prototype.hasOwnProperty.call(c,e))return!1;return!0}function Nf(c,e){if(c===e)return!0;const i=Object.keys(c),l=Object.keys(e);for(const f of i){if(!l.includes(f))return!1;const v=c[f],y=e[f];if(Tx(v)&&Tx(y)){if(!Nf(v,y))return!1}else if(v!==y)return!1}for(const f of l)if(!i.includes(f))return!1;return!0}function Tx(c){return c!==null&&typeof c=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e_(c){const e=[];for(const[i,l]of Object.entries(c))Array.isArray(l)?l.forEach(f=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(f))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(l));return e.length?"&"+e.join("&"):""}function hC(c,e){const i=new dC(c,e);return i.subscribe.bind(i)}class dC{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(l=>{this.error(l)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,l){let f;if(e===void 0&&i===void 0&&l===void 0)throw new Error("Missing Observer.");fC(e,["next","error","complete"])?f=e:f={next:e,error:i,complete:l},f.next===void 0&&(f.next=Gv),f.error===void 0&&(f.error=Gv),f.complete===void 0&&(f.complete=Gv);const v=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?f.error(this.finalError):f.complete()}catch{}}),this.observers.push(f),v}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(l){typeof console<"u"&&console.error&&console.error(l)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function fC(c,e){if(typeof c!="object"||c===null)return!1;for(const i of e)if(i in c&&typeof c[i]=="function")return!0;return!1}function Gv(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(c){return c&&c._delegate?c._delegate:c}class Bf{constructor(e,i,l){this.name=e,this.instanceFactory=i,this.type=l,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const If="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pC{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const l=new WI;if(this.instancesDeferred.set(i,l),this.isInitialized(i)||this.shouldAutoInitialize())try{const f=this.getOrInitializeService({instanceIdentifier:i});f&&l.resolve(f)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){const i=this.normalizeInstanceIdentifier(e?.identifier),l=e?.optional??!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(f){if(l)return null;throw f}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(gC(e))try{this.getOrInitializeService({instanceIdentifier:If})}catch{}for(const[i,l]of this.instancesDeferred.entries()){const f=this.normalizeInstanceIdentifier(i);try{const v=this.getOrInitializeService({instanceIdentifier:f});l.resolve(v)}catch{}}}}clearInstance(e=If){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=If){return this.instances.has(e)}getOptions(e=If){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,l=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(l))throw Error(`${this.name}(${l}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const f=this.getOrInitializeService({instanceIdentifier:l,options:i});for(const[v,y]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(v);l===h&&y.resolve(f)}return f}onInit(e,i){const l=this.normalizeInstanceIdentifier(i),f=this.onInitCallbacks.get(l)??new Set;f.add(e),this.onInitCallbacks.set(l,f);const v=this.instances.get(l);return v&&e(v,l),()=>{f.delete(e)}}invokeOnInitCallbacks(e,i){const l=this.onInitCallbacks.get(i);if(l)for(const f of l)try{f(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let l=this.instances.get(e);if(!l&&this.component&&(l=this.component.instanceFactory(this.container,{instanceIdentifier:mC(e),options:i}),this.instances.set(e,l),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(l,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,l)}catch{}return l||null}normalizeInstanceIdentifier(e=If){return this.component?this.component.multipleInstances?e:If:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function mC(c){return c===If?void 0:c}function gC(c){return c.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _C{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new pC(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wn;(function(c){c[c.DEBUG=0]="DEBUG",c[c.VERBOSE=1]="VERBOSE",c[c.INFO=2]="INFO",c[c.WARN=3]="WARN",c[c.ERROR=4]="ERROR",c[c.SILENT=5]="SILENT"})(Wn||(Wn={}));const yC={debug:Wn.DEBUG,verbose:Wn.VERBOSE,info:Wn.INFO,warn:Wn.WARN,error:Wn.ERROR,silent:Wn.SILENT},vC=Wn.INFO,bC={[Wn.DEBUG]:"log",[Wn.VERBOSE]:"log",[Wn.INFO]:"info",[Wn.WARN]:"warn",[Wn.ERROR]:"error"},xC=(c,e,...i)=>{if(e<c.logLevel)return;const l=new Date().toISOString(),f=bC[e];if(f)console[f](`[${l}]  ${c.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class sb{constructor(e){this.name=e,this._logLevel=vC,this._logHandler=xC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Wn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?yC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Wn.DEBUG,...e),this._logHandler(this,Wn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Wn.VERBOSE,...e),this._logHandler(this,Wn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Wn.INFO,...e),this._logHandler(this,Wn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Wn.WARN,...e),this._logHandler(this,Wn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Wn.ERROR,...e),this._logHandler(this,Wn.ERROR,...e)}}const wC=(c,e)=>e.some(i=>c instanceof i);let Sx,Ex;function TC(){return Sx||(Sx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function SC(){return Ex||(Ex=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const eT=new WeakMap,m0=new WeakMap,tT=new WeakMap,Hv=new WeakMap,ab=new WeakMap;function EC(c){const e=new Promise((i,l)=>{const f=()=>{c.removeEventListener("success",v),c.removeEventListener("error",y)},v=()=>{i(fd(c.result)),f()},y=()=>{l(c.error),f()};c.addEventListener("success",v),c.addEventListener("error",y)});return e.then(i=>{i instanceof IDBCursor&&eT.set(i,c)}).catch(()=>{}),ab.set(e,c),e}function AC(c){if(m0.has(c))return;const e=new Promise((i,l)=>{const f=()=>{c.removeEventListener("complete",v),c.removeEventListener("error",y),c.removeEventListener("abort",y)},v=()=>{i(),f()},y=()=>{l(c.error||new DOMException("AbortError","AbortError")),f()};c.addEventListener("complete",v),c.addEventListener("error",y),c.addEventListener("abort",y)});m0.set(c,e)}let g0={get(c,e,i){if(c instanceof IDBTransaction){if(e==="done")return m0.get(c);if(e==="objectStoreNames")return c.objectStoreNames||tT.get(c);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return fd(c[e])},set(c,e,i){return c[e]=i,!0},has(c,e){return c instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in c}};function IC(c){g0=c(g0)}function CC(c){return c===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const l=c.call(Zv(this),e,...i);return tT.set(l,e.sort?e.sort():[e]),fd(l)}:SC().includes(c)?function(...e){return c.apply(Zv(this),e),fd(eT.get(this))}:function(...e){return fd(c.apply(Zv(this),e))}}function PC(c){return typeof c=="function"?CC(c):(c instanceof IDBTransaction&&AC(c),wC(c,TC())?new Proxy(c,g0):c)}function fd(c){if(c instanceof IDBRequest)return EC(c);if(Hv.has(c))return Hv.get(c);const e=PC(c);return e!==c&&(Hv.set(c,e),ab.set(e,c)),e}const Zv=c=>ab.get(c);function RC(c,e,{blocked:i,upgrade:l,blocking:f,terminated:v}={}){const y=indexedDB.open(c,e),h=fd(y);return l&&y.addEventListener("upgradeneeded",M=>{l(fd(y.result),M.oldVersion,M.newVersion,fd(y.transaction),M)}),i&&y.addEventListener("blocked",M=>i(M.oldVersion,M.newVersion,M)),h.then(M=>{v&&M.addEventListener("close",()=>v()),f&&M.addEventListener("versionchange",O=>f(O.oldVersion,O.newVersion,O))}).catch(()=>{}),h}const MC=["get","getKey","getAll","getAllKeys","count"],kC=["put","add","delete","clear"],Wv=new Map;function Ax(c,e){if(!(c instanceof IDBDatabase&&!(e in c)&&typeof e=="string"))return;if(Wv.get(e))return Wv.get(e);const i=e.replace(/FromIndex$/,""),l=e!==i,f=kC.includes(i);if(!(i in(l?IDBIndex:IDBObjectStore).prototype)||!(f||MC.includes(i)))return;const v=async function(y,...h){const M=this.transaction(y,f?"readwrite":"readonly");let O=M.store;return l&&(O=O.index(h.shift())),(await Promise.all([O[i](...h),f&&M.done]))[0]};return Wv.set(e,v),v}IC(c=>({...c,get:(e,i,l)=>Ax(e,i)||c.get(e,i,l),has:(e,i)=>!!Ax(e,i)||c.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(OC(i)){const l=i.getImmediate();return`${l.library}/${l.version}`}else return null}).filter(i=>i).join(" ")}}function OC(c){return c.getComponent()?.type==="VERSION"}const _0="@firebase/app",Ix="0.14.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch=new sb("@firebase/app"),zC="@firebase/app-compat",LC="@firebase/analytics-compat",NC="@firebase/analytics",BC="@firebase/app-check-compat",VC="@firebase/app-check",jC="@firebase/auth",UC="@firebase/auth-compat",FC="@firebase/database",$C="@firebase/data-connect",qC="@firebase/database-compat",GC="@firebase/functions",HC="@firebase/functions-compat",ZC="@firebase/installations",WC="@firebase/installations-compat",KC="@firebase/messaging",XC="@firebase/messaging-compat",YC="@firebase/performance",QC="@firebase/performance-compat",JC="@firebase/remote-config",eP="@firebase/remote-config-compat",tP="@firebase/storage",nP="@firebase/storage-compat",iP="@firebase/firestore",rP="@firebase/ai",sP="@firebase/firestore-compat",aP="firebase",oP="12.3.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y0="[DEFAULT]",lP={[_0]:"fire-core",[zC]:"fire-core-compat",[NC]:"fire-analytics",[LC]:"fire-analytics-compat",[VC]:"fire-app-check",[BC]:"fire-app-check-compat",[jC]:"fire-auth",[UC]:"fire-auth-compat",[FC]:"fire-rtdb",[$C]:"fire-data-connect",[qC]:"fire-rtdb-compat",[GC]:"fire-fn",[HC]:"fire-fn-compat",[ZC]:"fire-iid",[WC]:"fire-iid-compat",[KC]:"fire-fcm",[XC]:"fire-fcm-compat",[YC]:"fire-perf",[QC]:"fire-perf-compat",[JC]:"fire-rc",[eP]:"fire-rc-compat",[tP]:"fire-gcs",[nP]:"fire-gcs-compat",[iP]:"fire-fst",[sP]:"fire-fst-compat",[rP]:"fire-vertex","fire-js":"fire-js",[aP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bg=new Map,cP=new Map,v0=new Map;function Cx(c,e){try{c.container.addComponent(e)}catch(i){ch.debug(`Component ${e.name} failed to register with FirebaseApp ${c.name}`,i)}}function Yp(c){const e=c.name;if(v0.has(e))return ch.debug(`There were multiple attempts to register component ${e}.`),!1;v0.set(e,c);for(const i of Bg.values())Cx(i,c);for(const i of cP.values())Cx(i,c);return!0}function ob(c,e){const i=c.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),c.container.getProvider(e)}function du(c){return c==null?!1:c.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},pd=new Jg("app","Firebase",uP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(e,i,l){this._isDeleted=!1,this._options={...e},this._config={...i},this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=l,this.container.addComponent(new Bf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw pd.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const um=oP;function nT(c,e={}){let i=c;typeof e!="object"&&(e={name:e});const l={name:y0,automaticDataCollectionEnabled:!0,...e},f=l.name;if(typeof f!="string"||!f)throw pd.create("bad-app-name",{appName:String(f)});if(i||(i=X1()),!i)throw pd.create("no-options");const v=Bg.get(f);if(v){if(Nf(i,v.options)&&Nf(l,v.config))return v;throw pd.create("duplicate-app",{appName:f})}const y=new _C(f);for(const M of v0.values())y.addComponent(M);const h=new hP(i,l,y);return Bg.set(f,h),h}function iT(c=y0){const e=Bg.get(c);if(!e&&c===y0&&X1())return nT();if(!e)throw pd.create("no-app",{appName:c});return e}function Px(){return Array.from(Bg.values())}function md(c,e,i){let l=lP[c]??c;i&&(l+=`-${i}`);const f=l.match(/\s|\//),v=e.match(/\s|\//);if(f||v){const y=[`Unable to register library "${l}" with version "${e}":`];f&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),f&&v&&y.push("and"),v&&y.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ch.warn(y.join(" "));return}Yp(new Bf(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP="firebase-heartbeat-database",fP=1,Vg="firebase-heartbeat-store";let Kv=null;function rT(){return Kv||(Kv=RC(dP,fP,{upgrade:(c,e)=>{switch(e){case 0:try{c.createObjectStore(Vg)}catch(i){console.warn(i)}}}}).catch(c=>{throw pd.create("idb-open",{originalErrorMessage:c.message})})),Kv}async function pP(c){try{const i=(await rT()).transaction(Vg),l=await i.objectStore(Vg).get(sT(c));return await i.done,l}catch(e){if(e instanceof ph)ch.warn(e.message);else{const i=pd.create("idb-get",{originalErrorMessage:e?.message});ch.warn(i.message)}}}async function Rx(c,e){try{const l=(await rT()).transaction(Vg,"readwrite");await l.objectStore(Vg).put(e,sT(c)),await l.done}catch(i){if(i instanceof ph)ch.warn(i.message);else{const l=pd.create("idb-set",{originalErrorMessage:i?.message});ch.warn(l.message)}}}function sT(c){return`${c.name}!${c.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mP=1024,gP=30;class _P{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new vP(i),this._heartbeatsCachePromise=this._storage.read().then(l=>(this._heartbeatsCache=l,l))}async triggerHeartbeat(){try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),l=Mx();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===l||this._heartbeatsCache.heartbeats.some(f=>f.date===l))return;if(this._heartbeatsCache.heartbeats.push({date:l,agent:i}),this._heartbeatsCache.heartbeats.length>gP){const f=bP(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ch.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Mx(),{heartbeatsToSend:i,unsentEntries:l}=yP(this._heartbeatsCache.heartbeats),f=Ly(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),f}catch(e){return ch.warn(e),""}}}function Mx(){return new Date().toISOString().substring(0,10)}function yP(c,e=mP){const i=[];let l=c.slice();for(const f of c){const v=i.find(y=>y.agent===f.agent);if(v){if(v.dates.push(f.date),kx(i)>e){v.dates.pop();break}}else if(i.push({agent:f.agent,dates:[f.date]}),kx(i)>e){i.pop();break}l=l.slice(1)}return{heartbeatsToSend:i,unsentEntries:l}}class vP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return sC()?aC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await pP(this.app);return i?.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const l=await this.read();return Rx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const l=await this.read();return Rx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function kx(c){return Ly(JSON.stringify({version:2,heartbeats:c})).length}function bP(c){if(c.length===0)return-1;let e=0,i=c[0].date;for(let l=1;l<c.length;l++)c[l].date<i&&(i=c[l].date,e=l);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xP(c){Yp(new Bf("platform-logger",e=>new DC(e),"PRIVATE")),Yp(new Bf("heartbeat",e=>new _P(e),"PRIVATE")),md(_0,Ix,c),md(_0,Ix,"esm2020"),md("fire-js","")}xP("");var Dx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var gd,aT;(function(){var c;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(Se,pe){function ye(){}ye.prototype=pe.prototype,Se.F=pe.prototype,Se.prototype=new ye,Se.prototype.constructor=Se,Se.D=function(Oe,Me,Ve){for(var Te=Array(arguments.length-2),dn=2;dn<arguments.length;dn++)Te[dn-2]=arguments[dn];return pe.prototype[Me].apply(Oe,Te)}}function i(){this.blockSize=-1}function l(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(l,i),l.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function f(Se,pe,ye){ye||(ye=0);const Oe=Array(16);if(typeof pe=="string")for(var Me=0;Me<16;++Me)Oe[Me]=pe.charCodeAt(ye++)|pe.charCodeAt(ye++)<<8|pe.charCodeAt(ye++)<<16|pe.charCodeAt(ye++)<<24;else for(Me=0;Me<16;++Me)Oe[Me]=pe[ye++]|pe[ye++]<<8|pe[ye++]<<16|pe[ye++]<<24;pe=Se.g[0],ye=Se.g[1],Me=Se.g[2];let Ve=Se.g[3],Te;Te=pe+(Ve^ye&(Me^Ve))+Oe[0]+3614090360&4294967295,pe=ye+(Te<<7&4294967295|Te>>>25),Te=Ve+(Me^pe&(ye^Me))+Oe[1]+3905402710&4294967295,Ve=pe+(Te<<12&4294967295|Te>>>20),Te=Me+(ye^Ve&(pe^ye))+Oe[2]+606105819&4294967295,Me=Ve+(Te<<17&4294967295|Te>>>15),Te=ye+(pe^Me&(Ve^pe))+Oe[3]+3250441966&4294967295,ye=Me+(Te<<22&4294967295|Te>>>10),Te=pe+(Ve^ye&(Me^Ve))+Oe[4]+4118548399&4294967295,pe=ye+(Te<<7&4294967295|Te>>>25),Te=Ve+(Me^pe&(ye^Me))+Oe[5]+1200080426&4294967295,Ve=pe+(Te<<12&4294967295|Te>>>20),Te=Me+(ye^Ve&(pe^ye))+Oe[6]+2821735955&4294967295,Me=Ve+(Te<<17&4294967295|Te>>>15),Te=ye+(pe^Me&(Ve^pe))+Oe[7]+4249261313&4294967295,ye=Me+(Te<<22&4294967295|Te>>>10),Te=pe+(Ve^ye&(Me^Ve))+Oe[8]+1770035416&4294967295,pe=ye+(Te<<7&4294967295|Te>>>25),Te=Ve+(Me^pe&(ye^Me))+Oe[9]+2336552879&4294967295,Ve=pe+(Te<<12&4294967295|Te>>>20),Te=Me+(ye^Ve&(pe^ye))+Oe[10]+4294925233&4294967295,Me=Ve+(Te<<17&4294967295|Te>>>15),Te=ye+(pe^Me&(Ve^pe))+Oe[11]+2304563134&4294967295,ye=Me+(Te<<22&4294967295|Te>>>10),Te=pe+(Ve^ye&(Me^Ve))+Oe[12]+1804603682&4294967295,pe=ye+(Te<<7&4294967295|Te>>>25),Te=Ve+(Me^pe&(ye^Me))+Oe[13]+4254626195&4294967295,Ve=pe+(Te<<12&4294967295|Te>>>20),Te=Me+(ye^Ve&(pe^ye))+Oe[14]+2792965006&4294967295,Me=Ve+(Te<<17&4294967295|Te>>>15),Te=ye+(pe^Me&(Ve^pe))+Oe[15]+1236535329&4294967295,ye=Me+(Te<<22&4294967295|Te>>>10),Te=pe+(Me^Ve&(ye^Me))+Oe[1]+4129170786&4294967295,pe=ye+(Te<<5&4294967295|Te>>>27),Te=Ve+(ye^Me&(pe^ye))+Oe[6]+3225465664&4294967295,Ve=pe+(Te<<9&4294967295|Te>>>23),Te=Me+(pe^ye&(Ve^pe))+Oe[11]+643717713&4294967295,Me=Ve+(Te<<14&4294967295|Te>>>18),Te=ye+(Ve^pe&(Me^Ve))+Oe[0]+3921069994&4294967295,ye=Me+(Te<<20&4294967295|Te>>>12),Te=pe+(Me^Ve&(ye^Me))+Oe[5]+3593408605&4294967295,pe=ye+(Te<<5&4294967295|Te>>>27),Te=Ve+(ye^Me&(pe^ye))+Oe[10]+38016083&4294967295,Ve=pe+(Te<<9&4294967295|Te>>>23),Te=Me+(pe^ye&(Ve^pe))+Oe[15]+3634488961&4294967295,Me=Ve+(Te<<14&4294967295|Te>>>18),Te=ye+(Ve^pe&(Me^Ve))+Oe[4]+3889429448&4294967295,ye=Me+(Te<<20&4294967295|Te>>>12),Te=pe+(Me^Ve&(ye^Me))+Oe[9]+568446438&4294967295,pe=ye+(Te<<5&4294967295|Te>>>27),Te=Ve+(ye^Me&(pe^ye))+Oe[14]+3275163606&4294967295,Ve=pe+(Te<<9&4294967295|Te>>>23),Te=Me+(pe^ye&(Ve^pe))+Oe[3]+4107603335&4294967295,Me=Ve+(Te<<14&4294967295|Te>>>18),Te=ye+(Ve^pe&(Me^Ve))+Oe[8]+1163531501&4294967295,ye=Me+(Te<<20&4294967295|Te>>>12),Te=pe+(Me^Ve&(ye^Me))+Oe[13]+2850285829&4294967295,pe=ye+(Te<<5&4294967295|Te>>>27),Te=Ve+(ye^Me&(pe^ye))+Oe[2]+4243563512&4294967295,Ve=pe+(Te<<9&4294967295|Te>>>23),Te=Me+(pe^ye&(Ve^pe))+Oe[7]+1735328473&4294967295,Me=Ve+(Te<<14&4294967295|Te>>>18),Te=ye+(Ve^pe&(Me^Ve))+Oe[12]+2368359562&4294967295,ye=Me+(Te<<20&4294967295|Te>>>12),Te=pe+(ye^Me^Ve)+Oe[5]+4294588738&4294967295,pe=ye+(Te<<4&4294967295|Te>>>28),Te=Ve+(pe^ye^Me)+Oe[8]+2272392833&4294967295,Ve=pe+(Te<<11&4294967295|Te>>>21),Te=Me+(Ve^pe^ye)+Oe[11]+1839030562&4294967295,Me=Ve+(Te<<16&4294967295|Te>>>16),Te=ye+(Me^Ve^pe)+Oe[14]+4259657740&4294967295,ye=Me+(Te<<23&4294967295|Te>>>9),Te=pe+(ye^Me^Ve)+Oe[1]+2763975236&4294967295,pe=ye+(Te<<4&4294967295|Te>>>28),Te=Ve+(pe^ye^Me)+Oe[4]+1272893353&4294967295,Ve=pe+(Te<<11&4294967295|Te>>>21),Te=Me+(Ve^pe^ye)+Oe[7]+4139469664&4294967295,Me=Ve+(Te<<16&4294967295|Te>>>16),Te=ye+(Me^Ve^pe)+Oe[10]+3200236656&4294967295,ye=Me+(Te<<23&4294967295|Te>>>9),Te=pe+(ye^Me^Ve)+Oe[13]+681279174&4294967295,pe=ye+(Te<<4&4294967295|Te>>>28),Te=Ve+(pe^ye^Me)+Oe[0]+3936430074&4294967295,Ve=pe+(Te<<11&4294967295|Te>>>21),Te=Me+(Ve^pe^ye)+Oe[3]+3572445317&4294967295,Me=Ve+(Te<<16&4294967295|Te>>>16),Te=ye+(Me^Ve^pe)+Oe[6]+76029189&4294967295,ye=Me+(Te<<23&4294967295|Te>>>9),Te=pe+(ye^Me^Ve)+Oe[9]+3654602809&4294967295,pe=ye+(Te<<4&4294967295|Te>>>28),Te=Ve+(pe^ye^Me)+Oe[12]+3873151461&4294967295,Ve=pe+(Te<<11&4294967295|Te>>>21),Te=Me+(Ve^pe^ye)+Oe[15]+530742520&4294967295,Me=Ve+(Te<<16&4294967295|Te>>>16),Te=ye+(Me^Ve^pe)+Oe[2]+3299628645&4294967295,ye=Me+(Te<<23&4294967295|Te>>>9),Te=pe+(Me^(ye|~Ve))+Oe[0]+4096336452&4294967295,pe=ye+(Te<<6&4294967295|Te>>>26),Te=Ve+(ye^(pe|~Me))+Oe[7]+1126891415&4294967295,Ve=pe+(Te<<10&4294967295|Te>>>22),Te=Me+(pe^(Ve|~ye))+Oe[14]+2878612391&4294967295,Me=Ve+(Te<<15&4294967295|Te>>>17),Te=ye+(Ve^(Me|~pe))+Oe[5]+4237533241&4294967295,ye=Me+(Te<<21&4294967295|Te>>>11),Te=pe+(Me^(ye|~Ve))+Oe[12]+1700485571&4294967295,pe=ye+(Te<<6&4294967295|Te>>>26),Te=Ve+(ye^(pe|~Me))+Oe[3]+2399980690&4294967295,Ve=pe+(Te<<10&4294967295|Te>>>22),Te=Me+(pe^(Ve|~ye))+Oe[10]+4293915773&4294967295,Me=Ve+(Te<<15&4294967295|Te>>>17),Te=ye+(Ve^(Me|~pe))+Oe[1]+2240044497&4294967295,ye=Me+(Te<<21&4294967295|Te>>>11),Te=pe+(Me^(ye|~Ve))+Oe[8]+1873313359&4294967295,pe=ye+(Te<<6&4294967295|Te>>>26),Te=Ve+(ye^(pe|~Me))+Oe[15]+4264355552&4294967295,Ve=pe+(Te<<10&4294967295|Te>>>22),Te=Me+(pe^(Ve|~ye))+Oe[6]+2734768916&4294967295,Me=Ve+(Te<<15&4294967295|Te>>>17),Te=ye+(Ve^(Me|~pe))+Oe[13]+1309151649&4294967295,ye=Me+(Te<<21&4294967295|Te>>>11),Te=pe+(Me^(ye|~Ve))+Oe[4]+4149444226&4294967295,pe=ye+(Te<<6&4294967295|Te>>>26),Te=Ve+(ye^(pe|~Me))+Oe[11]+3174756917&4294967295,Ve=pe+(Te<<10&4294967295|Te>>>22),Te=Me+(pe^(Ve|~ye))+Oe[2]+718787259&4294967295,Me=Ve+(Te<<15&4294967295|Te>>>17),Te=ye+(Ve^(Me|~pe))+Oe[9]+3951481745&4294967295,Se.g[0]=Se.g[0]+pe&4294967295,Se.g[1]=Se.g[1]+(Me+(Te<<21&4294967295|Te>>>11))&4294967295,Se.g[2]=Se.g[2]+Me&4294967295,Se.g[3]=Se.g[3]+Ve&4294967295}l.prototype.v=function(Se,pe){pe===void 0&&(pe=Se.length);const ye=pe-this.blockSize,Oe=this.C;let Me=this.h,Ve=0;for(;Ve<pe;){if(Me==0)for(;Ve<=ye;)f(this,Se,Ve),Ve+=this.blockSize;if(typeof Se=="string"){for(;Ve<pe;)if(Oe[Me++]=Se.charCodeAt(Ve++),Me==this.blockSize){f(this,Oe),Me=0;break}}else for(;Ve<pe;)if(Oe[Me++]=Se[Ve++],Me==this.blockSize){f(this,Oe),Me=0;break}}this.h=Me,this.o+=pe},l.prototype.A=function(){var Se=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);Se[0]=128;for(var pe=1;pe<Se.length-8;++pe)Se[pe]=0;pe=this.o*8;for(var ye=Se.length-8;ye<Se.length;++ye)Se[ye]=pe&255,pe/=256;for(this.v(Se),Se=Array(16),pe=0,ye=0;ye<4;++ye)for(let Oe=0;Oe<32;Oe+=8)Se[pe++]=this.g[ye]>>>Oe&255;return Se};function v(Se,pe){var ye=h;return Object.prototype.hasOwnProperty.call(ye,Se)?ye[Se]:ye[Se]=pe(Se)}function y(Se,pe){this.h=pe;const ye=[];let Oe=!0;for(let Me=Se.length-1;Me>=0;Me--){const Ve=Se[Me]|0;Oe&&Ve==pe||(ye[Me]=Ve,Oe=!1)}this.g=ye}var h={};function M(Se){return-128<=Se&&Se<128?v(Se,function(pe){return new y([pe|0],pe<0?-1:0)}):new y([Se|0],Se<0?-1:0)}function O(Se){if(isNaN(Se)||!isFinite(Se))return K;if(Se<0)return Ee(O(-Se));const pe=[];let ye=1;for(let Oe=0;Se>=ye;Oe++)pe[Oe]=Se/ye|0,ye*=4294967296;return new y(pe,0)}function V(Se,pe){if(Se.length==0)throw Error("number format error: empty string");if(pe=pe||10,pe<2||36<pe)throw Error("radix out of range: "+pe);if(Se.charAt(0)=="-")return Ee(V(Se.substring(1),pe));if(Se.indexOf("-")>=0)throw Error('number format error: interior "-" character');const ye=O(Math.pow(pe,8));let Oe=K;for(let Ve=0;Ve<Se.length;Ve+=8){var Me=Math.min(8,Se.length-Ve);const Te=parseInt(Se.substring(Ve,Ve+Me),pe);Me<8?(Me=O(Math.pow(pe,Me)),Oe=Oe.j(Me).add(O(Te))):(Oe=Oe.j(ye),Oe=Oe.add(O(Te)))}return Oe}var K=M(0),ee=M(1),Y=M(16777216);c=y.prototype,c.m=function(){if(Ce(this))return-Ee(this).m();let Se=0,pe=1;for(let ye=0;ye<this.g.length;ye++){const Oe=this.i(ye);Se+=(Oe>=0?Oe:4294967296+Oe)*pe,pe*=4294967296}return Se},c.toString=function(Se){if(Se=Se||10,Se<2||36<Se)throw Error("radix out of range: "+Se);if(ve(this))return"0";if(Ce(this))return"-"+Ee(this).toString(Se);const pe=O(Math.pow(Se,6));var ye=this;let Oe="";for(;;){const Me=gt(ye,pe).g;ye=Je(ye,Me.j(pe));let Ve=((ye.g.length>0?ye.g[0]:ye.h)>>>0).toString(Se);if(ye=Me,ve(ye))return Ve+Oe;for(;Ve.length<6;)Ve="0"+Ve;Oe=Ve+Oe}},c.i=function(Se){return Se<0?0:Se<this.g.length?this.g[Se]:this.h};function ve(Se){if(Se.h!=0)return!1;for(let pe=0;pe<Se.g.length;pe++)if(Se.g[pe]!=0)return!1;return!0}function Ce(Se){return Se.h==-1}c.l=function(Se){return Se=Je(this,Se),Ce(Se)?-1:ve(Se)?0:1};function Ee(Se){const pe=Se.g.length,ye=[];for(let Oe=0;Oe<pe;Oe++)ye[Oe]=~Se.g[Oe];return new y(ye,~Se.h).add(ee)}c.abs=function(){return Ce(this)?Ee(this):this},c.add=function(Se){const pe=Math.max(this.g.length,Se.g.length),ye=[];let Oe=0;for(let Me=0;Me<=pe;Me++){let Ve=Oe+(this.i(Me)&65535)+(Se.i(Me)&65535),Te=(Ve>>>16)+(this.i(Me)>>>16)+(Se.i(Me)>>>16);Oe=Te>>>16,Ve&=65535,Te&=65535,ye[Me]=Te<<16|Ve}return new y(ye,ye[ye.length-1]&-2147483648?-1:0)};function Je(Se,pe){return Se.add(Ee(pe))}c.j=function(Se){if(ve(this)||ve(Se))return K;if(Ce(this))return Ce(Se)?Ee(this).j(Ee(Se)):Ee(Ee(this).j(Se));if(Ce(Se))return Ee(this.j(Ee(Se)));if(this.l(Y)<0&&Se.l(Y)<0)return O(this.m()*Se.m());const pe=this.g.length+Se.g.length,ye=[];for(var Oe=0;Oe<2*pe;Oe++)ye[Oe]=0;for(Oe=0;Oe<this.g.length;Oe++)for(let Me=0;Me<Se.g.length;Me++){const Ve=this.i(Oe)>>>16,Te=this.i(Oe)&65535,dn=Se.i(Me)>>>16,In=Se.i(Me)&65535;ye[2*Oe+2*Me]+=Te*In,je(ye,2*Oe+2*Me),ye[2*Oe+2*Me+1]+=Ve*In,je(ye,2*Oe+2*Me+1),ye[2*Oe+2*Me+1]+=Te*dn,je(ye,2*Oe+2*Me+1),ye[2*Oe+2*Me+2]+=Ve*dn,je(ye,2*Oe+2*Me+2)}for(Se=0;Se<pe;Se++)ye[Se]=ye[2*Se+1]<<16|ye[2*Se];for(Se=pe;Se<2*pe;Se++)ye[Se]=0;return new y(ye,0)};function je(Se,pe){for(;(Se[pe]&65535)!=Se[pe];)Se[pe+1]+=Se[pe]>>>16,Se[pe]&=65535,pe++}function He(Se,pe){this.g=Se,this.h=pe}function gt(Se,pe){if(ve(pe))throw Error("division by zero");if(ve(Se))return new He(K,K);if(Ce(Se))return pe=gt(Ee(Se),pe),new He(Ee(pe.g),Ee(pe.h));if(Ce(pe))return pe=gt(Se,Ee(pe)),new He(Ee(pe.g),pe.h);if(Se.g.length>30){if(Ce(Se)||Ce(pe))throw Error("slowDivide_ only works with positive integers.");for(var ye=ee,Oe=pe;Oe.l(Se)<=0;)ye=St(ye),Oe=St(Oe);var Me=Pt(ye,1),Ve=Pt(Oe,1);for(Oe=Pt(Oe,2),ye=Pt(ye,2);!ve(Oe);){var Te=Ve.add(Oe);Te.l(Se)<=0&&(Me=Me.add(ye),Ve=Te),Oe=Pt(Oe,1),ye=Pt(ye,1)}return pe=Je(Se,Me.j(pe)),new He(Me,pe)}for(Me=K;Se.l(pe)>=0;){for(ye=Math.max(1,Math.floor(Se.m()/pe.m())),Oe=Math.ceil(Math.log(ye)/Math.LN2),Oe=Oe<=48?1:Math.pow(2,Oe-48),Ve=O(ye),Te=Ve.j(pe);Ce(Te)||Te.l(Se)>0;)ye-=Oe,Ve=O(ye),Te=Ve.j(pe);ve(Ve)&&(Ve=ee),Me=Me.add(Ve),Se=Je(Se,Te)}return new He(Me,Se)}c.B=function(Se){return gt(this,Se).h},c.and=function(Se){const pe=Math.max(this.g.length,Se.g.length),ye=[];for(let Oe=0;Oe<pe;Oe++)ye[Oe]=this.i(Oe)&Se.i(Oe);return new y(ye,this.h&Se.h)},c.or=function(Se){const pe=Math.max(this.g.length,Se.g.length),ye=[];for(let Oe=0;Oe<pe;Oe++)ye[Oe]=this.i(Oe)|Se.i(Oe);return new y(ye,this.h|Se.h)},c.xor=function(Se){const pe=Math.max(this.g.length,Se.g.length),ye=[];for(let Oe=0;Oe<pe;Oe++)ye[Oe]=this.i(Oe)^Se.i(Oe);return new y(ye,this.h^Se.h)};function St(Se){const pe=Se.g.length+1,ye=[];for(let Oe=0;Oe<pe;Oe++)ye[Oe]=Se.i(Oe)<<1|Se.i(Oe-1)>>>31;return new y(ye,Se.h)}function Pt(Se,pe){const ye=pe>>5;pe%=32;const Oe=Se.g.length-ye,Me=[];for(let Ve=0;Ve<Oe;Ve++)Me[Ve]=pe>0?Se.i(Ve+ye)>>>pe|Se.i(Ve+ye+1)<<32-pe:Se.i(Ve+ye);return new y(Me,Se.h)}l.prototype.digest=l.prototype.A,l.prototype.reset=l.prototype.u,l.prototype.update=l.prototype.v,aT=l,y.prototype.add=y.prototype.add,y.prototype.multiply=y.prototype.j,y.prototype.modulo=y.prototype.B,y.prototype.compare=y.prototype.l,y.prototype.toNumber=y.prototype.m,y.prototype.toString=y.prototype.toString,y.prototype.getBits=y.prototype.i,y.fromNumber=O,y.fromString=V,gd=y}).apply(typeof Dx<"u"?Dx:typeof self<"u"?self:typeof window<"u"?window:{});var cy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var oT,Tg,lT,Ty,b0,cT,uT,hT;(function(){var c,e=Object.defineProperty;function i(I){I=[typeof globalThis=="object"&&globalThis,I,typeof window=="object"&&window,typeof self=="object"&&self,typeof cy=="object"&&cy];for(var U=0;U<I.length;++U){var G=I[U];if(G&&G.Math==Math)return G}throw Error("Cannot find global object")}var l=i(this);function f(I,U){if(U)e:{var G=l;I=I.split(".");for(var le=0;le<I.length-1;le++){var We=I[le];if(!(We in G))break e;G=G[We]}I=I[I.length-1],le=G[I],U=U(le),U!=le&&U!=null&&e(G,I,{configurable:!0,writable:!0,value:U})}}f("Symbol.dispose",function(I){return I||Symbol("Symbol.dispose")}),f("Array.prototype.values",function(I){return I||function(){return this[Symbol.iterator]()}}),f("Object.entries",function(I){return I||function(U){var G=[],le;for(le in U)Object.prototype.hasOwnProperty.call(U,le)&&G.push([le,U[le]]);return G}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var v=v||{},y=this||self;function h(I){var U=typeof I;return U=="object"&&I!=null||U=="function"}function M(I,U,G){return I.call.apply(I.bind,arguments)}function O(I,U,G){return O=M,O.apply(null,arguments)}function V(I,U){var G=Array.prototype.slice.call(arguments,1);return function(){var le=G.slice();return le.push.apply(le,arguments),I.apply(this,le)}}function K(I,U){function G(){}G.prototype=U.prototype,I.Z=U.prototype,I.prototype=new G,I.prototype.constructor=I,I.Ob=function(le,We,tt){for(var Rt=Array(arguments.length-2),yn=2;yn<arguments.length;yn++)Rt[yn-2]=arguments[yn];return U.prototype[We].apply(le,Rt)}}var ee=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?I=>I&&AsyncContext.Snapshot.wrap(I):I=>I;function Y(I){const U=I.length;if(U>0){const G=Array(U);for(let le=0;le<U;le++)G[le]=I[le];return G}return[]}function ve(I,U){for(let le=1;le<arguments.length;le++){const We=arguments[le];var G=typeof We;if(G=G!="object"?G:We?Array.isArray(We)?"array":G:"null",G=="array"||G=="object"&&typeof We.length=="number"){G=I.length||0;const tt=We.length||0;I.length=G+tt;for(let Rt=0;Rt<tt;Rt++)I[G+Rt]=We[Rt]}else I.push(We)}}class Ce{constructor(U,G){this.i=U,this.j=G,this.h=0,this.g=null}get(){let U;return this.h>0?(this.h--,U=this.g,this.g=U.next,U.next=null):U=this.i(),U}}function Ee(I){y.setTimeout(()=>{throw I},0)}function Je(){var I=Se;let U=null;return I.g&&(U=I.g,I.g=I.g.next,I.g||(I.h=null),U.next=null),U}class je{constructor(){this.h=this.g=null}add(U,G){const le=He.get();le.set(U,G),this.h?this.h.next=le:this.g=le,this.h=le}}var He=new Ce(()=>new gt,I=>I.reset());class gt{constructor(){this.next=this.g=this.h=null}set(U,G){this.h=U,this.g=G,this.next=null}reset(){this.next=this.g=this.h=null}}let St,Pt=!1,Se=new je,pe=()=>{const I=Promise.resolve(void 0);St=()=>{I.then(ye)}};function ye(){for(var I;I=Je();){try{I.h.call(I.g)}catch(G){Ee(G)}var U=He;U.j(I),U.h<100&&(U.h++,I.next=U.g,U.g=I)}Pt=!1}function Oe(){this.u=this.u,this.C=this.C}Oe.prototype.u=!1,Oe.prototype.dispose=function(){this.u||(this.u=!0,this.N())},Oe.prototype[Symbol.dispose]=function(){this.dispose()},Oe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Me(I,U){this.type=I,this.g=this.target=U,this.defaultPrevented=!1}Me.prototype.h=function(){this.defaultPrevented=!0};var Ve=(function(){if(!y.addEventListener||!Object.defineProperty)return!1;var I=!1,U=Object.defineProperty({},"passive",{get:function(){I=!0}});try{const G=()=>{};y.addEventListener("test",G,U),y.removeEventListener("test",G,U)}catch{}return I})();function Te(I){return/^[\s\xa0]*$/.test(I)}function dn(I,U){Me.call(this,I?I.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,I&&this.init(I,U)}K(dn,Me),dn.prototype.init=function(I,U){const G=this.type=I.type,le=I.changedTouches&&I.changedTouches.length?I.changedTouches[0]:null;this.target=I.target||I.srcElement,this.g=U,U=I.relatedTarget,U||(G=="mouseover"?U=I.fromElement:G=="mouseout"&&(U=I.toElement)),this.relatedTarget=U,le?(this.clientX=le.clientX!==void 0?le.clientX:le.pageX,this.clientY=le.clientY!==void 0?le.clientY:le.pageY,this.screenX=le.screenX||0,this.screenY=le.screenY||0):(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0),this.button=I.button,this.key=I.key||"",this.ctrlKey=I.ctrlKey,this.altKey=I.altKey,this.shiftKey=I.shiftKey,this.metaKey=I.metaKey,this.pointerId=I.pointerId||0,this.pointerType=I.pointerType,this.state=I.state,this.i=I,I.defaultPrevented&&dn.Z.h.call(this)},dn.prototype.h=function(){dn.Z.h.call(this);const I=this.i;I.preventDefault?I.preventDefault():I.returnValue=!1};var In="closure_listenable_"+(Math.random()*1e6|0),st=0;function kt(I,U,G,le,We){this.listener=I,this.proxy=null,this.src=U,this.type=G,this.capture=!!le,this.ha=We,this.key=++st,this.da=this.fa=!1}function Zt(I){I.da=!0,I.listener=null,I.proxy=null,I.src=null,I.ha=null}function Wt(I,U,G){for(const le in I)U.call(G,I[le],le,I)}function De(I,U){for(const G in I)U.call(void 0,I[G],G,I)}function ut(I){const U={};for(const G in I)U[G]=I[G];return U}const Ot="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Mt(I,U){let G,le;for(let We=1;We<arguments.length;We++){le=arguments[We];for(G in le)I[G]=le[G];for(let tt=0;tt<Ot.length;tt++)G=Ot[tt],Object.prototype.hasOwnProperty.call(le,G)&&(I[G]=le[G])}}function qt(I){this.src=I,this.g={},this.h=0}qt.prototype.add=function(I,U,G,le,We){const tt=I.toString();I=this.g[tt],I||(I=this.g[tt]=[],this.h++);const Rt=Ht(I,U,le,We);return Rt>-1?(U=I[Rt],G||(U.fa=!1)):(U=new kt(U,this.src,tt,!!le,We),U.fa=G,I.push(U)),U};function An(I,U){const G=U.type;if(G in I.g){var le=I.g[G],We=Array.prototype.indexOf.call(le,U,void 0),tt;(tt=We>=0)&&Array.prototype.splice.call(le,We,1),tt&&(Zt(U),I.g[G].length==0&&(delete I.g[G],I.h--))}}function Ht(I,U,G,le){for(let We=0;We<I.length;++We){const tt=I[We];if(!tt.da&&tt.listener==U&&tt.capture==!!G&&tt.ha==le)return We}return-1}var Ji="closure_lm_"+(Math.random()*1e6|0),On={};function ar(I,U,G,le,We){if(Array.isArray(U)){for(let tt=0;tt<U.length;tt++)ar(I,U[tt],G,le,We);return null}return G=Ys(G),I&&I[In]?I.J(U,G,h(le)?!!le.capture:!1,We):uo(I,U,G,!1,le,We)}function uo(I,U,G,le,We,tt){if(!U)throw Error("Invalid event type");const Rt=h(We)?!!We.capture:!!We;let yn=Ls(I);if(yn||(I[Ji]=yn=new qt(I)),G=yn.add(U,G,le,Rt,tt),G.proxy)return G;if(le=Na(),G.proxy=le,le.src=I,le.listener=G,I.addEventListener)Ve||(We=Rt),We===void 0&&(We=!1),I.addEventListener(U.toString(),le,We);else if(I.attachEvent)I.attachEvent(Pi(U.toString()),le);else if(I.addListener&&I.removeListener)I.addListener(le);else throw Error("addEventListener and attachEvent are unavailable.");return G}function Na(){function I(G){return U.call(I.src,I.listener,G)}const U=Xs;return I}function zr(I,U,G,le,We){if(Array.isArray(U))for(var tt=0;tt<U.length;tt++)zr(I,U[tt],G,le,We);else le=h(le)?!!le.capture:!!le,G=Ys(G),I&&I[In]?(I=I.i,tt=String(U).toString(),tt in I.g&&(U=I.g[tt],G=Ht(U,G,le,We),G>-1&&(Zt(U[G]),Array.prototype.splice.call(U,G,1),U.length==0&&(delete I.g[tt],I.h--)))):I&&(I=Ls(I))&&(U=I.g[U.toString()],I=-1,U&&(I=Ht(U,G,le,We)),(G=I>-1?U[I]:null)&&hi(G))}function hi(I){if(typeof I!="number"&&I&&!I.da){var U=I.src;if(U&&U[In])An(U.i,I);else{var G=I.type,le=I.proxy;U.removeEventListener?U.removeEventListener(G,le,I.capture):U.detachEvent?U.detachEvent(Pi(G),le):U.addListener&&U.removeListener&&U.removeListener(le),(G=Ls(U))?(An(G,I),G.h==0&&(G.src=null,U[Ji]=null)):Zt(I)}}}function Pi(I){return I in On?On[I]:On[I]="on"+I}function Xs(I,U){if(I.da)I=!0;else{U=new dn(U,this);const G=I.listener,le=I.ha||I.src;I.fa&&hi(I),I=G.call(le,U)}return I}function Ls(I){return I=I[Ji],I instanceof qt?I:null}var br="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ys(I){return typeof I=="function"?I:(I[br]||(I[br]=function(U){return I.handleEvent(U)}),I[br])}function di(){Oe.call(this),this.i=new qt(this),this.M=this,this.G=null}K(di,Oe),di.prototype[In]=!0,di.prototype.removeEventListener=function(I,U,G,le){zr(this,I,U,G,le)};function Wi(I,U){var G,le=I.G;if(le)for(G=[];le;le=le.G)G.push(le);if(I=I.M,le=U.type||U,typeof U=="string")U=new Me(U,I);else if(U instanceof Me)U.target=U.target||I;else{var We=U;U=new Me(le,I),Mt(U,We)}We=!0;let tt,Rt;if(G)for(Rt=G.length-1;Rt>=0;Rt--)tt=U.g=G[Rt],We=Yr(tt,le,!0,U)&&We;if(tt=U.g=I,We=Yr(tt,le,!0,U)&&We,We=Yr(tt,le,!1,U)&&We,G)for(Rt=0;Rt<G.length;Rt++)tt=U.g=G[Rt],We=Yr(tt,le,!1,U)&&We}di.prototype.N=function(){if(di.Z.N.call(this),this.i){var I=this.i;for(const U in I.g){const G=I.g[U];for(let le=0;le<G.length;le++)Zt(G[le]);delete I.g[U],I.h--}}this.G=null},di.prototype.J=function(I,U,G,le){return this.i.add(String(I),U,!1,G,le)},di.prototype.K=function(I,U,G,le){return this.i.add(String(I),U,!0,G,le)};function Yr(I,U,G,le){if(U=I.i.g[String(U)],!U)return!0;U=U.concat();let We=!0;for(let tt=0;tt<U.length;++tt){const Rt=U[tt];if(Rt&&!Rt.da&&Rt.capture==G){const yn=Rt.listener,jn=Rt.ha||Rt.src;Rt.fa&&An(I.i,Rt),We=yn.call(jn,le)!==!1&&We}}return We&&!le.defaultPrevented}function ho(I,U){if(typeof I!="function")if(I&&typeof I.handleEvent=="function")I=O(I.handleEvent,I);else throw Error("Invalid listener argument");return Number(U)>2147483647?-1:y.setTimeout(I,U||0)}function xa(I){I.g=ho(()=>{I.g=null,I.i&&(I.i=!1,xa(I))},I.l);const U=I.h;I.h=null,I.m.apply(null,U)}class Bo extends Oe{constructor(U,G){super(),this.m=U,this.l=G,this.h=null,this.i=!1,this.g=null}j(U){this.h=arguments,this.g?this.i=!0:xa(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ns(I){Oe.call(this),this.h=I,this.g={}}K(Ns,Oe);var gs=[];function Ki(I){Wt(I.g,function(U,G){this.g.hasOwnProperty(G)&&hi(U)},I),I.g={}}Ns.prototype.N=function(){Ns.Z.N.call(this),Ki(this)},Ns.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var qr=y.JSON.stringify,Pe=y.JSON.parse,J=class{stringify(I){return y.JSON.stringify(I,void 0)}parse(I){return y.JSON.parse(I,void 0)}};function Q(){}function re(){}var me={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function xe(){Me.call(this,"d")}K(xe,Me);function ke(){Me.call(this,"c")}K(ke,Me);var Fe={},Le=null;function nt(){return Le=Le||new di}Fe.Ia="serverreachability";function mt(I){Me.call(this,Fe.Ia,I)}K(mt,Me);function ot(I){const U=nt();Wi(U,new mt(U))}Fe.STAT_EVENT="statevent";function zt(I,U){Me.call(this,Fe.STAT_EVENT,I),this.stat=U}K(zt,Me);function Re(I){const U=nt();Wi(U,new zt(U,I))}Fe.Ja="timingevent";function nn(I,U){Me.call(this,Fe.Ja,I),this.size=U}K(nn,Me);function _n(I,U){if(typeof I!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){I()},U)}function Nt(){this.g=!0}Nt.prototype.ua=function(){this.g=!1};function cn(I,U,G,le,We,tt){I.info(function(){if(I.g)if(tt){var Rt="",yn=tt.split("&");for(let ai=0;ai<yn.length;ai++){var jn=yn[ai].split("=");if(jn.length>1){const qi=jn[0];jn=jn[1];const Hr=qi.split("_");Rt=Hr.length>=2&&Hr[1]=="type"?Rt+(qi+"="+jn+"&"):Rt+(qi+"=redacted&")}}}else Rt=null;else Rt=tt;return"XMLHTTP REQ ("+le+") [attempt "+We+"]: "+U+`
`+G+`
`+Rt})}function Yn(I,U,G,le,We,tt,Rt){I.info(function(){return"XMLHTTP RESP ("+le+") [ attempt "+We+"]: "+U+`
`+G+`
`+tt+" "+Rt})}function vi(I,U,G,le){I.info(function(){return"XMLHTTP TEXT ("+U+"): "+ei(I,G)+(le?" "+le:"")})}function or(I,U){I.info(function(){return"TIMEOUT: "+U})}Nt.prototype.info=function(){};function ei(I,U){if(!I.g)return U;if(!U)return null;try{const tt=JSON.parse(U);if(tt){for(I=0;I<tt.length;I++)if(Array.isArray(tt[I])){var G=tt[I];if(!(G.length<2)){var le=G[1];if(Array.isArray(le)&&!(le.length<1)){var We=le[0];if(We!="noop"&&We!="stop"&&We!="close")for(let Rt=1;Rt<le.length;Rt++)le[Rt]=""}}}}return qr(tt)}catch{return U}}var Kt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},rn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},fi;function yt(){}K(yt,Q),yt.prototype.g=function(){return new XMLHttpRequest},fi=new yt;function er(I){return encodeURIComponent(String(I))}function Ni(I){var U=1;I=I.split(":");const G=[];for(;U>0&&I.length;)G.push(I.shift()),U--;return I.length&&G.push(I.join(":")),G}function Lr(I,U,G,le){this.j=I,this.i=U,this.l=G,this.S=le||1,this.V=new Ns(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Qs}function Qs(){this.i=null,this.g="",this.h=!1}var It={},un={};function sn(I,U,G){I.M=1,I.A=Va(mi(U)),I.u=G,I.R=!0,$i(I,null)}function $i(I,U){I.F=Date.now(),fo(I),I.B=mi(I.A);var G=I.B,le=I.S;Array.isArray(le)||(le=[String(le)]),Sa(G.i,"t",le),I.C=0,G=I.j.L,I.h=new Qs,I.g=wo(I.j,G?U:null,!I.u),I.P>0&&(I.O=new Bo(O(I.Y,I,I.g),I.P)),U=I.V,G=I.g,le=I.ba;var We="readystatechange";Array.isArray(We)||(We&&(gs[0]=We.toString()),We=gs);for(let tt=0;tt<We.length;tt++){const Rt=ar(G,We[tt],le||U.handleEvent,!1,U.h||U);if(!Rt)break;U.g[Rt.key]=Rt}U=I.J?ut(I.J):{},I.u?(I.v||(I.v="POST"),U["Content-Type"]="application/x-www-form-urlencoded",I.g.ea(I.B,I.v,I.u,U)):(I.v="GET",I.g.ea(I.B,I.v,null,U)),ot(),cn(I.i,I.v,I.B,I.l,I.S,I.u)}Lr.prototype.ba=function(I){I=I.target;const U=this.O;U&&Bi(I)==3?U.j():this.Y(I)},Lr.prototype.Y=function(I){try{if(I==this.g)e:{const yn=Bi(this.g),jn=this.g.ya(),ai=this.g.ca();if(!(yn<3)&&(yn!=3||this.g&&(this.h.h||this.g.la()||ns(this.g)))){this.K||yn!=4||jn==7||(jn==8||ai<=0?ot(3):ot(2)),Js(this);var U=this.g.ca();this.X=U;var G=Bs(this);if(this.o=U==200,Yn(this.i,this.v,this.B,this.l,this.S,yn,U),this.o){if(this.U&&!this.L){t:{if(this.g){var le,We=this.g;if((le=We.g?We.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Te(le)){var tt=le;break t}}tt=null}if(I=tt)vi(this.i,this.l,I,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,bi(this,I);else{this.o=!1,this.m=3,Re(12),_s(this),Qr(this);break e}}if(this.R){I=!0;let qi;for(;!this.K&&this.C<G.length;)if(qi=pn(this,G),qi==un){yn==4&&(this.m=4,Re(14),I=!1),vi(this.i,this.l,null,"[Incomplete Response]");break}else if(qi==It){this.m=4,Re(15),vi(this.i,this.l,G,"[Invalid Chunk]"),I=!1;break}else vi(this.i,this.l,qi,null),bi(this,qi);if(pi(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),yn!=4||G.length!=0||this.h.h||(this.m=1,Re(16),I=!1),this.o=this.o&&I,!I)vi(this.i,this.l,G,"[Invalid Chunked Response]"),_s(this),Qr(this);else if(G.length>0&&!this.W){this.W=!0;var Rt=this.j;Rt.g==this&&Rt.aa&&!Rt.P&&(Rt.j.info("Great, no buffering proxy detected. Bytes received: "+G.length),Pc(Rt),Rt.P=!0,Re(11))}}else vi(this.i,this.l,G,null),bi(this,G);yn==4&&_s(this),this.o&&!this.K&&(yn==4?Tu(this.j,this):(this.o=!1,fo(this)))}else _o(this.g),U==400&&G.indexOf("Unknown SID")>0?(this.m=3,Re(12)):(this.m=0,Re(13)),_s(this),Qr(this)}}}catch{}finally{}};function Bs(I){if(!pi(I))return I.g.la();const U=ns(I.g);if(U==="")return"";let G="";const le=U.length,We=Bi(I.g)==4;if(!I.h.i){if(typeof TextDecoder>"u")return _s(I),Qr(I),"";I.h.i=new y.TextDecoder}for(let tt=0;tt<le;tt++)I.h.h=!0,G+=I.h.i.decode(U[tt],{stream:!(We&&tt==le-1)});return U.length=0,I.h.g+=G,I.C=0,I.h.g}function pi(I){return I.g?I.v=="GET"&&I.M!=2&&I.j.Aa:!1}function pn(I,U){var G=I.C,le=U.indexOf(`
`,G);return le==-1?un:(G=Number(U.substring(G,le)),isNaN(G)?It:(le+=1,le+G>U.length?un:(U=U.slice(le,le+G),I.C=le+G,U)))}Lr.prototype.cancel=function(){this.K=!0,_s(this)};function fo(I){I.T=Date.now()+I.H,Gr(I,I.H)}function Gr(I,U){if(I.D!=null)throw Error("WatchDog timer not null");I.D=_n(O(I.aa,I),U)}function Js(I){I.D&&(y.clearTimeout(I.D),I.D=null)}Lr.prototype.aa=function(){this.D=null;const I=Date.now();I-this.T>=0?(or(this.i,this.B),this.M!=2&&(ot(),Re(17)),_s(this),this.m=2,Qr(this)):Gr(this,this.T-I)};function Qr(I){I.j.I==0||I.K||Tu(I.j,I)}function _s(I){Js(I);var U=I.O;U&&typeof U.dispose=="function"&&U.dispose(),I.O=null,Ki(I.V),I.g&&(U=I.g,I.g=null,U.abort(),U.dispose())}function bi(I,U){try{var G=I.j;if(G.I!=0&&(G.g==I||Ba(G.h,I))){if(!I.L&&Ba(G.h,I)&&G.I==3){try{var le=G.Ba.g.parse(U)}catch{le=null}if(Array.isArray(le)&&le.length==3){var We=le;if(We[0]==0){e:if(!G.v){if(G.g)if(G.g.F+3e3<I.F)yl(G),ia(G);else break e;Mi(G),Re(18)}}else G.xa=We[1],0<G.xa-G.K&&We[2]<37500&&G.F&&G.A==0&&!G.C&&(G.C=_n(O(G.Va,G),6e3));ea(G.h)<=1&&G.ta&&(G.ta=void 0)}else Vi(G,11)}else if((I.L||G.g==I)&&yl(G),!Te(U))for(We=G.Ba.g.parse(U),U=0;U<We.length;U++){let ai=We[U];const qi=ai[0];if(!(qi<=G.K))if(G.K=qi,ai=ai[1],G.I==2)if(ai[0]=="c"){G.M=ai[1],G.ba=ai[2];const Hr=ai[3];Hr!=null&&(G.ka=Hr,G.j.info("VER="+G.ka));const Vs=ai[4];Vs!=null&&(G.za=Vs,G.j.info("SVER="+G.za));const Ga=ai[5];Ga!=null&&typeof Ga=="number"&&Ga>0&&(le=1.5*Ga,G.O=le,G.j.info("backChannelRequestTimeoutMs_="+le)),le=G;const js=I.g;if(js){const Ha=js.g?js.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ha){var tt=le.h;tt.g||Ha.indexOf("spdy")==-1&&Ha.indexOf("quic")==-1&&Ha.indexOf("h2")==-1||(tt.j=tt.l,tt.g=new Set,tt.h&&(fl(tt,tt.h),tt.h=null))}if(le.G){const Za=js.g?js.g.getResponseHeader("X-HTTP-Session-Id"):null;Za&&(le.wa=Za,gi(le.J,le.G,Za))}}G.I=3,G.l&&G.l.ra(),G.aa&&(G.T=Date.now()-I.F,G.j.info("Handshake RTT: "+G.T+"ms")),le=G;var Rt=I;if(le.na=sa(le,le.L?le.ba:null,le.W),Rt.L){Jr(le.h,Rt);var yn=Rt,jn=le.O;jn&&(yn.H=jn),yn.D&&(Js(yn),fo(yn)),le.g=Rt}else xo(le);G.i.length>0&&vo(G)}else ai[0]!="stop"&&ai[0]!="close"||Vi(G,7);else G.I==3&&(ai[0]=="stop"||ai[0]=="close"?ai[0]=="stop"?Vi(G,7):qa(G):ai[0]!="noop"&&G.l&&G.l.qa(ai),G.A=0)}}ot(4)}catch{}}var Cc=class{constructor(I,U){this.g=I,this.map=U}};function xr(I){this.l=I||10,y.PerformanceNavigationTiming?(I=y.performance.getEntriesByType("navigation"),I=I.length>0&&(I[0].nextHopProtocol=="hq"||I[0].nextHopProtocol=="h2")):I=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=I?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function qn(I){return I.h?!0:I.g?I.g.size>=I.j:!1}function ea(I){return I.h?1:I.g?I.g.size:0}function Ba(I,U){return I.h?I.h==U:I.g?I.g.has(U):!1}function fl(I,U){I.g?I.g.add(U):I.h=U}function Jr(I,U){I.h&&I.h==U?I.h=null:I.g&&I.g.has(U)&&I.g.delete(U)}xr.prototype.cancel=function(){if(this.i=ta(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const I of this.g.values())I.cancel();this.g.clear()}};function ta(I){if(I.h!=null)return I.i.concat(I.h.G);if(I.g!=null&&I.g.size!==0){let U=I.i;for(const G of I.g.values())U=U.concat(G.G);return U}return Y(I.i)}var pl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mh(I,U){if(I){I=I.split("&");for(let G=0;G<I.length;G++){const le=I[G].indexOf("=");let We,tt=null;le>=0?(We=I[G].substring(0,le),tt=I[G].substring(le+1)):We=I[G],U(We,tt?decodeURIComponent(tt.replace(/\+/g," ")):"")}}}function wa(I){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let U;I instanceof wa?(this.l=I.l,Vo(this,I.j),this.o=I.o,this.g=I.g,Ul(this,I.u),this.h=I.h,ml(this,go(I.i)),this.m=I.m):I&&(U=String(I).match(pl))?(this.l=!1,Vo(this,U[1]||"",!0),this.o=Ta(U[2]||""),this.g=Ta(U[3]||"",!0),Ul(this,U[4]),this.h=Ta(U[5]||"",!0),ml(this,U[6]||"",!0),this.m=Ta(U[7]||"")):(this.l=!1,this.i=new es(null,this.l))}wa.prototype.toString=function(){const I=[];var U=this.j;U&&I.push(wr(U,po,!0),":");var G=this.g;return(G||U=="file")&&(I.push("//"),(U=this.o)&&I.push(wr(U,po,!0),"@"),I.push(er(G).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),G=this.u,G!=null&&I.push(":",String(G))),(G=this.h)&&(this.g&&G.charAt(0)!="/"&&I.push("/"),I.push(wr(G,G.charAt(0)=="/"?mo:$l,!0))),(G=this.i.toString())&&I.push("?",G),(G=this.m)&&I.push("#",wr(G,jo)),I.join("")},wa.prototype.resolve=function(I){const U=mi(this);let G=!!I.j;G?Vo(U,I.j):G=!!I.o,G?U.o=I.o:G=!!I.g,G?U.g=I.g:G=I.u!=null;var le=I.h;if(G)Ul(U,I.u);else if(G=!!I.h){if(le.charAt(0)!="/")if(this.g&&!this.h)le="/"+le;else{var We=U.h.lastIndexOf("/");We!=-1&&(le=U.h.slice(0,We+1)+le)}if(We=le,We==".."||We==".")le="";else if(We.indexOf("./")!=-1||We.indexOf("/.")!=-1){le=We.lastIndexOf("/",0)==0,We=We.split("/");const tt=[];for(let Rt=0;Rt<We.length;){const yn=We[Rt++];yn=="."?le&&Rt==We.length&&tt.push(""):yn==".."?((tt.length>1||tt.length==1&&tt[0]!="")&&tt.pop(),le&&Rt==We.length&&tt.push("")):(tt.push(yn),le=!0)}le=tt.join("/")}else le=We}return G?U.h=le:G=I.i.toString()!=="",G?ml(U,go(I.i)):G=!!I.m,G&&(U.m=I.m),U};function mi(I){return new wa(I)}function Vo(I,U,G){I.j=G?Ta(U,!0):U,I.j&&(I.j=I.j.replace(/:$/,""))}function Ul(I,U){if(U){if(U=Number(U),isNaN(U)||U<0)throw Error("Bad port number "+U);I.u=U}else I.u=null}function ml(I,U,G){U instanceof es?(I.i=U,Ua(I.i,I.l)):(G||(U=wr(U,gh)),I.i=new es(U,I.l))}function gi(I,U,G){I.i.set(U,G)}function Va(I){return gi(I,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),I}function Ta(I,U){return I?U?decodeURI(I.replace(/%25/g,"%2525")):decodeURIComponent(I):""}function wr(I,U,G){return typeof I=="string"?(I=encodeURI(I).replace(U,Fl),G&&(I=I.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),I):null}function Fl(I){return I=I.charCodeAt(0),"%"+(I>>4&15).toString(16)+(I&15).toString(16)}var po=/[#\/\?@]/g,$l=/[#\?:]/g,mo=/[#\?]/g,gh=/[#\?@]/g,jo=/#/g;function es(I,U){this.h=this.g=null,this.i=I||null,this.j=!!U}function Ar(I){I.g||(I.g=new Map,I.h=0,I.i&&mh(I.i,function(U,G){I.add(decodeURIComponent(U.replace(/\+/g," ")),G)}))}c=es.prototype,c.add=function(I,U){Ar(this),this.i=null,I=on(this,I);let G=this.g.get(I);return G||this.g.set(I,G=[]),G.push(U),this.h+=1,this};function xn(I,U){Ar(I),U=on(I,U),I.g.has(U)&&(I.i=null,I.h-=I.g.get(U).length,I.g.delete(U))}function ja(I,U){return Ar(I),U=on(I,U),I.g.has(U)}c.forEach=function(I,U){Ar(this),this.g.forEach(function(G,le){G.forEach(function(We){I.call(U,We,le,this)},this)},this)};function na(I,U){Ar(I);let G=[];if(typeof U=="string")ja(I,U)&&(G=G.concat(I.g.get(on(I,U))));else for(I=Array.from(I.g.values()),U=0;U<I.length;U++)G=G.concat(I[U]);return G}c.set=function(I,U){return Ar(this),this.i=null,I=on(this,I),ja(this,I)&&(this.h-=this.g.get(I).length),this.g.set(I,[U]),this.h+=1,this},c.get=function(I,U){return I?(I=na(this,I),I.length>0?String(I[0]):U):U};function Sa(I,U,G){xn(I,U),G.length>0&&(I.i=null,I.g.set(on(I,U),Y(G)),I.h+=G.length)}c.toString=function(){if(this.i)return this.i;if(!this.g)return"";const I=[],U=Array.from(this.g.keys());for(let le=0;le<U.length;le++){var G=U[le];const We=er(G);G=na(this,G);for(let tt=0;tt<G.length;tt++){let Rt=We;G[tt]!==""&&(Rt+="="+er(G[tt])),I.push(Rt)}}return this.i=I.join("&")};function go(I){const U=new es;return U.i=I.i,I.g&&(U.g=new Map(I.g),U.h=I.h),U}function on(I,U){return U=String(U),I.j&&(U=U.toLowerCase()),U}function Ua(I,U){U&&!I.j&&(Ar(I),I.i=null,I.g.forEach(function(G,le){const We=le.toLowerCase();le!=We&&(xn(this,le),Sa(this,We,G))},I)),I.j=U}function gl(I,U){const G=new Nt;if(y.Image){const le=new Image;le.onload=V(si,G,"TestLoadImage: loaded",!0,U,le),le.onerror=V(si,G,"TestLoadImage: error",!1,U,le),le.onabort=V(si,G,"TestLoadImage: abort",!1,U,le),le.ontimeout=V(si,G,"TestLoadImage: timeout",!1,U,le),y.setTimeout(function(){le.ontimeout&&le.ontimeout()},1e4),le.src=I}else U(!1)}function Fa(I,U){const G=new Nt,le=new AbortController,We=setTimeout(()=>{le.abort(),si(G,"TestPingServer: timeout",!1,U)},1e4);fetch(I,{signal:le.signal}).then(tt=>{clearTimeout(We),tt.ok?si(G,"TestPingServer: ok",!0,U):si(G,"TestPingServer: server error",!1,U)}).catch(()=>{clearTimeout(We),si(G,"TestPingServer: error",!1,U)})}function si(I,U,G,le,We){try{We&&(We.onload=null,We.onerror=null,We.onabort=null,We.ontimeout=null),le(G)}catch{}}function lr(){this.g=new J}function cr(I){this.i=I.Sb||null,this.h=I.ab||!1}K(cr,Q),cr.prototype.g=function(){return new Ri(this.i,this.h)};function Ri(I,U){di.call(this),this.H=I,this.o=U,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}K(Ri,di),c=Ri.prototype,c.open=function(I,U){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=I,this.D=U,this.readyState=1,Xi(this)},c.send=function(I){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const U={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};I&&(U.body=I),(this.H||y).fetch(new Request(this.D,U)).then(this.Pa.bind(this),this.ga.bind(this))},c.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ts(this)),this.readyState=0},c.Pa=function(I){if(this.g&&(this.l=I,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=I.headers,this.readyState=2,Xi(this)),this.g&&(this.readyState=3,Xi(this),this.g)))if(this.responseType==="arraybuffer")I.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in I){if(this.j=I.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Vn(this)}else I.text().then(this.Oa.bind(this),this.ga.bind(this))};function Vn(I){I.j.read().then(I.Ma.bind(I)).catch(I.ga.bind(I))}c.Ma=function(I){if(this.g){if(this.o&&I.value)this.response.push(I.value);else if(!this.o){var U=I.value?I.value:new Uint8Array(0);(U=this.B.decode(U,{stream:!I.done}))&&(this.response=this.responseText+=U)}I.done?ts(this):Xi(this),this.readyState==3&&Vn(this)}},c.Oa=function(I){this.g&&(this.response=this.responseText=I,ts(this))},c.Na=function(I){this.g&&(this.response=I,ts(this))},c.ga=function(){this.g&&ts(this)};function ts(I){I.readyState=4,I.l=null,I.j=null,I.B=null,Xi(I)}c.setRequestHeader=function(I,U){this.A.append(I,U)},c.getResponseHeader=function(I){return this.h&&this.h.get(I.toLowerCase())||""},c.getAllResponseHeaders=function(){if(!this.h)return"";const I=[],U=this.h.entries();for(var G=U.next();!G.done;)G=G.value,I.push(G[0]+": "+G[1]),G=U.next();return I.join(`\r
`)};function Xi(I){I.onreadystatechange&&I.onreadystatechange.call(I)}Object.defineProperty(Ri.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(I){this.m=I?"include":"same-origin"}});function Tr(I){let U="";return Wt(I,function(G,le){U+=le,U+=":",U+=G,U+=`\r
`}),U}function xi(I,U,G){e:{for(le in G){var le=!1;break e}le=!0}le||(G=Tr(G),typeof I=="string"?G!=null&&er(G):gi(I,U,G))}function ln(I){di.call(this),this.headers=new Map,this.L=I||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}K(ln,di);var Ea=/^https?$/i,Qt=["POST","PUT"];c=ln.prototype,c.Fa=function(I){this.H=I},c.ea=function(I,U,G,le){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+I);U=U?U.toUpperCase():"GET",this.D=I,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():fi.g(),this.g.onreadystatechange=ee(O(this.Ca,this));try{this.B=!0,this.g.open(U,String(I),!0),this.B=!1}catch(tt){an(this,tt);return}if(I=G||"",G=new Map(this.headers),le)if(Object.getPrototypeOf(le)===Object.prototype)for(var We in le)G.set(We,le[We]);else if(typeof le.keys=="function"&&typeof le.get=="function")for(const tt of le.keys())G.set(tt,le.get(tt));else throw Error("Unknown input type for opt_headers: "+String(le));le=Array.from(G.keys()).find(tt=>tt.toLowerCase()=="content-type"),We=y.FormData&&I instanceof y.FormData,!(Array.prototype.indexOf.call(Qt,U,void 0)>=0)||le||We||G.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[tt,Rt]of G)this.g.setRequestHeader(tt,Rt);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(I),this.v=!1}catch(tt){an(this,tt)}};function an(I,U){I.h=!1,I.g&&(I.j=!0,I.g.abort(),I.j=!1),I.l=U,I.o=5,ys(I),Qn(I)}function ys(I){I.A||(I.A=!0,Wi(I,"complete"),Wi(I,"error"))}c.abort=function(I){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=I||7,Wi(this,"complete"),Wi(this,"abort"),Qn(this))},c.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qn(this,!0)),ln.Z.N.call(this)},c.Ca=function(){this.u||(this.B||this.v||this.j?Cn(this):this.Xa())},c.Xa=function(){Cn(this)};function Cn(I){if(I.h&&typeof v<"u"){if(I.v&&Bi(I)==4)setTimeout(I.Ca.bind(I),0);else if(Wi(I,"readystatechange"),Bi(I)==4){I.h=!1;try{const tt=I.ca();e:switch(tt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var U=!0;break e;default:U=!1}var G;if(!(G=U)){var le;if(le=tt===0){let Rt=String(I.D).match(pl)[1]||null;!Rt&&y.self&&y.self.location&&(Rt=y.self.location.protocol.slice(0,-1)),le=!Ea.test(Rt?Rt.toLowerCase():"")}G=le}if(G)Wi(I,"complete"),Wi(I,"success");else{I.o=6;try{var We=Bi(I)>2?I.g.statusText:""}catch{We=""}I.l=We+" ["+I.ca()+"]",ys(I)}}finally{Qn(I)}}}}function Qn(I,U){if(I.g){I.m&&(clearTimeout(I.m),I.m=null);const G=I.g;I.g=null,U||Wi(I,"ready");try{G.onreadystatechange=null}catch{}}}c.isActive=function(){return!!this.g};function Bi(I){return I.g?I.g.readyState:0}c.ca=function(){try{return Bi(this)>2?this.g.status:-1}catch{return-1}},c.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},c.La=function(I){if(this.g){var U=this.g.responseText;return I&&U.indexOf(I)==0&&(U=U.substring(I.length)),Pe(U)}};function ns(I){try{if(!I.g)return null;if("response"in I.g)return I.g.response;switch(I.F){case"":case"text":return I.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in I.g)return I.g.mozResponseArrayBuffer}return null}catch{return null}}function _o(I){const U={};I=(I.g&&Bi(I)>=2&&I.g.getAllResponseHeaders()||"").split(`\r
`);for(let le=0;le<I.length;le++){if(Te(I[le]))continue;var G=Ni(I[le]);const We=G[0];if(G=G[1],typeof G!="string")continue;G=G.trim();const tt=U[We]||[];U[We]=tt,tt.push(G)}De(U,function(le){return le.join(", ")})}c.ya=function(){return this.o},c.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Uo(I,U,G){return G&&G.internalChannelParams&&G.internalChannelParams[I]||U}function $a(I){this.za=0,this.i=[],this.j=new Nt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Uo("failFast",!1,I),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Uo("baseRetryDelayMs",5e3,I),this.Za=Uo("retryDelaySeedMs",1e4,I),this.Ta=Uo("forwardChannelMaxRetries",2,I),this.va=Uo("forwardChannelRequestTimeoutMs",2e4,I),this.ma=I&&I.xmlHttpFactory||void 0,this.Ua=I&&I.Rb||void 0,this.Aa=I&&I.useFetchStreams||!1,this.O=void 0,this.L=I&&I.supportsCrossDomainXhr||!1,this.M="",this.h=new xr(I&&I.concurrentRequestLimit),this.Ba=new lr,this.S=I&&I.fastHandshake||!1,this.R=I&&I.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=I&&I.Pb||!1,I&&I.ua&&this.j.ua(),I&&I.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&I&&I.detectBufferingProxy||!1,this.ia=void 0,I&&I.longPollingTimeout&&I.longPollingTimeout>0&&(this.ia=I.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}c=$a.prototype,c.ka=8,c.I=1,c.connect=function(I,U,G,le){Re(0),this.W=I,this.H=U||{},G&&le!==void 0&&(this.H.OSID=G,this.H.OAID=le),this.F=this.X,this.J=sa(this,null,this.W),vo(this)};function qa(I){if(yo(I),I.I==3){var U=I.V++,G=mi(I.J);if(gi(G,"SID",I.M),gi(G,"RID",U),gi(G,"TYPE","terminate"),Aa(I,G),U=new Lr(I,I.j,U),U.M=2,U.A=Va(mi(G)),G=!1,y.navigator&&y.navigator.sendBeacon)try{G=y.navigator.sendBeacon(U.A.toString(),"")}catch{}!G&&y.Image&&(new Image().src=U.A,G=!0),G||(U.g=wo(U.j,null),U.g.ea(U.A)),U.F=Date.now(),fo(U)}vl(I)}function ia(I){I.g&&(Pc(I),I.g.cancel(),I.g=null)}function yo(I){ia(I),I.v&&(y.clearTimeout(I.v),I.v=null),yl(I),I.h.cancel(),I.m&&(typeof I.m=="number"&&y.clearTimeout(I.m),I.m=null)}function vo(I){if(!qn(I.h)&&!I.m){I.m=!0;var U=I.Ea;St||pe(),Pt||(St(),Pt=!0),Se.add(U,I),I.D=0}}function ra(I,U){return ea(I.h)>=I.h.j-(I.m?1:0)?!1:I.m?(I.i=U.G.concat(I.i),!0):I.I==1||I.I==2||I.D>=(I.Sa?0:I.Ta)?!1:(I.m=_n(O(I.Ea,I,U),Fo(I,I.D)),I.D++,!0)}c.Ea=function(I){if(this.m)if(this.m=null,this.I==1){if(!I){this.V=Math.floor(Math.random()*1e5),I=this.V++;const We=new Lr(this,this.j,I);let tt=this.o;if(this.U&&(tt?(tt=ut(tt),Mt(tt,this.U)):tt=this.U),this.u!==null||this.R||(We.J=tt,tt=null),this.S)e:{for(var U=0,G=0;G<this.i.length;G++){t:{var le=this.i[G];if("__data__"in le.map&&(le=le.map.__data__,typeof le=="string")){le=le.length;break t}le=void 0}if(le===void 0)break;if(U+=le,U>4096){U=G;break e}if(U===4096||G===this.i.length-1){U=G+1;break e}}U=1e3}else U=1e3;U=bo(this,We,U),G=mi(this.J),gi(G,"RID",I),gi(G,"CVER",22),this.G&&gi(G,"X-HTTP-Session-Id",this.G),Aa(this,G),tt&&(this.R?U="headers="+er(Tr(tt))+"&"+U:this.u&&xi(G,this.u,tt)),fl(this.h,We),this.Ra&&gi(G,"TYPE","init"),this.S?(gi(G,"$req",U),gi(G,"SID","null"),We.U=!0,sn(We,G,null)):sn(We,G,U),this.I=2}}else this.I==3&&(I?ur(this,I):this.i.length==0||qn(this.h)||ur(this))};function ur(I,U){var G;U?G=U.l:G=I.V++;const le=mi(I.J);gi(le,"SID",I.M),gi(le,"RID",G),gi(le,"AID",I.K),Aa(I,le),I.u&&I.o&&xi(le,I.u,I.o),G=new Lr(I,I.j,G,I.D+1),I.u===null&&(G.J=I.o),U&&(I.i=U.G.concat(I.i)),U=bo(I,G,1e3),G.H=Math.round(I.va*.5)+Math.round(I.va*.5*Math.random()),fl(I.h,G),sn(G,le,U)}function Aa(I,U){I.H&&Wt(I.H,function(G,le){gi(U,le,G)}),I.l&&Wt({},function(G,le){gi(U,le,G)})}function bo(I,U,G){G=Math.min(I.i.length,G);const le=I.l?O(I.l.Ka,I.l,I):null;e:{var We=I.i;let yn=-1;for(;;){const jn=["count="+G];yn==-1?G>0?(yn=We[0].g,jn.push("ofs="+yn)):yn=0:jn.push("ofs="+yn);let ai=!0;for(let qi=0;qi<G;qi++){var tt=We[qi].g;const Hr=We[qi].map;if(tt-=yn,tt<0)yn=Math.max(0,We[qi].g-100),ai=!1;else try{tt="req"+tt+"_"||"";try{var Rt=Hr instanceof Map?Hr:Object.entries(Hr);for(const[Vs,Ga]of Rt){let js=Ga;h(Ga)&&(js=qr(Ga)),jn.push(tt+Vs+"="+encodeURIComponent(js))}}catch(Vs){throw jn.push(tt+"type="+encodeURIComponent("_badmap")),Vs}}catch{le&&le(Hr)}}if(ai){Rt=jn.join("&");break e}}Rt=void 0}return I=I.i.splice(0,G),U.G=I,Rt}function xo(I){if(!I.g&&!I.v){I.Y=1;var U=I.Da;St||pe(),Pt||(St(),Pt=!0),Se.add(U,I),I.A=0}}function Mi(I){return I.g||I.v||I.A>=3?!1:(I.Y++,I.v=_n(O(I.Da,I),Fo(I,I.A)),I.A++,!0)}c.Da=function(){if(this.v=null,_l(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var I=4*this.T;this.j.info("BP detection timer enabled: "+I),this.B=_n(O(this.Wa,this),I)}},c.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Re(10),ia(this),_l(this))};function Pc(I){I.B!=null&&(y.clearTimeout(I.B),I.B=null)}function _l(I){I.g=new Lr(I,I.j,"rpc",I.Y),I.u===null&&(I.g.J=I.o),I.g.P=0;var U=mi(I.na);gi(U,"RID","rpc"),gi(U,"SID",I.M),gi(U,"AID",I.K),gi(U,"CI",I.F?"0":"1"),!I.F&&I.ia&&gi(U,"TO",I.ia),gi(U,"TYPE","xmlhttp"),Aa(I,U),I.u&&I.o&&xi(U,I.u,I.o),I.O&&(I.g.H=I.O);var G=I.g;I=I.ba,G.M=1,G.A=Va(mi(U)),G.u=null,G.R=!0,$i(G,I)}c.Va=function(){this.C!=null&&(this.C=null,ia(this),Mi(this),Re(19))};function yl(I){I.C!=null&&(y.clearTimeout(I.C),I.C=null)}function Tu(I,U){var G=null;if(I.g==U){yl(I),Pc(I),I.g=null;var le=2}else if(Ba(I.h,U))G=U.G,Jr(I.h,U),le=1;else return;if(I.I!=0){if(U.o)if(le==1){G=U.u?U.u.length:0,U=Date.now()-U.F;var We=I.D;le=nt(),Wi(le,new nn(le,G)),vo(I)}else xo(I);else if(We=U.m,We==3||We==0&&U.X>0||!(le==1&&ra(I,U)||le==2&&Mi(I)))switch(G&&G.length>0&&(U=I.h,U.i=U.i.concat(G)),We){case 1:Vi(I,5);break;case 4:Vi(I,10);break;case 3:Vi(I,6);break;default:Vi(I,2)}}}function Fo(I,U){let G=I.Qa+Math.floor(Math.random()*I.Za);return I.isActive()||(G*=2),G*U}function Vi(I,U){if(I.j.info("Error code "+U),U==2){var G=O(I.bb,I),le=I.Ua;const We=!le;le=new wa(le||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||Vo(le,"https"),Va(le),We?gl(le.toString(),G):Fa(le.toString(),G)}else Re(2);I.I=0,I.l&&I.l.pa(U),vl(I),yo(I)}c.bb=function(I){I?(this.j.info("Successfully pinged google.com"),Re(2)):(this.j.info("Failed to ping google.com"),Re(1))};function vl(I){if(I.I=0,I.ja=[],I.l){const U=ta(I.h);(U.length!=0||I.i.length!=0)&&(ve(I.ja,U),ve(I.ja,I.i),I.h.i.length=0,Y(I.i),I.i.length=0),I.l.oa()}}function sa(I,U,G){var le=G instanceof wa?mi(G):new wa(G);if(le.g!="")U&&(le.g=U+"."+le.g),Ul(le,le.u);else{var We=y.location;le=We.protocol,U=U?U+"."+We.hostname:We.hostname,We=+We.port;const tt=new wa(null);le&&Vo(tt,le),U&&(tt.g=U),We&&Ul(tt,We),G&&(tt.h=G),le=tt}return G=I.G,U=I.wa,G&&U&&gi(le,G,U),gi(le,"VER",I.ka),Aa(I,le),le}function wo(I,U,G){if(U&&!I.L)throw Error("Can't create secondary domain capable XhrIo object.");return U=I.Aa&&!I.ma?new ln(new cr({ab:G})):new ln(I.ma),U.Fa(I.L),U}c.isActive=function(){return!!this.l&&this.l.isActive(this)};function bl(){}c=bl.prototype,c.ra=function(){},c.qa=function(){},c.pa=function(){},c.oa=function(){},c.isActive=function(){return!0},c.Ka=function(){};function To(){}To.prototype.g=function(I,U){return new ti(I,U)};function ti(I,U){di.call(this),this.g=new $a(U),this.l=I,this.h=U&&U.messageUrlParams||null,I=U&&U.messageHeaders||null,U&&U.clientProtocolHeaderRequired&&(I?I["X-Client-Protocol"]="webchannel":I={"X-Client-Protocol":"webchannel"}),this.g.o=I,I=U&&U.initMessageHeaders||null,U&&U.messageContentType&&(I?I["X-WebChannel-Content-Type"]=U.messageContentType:I={"X-WebChannel-Content-Type":U.messageContentType}),U&&U.sa&&(I?I["X-WebChannel-Client-Profile"]=U.sa:I={"X-WebChannel-Client-Profile":U.sa}),this.g.U=I,(I=U&&U.Qb)&&!Te(I)&&(this.g.u=I),this.A=U&&U.supportsCrossDomainXhr||!1,this.v=U&&U.sendRawJson||!1,(U=U&&U.httpSessionIdParam)&&!Te(U)&&(this.g.G=U,I=this.h,I!==null&&U in I&&(I=this.h,U in I&&delete I[U])),this.j=new xl(this)}K(ti,di),ti.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ti.prototype.close=function(){qa(this.g)},ti.prototype.o=function(I){var U=this.g;if(typeof I=="string"){var G={};G.__data__=I,I=G}else this.v&&(G={},G.__data__=qr(I),I=G);U.i.push(new Cc(U.Ya++,I)),U.I==3&&vo(U)},ti.prototype.N=function(){this.g.l=null,delete this.j,qa(this.g),delete this.g,ti.Z.N.call(this)};function Rc(I){xe.call(this),I.__headers__&&(this.headers=I.__headers__,this.statusCode=I.__status__,delete I.__headers__,delete I.__status__);var U=I.__sm__;if(U){e:{for(const G in U){I=G;break e}I=void 0}(this.i=I)&&(I=this.i,U=U!==null&&I in U?U[I]:void 0),this.data=U}else this.data=I}K(Rc,xe);function ql(){ke.call(this),this.status=1}K(ql,ke);function xl(I){this.g=I}K(xl,bl),xl.prototype.ra=function(){Wi(this.g,"a")},xl.prototype.qa=function(I){Wi(this.g,new Rc(I))},xl.prototype.pa=function(I){Wi(this.g,new ql)},xl.prototype.oa=function(){Wi(this.g,"b")},To.prototype.createWebChannel=To.prototype.g,ti.prototype.send=ti.prototype.o,ti.prototype.open=ti.prototype.m,ti.prototype.close=ti.prototype.close,hT=function(){return new To},uT=function(){return nt()},cT=Fe,b0={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Kt.NO_ERROR=0,Kt.TIMEOUT=8,Kt.HTTP_ERROR=6,Ty=Kt,rn.COMPLETE="complete",lT=rn,re.EventType=me,me.OPEN="a",me.CLOSE="b",me.ERROR="c",me.MESSAGE="d",di.prototype.listen=di.prototype.J,Tg=re,ln.prototype.listenOnce=ln.prototype.K,ln.prototype.getLastError=ln.prototype.Ha,ln.prototype.getLastErrorCode=ln.prototype.ya,ln.prototype.getStatus=ln.prototype.ca,ln.prototype.getResponseJson=ln.prototype.La,ln.prototype.getResponseText=ln.prototype.la,ln.prototype.send=ln.prototype.ea,ln.prototype.setWithCredentials=ln.prototype.Fa,oT=ln}).apply(typeof cy<"u"?cy:typeof self<"u"?self:typeof window<"u"?window:{});const Ox="@firebase/firestore",zx="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Oa.UNAUTHENTICATED=new Oa(null),Oa.GOOGLE_CREDENTIALS=new Oa("google-credentials-uid"),Oa.FIRST_PARTY=new Oa("first-party-uid"),Oa.MOCK_USER=new Oa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hm="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vf=new sb("@firebase/firestore");function Bp(){return Vf.logLevel}function $t(c,...e){if(Vf.logLevel<=Wn.DEBUG){const i=e.map(lb);Vf.debug(`Firestore (${hm}): ${c}`,...i)}}function uh(c,...e){if(Vf.logLevel<=Wn.ERROR){const i=e.map(lb);Vf.error(`Firestore (${hm}): ${c}`,...i)}}function Qp(c,...e){if(Vf.logLevel<=Wn.WARN){const i=e.map(lb);Vf.warn(`Firestore (${hm}): ${c}`,...i)}}function lb(c){if(typeof c=="string")return c;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(i){return JSON.stringify(i)})(c)}catch{return c}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sn(c,e,i){let l="Unexpected state";typeof e=="string"?l=e:i=e,dT(c,l,i)}function dT(c,e,i){let l=`FIRESTORE (${hm}) INTERNAL ASSERTION FAILED: ${e} (ID: ${c.toString(16)})`;if(i!==void 0)try{l+=" CONTEXT: "+JSON.stringify(i)}catch{l+=" CONTEXT: "+i}throw uh(l),new Error(l)}function Li(c,e,i,l){let f="Unexpected state";typeof i=="string"?f=i:l=i,c||dT(e,f,l)}function Dn(c,e){return c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Jt extends ph{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(){this.promise=new Promise(((e,i)=>{this.resolve=e,this.reject=i}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fT{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class wP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable((()=>i(Oa.UNAUTHENTICATED)))}shutdown(){}}class TP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable((()=>i(this.token.user)))}shutdown(){this.changeListener=null}}class SP{constructor(e){this.t=e,this.currentUser=Oa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){Li(this.o===void 0,42304);let l=this.i;const f=M=>this.i!==l?(l=this.i,i(M)):Promise.resolve();let v=new _d;this.o=()=>{this.i++,this.currentUser=this.u(),v.resolve(),v=new _d,e.enqueueRetryable((()=>f(this.currentUser)))};const y=()=>{const M=v;e.enqueueRetryable((async()=>{await M.promise,await f(this.currentUser)}))},h=M=>{$t("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=M,this.o&&(this.auth.addAuthTokenListener(this.o),y())};this.t.onInit((M=>h(M))),setTimeout((()=>{if(!this.auth){const M=this.t.getImmediate({optional:!0});M?h(M):($t("FirebaseAuthCredentialsProvider","Auth not yet detected"),v.resolve(),v=new _d)}}),0),y()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then((l=>this.i!==e?($t("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):l?(Li(typeof l.accessToken=="string",31837,{l}),new fT(l.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Li(e===null||typeof e=="string",2055,{h:e}),new Oa(e)}}class EP{constructor(e,i,l){this.P=e,this.T=i,this.I=l,this.type="FirstParty",this.user=Oa.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class AP{constructor(e,i,l){this.P=e,this.T=i,this.I=l}getToken(){return Promise.resolve(new EP(this.P,this.T,this.I))}start(e,i){e.enqueueRetryable((()=>i(Oa.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Lx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class IP{constructor(e,i){this.V=i,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,du(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,i){Li(this.o===void 0,3512);const l=v=>{v.error!=null&&$t("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${v.error.message}`);const y=v.token!==this.m;return this.m=v.token,$t("FirebaseAppCheckTokenProvider",`Received ${y?"new":"existing"} token.`),y?i(v.token):Promise.resolve()};this.o=v=>{e.enqueueRetryable((()=>l(v)))};const f=v=>{$t("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=v,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((v=>f(v))),setTimeout((()=>{if(!this.appCheck){const v=this.V.getImmediate({optional:!0});v?f(v):$t("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Lx(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((i=>i?(Li(typeof i.token=="string",44558,{tokenResult:i}),this.m=i.token,new Lx(i.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CP(c){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(c);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let l=0;l<c;l++)i[l]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let l="";for(;l.length<20;){const f=CP(40);for(let v=0;v<f.length;++v)l.length<20&&f[v]<i&&(l+=e.charAt(f[v]%62))}return l}}function Kn(c,e){return c<e?-1:c>e?1:0}function x0(c,e){const i=Math.min(c.length,e.length);for(let l=0;l<i;l++){const f=c.charAt(l),v=e.charAt(l);if(f!==v)return Xv(f)===Xv(v)?Kn(f,v):Xv(f)?1:-1}return Kn(c.length,e.length)}const PP=55296,RP=57343;function Xv(c){const e=c.charCodeAt(0);return e>=PP&&e<=RP}function Jp(c,e,i){return c.length===e.length&&c.every(((l,f)=>i(l,e[f])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nx="__name__";class hu{constructor(e,i,l){i===void 0?i=0:i>e.length&&Sn(637,{offset:i,range:e.length}),l===void 0?l=e.length-i:l>e.length-i&&Sn(1746,{length:l,range:e.length-i}),this.segments=e,this.offset=i,this.len=l}get length(){return this.len}isEqual(e){return hu.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof hu?e.forEach((l=>{i.push(l)})):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,l=this.limit();i<l;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const l=Math.min(e.length,i.length);for(let f=0;f<l;f++){const v=hu.compareSegments(e.get(f),i.get(f));if(v!==0)return v}return Kn(e.length,i.length)}static compareSegments(e,i){const l=hu.isNumericId(e),f=hu.isNumericId(i);return l&&!f?-1:!l&&f?1:l&&f?hu.extractNumericId(e).compare(hu.extractNumericId(i)):x0(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return gd.fromString(e.substring(4,e.length-2))}}class yr extends hu{construct(e,i,l){return new yr(e,i,l)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const l of e){if(l.indexOf("//")>=0)throw new Jt(vt.INVALID_ARGUMENT,`Invalid segment (${l}). Paths must not contain // in them.`);i.push(...l.split("/").filter((f=>f.length>0)))}return new yr(i)}static emptyPath(){return new yr([])}}const MP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ya extends hu{construct(e,i,l){return new ya(e,i,l)}static isValidIdentifier(e){return MP.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ya.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Nx}static keyField(){return new ya([Nx])}static fromServerFormat(e){const i=[];let l="",f=0;const v=()=>{if(l.length===0)throw new Jt(vt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(l),l=""};let y=!1;for(;f<e.length;){const h=e[f];if(h==="\\"){if(f+1===e.length)throw new Jt(vt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const M=e[f+1];if(M!=="\\"&&M!=="."&&M!=="`")throw new Jt(vt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);l+=M,f+=2}else h==="`"?(y=!y,f++):h!=="."||y?(l+=h,f++):(v(),f++)}if(v(),y)throw new Jt(vt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ya(i)}static emptyPath(){return new ya([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this.path=e}static fromPath(e){return new fn(yr.fromString(e))}static fromName(e){return new fn(yr.fromString(e).popFirst(5))}static empty(){return new fn(yr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&yr.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return yr.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new fn(new yr(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pT(c,e,i){if(!i)throw new Jt(vt.INVALID_ARGUMENT,`Function ${c}() cannot be called with an empty ${e}.`)}function kP(c,e,i,l){if(e===!0&&l===!0)throw new Jt(vt.INVALID_ARGUMENT,`${c} and ${i} cannot be used together.`)}function Bx(c){if(!fn.isDocumentKey(c))throw new Jt(vt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${c} has ${c.length}.`)}function Vx(c){if(fn.isDocumentKey(c))throw new Jt(vt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${c} has ${c.length}.`)}function mT(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)}function ub(c){if(c===void 0)return"undefined";if(c===null)return"null";if(typeof c=="string")return c.length>20&&(c=`${c.substring(0,20)}...`),JSON.stringify(c);if(typeof c=="number"||typeof c=="boolean")return""+c;if(typeof c=="object"){if(c instanceof Array)return"an array";{const e=(function(l){return l.constructor?l.constructor.name:null})(c);return e?`a custom ${e} object`:"an object"}}return typeof c=="function"?"a function":Sn(12329,{type:typeof c})}function Ac(c,e){if("_delegate"in c&&(c=c._delegate),!(c instanceof e)){if(e.name===c.constructor.name)throw new Jt(vt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=ub(c);throw new Jt(vt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return c}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ps(c,e){const i={typeString:c};return e&&(i.value=e),i}function t_(c,e){if(!mT(c))throw new Jt(vt.INVALID_ARGUMENT,"JSON must be an object");let i;for(const l in e)if(e[l]){const f=e[l].typeString,v="value"in e[l]?{value:e[l].value}:void 0;if(!(l in c)){i=`JSON missing required field: '${l}'`;break}const y=c[l];if(f&&typeof y!==f){i=`JSON field '${l}' must be a ${f}.`;break}if(v!==void 0&&y!==v.value){i=`Expected '${l}' field to equal '${v.value}'`;break}}if(i)throw new Jt(vt.INVALID_ARGUMENT,i);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jx=-62135596800,Ux=1e6;class vr{static now(){return vr.fromMillis(Date.now())}static fromDate(e){return vr.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),l=Math.floor((e-1e3*i)*Ux);return new vr(i,l)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Jt(vt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Jt(vt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<jx)throw new Jt(vt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Jt(vt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ux}_compareTo(e){return this.seconds===e.seconds?Kn(this.nanoseconds,e.nanoseconds):Kn(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:vr._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(t_(e,vr._jsonSchema))return new vr(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-jx;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}vr._jsonSchemaVersion="firestore/timestamp/1.0",vr._jsonSchema={type:ps("string",vr._jsonSchemaVersion),seconds:ps("number"),nanoseconds:ps("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{static fromTimestamp(e){return new Rn(e)}static min(){return new Rn(new vr(0,0))}static max(){return new Rn(new vr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jg=-1;function DP(c,e){const i=c.toTimestamp().seconds,l=c.toTimestamp().nanoseconds+1,f=Rn.fromTimestamp(l===1e9?new vr(i+1,0):new vr(i,l));return new vd(f,fn.empty(),e)}function OP(c){return new vd(c.readTime,c.key,jg)}class vd{constructor(e,i,l){this.readTime=e,this.documentKey=i,this.largestBatchId=l}static min(){return new vd(Rn.min(),fn.empty(),jg)}static max(){return new vd(Rn.max(),fn.empty(),jg)}}function zP(c,e){let i=c.readTime.compareTo(e.readTime);return i!==0?i:(i=fn.comparator(c.documentKey,e.documentKey),i!==0?i:Kn(c.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LP="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class NP{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dm(c){if(c.code!==vt.FAILED_PRECONDITION||c.message!==LP)throw c;$t("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)}),(i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)}))}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Sn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new _t(((l,f)=>{this.nextCallback=v=>{this.wrapSuccess(e,v).next(l,f)},this.catchCallback=v=>{this.wrapFailure(i,v).next(l,f)}}))}toPromise(){return new Promise(((e,i)=>{this.next(e,i)}))}wrapUserFunction(e){try{const i=e();return i instanceof _t?i:_t.resolve(i)}catch(i){return _t.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction((()=>e(i))):_t.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction((()=>e(i))):_t.reject(i)}static resolve(e){return new _t(((i,l)=>{i(e)}))}static reject(e){return new _t(((i,l)=>{l(e)}))}static waitFor(e){return new _t(((i,l)=>{let f=0,v=0,y=!1;e.forEach((h=>{++f,h.next((()=>{++v,y&&v===f&&i()}),(M=>l(M)))})),y=!0,v===f&&i()}))}static or(e){let i=_t.resolve(!1);for(const l of e)i=i.next((f=>f?_t.resolve(f):l()));return i}static forEach(e,i){const l=[];return e.forEach(((f,v)=>{l.push(i.call(this,f,v))})),this.waitFor(l)}static mapArray(e,i){return new _t(((l,f)=>{const v=e.length,y=new Array(v);let h=0;for(let M=0;M<v;M++){const O=M;i(e[O]).next((V=>{y[O]=V,++h,h===v&&l(y)}),(V=>f(V)))}}))}static doWhile(e,i){return new _t(((l,f)=>{const v=()=>{e()===!0?i().next((()=>{v()}),f):l()};v()}))}}function BP(c){const e=c.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function fm(c){return c.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ov{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=l=>this.ae(l),this.ue=l=>i.writeSequenceNumber(l))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ov.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hb=-1;function lv(c){return c==null}function Ny(c){return c===0&&1/c==-1/0}function VP(c){return typeof c=="number"&&Number.isInteger(c)&&!Ny(c)&&c<=Number.MAX_SAFE_INTEGER&&c>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gT="";function jP(c){let e="";for(let i=0;i<c.length;i++)e.length>0&&(e=Fx(e)),e=UP(c.get(i),e);return Fx(e)}function UP(c,e){let i=e;const l=c.length;for(let f=0;f<l;f++){const v=c.charAt(f);switch(v){case"\0":i+="";break;case gT:i+="";break;default:i+=v}}return i}function Fx(c){return c+gT+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $x(c){let e=0;for(const i in c)Object.prototype.hasOwnProperty.call(c,i)&&e++;return e}function Ed(c,e){for(const i in c)Object.prototype.hasOwnProperty.call(c,i)&&e(i,c[i])}function _T(c){for(const e in c)if(Object.prototype.hasOwnProperty.call(c,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e,i){this.comparator=e,this.root=i||_a.EMPTY}insert(e,i){return new Or(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,_a.BLACK,null,null))}remove(e){return new Or(this.comparator,this.root.remove(e,this.comparator).copy(null,null,_a.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const l=this.comparator(e,i.key);if(l===0)return i.value;l<0?i=i.left:l>0&&(i=i.right)}return null}indexOf(e){let i=0,l=this.root;for(;!l.isEmpty();){const f=this.comparator(e,l.key);if(f===0)return i+l.left.size;f<0?l=l.left:(i+=l.left.size+1,l=l.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((i,l)=>(e(i,l),!1)))}toString(){const e=[];return this.inorderTraversal(((i,l)=>(e.push(`${i}:${l}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new uy(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new uy(this.root,e,this.comparator,!1)}getReverseIterator(){return new uy(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new uy(this.root,e,this.comparator,!0)}}class uy{constructor(e,i,l,f){this.isReverse=f,this.nodeStack=[];let v=1;for(;!e.isEmpty();)if(v=i?l(e.key,i):1,i&&f&&(v*=-1),v<0)e=this.isReverse?e.left:e.right;else{if(v===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class _a{constructor(e,i,l,f,v){this.key=e,this.value=i,this.color=l??_a.RED,this.left=f??_a.EMPTY,this.right=v??_a.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,l,f,v){return new _a(e??this.key,i??this.value,l??this.color,f??this.left,v??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,l){let f=this;const v=l(e,f.key);return f=v<0?f.copy(null,null,null,f.left.insert(e,i,l),null):v===0?f.copy(null,i,null,null,null):f.copy(null,null,null,null,f.right.insert(e,i,l)),f.fixUp()}removeMin(){if(this.left.isEmpty())return _a.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let l,f=this;if(i(e,f.key)<0)f.left.isEmpty()||f.left.isRed()||f.left.left.isRed()||(f=f.moveRedLeft()),f=f.copy(null,null,null,f.left.remove(e,i),null);else{if(f.left.isRed()&&(f=f.rotateRight()),f.right.isEmpty()||f.right.isRed()||f.right.left.isRed()||(f=f.moveRedRight()),i(e,f.key)===0){if(f.right.isEmpty())return _a.EMPTY;l=f.right.min(),f=f.copy(l.key,l.value,null,null,f.right.removeMin())}f=f.copy(null,null,null,null,f.right.remove(e,i))}return f.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,_a.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,_a.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Sn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Sn(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Sn(27949);return e+(this.isRed()?0:1)}}_a.EMPTY=null,_a.RED=!0,_a.BLACK=!1;_a.EMPTY=new class{constructor(){this.size=0}get key(){throw Sn(57766)}get value(){throw Sn(16141)}get color(){throw Sn(16727)}get left(){throw Sn(29726)}get right(){throw Sn(36894)}copy(e,i,l,f,v){return this}insert(e,i,l){return new _a(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e){this.comparator=e,this.data=new Or(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((i,l)=>(e(i),!1)))}forEachInRange(e,i){const l=this.data.getIteratorFrom(e[0]);for(;l.hasNext();){const f=l.getNext();if(this.comparator(f.key,e[1])>=0)return;i(f.key)}}forEachWhile(e,i){let l;for(l=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();l.hasNext();)if(!e(l.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new qx(this.data.getIterator())}getIteratorFrom(e){return new qx(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach((l=>{i=i.add(l)})),i}isEqual(e){if(!(e instanceof zs)||this.size!==e.size)return!1;const i=this.data.getIterator(),l=e.data.getIterator();for(;i.hasNext();){const f=i.getNext().key,v=l.getNext().key;if(this.comparator(f,v)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((i=>{e.push(i)})),e}toString(){const e=[];return this.forEach((i=>e.push(i))),"SortedSet("+e.toString()+")"}copy(e){const i=new zs(this.comparator);return i.data=e,i}}class qx{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e){this.fields=e,e.sort(ya.comparator)}static empty(){return new hl([])}unionWith(e){let i=new zs(ya.comparator);for(const l of this.fields)i=i.add(l);for(const l of e)i=i.add(l);return new hl(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return Jp(this.fields,e.fields,((i,l)=>i.isEqual(l)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(e){this.binaryString=e}static fromBase64String(e){const i=(function(f){try{return atob(f)}catch(v){throw typeof DOMException<"u"&&v instanceof DOMException?new yT("Invalid base64 string: "+v):v}})(e);return new ba(i)}static fromUint8Array(e){const i=(function(f){let v="";for(let y=0;y<f.length;++y)v+=String.fromCharCode(f[y]);return v})(e);return new ba(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(i){return btoa(i)})(this.binaryString)}toUint8Array(){return(function(i){const l=new Uint8Array(i.length);for(let f=0;f<i.length;f++)l[f]=i.charCodeAt(f);return l})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Kn(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ba.EMPTY_BYTE_STRING=new ba("");const FP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bd(c){if(Li(!!c,39018),typeof c=="string"){let e=0;const i=FP.exec(c);if(Li(!!i,46558,{timestamp:c}),i[1]){let f=i[1];f=(f+"000000000").substr(0,9),e=Number(f)}const l=new Date(c);return{seconds:Math.floor(l.getTime()/1e3),nanos:e}}return{seconds:Xr(c.seconds),nanos:Xr(c.nanos)}}function Xr(c){return typeof c=="number"?c:typeof c=="string"?Number(c):0}function xd(c){return typeof c=="string"?ba.fromBase64String(c):ba.fromUint8Array(c)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vT="server_timestamp",bT="__type__",xT="__previous_value__",wT="__local_write_time__";function db(c){return(c?.mapValue?.fields||{})[bT]?.stringValue===vT}function cv(c){const e=c.mapValue.fields[xT];return db(e)?cv(e):e}function Ug(c){const e=bd(c.mapValue.fields[wT].timestampValue);return new vr(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $P{constructor(e,i,l,f,v,y,h,M,O,V){this.databaseId=e,this.appId=i,this.persistenceKey=l,this.host=f,this.ssl=v,this.forceLongPolling=y,this.autoDetectLongPolling=h,this.longPollingOptions=M,this.useFetchStreams=O,this.isUsingEmulator=V}}const By="(default)";class Fg{constructor(e,i){this.projectId=e,this.database=i||By}static empty(){return new Fg("","")}get isDefaultDatabase(){return this.database===By}isEqual(e){return e instanceof Fg&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TT="__type__",qP="__max__",hy={mapValue:{}},ST="__vector__",Vy="value";function wd(c){return"nullValue"in c?0:"booleanValue"in c?1:"integerValue"in c||"doubleValue"in c?2:"timestampValue"in c?3:"stringValue"in c?5:"bytesValue"in c?6:"referenceValue"in c?7:"geoPointValue"in c?8:"arrayValue"in c?9:"mapValue"in c?db(c)?4:HP(c)?9007199254740991:GP(c)?10:11:Sn(28295,{value:c})}function vu(c,e){if(c===e)return!0;const i=wd(c);if(i!==wd(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return c.booleanValue===e.booleanValue;case 4:return Ug(c).isEqual(Ug(e));case 3:return(function(f,v){if(typeof f.timestampValue=="string"&&typeof v.timestampValue=="string"&&f.timestampValue.length===v.timestampValue.length)return f.timestampValue===v.timestampValue;const y=bd(f.timestampValue),h=bd(v.timestampValue);return y.seconds===h.seconds&&y.nanos===h.nanos})(c,e);case 5:return c.stringValue===e.stringValue;case 6:return(function(f,v){return xd(f.bytesValue).isEqual(xd(v.bytesValue))})(c,e);case 7:return c.referenceValue===e.referenceValue;case 8:return(function(f,v){return Xr(f.geoPointValue.latitude)===Xr(v.geoPointValue.latitude)&&Xr(f.geoPointValue.longitude)===Xr(v.geoPointValue.longitude)})(c,e);case 2:return(function(f,v){if("integerValue"in f&&"integerValue"in v)return Xr(f.integerValue)===Xr(v.integerValue);if("doubleValue"in f&&"doubleValue"in v){const y=Xr(f.doubleValue),h=Xr(v.doubleValue);return y===h?Ny(y)===Ny(h):isNaN(y)&&isNaN(h)}return!1})(c,e);case 9:return Jp(c.arrayValue.values||[],e.arrayValue.values||[],vu);case 10:case 11:return(function(f,v){const y=f.mapValue.fields||{},h=v.mapValue.fields||{};if($x(y)!==$x(h))return!1;for(const M in y)if(y.hasOwnProperty(M)&&(h[M]===void 0||!vu(y[M],h[M])))return!1;return!0})(c,e);default:return Sn(52216,{left:c})}}function $g(c,e){return(c.values||[]).find((i=>vu(i,e)))!==void 0}function em(c,e){if(c===e)return 0;const i=wd(c),l=wd(e);if(i!==l)return Kn(i,l);switch(i){case 0:case 9007199254740991:return 0;case 1:return Kn(c.booleanValue,e.booleanValue);case 2:return(function(v,y){const h=Xr(v.integerValue||v.doubleValue),M=Xr(y.integerValue||y.doubleValue);return h<M?-1:h>M?1:h===M?0:isNaN(h)?isNaN(M)?0:-1:1})(c,e);case 3:return Gx(c.timestampValue,e.timestampValue);case 4:return Gx(Ug(c),Ug(e));case 5:return x0(c.stringValue,e.stringValue);case 6:return(function(v,y){const h=xd(v),M=xd(y);return h.compareTo(M)})(c.bytesValue,e.bytesValue);case 7:return(function(v,y){const h=v.split("/"),M=y.split("/");for(let O=0;O<h.length&&O<M.length;O++){const V=Kn(h[O],M[O]);if(V!==0)return V}return Kn(h.length,M.length)})(c.referenceValue,e.referenceValue);case 8:return(function(v,y){const h=Kn(Xr(v.latitude),Xr(y.latitude));return h!==0?h:Kn(Xr(v.longitude),Xr(y.longitude))})(c.geoPointValue,e.geoPointValue);case 9:return Hx(c.arrayValue,e.arrayValue);case 10:return(function(v,y){const h=v.fields||{},M=y.fields||{},O=h[Vy]?.arrayValue,V=M[Vy]?.arrayValue,K=Kn(O?.values?.length||0,V?.values?.length||0);return K!==0?K:Hx(O,V)})(c.mapValue,e.mapValue);case 11:return(function(v,y){if(v===hy.mapValue&&y===hy.mapValue)return 0;if(v===hy.mapValue)return 1;if(y===hy.mapValue)return-1;const h=v.fields||{},M=Object.keys(h),O=y.fields||{},V=Object.keys(O);M.sort(),V.sort();for(let K=0;K<M.length&&K<V.length;++K){const ee=x0(M[K],V[K]);if(ee!==0)return ee;const Y=em(h[M[K]],O[V[K]]);if(Y!==0)return Y}return Kn(M.length,V.length)})(c.mapValue,e.mapValue);default:throw Sn(23264,{he:i})}}function Gx(c,e){if(typeof c=="string"&&typeof e=="string"&&c.length===e.length)return Kn(c,e);const i=bd(c),l=bd(e),f=Kn(i.seconds,l.seconds);return f!==0?f:Kn(i.nanos,l.nanos)}function Hx(c,e){const i=c.values||[],l=e.values||[];for(let f=0;f<i.length&&f<l.length;++f){const v=em(i[f],l[f]);if(v)return v}return Kn(i.length,l.length)}function tm(c){return w0(c)}function w0(c){return"nullValue"in c?"null":"booleanValue"in c?""+c.booleanValue:"integerValue"in c?""+c.integerValue:"doubleValue"in c?""+c.doubleValue:"timestampValue"in c?(function(i){const l=bd(i);return`time(${l.seconds},${l.nanos})`})(c.timestampValue):"stringValue"in c?c.stringValue:"bytesValue"in c?(function(i){return xd(i).toBase64()})(c.bytesValue):"referenceValue"in c?(function(i){return fn.fromName(i).toString()})(c.referenceValue):"geoPointValue"in c?(function(i){return`geo(${i.latitude},${i.longitude})`})(c.geoPointValue):"arrayValue"in c?(function(i){let l="[",f=!0;for(const v of i.values||[])f?f=!1:l+=",",l+=w0(v);return l+"]"})(c.arrayValue):"mapValue"in c?(function(i){const l=Object.keys(i.fields||{}).sort();let f="{",v=!0;for(const y of l)v?v=!1:f+=",",f+=`${y}:${w0(i.fields[y])}`;return f+"}"})(c.mapValue):Sn(61005,{value:c})}function Sy(c){switch(wd(c)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=cv(c);return e?16+Sy(e):16;case 5:return 2*c.stringValue.length;case 6:return xd(c.bytesValue).approximateByteSize();case 7:return c.referenceValue.length;case 9:return(function(l){return(l.values||[]).reduce(((f,v)=>f+Sy(v)),0)})(c.arrayValue);case 10:case 11:return(function(l){let f=0;return Ed(l.fields,((v,y)=>{f+=v.length+Sy(y)})),f})(c.mapValue);default:throw Sn(13486,{value:c})}}function T0(c){return!!c&&"integerValue"in c}function fb(c){return!!c&&"arrayValue"in c}function Zx(c){return!!c&&"nullValue"in c}function Wx(c){return!!c&&"doubleValue"in c&&isNaN(Number(c.doubleValue))}function Ey(c){return!!c&&"mapValue"in c}function GP(c){return(c?.mapValue?.fields||{})[TT]?.stringValue===ST}function Pg(c){if(c.geoPointValue)return{geoPointValue:{...c.geoPointValue}};if(c.timestampValue&&typeof c.timestampValue=="object")return{timestampValue:{...c.timestampValue}};if(c.mapValue){const e={mapValue:{fields:{}}};return Ed(c.mapValue.fields,((i,l)=>e.mapValue.fields[i]=Pg(l))),e}if(c.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(c.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=Pg(c.arrayValue.values[i]);return e}return{...c}}function HP(c){return(((c.mapValue||{}).fields||{}).__type__||{}).stringValue===qP}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e){this.value=e}static empty(){return new No({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let l=0;l<e.length-1;++l)if(i=(i.mapValue.fields||{})[e.get(l)],!Ey(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=Pg(i)}setAll(e){let i=ya.emptyPath(),l={},f=[];e.forEach(((y,h)=>{if(!i.isImmediateParentOf(h)){const M=this.getFieldsMap(i);this.applyChanges(M,l,f),l={},f=[],i=h.popLast()}y?l[h.lastSegment()]=Pg(y):f.push(h.lastSegment())}));const v=this.getFieldsMap(i);this.applyChanges(v,l,f)}delete(e){const i=this.field(e.popLast());Ey(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return vu(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let l=0;l<e.length;++l){let f=i.mapValue.fields[e.get(l)];Ey(f)&&f.mapValue.fields||(f={mapValue:{fields:{}}},i.mapValue.fields[e.get(l)]=f),i=f}return i.mapValue.fields}applyChanges(e,i,l){Ed(i,((f,v)=>e[f]=v));for(const f of l)delete e[f]}clone(){return new No(Pg(this.value))}}function ET(c){const e=[];return Ed(c.fields,((i,l)=>{const f=new ya([i]);if(Ey(l)){const v=ET(l.mapValue).fields;if(v.length===0)e.push(f);else for(const y of v)e.push(f.child(y))}else e.push(f)})),new hl(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class za{constructor(e,i,l,f,v,y,h){this.key=e,this.documentType=i,this.version=l,this.readTime=f,this.createTime=v,this.data=y,this.documentState=h}static newInvalidDocument(e){return new za(e,0,Rn.min(),Rn.min(),Rn.min(),No.empty(),0)}static newFoundDocument(e,i,l,f){return new za(e,1,i,Rn.min(),l,f,0)}static newNoDocument(e,i){return new za(e,2,i,Rn.min(),Rn.min(),No.empty(),0)}static newUnknownDocument(e,i){return new za(e,3,i,Rn.min(),Rn.min(),No.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(Rn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=No.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=No.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Rn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof za&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new za(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jy{constructor(e,i){this.position=e,this.inclusive=i}}function Kx(c,e,i){let l=0;for(let f=0;f<c.position.length;f++){const v=e[f],y=c.position[f];if(v.field.isKeyField()?l=fn.comparator(fn.fromName(y.referenceValue),i.key):l=em(y,i.data.field(v.field)),v.dir==="desc"&&(l*=-1),l!==0)break}return l}function Xx(c,e){if(c===null)return e===null;if(e===null||c.inclusive!==e.inclusive||c.position.length!==e.position.length)return!1;for(let i=0;i<c.position.length;i++)if(!vu(c.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(e,i="asc"){this.field=e,this.dir=i}}function ZP(c,e){return c.dir===e.dir&&c.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AT{}class Os extends AT{constructor(e,i,l){super(),this.field=e,this.op=i,this.value=l}static create(e,i,l){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,l):new KP(e,i,l):i==="array-contains"?new QP(e,l):i==="in"?new JP(e,l):i==="not-in"?new eR(e,l):i==="array-contains-any"?new tR(e,l):new Os(e,i,l)}static createKeyFieldInFilter(e,i,l){return i==="in"?new XP(e,l):new YP(e,l)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&i.nullValue===void 0&&this.matchesComparison(em(i,this.value)):i!==null&&wd(this.value)===wd(i)&&this.matchesComparison(em(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Sn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class bu extends AT{constructor(e,i){super(),this.filters=e,this.op=i,this.Pe=null}static create(e,i){return new bu(e,i)}matches(e){return IT(this)?this.filters.find((i=>!i.matches(e)))===void 0:this.filters.find((i=>i.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,i)=>e.concat(i.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function IT(c){return c.op==="and"}function CT(c){return WP(c)&&IT(c)}function WP(c){for(const e of c.filters)if(e instanceof bu)return!1;return!0}function S0(c){if(c instanceof Os)return c.field.canonicalString()+c.op.toString()+tm(c.value);if(CT(c))return c.filters.map((e=>S0(e))).join(",");{const e=c.filters.map((i=>S0(i))).join(",");return`${c.op}(${e})`}}function PT(c,e){return c instanceof Os?(function(l,f){return f instanceof Os&&l.op===f.op&&l.field.isEqual(f.field)&&vu(l.value,f.value)})(c,e):c instanceof bu?(function(l,f){return f instanceof bu&&l.op===f.op&&l.filters.length===f.filters.length?l.filters.reduce(((v,y,h)=>v&&PT(y,f.filters[h])),!0):!1})(c,e):void Sn(19439)}function RT(c){return c instanceof Os?(function(i){return`${i.field.canonicalString()} ${i.op} ${tm(i.value)}`})(c):c instanceof bu?(function(i){return i.op.toString()+" {"+i.getFilters().map(RT).join(" ,")+"}"})(c):"Filter"}class KP extends Os{constructor(e,i,l){super(e,i,l),this.key=fn.fromName(l.referenceValue)}matches(e){const i=fn.comparator(e.key,this.key);return this.matchesComparison(i)}}class XP extends Os{constructor(e,i){super(e,"in",i),this.keys=MT("in",i)}matches(e){return this.keys.some((i=>i.isEqual(e.key)))}}class YP extends Os{constructor(e,i){super(e,"not-in",i),this.keys=MT("not-in",i)}matches(e){return!this.keys.some((i=>i.isEqual(e.key)))}}function MT(c,e){return(e.arrayValue?.values||[]).map((i=>fn.fromName(i.referenceValue)))}class QP extends Os{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return fb(i)&&$g(i.arrayValue,this.value)}}class JP extends Os{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&$g(this.value.arrayValue,i)}}class eR extends Os{constructor(e,i){super(e,"not-in",i)}matches(e){if($g(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&i.nullValue===void 0&&!$g(this.value.arrayValue,i)}}class tR extends Os{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!fb(i)||!i.arrayValue.values)&&i.arrayValue.values.some((l=>$g(this.value.arrayValue,l)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{constructor(e,i=null,l=[],f=[],v=null,y=null,h=null){this.path=e,this.collectionGroup=i,this.orderBy=l,this.filters=f,this.limit=v,this.startAt=y,this.endAt=h,this.Te=null}}function Yx(c,e=null,i=[],l=[],f=null,v=null,y=null){return new nR(c,e,i,l,f,v,y)}function pb(c){const e=Dn(c);if(e.Te===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map((l=>S0(l))).join(","),i+="|ob:",i+=e.orderBy.map((l=>(function(v){return v.field.canonicalString()+v.dir})(l))).join(","),lv(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map((l=>tm(l))).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map((l=>tm(l))).join(",")),e.Te=i}return e.Te}function mb(c,e){if(c.limit!==e.limit||c.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<c.orderBy.length;i++)if(!ZP(c.orderBy[i],e.orderBy[i]))return!1;if(c.filters.length!==e.filters.length)return!1;for(let i=0;i<c.filters.length;i++)if(!PT(c.filters[i],e.filters[i]))return!1;return c.collectionGroup===e.collectionGroup&&!!c.path.isEqual(e.path)&&!!Xx(c.startAt,e.startAt)&&Xx(c.endAt,e.endAt)}function E0(c){return fn.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(e,i=null,l=[],f=[],v=null,y="F",h=null,M=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=l,this.filters=f,this.limit=v,this.limitType=y,this.startAt=h,this.endAt=M,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function iR(c,e,i,l,f,v,y,h){return new uv(c,e,i,l,f,v,y,h)}function gb(c){return new uv(c)}function Qx(c){return c.filters.length===0&&c.limit===null&&c.startAt==null&&c.endAt==null&&(c.explicitOrderBy.length===0||c.explicitOrderBy.length===1&&c.explicitOrderBy[0].field.isKeyField())}function rR(c){return c.collectionGroup!==null}function Rg(c){const e=Dn(c);if(e.Ie===null){e.Ie=[];const i=new Set;for(const v of e.explicitOrderBy)e.Ie.push(v),i.add(v.field.canonicalString());const l=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(y){let h=new zs(ya.comparator);return y.filters.forEach((M=>{M.getFlattenedFilters().forEach((O=>{O.isInequality()&&(h=h.add(O.field))}))})),h})(e).forEach((v=>{i.has(v.canonicalString())||v.isKeyField()||e.Ie.push(new Uy(v,l))})),i.has(ya.keyField().canonicalString())||e.Ie.push(new Uy(ya.keyField(),l))}return e.Ie}function fu(c){const e=Dn(c);return e.Ee||(e.Ee=sR(e,Rg(c))),e.Ee}function sR(c,e){if(c.limitType==="F")return Yx(c.path,c.collectionGroup,e,c.filters,c.limit,c.startAt,c.endAt);{e=e.map((f=>{const v=f.dir==="desc"?"asc":"desc";return new Uy(f.field,v)}));const i=c.endAt?new jy(c.endAt.position,c.endAt.inclusive):null,l=c.startAt?new jy(c.startAt.position,c.startAt.inclusive):null;return Yx(c.path,c.collectionGroup,e,c.filters,c.limit,i,l)}}function A0(c,e,i){return new uv(c.path,c.collectionGroup,c.explicitOrderBy.slice(),c.filters.slice(),e,i,c.startAt,c.endAt)}function hv(c,e){return mb(fu(c),fu(e))&&c.limitType===e.limitType}function kT(c){return`${pb(fu(c))}|lt:${c.limitType}`}function Vp(c){return`Query(target=${(function(i){let l=i.path.canonicalString();return i.collectionGroup!==null&&(l+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(l+=`, filters: [${i.filters.map((f=>RT(f))).join(", ")}]`),lv(i.limit)||(l+=", limit: "+i.limit),i.orderBy.length>0&&(l+=`, orderBy: [${i.orderBy.map((f=>(function(y){return`${y.field.canonicalString()} (${y.dir})`})(f))).join(", ")}]`),i.startAt&&(l+=", startAt: ",l+=i.startAt.inclusive?"b:":"a:",l+=i.startAt.position.map((f=>tm(f))).join(",")),i.endAt&&(l+=", endAt: ",l+=i.endAt.inclusive?"a:":"b:",l+=i.endAt.position.map((f=>tm(f))).join(",")),`Target(${l})`})(fu(c))}; limitType=${c.limitType})`}function dv(c,e){return e.isFoundDocument()&&(function(l,f){const v=f.key.path;return l.collectionGroup!==null?f.key.hasCollectionId(l.collectionGroup)&&l.path.isPrefixOf(v):fn.isDocumentKey(l.path)?l.path.isEqual(v):l.path.isImmediateParentOf(v)})(c,e)&&(function(l,f){for(const v of Rg(l))if(!v.field.isKeyField()&&f.data.field(v.field)===null)return!1;return!0})(c,e)&&(function(l,f){for(const v of l.filters)if(!v.matches(f))return!1;return!0})(c,e)&&(function(l,f){return!(l.startAt&&!(function(y,h,M){const O=Kx(y,h,M);return y.inclusive?O<=0:O<0})(l.startAt,Rg(l),f)||l.endAt&&!(function(y,h,M){const O=Kx(y,h,M);return y.inclusive?O>=0:O>0})(l.endAt,Rg(l),f))})(c,e)}function aR(c){return c.collectionGroup||(c.path.length%2==1?c.path.lastSegment():c.path.get(c.path.length-2))}function DT(c){return(e,i)=>{let l=!1;for(const f of Rg(c)){const v=oR(f,e,i);if(v!==0)return v;l=l||f.field.isKeyField()}return 0}}function oR(c,e,i){const l=c.field.isKeyField()?fn.comparator(e.key,i.key):(function(v,y,h){const M=y.data.field(v),O=h.data.field(v);return M!==null&&O!==null?em(M,O):Sn(42886)})(c.field,e,i);switch(c.dir){case"asc":return l;case"desc":return-1*l;default:return Sn(19790,{direction:c.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),l=this.inner[i];if(l!==void 0){for(const[f,v]of l)if(this.equalsFn(f,e))return v}}has(e){return this.get(e)!==void 0}set(e,i){const l=this.mapKeyFn(e),f=this.inner[l];if(f===void 0)return this.inner[l]=[[e,i]],void this.innerSize++;for(let v=0;v<f.length;v++)if(this.equalsFn(f[v][0],e))return void(f[v]=[e,i]);f.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),l=this.inner[i];if(l===void 0)return!1;for(let f=0;f<l.length;f++)if(this.equalsFn(l[f][0],e))return l.length===1?delete this.inner[i]:l.splice(f,1),this.innerSize--,!0;return!1}forEach(e){Ed(this.inner,((i,l)=>{for(const[f,v]of l)e(f,v)}))}isEmpty(){return _T(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lR=new Or(fn.comparator);function hh(){return lR}const OT=new Or(fn.comparator);function Sg(...c){let e=OT;for(const i of c)e=e.insert(i.key,i);return e}function zT(c){let e=OT;return c.forEach(((i,l)=>e=e.insert(i,l.overlayedDocument))),e}function Mf(){return Mg()}function LT(){return Mg()}function Mg(){return new qf((c=>c.toString()),((c,e)=>c.isEqual(e)))}const cR=new Or(fn.comparator),uR=new zs(fn.comparator);function Xn(...c){let e=uR;for(const i of c)e=e.add(i);return e}const hR=new zs(Kn);function dR(){return hR}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _b(c,e){if(c.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ny(e)?"-0":e}}function NT(c){return{integerValue:""+c}}function fR(c,e){return VP(e)?NT(e):_b(c,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(){this._=void 0}}function pR(c,e,i){return c instanceof qg?(function(f,v){const y={fields:{[bT]:{stringValue:vT},[wT]:{timestampValue:{seconds:f.seconds,nanos:f.nanoseconds}}}};return v&&db(v)&&(v=cv(v)),v&&(y.fields[xT]=v),{mapValue:y}})(i,e):c instanceof Gg?VT(c,e):c instanceof Hg?jT(c,e):(function(f,v){const y=BT(f,v),h=Jx(y)+Jx(f.Ae);return T0(y)&&T0(f.Ae)?NT(h):_b(f.serializer,h)})(c,e)}function mR(c,e,i){return c instanceof Gg?VT(c,e):c instanceof Hg?jT(c,e):i}function BT(c,e){return c instanceof Fy?(function(l){return T0(l)||(function(v){return!!v&&"doubleValue"in v})(l)})(e)?e:{integerValue:0}:null}class qg extends fv{}class Gg extends fv{constructor(e){super(),this.elements=e}}function VT(c,e){const i=UT(e);for(const l of c.elements)i.some((f=>vu(f,l)))||i.push(l);return{arrayValue:{values:i}}}class Hg extends fv{constructor(e){super(),this.elements=e}}function jT(c,e){let i=UT(e);for(const l of c.elements)i=i.filter((f=>!vu(f,l)));return{arrayValue:{values:i}}}class Fy extends fv{constructor(e,i){super(),this.serializer=e,this.Ae=i}}function Jx(c){return Xr(c.integerValue||c.doubleValue)}function UT(c){return fb(c)&&c.arrayValue.values?c.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,i){this.field=e,this.transform=i}}function _R(c,e){return c.field.isEqual(e.field)&&(function(l,f){return l instanceof Gg&&f instanceof Gg||l instanceof Hg&&f instanceof Hg?Jp(l.elements,f.elements,vu):l instanceof Fy&&f instanceof Fy?vu(l.Ae,f.Ae):l instanceof qg&&f instanceof qg})(c.transform,e.transform)}class yR{constructor(e,i){this.version=e,this.transformResults=i}}class dl{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new dl}static exists(e){return new dl(void 0,e)}static updateTime(e){return new dl(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ay(c,e){return c.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(c.updateTime):c.exists===void 0||c.exists===e.isFoundDocument()}class pv{}function FT(c,e){if(!c.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return c.isNoDocument()?new yb(c.key,dl.none()):new n_(c.key,c.data,dl.none());{const i=c.data,l=No.empty();let f=new zs(ya.comparator);for(let v of e.fields)if(!f.has(v)){let y=i.field(v);y===null&&v.length>1&&(v=v.popLast(),y=i.field(v)),y===null?l.delete(v):l.set(v,y),f=f.add(v)}return new Ad(c.key,l,new hl(f.toArray()),dl.none())}}function vR(c,e,i){c instanceof n_?(function(f,v,y){const h=f.value.clone(),M=tw(f.fieldTransforms,v,y.transformResults);h.setAll(M),v.convertToFoundDocument(y.version,h).setHasCommittedMutations()})(c,e,i):c instanceof Ad?(function(f,v,y){if(!Ay(f.precondition,v))return void v.convertToUnknownDocument(y.version);const h=tw(f.fieldTransforms,v,y.transformResults),M=v.data;M.setAll($T(f)),M.setAll(h),v.convertToFoundDocument(y.version,M).setHasCommittedMutations()})(c,e,i):(function(f,v,y){v.convertToNoDocument(y.version).setHasCommittedMutations()})(0,e,i)}function kg(c,e,i,l){return c instanceof n_?(function(v,y,h,M){if(!Ay(v.precondition,y))return h;const O=v.value.clone(),V=nw(v.fieldTransforms,M,y);return O.setAll(V),y.convertToFoundDocument(y.version,O).setHasLocalMutations(),null})(c,e,i,l):c instanceof Ad?(function(v,y,h,M){if(!Ay(v.precondition,y))return h;const O=nw(v.fieldTransforms,M,y),V=y.data;return V.setAll($T(v)),V.setAll(O),y.convertToFoundDocument(y.version,V).setHasLocalMutations(),h===null?null:h.unionWith(v.fieldMask.fields).unionWith(v.fieldTransforms.map((K=>K.field)))})(c,e,i,l):(function(v,y,h){return Ay(v.precondition,y)?(y.convertToNoDocument(y.version).setHasLocalMutations(),null):h})(c,e,i)}function bR(c,e){let i=null;for(const l of c.fieldTransforms){const f=e.data.field(l.field),v=BT(l.transform,f||null);v!=null&&(i===null&&(i=No.empty()),i.set(l.field,v))}return i||null}function ew(c,e){return c.type===e.type&&!!c.key.isEqual(e.key)&&!!c.precondition.isEqual(e.precondition)&&!!(function(l,f){return l===void 0&&f===void 0||!(!l||!f)&&Jp(l,f,((v,y)=>_R(v,y)))})(c.fieldTransforms,e.fieldTransforms)&&(c.type===0?c.value.isEqual(e.value):c.type!==1||c.data.isEqual(e.data)&&c.fieldMask.isEqual(e.fieldMask))}class n_ extends pv{constructor(e,i,l,f=[]){super(),this.key=e,this.value=i,this.precondition=l,this.fieldTransforms=f,this.type=0}getFieldMask(){return null}}class Ad extends pv{constructor(e,i,l,f,v=[]){super(),this.key=e,this.data=i,this.fieldMask=l,this.precondition=f,this.fieldTransforms=v,this.type=1}getFieldMask(){return this.fieldMask}}function $T(c){const e=new Map;return c.fieldMask.fields.forEach((i=>{if(!i.isEmpty()){const l=c.data.field(i);e.set(i,l)}})),e}function tw(c,e,i){const l=new Map;Li(c.length===i.length,32656,{Re:i.length,Ve:c.length});for(let f=0;f<i.length;f++){const v=c[f],y=v.transform,h=e.data.field(v.field);l.set(v.field,mR(y,h,i[f]))}return l}function nw(c,e,i){const l=new Map;for(const f of c){const v=f.transform,y=i.data.field(f.field);l.set(f.field,pR(v,y,e))}return l}class yb extends pv{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xR extends pv{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e,i,l,f){this.batchId=e,this.localWriteTime=i,this.baseMutations=l,this.mutations=f}applyToRemoteDocument(e,i){const l=i.mutationResults;for(let f=0;f<this.mutations.length;f++){const v=this.mutations[f];v.key.isEqual(e.key)&&vR(v,e,l[f])}}applyToLocalView(e,i){for(const l of this.baseMutations)l.key.isEqual(e.key)&&(i=kg(l,e,i,this.localWriteTime));for(const l of this.mutations)l.key.isEqual(e.key)&&(i=kg(l,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const l=LT();return this.mutations.forEach((f=>{const v=e.get(f.key),y=v.overlayedDocument;let h=this.applyToLocalView(y,v.mutatedFields);h=i.has(f.key)?null:h;const M=FT(y,h);M!==null&&l.set(f.key,M),y.isValidDocument()||y.convertToNoDocument(Rn.min())})),l}keys(){return this.mutations.reduce(((e,i)=>e.add(i.key)),Xn())}isEqual(e){return this.batchId===e.batchId&&Jp(this.mutations,e.mutations,((i,l)=>ew(i,l)))&&Jp(this.baseMutations,e.baseMutations,((i,l)=>ew(i,l)))}}class vb{constructor(e,i,l,f){this.batch=e,this.commitVersion=i,this.mutationResults=l,this.docVersions=f}static from(e,i,l){Li(e.mutations.length===l.length,58842,{me:e.mutations.length,fe:l.length});let f=(function(){return cR})();const v=e.mutations;for(let y=0;y<v.length;y++)f=f.insert(v[y].key,l[y].version);return new vb(e,i,l,f)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var hs,ri;function ER(c){switch(c){case vt.OK:return Sn(64938);case vt.CANCELLED:case vt.UNKNOWN:case vt.DEADLINE_EXCEEDED:case vt.RESOURCE_EXHAUSTED:case vt.INTERNAL:case vt.UNAVAILABLE:case vt.UNAUTHENTICATED:return!1;case vt.INVALID_ARGUMENT:case vt.NOT_FOUND:case vt.ALREADY_EXISTS:case vt.PERMISSION_DENIED:case vt.FAILED_PRECONDITION:case vt.ABORTED:case vt.OUT_OF_RANGE:case vt.UNIMPLEMENTED:case vt.DATA_LOSS:return!0;default:return Sn(15467,{code:c})}}function qT(c){if(c===void 0)return uh("GRPC error has no .code"),vt.UNKNOWN;switch(c){case hs.OK:return vt.OK;case hs.CANCELLED:return vt.CANCELLED;case hs.UNKNOWN:return vt.UNKNOWN;case hs.DEADLINE_EXCEEDED:return vt.DEADLINE_EXCEEDED;case hs.RESOURCE_EXHAUSTED:return vt.RESOURCE_EXHAUSTED;case hs.INTERNAL:return vt.INTERNAL;case hs.UNAVAILABLE:return vt.UNAVAILABLE;case hs.UNAUTHENTICATED:return vt.UNAUTHENTICATED;case hs.INVALID_ARGUMENT:return vt.INVALID_ARGUMENT;case hs.NOT_FOUND:return vt.NOT_FOUND;case hs.ALREADY_EXISTS:return vt.ALREADY_EXISTS;case hs.PERMISSION_DENIED:return vt.PERMISSION_DENIED;case hs.FAILED_PRECONDITION:return vt.FAILED_PRECONDITION;case hs.ABORTED:return vt.ABORTED;case hs.OUT_OF_RANGE:return vt.OUT_OF_RANGE;case hs.UNIMPLEMENTED:return vt.UNIMPLEMENTED;case hs.DATA_LOSS:return vt.DATA_LOSS;default:return Sn(39323,{code:c})}}(ri=hs||(hs={}))[ri.OK=0]="OK",ri[ri.CANCELLED=1]="CANCELLED",ri[ri.UNKNOWN=2]="UNKNOWN",ri[ri.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ri[ri.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ri[ri.NOT_FOUND=5]="NOT_FOUND",ri[ri.ALREADY_EXISTS=6]="ALREADY_EXISTS",ri[ri.PERMISSION_DENIED=7]="PERMISSION_DENIED",ri[ri.UNAUTHENTICATED=16]="UNAUTHENTICATED",ri[ri.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ri[ri.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ri[ri.ABORTED=10]="ABORTED",ri[ri.OUT_OF_RANGE=11]="OUT_OF_RANGE",ri[ri.UNIMPLEMENTED=12]="UNIMPLEMENTED",ri[ri.INTERNAL=13]="INTERNAL",ri[ri.UNAVAILABLE=14]="UNAVAILABLE",ri[ri.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AR(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IR=new gd([4294967295,4294967295],0);function iw(c){const e=AR().encode(c),i=new aT;return i.update(e),new Uint8Array(i.digest())}function rw(c){const e=new DataView(c.buffer),i=e.getUint32(0,!0),l=e.getUint32(4,!0),f=e.getUint32(8,!0),v=e.getUint32(12,!0);return[new gd([i,l],0),new gd([f,v],0)]}class bb{constructor(e,i,l){if(this.bitmap=e,this.padding=i,this.hashCount=l,i<0||i>=8)throw new Eg(`Invalid padding: ${i}`);if(l<0)throw new Eg(`Invalid hash count: ${l}`);if(e.length>0&&this.hashCount===0)throw new Eg(`Invalid hash count: ${l}`);if(e.length===0&&i!==0)throw new Eg(`Invalid padding when bitmap length is 0: ${i}`);this.ge=8*e.length-i,this.pe=gd.fromNumber(this.ge)}ye(e,i,l){let f=e.add(i.multiply(gd.fromNumber(l)));return f.compare(IR)===1&&(f=new gd([f.getBits(0),f.getBits(1)],0)),f.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const i=iw(e),[l,f]=rw(i);for(let v=0;v<this.hashCount;v++){const y=this.ye(l,f,v);if(!this.we(y))return!1}return!0}static create(e,i,l){const f=e%8==0?0:8-e%8,v=new Uint8Array(Math.ceil(e/8)),y=new bb(v,f,i);return l.forEach((h=>y.insert(h))),y}insert(e){if(this.ge===0)return;const i=iw(e),[l,f]=rw(i);for(let v=0;v<this.hashCount;v++){const y=this.ye(l,f,v);this.Se(y)}}Se(e){const i=Math.floor(e/8),l=e%8;this.bitmap[i]|=1<<l}}class Eg extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(e,i,l,f,v){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=l,this.documentUpdates=f,this.resolvedLimboDocuments=v}static createSynthesizedRemoteEventForCurrentChange(e,i,l){const f=new Map;return f.set(e,i_.createSynthesizedTargetChangeForCurrentChange(e,i,l)),new mv(Rn.min(),f,new Or(Kn),hh(),Xn())}}class i_{constructor(e,i,l,f,v){this.resumeToken=e,this.current=i,this.addedDocuments=l,this.modifiedDocuments=f,this.removedDocuments=v}static createSynthesizedTargetChangeForCurrentChange(e,i,l){return new i_(l,i,Xn(),Xn(),Xn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(e,i,l,f){this.be=e,this.removedTargetIds=i,this.key=l,this.De=f}}class GT{constructor(e,i){this.targetId=e,this.Ce=i}}class HT{constructor(e,i,l=ba.EMPTY_BYTE_STRING,f=null){this.state=e,this.targetIds=i,this.resumeToken=l,this.cause=f}}class sw{constructor(){this.ve=0,this.Fe=aw(),this.Me=ba.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Xn(),i=Xn(),l=Xn();return this.Fe.forEach(((f,v)=>{switch(v){case 0:e=e.add(f);break;case 2:i=i.add(f);break;case 1:l=l.add(f);break;default:Sn(38017,{changeType:v})}})),new i_(this.Me,this.xe,e,i,l)}qe(){this.Oe=!1,this.Fe=aw()}Qe(e,i){this.Oe=!0,this.Fe=this.Fe.insert(e,i)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Li(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class CR{constructor(e){this.Ge=e,this.ze=new Map,this.je=hh(),this.Je=dy(),this.He=dy(),this.Ye=new Or(Kn)}Ze(e){for(const i of e.be)e.De&&e.De.isFoundDocument()?this.Xe(i,e.De):this.et(i,e.key,e.De);for(const i of e.removedTargetIds)this.et(i,e.key,e.De)}tt(e){this.forEachTarget(e,(i=>{const l=this.nt(i);switch(e.state){case 0:this.rt(i)&&l.Le(e.resumeToken);break;case 1:l.Ke(),l.Ne||l.qe(),l.Le(e.resumeToken);break;case 2:l.Ke(),l.Ne||this.removeTarget(i);break;case 3:this.rt(i)&&(l.We(),l.Le(e.resumeToken));break;case 4:this.rt(i)&&(this.it(i),l.Le(e.resumeToken));break;default:Sn(56790,{state:e.state})}}))}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.ze.forEach(((l,f)=>{this.rt(f)&&i(f)}))}st(e){const i=e.targetId,l=e.Ce.count,f=this.ot(i);if(f){const v=f.target;if(E0(v))if(l===0){const y=new fn(v.path);this.et(i,y,za.newNoDocument(y,Rn.min()))}else Li(l===1,20013,{expectedCount:l});else{const y=this._t(i);if(y!==l){const h=this.ut(e),M=h?this.ct(h,e,y):1;if(M!==0){this.it(i);const O=M===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(i,O)}}}}}ut(e){const i=e.Ce.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:l="",padding:f=0},hashCount:v=0}=i;let y,h;try{y=xd(l).toUint8Array()}catch(M){if(M instanceof yT)return Qp("Decoding the base64 bloom filter in existence filter failed ("+M.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw M}try{h=new bb(y,f,v)}catch(M){return Qp(M instanceof Eg?"BloomFilter error: ":"Applying bloom filter failed: ",M),null}return h.ge===0?null:h}ct(e,i,l){return i.Ce.count===l-this.Pt(e,i.targetId)?0:2}Pt(e,i){const l=this.Ge.getRemoteKeysForTarget(i);let f=0;return l.forEach((v=>{const y=this.Ge.ht(),h=`projects/${y.projectId}/databases/${y.database}/documents/${v.path.canonicalString()}`;e.mightContain(h)||(this.et(i,v,null),f++)})),f}Tt(e){const i=new Map;this.ze.forEach(((v,y)=>{const h=this.ot(y);if(h){if(v.current&&E0(h.target)){const M=new fn(h.target.path);this.It(M).has(y)||this.Et(y,M)||this.et(y,M,za.newNoDocument(M,e))}v.Be&&(i.set(y,v.ke()),v.qe())}}));let l=Xn();this.He.forEach(((v,y)=>{let h=!0;y.forEachWhile((M=>{const O=this.ot(M);return!O||O.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(l=l.add(v))})),this.je.forEach(((v,y)=>y.setReadTime(e)));const f=new mv(e,i,this.Ye,this.je,l);return this.je=hh(),this.Je=dy(),this.He=dy(),this.Ye=new Or(Kn),f}Xe(e,i){if(!this.rt(e))return;const l=this.Et(e,i.key)?2:0;this.nt(e).Qe(i.key,l),this.je=this.je.insert(i.key,i),this.Je=this.Je.insert(i.key,this.It(i.key).add(e)),this.He=this.He.insert(i.key,this.dt(i.key).add(e))}et(e,i,l){if(!this.rt(e))return;const f=this.nt(e);this.Et(e,i)?f.Qe(i,1):f.$e(i),this.He=this.He.insert(i,this.dt(i).delete(e)),this.He=this.He.insert(i,this.dt(i).add(e)),l&&(this.je=this.je.insert(i,l))}removeTarget(e){this.ze.delete(e)}_t(e){const i=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let i=this.ze.get(e);return i||(i=new sw,this.ze.set(e,i)),i}dt(e){let i=this.He.get(e);return i||(i=new zs(Kn),this.He=this.He.insert(e,i)),i}It(e){let i=this.Je.get(e);return i||(i=new zs(Kn),this.Je=this.Je.insert(e,i)),i}rt(e){const i=this.ot(e)!==null;return i||$t("WatchChangeAggregator","Detected inactive target",e),i}ot(e){const i=this.ze.get(e);return i&&i.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new sw),this.Ge.getRemoteKeysForTarget(e).forEach((i=>{this.et(e,i,null)}))}Et(e,i){return this.Ge.getRemoteKeysForTarget(e).has(i)}}function dy(){return new Or(fn.comparator)}function aw(){return new Or(fn.comparator)}const PR={asc:"ASCENDING",desc:"DESCENDING"},RR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},MR={and:"AND",or:"OR"};class kR{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function I0(c,e){return c.useProto3Json||lv(e)?e:{value:e}}function $y(c,e){return c.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ZT(c,e){return c.useProto3Json?e.toBase64():e.toUint8Array()}function DR(c,e){return $y(c,e.toTimestamp())}function pu(c){return Li(!!c,49232),Rn.fromTimestamp((function(i){const l=bd(i);return new vr(l.seconds,l.nanos)})(c))}function xb(c,e){return C0(c,e).canonicalString()}function C0(c,e){const i=(function(f){return new yr(["projects",f.projectId,"databases",f.database])})(c).child("documents");return e===void 0?i:i.child(e)}function WT(c){const e=yr.fromString(c);return Li(JT(e),10190,{key:e.toString()}),e}function P0(c,e){return xb(c.databaseId,e.path)}function Yv(c,e){const i=WT(e);if(i.get(1)!==c.databaseId.projectId)throw new Jt(vt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+c.databaseId.projectId);if(i.get(3)!==c.databaseId.database)throw new Jt(vt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+c.databaseId.database);return new fn(XT(i))}function KT(c,e){return xb(c.databaseId,e)}function OR(c){const e=WT(c);return e.length===4?yr.emptyPath():XT(e)}function R0(c){return new yr(["projects",c.databaseId.projectId,"databases",c.databaseId.database]).canonicalString()}function XT(c){return Li(c.length>4&&c.get(4)==="documents",29091,{key:c.toString()}),c.popFirst(5)}function ow(c,e,i){return{name:P0(c,e),fields:i.value.mapValue.fields}}function zR(c,e){let i;if("targetChange"in e){e.targetChange;const l=(function(O){return O==="NO_CHANGE"?0:O==="ADD"?1:O==="REMOVE"?2:O==="CURRENT"?3:O==="RESET"?4:Sn(39313,{state:O})})(e.targetChange.targetChangeType||"NO_CHANGE"),f=e.targetChange.targetIds||[],v=(function(O,V){return O.useProto3Json?(Li(V===void 0||typeof V=="string",58123),ba.fromBase64String(V||"")):(Li(V===void 0||V instanceof Buffer||V instanceof Uint8Array,16193),ba.fromUint8Array(V||new Uint8Array))})(c,e.targetChange.resumeToken),y=e.targetChange.cause,h=y&&(function(O){const V=O.code===void 0?vt.UNKNOWN:qT(O.code);return new Jt(V,O.message||"")})(y);i=new HT(l,f,v,h||null)}else if("documentChange"in e){e.documentChange;const l=e.documentChange;l.document,l.document.name,l.document.updateTime;const f=Yv(c,l.document.name),v=pu(l.document.updateTime),y=l.document.createTime?pu(l.document.createTime):Rn.min(),h=new No({mapValue:{fields:l.document.fields}}),M=za.newFoundDocument(f,v,y,h),O=l.targetIds||[],V=l.removedTargetIds||[];i=new Iy(O,V,M.key,M)}else if("documentDelete"in e){e.documentDelete;const l=e.documentDelete;l.document;const f=Yv(c,l.document),v=l.readTime?pu(l.readTime):Rn.min(),y=za.newNoDocument(f,v),h=l.removedTargetIds||[];i=new Iy([],h,y.key,y)}else if("documentRemove"in e){e.documentRemove;const l=e.documentRemove;l.document;const f=Yv(c,l.document),v=l.removedTargetIds||[];i=new Iy([],v,f,null)}else{if(!("filter"in e))return Sn(11601,{Rt:e});{e.filter;const l=e.filter;l.targetId;const{count:f=0,unchangedNames:v}=l,y=new SR(f,v),h=l.targetId;i=new GT(h,y)}}return i}function LR(c,e){let i;if(e instanceof n_)i={update:ow(c,e.key,e.value)};else if(e instanceof yb)i={delete:P0(c,e.key)};else if(e instanceof Ad)i={update:ow(c,e.key,e.data),updateMask:GR(e.fieldMask)};else{if(!(e instanceof xR))return Sn(16599,{Vt:e.type});i={verify:P0(c,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map((l=>(function(v,y){const h=y.transform;if(h instanceof qg)return{fieldPath:y.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof Gg)return{fieldPath:y.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof Hg)return{fieldPath:y.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof Fy)return{fieldPath:y.field.canonicalString(),increment:h.Ae};throw Sn(20930,{transform:y.transform})})(0,l)))),e.precondition.isNone||(i.currentDocument=(function(f,v){return v.updateTime!==void 0?{updateTime:DR(f,v.updateTime)}:v.exists!==void 0?{exists:v.exists}:Sn(27497)})(c,e.precondition)),i}function NR(c,e){return c&&c.length>0?(Li(e!==void 0,14353),c.map((i=>(function(f,v){let y=f.updateTime?pu(f.updateTime):pu(v);return y.isEqual(Rn.min())&&(y=pu(v)),new yR(y,f.transformResults||[])})(i,e)))):[]}function BR(c,e){return{documents:[KT(c,e.path)]}}function VR(c,e){const i={structuredQuery:{}},l=e.path;let f;e.collectionGroup!==null?(f=l,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(f=l.popLast(),i.structuredQuery.from=[{collectionId:l.lastSegment()}]),i.parent=KT(c,f);const v=(function(O){if(O.length!==0)return QT(bu.create(O,"and"))})(e.filters);v&&(i.structuredQuery.where=v);const y=(function(O){if(O.length!==0)return O.map((V=>(function(ee){return{field:jp(ee.field),direction:FR(ee.dir)}})(V)))})(e.orderBy);y&&(i.structuredQuery.orderBy=y);const h=I0(c,e.limit);return h!==null&&(i.structuredQuery.limit=h),e.startAt&&(i.structuredQuery.startAt=(function(O){return{before:O.inclusive,values:O.position}})(e.startAt)),e.endAt&&(i.structuredQuery.endAt=(function(O){return{before:!O.inclusive,values:O.position}})(e.endAt)),{ft:i,parent:f}}function jR(c){let e=OR(c.parent);const i=c.structuredQuery,l=i.from?i.from.length:0;let f=null;if(l>0){Li(l===1,65062);const V=i.from[0];V.allDescendants?f=V.collectionId:e=e.child(V.collectionId)}let v=[];i.where&&(v=(function(K){const ee=YT(K);return ee instanceof bu&&CT(ee)?ee.getFilters():[ee]})(i.where));let y=[];i.orderBy&&(y=(function(K){return K.map((ee=>(function(ve){return new Uy(Up(ve.field),(function(Ee){switch(Ee){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(ve.direction))})(ee)))})(i.orderBy));let h=null;i.limit&&(h=(function(K){let ee;return ee=typeof K=="object"?K.value:K,lv(ee)?null:ee})(i.limit));let M=null;i.startAt&&(M=(function(K){const ee=!!K.before,Y=K.values||[];return new jy(Y,ee)})(i.startAt));let O=null;return i.endAt&&(O=(function(K){const ee=!K.before,Y=K.values||[];return new jy(Y,ee)})(i.endAt)),iR(e,f,y,v,h,"F",M,O)}function UR(c,e){const i=(function(f){switch(f){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Sn(28987,{purpose:f})}})(e.purpose);return i==null?null:{"goog-listen-tags":i}}function YT(c){return c.unaryFilter!==void 0?(function(i){switch(i.unaryFilter.op){case"IS_NAN":const l=Up(i.unaryFilter.field);return Os.create(l,"==",{doubleValue:NaN});case"IS_NULL":const f=Up(i.unaryFilter.field);return Os.create(f,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const v=Up(i.unaryFilter.field);return Os.create(v,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const y=Up(i.unaryFilter.field);return Os.create(y,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Sn(61313);default:return Sn(60726)}})(c):c.fieldFilter!==void 0?(function(i){return Os.create(Up(i.fieldFilter.field),(function(f){switch(f){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Sn(58110);default:return Sn(50506)}})(i.fieldFilter.op),i.fieldFilter.value)})(c):c.compositeFilter!==void 0?(function(i){return bu.create(i.compositeFilter.filters.map((l=>YT(l))),(function(f){switch(f){case"AND":return"and";case"OR":return"or";default:return Sn(1026)}})(i.compositeFilter.op))})(c):Sn(30097,{filter:c})}function FR(c){return PR[c]}function $R(c){return RR[c]}function qR(c){return MR[c]}function jp(c){return{fieldPath:c.canonicalString()}}function Up(c){return ya.fromServerFormat(c.fieldPath)}function QT(c){return c instanceof Os?(function(i){if(i.op==="=="){if(Wx(i.value))return{unaryFilter:{field:jp(i.field),op:"IS_NAN"}};if(Zx(i.value))return{unaryFilter:{field:jp(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(Wx(i.value))return{unaryFilter:{field:jp(i.field),op:"IS_NOT_NAN"}};if(Zx(i.value))return{unaryFilter:{field:jp(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jp(i.field),op:$R(i.op),value:i.value}}})(c):c instanceof bu?(function(i){const l=i.getFilters().map((f=>QT(f)));return l.length===1?l[0]:{compositeFilter:{op:qR(i.op),filters:l}}})(c):Sn(54877,{filter:c})}function GR(c){const e=[];return c.fields.forEach((i=>e.push(i.canonicalString()))),{fieldPaths:e}}function JT(c){return c.length>=4&&c.get(0)==="projects"&&c.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(e,i,l,f,v=Rn.min(),y=Rn.min(),h=ba.EMPTY_BYTE_STRING,M=null){this.target=e,this.targetId=i,this.purpose=l,this.sequenceNumber=f,this.snapshotVersion=v,this.lastLimboFreeSnapshotVersion=y,this.resumeToken=h,this.expectedCount=M}withSequenceNumber(e){return new dd(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new dd(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new dd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new dd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR{constructor(e){this.yt=e}}function ZR(c){const e=jR({parent:c.parent,structuredQuery:c.structuredQuery});return c.limitType==="LAST"?A0(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{constructor(){this.Cn=new KR}addToCollectionParentIndex(e,i){return this.Cn.add(i),_t.resolve()}getCollectionParents(e,i){return _t.resolve(this.Cn.getEntries(i))}addFieldIndex(e,i){return _t.resolve()}deleteFieldIndex(e,i){return _t.resolve()}deleteAllFieldIndexes(e){return _t.resolve()}createTargetIndexes(e,i){return _t.resolve()}getDocumentsMatchingTarget(e,i){return _t.resolve(null)}getIndexType(e,i){return _t.resolve(0)}getFieldIndexes(e,i){return _t.resolve([])}getNextCollectionGroupToUpdate(e){return _t.resolve(null)}getMinOffset(e,i){return _t.resolve(vd.min())}getMinOffsetFromCollectionGroup(e,i){return _t.resolve(vd.min())}updateCollectionGroup(e,i,l){return _t.resolve()}updateIndexEntries(e,i){return _t.resolve()}}class KR{constructor(){this.index={}}add(e){const i=e.lastSegment(),l=e.popLast(),f=this.index[i]||new zs(yr.comparator),v=!f.has(l);return this.index[i]=f.add(l),v}has(e){const i=e.lastSegment(),l=e.popLast(),f=this.index[i];return f&&f.has(l)}getEntries(e){return(this.index[e]||new zs(yr.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},eS=41943040;class Lo{static withCacheSize(e){return new Lo(e,Lo.DEFAULT_COLLECTION_PERCENTILE,Lo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,l){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Lo.DEFAULT_COLLECTION_PERCENTILE=10,Lo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lo.DEFAULT=new Lo(eS,Lo.DEFAULT_COLLECTION_PERCENTILE,Lo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lo.DISABLED=new Lo(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new nm(0)}static cr(){return new nm(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cw="LruGarbageCollector",XR=1048576;function uw([c,e],[i,l]){const f=Kn(c,i);return f===0?Kn(e,l):f}class YR{constructor(e){this.Ir=e,this.buffer=new zs(uw),this.Er=0}dr(){return++this.Er}Ar(e){const i=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(i);else{const l=this.buffer.last();uw(i,l)<0&&(this.buffer=this.buffer.delete(l).add(i))}}get maxValue(){return this.buffer.last()[0]}}class QR{constructor(e,i,l){this.garbageCollector=e,this.asyncQueue=i,this.localStore=l,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){$t(cw,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){fm(i)?$t(cw,"Ignoring IndexedDB error during garbage collection: ",i):await dm(i)}await this.Vr(3e5)}))}}class JR{constructor(e,i){this.mr=e,this.params=i}calculateTargetCount(e,i){return this.mr.gr(e).next((l=>Math.floor(i/100*l)))}nthSequenceNumber(e,i){if(i===0)return _t.resolve(ov.ce);const l=new YR(i);return this.mr.forEachTarget(e,(f=>l.Ar(f.sequenceNumber))).next((()=>this.mr.pr(e,(f=>l.Ar(f))))).next((()=>l.maxValue))}removeTargets(e,i,l){return this.mr.removeTargets(e,i,l)}removeOrphanedDocuments(e,i){return this.mr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?($t("LruGarbageCollector","Garbage collection skipped; disabled"),_t.resolve(lw)):this.getCacheSize(e).next((l=>l<this.params.cacheSizeCollectionThreshold?($t("LruGarbageCollector",`Garbage collection skipped; Cache size ${l} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lw):this.yr(e,i)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,i){let l,f,v,y,h,M,O;const V=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((K=>(K>this.params.maximumSequenceNumbersToCollect?($t("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${K}`),f=this.params.maximumSequenceNumbersToCollect):f=K,y=Date.now(),this.nthSequenceNumber(e,f)))).next((K=>(l=K,h=Date.now(),this.removeTargets(e,l,i)))).next((K=>(v=K,M=Date.now(),this.removeOrphanedDocuments(e,l)))).next((K=>(O=Date.now(),Bp()<=Wn.DEBUG&&$t("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${y-V}ms
	Determined least recently used ${f} in `+(h-y)+`ms
	Removed ${v} targets in `+(M-h)+`ms
	Removed ${K} documents in `+(O-M)+`ms
Total Duration: ${O-V}ms`),_t.resolve({didRun:!0,sequenceNumbersCollected:f,targetsRemoved:v,documentsRemoved:K}))))}}function eM(c,e){return new JR(c,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tM{constructor(){this.changes=new qf((e=>e.toString()),((e,i)=>e.isEqual(i))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,za.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const l=this.changes.get(i);return l!==void 0?_t.resolve(l):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nM{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM{constructor(e,i,l,f){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=l,this.indexManager=f}getDocument(e,i){let l=null;return this.documentOverlayCache.getOverlay(e,i).next((f=>(l=f,this.remoteDocumentCache.getEntry(e,i)))).next((f=>(l!==null&&kg(l.mutation,f,hl.empty(),vr.now()),f)))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next((l=>this.getLocalViewOfDocuments(e,l,Xn()).next((()=>l))))}getLocalViewOfDocuments(e,i,l=Xn()){const f=Mf();return this.populateOverlays(e,f,i).next((()=>this.computeViews(e,i,f,l).next((v=>{let y=Sg();return v.forEach(((h,M)=>{y=y.insert(h,M.overlayedDocument)})),y}))))}getOverlayedDocuments(e,i){const l=Mf();return this.populateOverlays(e,l,i).next((()=>this.computeViews(e,i,l,Xn())))}populateOverlays(e,i,l){const f=[];return l.forEach((v=>{i.has(v)||f.push(v)})),this.documentOverlayCache.getOverlays(e,f).next((v=>{v.forEach(((y,h)=>{i.set(y,h)}))}))}computeViews(e,i,l,f){let v=hh();const y=Mg(),h=(function(){return Mg()})();return i.forEach(((M,O)=>{const V=l.get(O.key);f.has(O.key)&&(V===void 0||V.mutation instanceof Ad)?v=v.insert(O.key,O):V!==void 0?(y.set(O.key,V.mutation.getFieldMask()),kg(V.mutation,O,V.mutation.getFieldMask(),vr.now())):y.set(O.key,hl.empty())})),this.recalculateAndSaveOverlays(e,v).next((M=>(M.forEach(((O,V)=>y.set(O,V))),i.forEach(((O,V)=>h.set(O,new nM(V,y.get(O)??null)))),h)))}recalculateAndSaveOverlays(e,i){const l=Mg();let f=new Or(((y,h)=>y-h)),v=Xn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next((y=>{for(const h of y)h.keys().forEach((M=>{const O=i.get(M);if(O===null)return;let V=l.get(M)||hl.empty();V=h.applyToLocalView(O,V),l.set(M,V);const K=(f.get(h.batchId)||Xn()).add(M);f=f.insert(h.batchId,K)}))})).next((()=>{const y=[],h=f.getReverseIterator();for(;h.hasNext();){const M=h.getNext(),O=M.key,V=M.value,K=LT();V.forEach((ee=>{if(!v.has(ee)){const Y=FT(i.get(ee),l.get(ee));Y!==null&&K.set(ee,Y),v=v.add(ee)}})),y.push(this.documentOverlayCache.saveOverlays(e,O,K))}return _t.waitFor(y)})).next((()=>l))}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next((l=>this.recalculateAndSaveOverlays(e,l)))}getDocumentsMatchingQuery(e,i,l,f){return(function(y){return fn.isDocumentKey(y.path)&&y.collectionGroup===null&&y.filters.length===0})(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):rR(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,l,f):this.getDocumentsMatchingCollectionQuery(e,i,l,f)}getNextDocuments(e,i,l,f){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,l,f).next((v=>{const y=f-v.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,l.largestBatchId,f-v.size):_t.resolve(Mf());let h=jg,M=v;return y.next((O=>_t.forEach(O,((V,K)=>(h<K.largestBatchId&&(h=K.largestBatchId),v.get(V)?_t.resolve():this.remoteDocumentCache.getEntry(e,V).next((ee=>{M=M.insert(V,ee)}))))).next((()=>this.populateOverlays(e,O,v))).next((()=>this.computeViews(e,M,O,Xn()))).next((V=>({batchId:h,changes:zT(V)})))))}))}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new fn(i)).next((l=>{let f=Sg();return l.isFoundDocument()&&(f=f.insert(l.key,l)),f}))}getDocumentsMatchingCollectionGroupQuery(e,i,l,f){const v=i.collectionGroup;let y=Sg();return this.indexManager.getCollectionParents(e,v).next((h=>_t.forEach(h,(M=>{const O=(function(K,ee){return new uv(ee,null,K.explicitOrderBy.slice(),K.filters.slice(),K.limit,K.limitType,K.startAt,K.endAt)})(i,M.child(v));return this.getDocumentsMatchingCollectionQuery(e,O,l,f).next((V=>{V.forEach(((K,ee)=>{y=y.insert(K,ee)}))}))})).next((()=>y))))}getDocumentsMatchingCollectionQuery(e,i,l,f){let v;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,l.largestBatchId).next((y=>(v=y,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,l,v,f)))).next((y=>{v.forEach(((M,O)=>{const V=O.getKey();y.get(V)===null&&(y=y.insert(V,za.newInvalidDocument(V)))}));let h=Sg();return y.forEach(((M,O)=>{const V=v.get(M);V!==void 0&&kg(V.mutation,O,hl.empty(),vr.now()),dv(i,O)&&(h=h.insert(M,O))})),h}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rM{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,i){return _t.resolve(this.Lr.get(i))}saveBundleMetadata(e,i){return this.Lr.set(i.id,(function(f){return{id:f.id,version:f.version,createTime:pu(f.createTime)}})(i)),_t.resolve()}getNamedQuery(e,i){return _t.resolve(this.kr.get(i))}saveNamedQuery(e,i){return this.kr.set(i.name,(function(f){return{name:f.name,query:ZR(f.bundledQuery),readTime:pu(f.readTime)}})(i)),_t.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{constructor(){this.overlays=new Or(fn.comparator),this.qr=new Map}getOverlay(e,i){return _t.resolve(this.overlays.get(i))}getOverlays(e,i){const l=Mf();return _t.forEach(i,(f=>this.getOverlay(e,f).next((v=>{v!==null&&l.set(f,v)})))).next((()=>l))}saveOverlays(e,i,l){return l.forEach(((f,v)=>{this.St(e,i,v)})),_t.resolve()}removeOverlaysForBatchId(e,i,l){const f=this.qr.get(l);return f!==void 0&&(f.forEach((v=>this.overlays=this.overlays.remove(v))),this.qr.delete(l)),_t.resolve()}getOverlaysForCollection(e,i,l){const f=Mf(),v=i.length+1,y=new fn(i.child("")),h=this.overlays.getIteratorFrom(y);for(;h.hasNext();){const M=h.getNext().value,O=M.getKey();if(!i.isPrefixOf(O.path))break;O.path.length===v&&M.largestBatchId>l&&f.set(M.getKey(),M)}return _t.resolve(f)}getOverlaysForCollectionGroup(e,i,l,f){let v=new Or(((O,V)=>O-V));const y=this.overlays.getIterator();for(;y.hasNext();){const O=y.getNext().value;if(O.getKey().getCollectionGroup()===i&&O.largestBatchId>l){let V=v.get(O.largestBatchId);V===null&&(V=Mf(),v=v.insert(O.largestBatchId,V)),V.set(O.getKey(),O)}}const h=Mf(),M=v.getIterator();for(;M.hasNext()&&(M.getNext().value.forEach(((O,V)=>h.set(O,V))),!(h.size()>=f)););return _t.resolve(h)}St(e,i,l){const f=this.overlays.get(l.key);if(f!==null){const y=this.qr.get(f.largestBatchId).delete(l.key);this.qr.set(f.largestBatchId,y)}this.overlays=this.overlays.insert(l.key,new TR(i,l));let v=this.qr.get(i);v===void 0&&(v=Xn(),this.qr.set(i,v)),this.qr.set(i,v.add(l.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(){this.sessionToken=ba.EMPTY_BYTE_STRING}getSessionToken(e){return _t.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,_t.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wb{constructor(){this.Qr=new zs(Ks.$r),this.Ur=new zs(Ks.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,i){const l=new Ks(e,i);this.Qr=this.Qr.add(l),this.Ur=this.Ur.add(l)}Wr(e,i){e.forEach((l=>this.addReference(l,i)))}removeReference(e,i){this.Gr(new Ks(e,i))}zr(e,i){e.forEach((l=>this.removeReference(l,i)))}jr(e){const i=new fn(new yr([])),l=new Ks(i,e),f=new Ks(i,e+1),v=[];return this.Ur.forEachInRange([l,f],(y=>{this.Gr(y),v.push(y.key)})),v}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const i=new fn(new yr([])),l=new Ks(i,e),f=new Ks(i,e+1);let v=Xn();return this.Ur.forEachInRange([l,f],(y=>{v=v.add(y.key)})),v}containsKey(e){const i=new Ks(e,0),l=this.Qr.firstAfterOrEqual(i);return l!==null&&e.isEqual(l.key)}}class Ks{constructor(e,i){this.key=e,this.Yr=i}static $r(e,i){return fn.comparator(e.key,i.key)||Kn(e.Yr,i.Yr)}static Kr(e,i){return Kn(e.Yr,i.Yr)||fn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.tr=1,this.Zr=new zs(Ks.$r)}checkEmpty(e){return _t.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,l,f){const v=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const y=new wR(v,i,l,f);this.mutationQueue.push(y);for(const h of f)this.Zr=this.Zr.add(new Ks(h.key,v)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return _t.resolve(y)}lookupMutationBatch(e,i){return _t.resolve(this.Xr(i))}getNextMutationBatchAfterBatchId(e,i){const l=i+1,f=this.ei(l),v=f<0?0:f;return _t.resolve(this.mutationQueue.length>v?this.mutationQueue[v]:null)}getHighestUnacknowledgedBatchId(){return _t.resolve(this.mutationQueue.length===0?hb:this.tr-1)}getAllMutationBatches(e){return _t.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const l=new Ks(i,0),f=new Ks(i,Number.POSITIVE_INFINITY),v=[];return this.Zr.forEachInRange([l,f],(y=>{const h=this.Xr(y.Yr);v.push(h)})),_t.resolve(v)}getAllMutationBatchesAffectingDocumentKeys(e,i){let l=new zs(Kn);return i.forEach((f=>{const v=new Ks(f,0),y=new Ks(f,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([v,y],(h=>{l=l.add(h.Yr)}))})),_t.resolve(this.ti(l))}getAllMutationBatchesAffectingQuery(e,i){const l=i.path,f=l.length+1;let v=l;fn.isDocumentKey(v)||(v=v.child(""));const y=new Ks(new fn(v),0);let h=new zs(Kn);return this.Zr.forEachWhile((M=>{const O=M.key.path;return!!l.isPrefixOf(O)&&(O.length===f&&(h=h.add(M.Yr)),!0)}),y),_t.resolve(this.ti(h))}ti(e){const i=[];return e.forEach((l=>{const f=this.Xr(l);f!==null&&i.push(f)})),i}removeMutationBatch(e,i){Li(this.ni(i.batchId,"removed")===0,55003),this.mutationQueue.shift();let l=this.Zr;return _t.forEach(i.mutations,(f=>{const v=new Ks(f.key,i.batchId);return l=l.delete(v),this.referenceDelegate.markPotentiallyOrphaned(e,f.key)})).next((()=>{this.Zr=l}))}ir(e){}containsKey(e,i){const l=new Ks(i,0),f=this.Zr.firstAfterOrEqual(l);return _t.resolve(i.isEqual(f&&f.key))}performConsistencyCheck(e){return this.mutationQueue.length,_t.resolve()}ni(e,i){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const i=this.ei(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lM{constructor(e){this.ri=e,this.docs=(function(){return new Or(fn.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const l=i.key,f=this.docs.get(l),v=f?f.size:0,y=this.ri(i);return this.docs=this.docs.insert(l,{document:i.mutableCopy(),size:y}),this.size+=y-v,this.indexManager.addToCollectionParentIndex(e,l.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const l=this.docs.get(i);return _t.resolve(l?l.document.mutableCopy():za.newInvalidDocument(i))}getEntries(e,i){let l=hh();return i.forEach((f=>{const v=this.docs.get(f);l=l.insert(f,v?v.document.mutableCopy():za.newInvalidDocument(f))})),_t.resolve(l)}getDocumentsMatchingQuery(e,i,l,f){let v=hh();const y=i.path,h=new fn(y.child("__id-9223372036854775808__")),M=this.docs.getIteratorFrom(h);for(;M.hasNext();){const{key:O,value:{document:V}}=M.getNext();if(!y.isPrefixOf(O.path))break;O.path.length>y.length+1||zP(OP(V),l)<=0||(f.has(V.key)||dv(i,V))&&(v=v.insert(V.key,V.mutableCopy()))}return _t.resolve(v)}getAllFromCollectionGroup(e,i,l,f){Sn(9500)}ii(e,i){return _t.forEach(this.docs,(l=>i(l)))}newChangeBuffer(e){return new cM(this)}getSize(e){return _t.resolve(this.size)}}class cM extends tM{constructor(e){super(),this.Nr=e}applyChanges(e){const i=[];return this.changes.forEach(((l,f)=>{f.isValidDocument()?i.push(this.Nr.addEntry(e,f)):this.Nr.removeEntry(l)})),_t.waitFor(i)}getFromCache(e,i){return this.Nr.getEntry(e,i)}getAllFromCache(e,i){return this.Nr.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uM{constructor(e){this.persistence=e,this.si=new qf((i=>pb(i)),mb),this.lastRemoteSnapshotVersion=Rn.min(),this.highestTargetId=0,this.oi=0,this._i=new wb,this.targetCount=0,this.ai=nm.ur()}forEachTarget(e,i){return this.si.forEach(((l,f)=>i(f))),_t.resolve()}getLastRemoteSnapshotVersion(e){return _t.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return _t.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),_t.resolve(this.highestTargetId)}setTargetsMetadata(e,i,l){return l&&(this.lastRemoteSnapshotVersion=l),i>this.oi&&(this.oi=i),_t.resolve()}Pr(e){this.si.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.ai=new nm(i),this.highestTargetId=i),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,i){return this.Pr(i),this.targetCount+=1,_t.resolve()}updateTargetData(e,i){return this.Pr(i),_t.resolve()}removeTargetData(e,i){return this.si.delete(i.target),this._i.jr(i.targetId),this.targetCount-=1,_t.resolve()}removeTargets(e,i,l){let f=0;const v=[];return this.si.forEach(((y,h)=>{h.sequenceNumber<=i&&l.get(h.targetId)===null&&(this.si.delete(y),v.push(this.removeMatchingKeysForTargetId(e,h.targetId)),f++)})),_t.waitFor(v).next((()=>f))}getTargetCount(e){return _t.resolve(this.targetCount)}getTargetData(e,i){const l=this.si.get(i)||null;return _t.resolve(l)}addMatchingKeys(e,i,l){return this._i.Wr(i,l),_t.resolve()}removeMatchingKeys(e,i,l){this._i.zr(i,l);const f=this.persistence.referenceDelegate,v=[];return f&&i.forEach((y=>{v.push(f.markPotentiallyOrphaned(e,y))})),_t.waitFor(v)}removeMatchingKeysForTargetId(e,i){return this._i.jr(i),_t.resolve()}getMatchingKeysForTargetId(e,i){const l=this._i.Hr(i);return _t.resolve(l)}containsKey(e,i){return _t.resolve(this._i.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(e,i){this.ui={},this.overlays={},this.ci=new ov(0),this.li=!1,this.li=!0,this.hi=new aM,this.referenceDelegate=e(this),this.Pi=new uM(this),this.indexManager=new WR,this.remoteDocumentCache=(function(f){return new lM(f)})((l=>this.referenceDelegate.Ti(l))),this.serializer=new HR(i),this.Ii=new rM(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new sM,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let l=this.ui[e.toKey()];return l||(l=new oM(i,this.referenceDelegate),this.ui[e.toKey()]=l),l}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,i,l){$t("MemoryPersistence","Starting transaction:",e);const f=new hM(this.ci.next());return this.referenceDelegate.Ei(),l(f).next((v=>this.referenceDelegate.di(f).next((()=>v)))).toPromise().then((v=>(f.raiseOnCommittedEvent(),v)))}Ai(e,i){return _t.or(Object.values(this.ui).map((l=>()=>l.containsKey(e,i))))}}class hM extends NP{constructor(e){super(),this.currentSequenceNumber=e}}class Tb{constructor(e){this.persistence=e,this.Ri=new wb,this.Vi=null}static mi(e){return new Tb(e)}get fi(){if(this.Vi)return this.Vi;throw Sn(60996)}addReference(e,i,l){return this.Ri.addReference(l,i),this.fi.delete(l.toString()),_t.resolve()}removeReference(e,i,l){return this.Ri.removeReference(l,i),this.fi.add(l.toString()),_t.resolve()}markPotentiallyOrphaned(e,i){return this.fi.add(i.toString()),_t.resolve()}removeTarget(e,i){this.Ri.jr(i.targetId).forEach((f=>this.fi.add(f.toString())));const l=this.persistence.getTargetCache();return l.getMatchingKeysForTargetId(e,i.targetId).next((f=>{f.forEach((v=>this.fi.add(v.toString())))})).next((()=>l.removeTargetData(e,i)))}Ei(){this.Vi=new Set}di(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _t.forEach(this.fi,(l=>{const f=fn.fromPath(l);return this.gi(e,f).next((v=>{v||i.removeEntry(f,Rn.min())}))})).next((()=>(this.Vi=null,i.apply(e))))}updateLimboDocument(e,i){return this.gi(e,i).next((l=>{l?this.fi.delete(i.toString()):this.fi.add(i.toString())}))}Ti(e){return 0}gi(e,i){return _t.or([()=>_t.resolve(this.Ri.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.Ai(e,i)])}}class qy{constructor(e,i){this.persistence=e,this.pi=new qf((l=>jP(l.path)),((l,f)=>l.isEqual(f))),this.garbageCollector=eM(this,i)}static mi(e,i){return new qy(e,i)}Ei(){}di(e){return _t.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}gr(e){const i=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((l=>i.next((f=>l+f))))}wr(e){let i=0;return this.pr(e,(l=>{i++})).next((()=>i))}pr(e,i){return _t.forEach(this.pi,((l,f)=>this.br(e,l,f).next((v=>v?_t.resolve():i(f)))))}removeTargets(e,i,l){return this.persistence.getTargetCache().removeTargets(e,i,l)}removeOrphanedDocuments(e,i){let l=0;const f=this.persistence.getRemoteDocumentCache(),v=f.newChangeBuffer();return f.ii(e,(y=>this.br(e,y,i).next((h=>{h||(l++,v.removeEntry(y,Rn.min()))})))).next((()=>v.apply(e))).next((()=>l))}markPotentiallyOrphaned(e,i){return this.pi.set(i,e.currentSequenceNumber),_t.resolve()}removeTarget(e,i){const l=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,l)}addReference(e,i,l){return this.pi.set(l,e.currentSequenceNumber),_t.resolve()}removeReference(e,i,l){return this.pi.set(l,e.currentSequenceNumber),_t.resolve()}updateLimboDocument(e,i){return this.pi.set(i,e.currentSequenceNumber),_t.resolve()}Ti(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=Sy(e.data.value)),i}br(e,i,l){return _t.or([()=>this.persistence.Ai(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const f=this.pi.get(i);return _t.resolve(f!==void 0&&f>l)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sb{constructor(e,i,l,f){this.targetId=e,this.fromCache=i,this.Es=l,this.ds=f}static As(e,i){let l=Xn(),f=Xn();for(const v of i.docChanges)switch(v.type){case 0:l=l.add(v.doc.key);break;case 1:f=f.add(v.doc.key)}return new Sb(e,i.fromCache,l,f)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dM{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fM{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return rC()?8:BP(La())>0?6:4})()}initialize(e,i){this.ps=e,this.indexManager=i,this.Rs=!0}getDocumentsMatchingQuery(e,i,l,f){const v={result:null};return this.ys(e,i).next((y=>{v.result=y})).next((()=>{if(!v.result)return this.ws(e,i,f,l).next((y=>{v.result=y}))})).next((()=>{if(v.result)return;const y=new dM;return this.Ss(e,i,y).next((h=>{if(v.result=h,this.Vs)return this.bs(e,i,y,h.size)}))})).next((()=>v.result))}bs(e,i,l,f){return l.documentReadCount<this.fs?(Bp()<=Wn.DEBUG&&$t("QueryEngine","SDK will not create cache indexes for query:",Vp(i),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),_t.resolve()):(Bp()<=Wn.DEBUG&&$t("QueryEngine","Query:",Vp(i),"scans",l.documentReadCount,"local documents and returns",f,"documents as results."),l.documentReadCount>this.gs*f?(Bp()<=Wn.DEBUG&&$t("QueryEngine","The SDK decides to create cache indexes for query:",Vp(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,fu(i))):_t.resolve())}ys(e,i){if(Qx(i))return _t.resolve(null);let l=fu(i);return this.indexManager.getIndexType(e,l).next((f=>f===0?null:(i.limit!==null&&f===1&&(i=A0(i,null,"F"),l=fu(i)),this.indexManager.getDocumentsMatchingTarget(e,l).next((v=>{const y=Xn(...v);return this.ps.getDocuments(e,y).next((h=>this.indexManager.getMinOffset(e,l).next((M=>{const O=this.Ds(i,h);return this.Cs(i,O,y,M.readTime)?this.ys(e,A0(i,null,"F")):this.vs(e,O,i,M)}))))})))))}ws(e,i,l,f){return Qx(i)||f.isEqual(Rn.min())?_t.resolve(null):this.ps.getDocuments(e,l).next((v=>{const y=this.Ds(i,v);return this.Cs(i,y,l,f)?_t.resolve(null):(Bp()<=Wn.DEBUG&&$t("QueryEngine","Re-using previous result from %s to execute query: %s",f.toString(),Vp(i)),this.vs(e,y,i,DP(f,jg)).next((h=>h)))}))}Ds(e,i){let l=new zs(DT(e));return i.forEach(((f,v)=>{dv(e,v)&&(l=l.add(v))})),l}Cs(e,i,l,f){if(e.limit===null)return!1;if(l.size!==i.size)return!0;const v=e.limitType==="F"?i.last():i.first();return!!v&&(v.hasPendingWrites||v.version.compareTo(f)>0)}Ss(e,i,l){return Bp()<=Wn.DEBUG&&$t("QueryEngine","Using full collection scan to execute query:",Vp(i)),this.ps.getDocumentsMatchingQuery(e,i,vd.min(),l)}vs(e,i,l,f){return this.ps.getDocumentsMatchingQuery(e,l,f).next((v=>(i.forEach((y=>{v=v.insert(y.key,y)})),v)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eb="LocalStore",pM=3e8;class mM{constructor(e,i,l,f){this.persistence=e,this.Fs=i,this.serializer=f,this.Ms=new Or(Kn),this.xs=new qf((v=>pb(v)),mb),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(l)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new iM(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(i=>e.collect(i,this.Ms)))}}function gM(c,e,i,l){return new mM(c,e,i,l)}async function nS(c,e){const i=Dn(c);return await i.persistence.runTransaction("Handle user change","readonly",(l=>{let f;return i.mutationQueue.getAllMutationBatches(l).next((v=>(f=v,i.Bs(e),i.mutationQueue.getAllMutationBatches(l)))).next((v=>{const y=[],h=[];let M=Xn();for(const O of f){y.push(O.batchId);for(const V of O.mutations)M=M.add(V.key)}for(const O of v){h.push(O.batchId);for(const V of O.mutations)M=M.add(V.key)}return i.localDocuments.getDocuments(l,M).next((O=>({Ls:O,removedBatchIds:y,addedBatchIds:h})))}))}))}function _M(c,e){const i=Dn(c);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",(l=>{const f=e.batch.keys(),v=i.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,M,O,V){const K=O.batch,ee=K.keys();let Y=_t.resolve();return ee.forEach((ve=>{Y=Y.next((()=>V.getEntry(M,ve))).next((Ce=>{const Ee=O.docVersions.get(ve);Li(Ee!==null,48541),Ce.version.compareTo(Ee)<0&&(K.applyToRemoteDocument(Ce,O),Ce.isValidDocument()&&(Ce.setReadTime(O.commitVersion),V.addEntry(Ce)))}))})),Y.next((()=>h.mutationQueue.removeMutationBatch(M,K)))})(i,l,e,v).next((()=>v.apply(l))).next((()=>i.mutationQueue.performConsistencyCheck(l))).next((()=>i.documentOverlayCache.removeOverlaysForBatchId(l,f,e.batch.batchId))).next((()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,(function(h){let M=Xn();for(let O=0;O<h.mutationResults.length;++O)h.mutationResults[O].transformResults.length>0&&(M=M.add(h.batch.mutations[O].key));return M})(e)))).next((()=>i.localDocuments.getDocuments(l,f)))}))}function iS(c){const e=Dn(c);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(i=>e.Pi.getLastRemoteSnapshotVersion(i)))}function yM(c,e){const i=Dn(c),l=e.snapshotVersion;let f=i.Ms;return i.persistence.runTransaction("Apply remote event","readwrite-primary",(v=>{const y=i.Ns.newChangeBuffer({trackRemovals:!0});f=i.Ms;const h=[];e.targetChanges.forEach(((V,K)=>{const ee=f.get(K);if(!ee)return;h.push(i.Pi.removeMatchingKeys(v,V.removedDocuments,K).next((()=>i.Pi.addMatchingKeys(v,V.addedDocuments,K))));let Y=ee.withSequenceNumber(v.currentSequenceNumber);e.targetMismatches.get(K)!==null?Y=Y.withResumeToken(ba.EMPTY_BYTE_STRING,Rn.min()).withLastLimboFreeSnapshotVersion(Rn.min()):V.resumeToken.approximateByteSize()>0&&(Y=Y.withResumeToken(V.resumeToken,l)),f=f.insert(K,Y),(function(Ce,Ee,Je){return Ce.resumeToken.approximateByteSize()===0||Ee.snapshotVersion.toMicroseconds()-Ce.snapshotVersion.toMicroseconds()>=pM?!0:Je.addedDocuments.size+Je.modifiedDocuments.size+Je.removedDocuments.size>0})(ee,Y,V)&&h.push(i.Pi.updateTargetData(v,Y))}));let M=hh(),O=Xn();if(e.documentUpdates.forEach((V=>{e.resolvedLimboDocuments.has(V)&&h.push(i.persistence.referenceDelegate.updateLimboDocument(v,V))})),h.push(vM(v,y,e.documentUpdates).next((V=>{M=V.ks,O=V.qs}))),!l.isEqual(Rn.min())){const V=i.Pi.getLastRemoteSnapshotVersion(v).next((K=>i.Pi.setTargetsMetadata(v,v.currentSequenceNumber,l)));h.push(V)}return _t.waitFor(h).next((()=>y.apply(v))).next((()=>i.localDocuments.getLocalViewOfDocuments(v,M,O))).next((()=>M))})).then((v=>(i.Ms=f,v)))}function vM(c,e,i){let l=Xn(),f=Xn();return i.forEach((v=>l=l.add(v))),e.getEntries(c,l).next((v=>{let y=hh();return i.forEach(((h,M)=>{const O=v.get(h);M.isFoundDocument()!==O.isFoundDocument()&&(f=f.add(h)),M.isNoDocument()&&M.version.isEqual(Rn.min())?(e.removeEntry(h,M.readTime),y=y.insert(h,M)):!O.isValidDocument()||M.version.compareTo(O.version)>0||M.version.compareTo(O.version)===0&&O.hasPendingWrites?(e.addEntry(M),y=y.insert(h,M)):$t(Eb,"Ignoring outdated watch update for ",h,". Current version:",O.version," Watch version:",M.version)})),{ks:y,qs:f}}))}function bM(c,e){const i=Dn(c);return i.persistence.runTransaction("Get next mutation batch","readonly",(l=>(e===void 0&&(e=hb),i.mutationQueue.getNextMutationBatchAfterBatchId(l,e))))}function xM(c,e){const i=Dn(c);return i.persistence.runTransaction("Allocate target","readwrite",(l=>{let f;return i.Pi.getTargetData(l,e).next((v=>v?(f=v,_t.resolve(f)):i.Pi.allocateTargetId(l).next((y=>(f=new dd(e,y,"TargetPurposeListen",l.currentSequenceNumber),i.Pi.addTargetData(l,f).next((()=>f)))))))})).then((l=>{const f=i.Ms.get(l.targetId);return(f===null||l.snapshotVersion.compareTo(f.snapshotVersion)>0)&&(i.Ms=i.Ms.insert(l.targetId,l),i.xs.set(e,l.targetId)),l}))}async function M0(c,e,i){const l=Dn(c),f=l.Ms.get(e),v=i?"readwrite":"readwrite-primary";try{i||await l.persistence.runTransaction("Release target",v,(y=>l.persistence.referenceDelegate.removeTarget(y,f)))}catch(y){if(!fm(y))throw y;$t(Eb,`Failed to update sequence numbers for target ${e}: ${y}`)}l.Ms=l.Ms.remove(e),l.xs.delete(f.target)}function hw(c,e,i){const l=Dn(c);let f=Rn.min(),v=Xn();return l.persistence.runTransaction("Execute query","readwrite",(y=>(function(M,O,V){const K=Dn(M),ee=K.xs.get(V);return ee!==void 0?_t.resolve(K.Ms.get(ee)):K.Pi.getTargetData(O,V)})(l,y,fu(e)).next((h=>{if(h)return f=h.lastLimboFreeSnapshotVersion,l.Pi.getMatchingKeysForTargetId(y,h.targetId).next((M=>{v=M}))})).next((()=>l.Fs.getDocumentsMatchingQuery(y,e,i?f:Rn.min(),i?v:Xn()))).next((h=>(wM(l,aR(e),h),{documents:h,Qs:v})))))}function wM(c,e,i){let l=c.Os.get(e)||Rn.min();i.forEach(((f,v)=>{v.readTime.compareTo(l)>0&&(l=v.readTime)})),c.Os.set(e,l)}class dw{constructor(){this.activeTargetIds=dR()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class TM{constructor(){this.Mo=new dw,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,l){}addLocalQueryTarget(e,i=!0){return i&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,i,l){this.xo[e]=i}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new dw,Promise.resolve()}handleUserChange(e,i,l){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SM{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fw="ConnectivityMonitor";class pw{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){$t(fw,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){$t(fw,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fy=null;function k0(){return fy===null?fy=(function(){return 268435456+Math.round(2147483648*Math.random())})():fy++,"0x"+fy.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qv="RestConnection",EM={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class AM{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",l=encodeURIComponent(this.databaseId.projectId),f=encodeURIComponent(this.databaseId.database);this.Uo=i+"://"+e.host,this.Ko=`projects/${l}/databases/${f}`,this.Wo=this.databaseId.database===By?`project_id=${l}`:`project_id=${l}&database_id=${f}`}Go(e,i,l,f,v){const y=k0(),h=this.zo(e,i.toUriEncodedString());$t(Qv,`Sending RPC '${e}' ${y}:`,h,l);const M={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(M,f,v);const{host:O}=new URL(h),V=cm(O);return this.Jo(e,h,M,l,V).then((K=>($t(Qv,`Received RPC '${e}' ${y}: `,K),K)),(K=>{throw Qp(Qv,`RPC '${e}' ${y} failed with error: `,K,"url: ",h,"request:",l),K}))}Ho(e,i,l,f,v,y){return this.Go(e,i,l,f,v)}jo(e,i,l){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+hm})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach(((f,v)=>e[v]=f)),l&&l.headers.forEach(((f,v)=>e[v]=f))}zo(e,i){const l=EM[e];return`${this.Uo}/v1/${i}:${l}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IM{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Da="WebChannelConnection";class CM extends AM{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,i,l,f,v){const y=k0();return new Promise(((h,M)=>{const O=new oT;O.setWithCredentials(!0),O.listenOnce(lT.COMPLETE,(()=>{try{switch(O.getLastErrorCode()){case Ty.NO_ERROR:const K=O.getResponseJson();$t(Da,`XHR for RPC '${e}' ${y} received:`,JSON.stringify(K)),h(K);break;case Ty.TIMEOUT:$t(Da,`RPC '${e}' ${y} timed out`),M(new Jt(vt.DEADLINE_EXCEEDED,"Request time out"));break;case Ty.HTTP_ERROR:const ee=O.getStatus();if($t(Da,`RPC '${e}' ${y} failed with status:`,ee,"response text:",O.getResponseText()),ee>0){let Y=O.getResponseJson();Array.isArray(Y)&&(Y=Y[0]);const ve=Y?.error;if(ve&&ve.status&&ve.message){const Ce=(function(Je){const je=Je.toLowerCase().replace(/_/g,"-");return Object.values(vt).indexOf(je)>=0?je:vt.UNKNOWN})(ve.status);M(new Jt(Ce,ve.message))}else M(new Jt(vt.UNKNOWN,"Server responded with status "+O.getStatus()))}else M(new Jt(vt.UNAVAILABLE,"Connection failed."));break;default:Sn(9055,{l_:e,streamId:y,h_:O.getLastErrorCode(),P_:O.getLastError()})}}finally{$t(Da,`RPC '${e}' ${y} completed.`)}}));const V=JSON.stringify(f);$t(Da,`RPC '${e}' ${y} sending request:`,f),O.send(i,"POST",V,l,15)}))}T_(e,i,l){const f=k0(),v=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],y=hT(),h=uT(),M={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},O=this.longPollingOptions.timeoutSeconds;O!==void 0&&(M.longPollingTimeout=Math.round(1e3*O)),this.useFetchStreams&&(M.useFetchStreams=!0),this.jo(M.initMessageHeaders,i,l),M.encodeInitMessageHeaders=!0;const V=v.join("");$t(Da,`Creating RPC '${e}' stream ${f}: ${V}`,M);const K=y.createWebChannel(V,M);this.I_(K);let ee=!1,Y=!1;const ve=new IM({Yo:Ee=>{Y?$t(Da,`Not sending because RPC '${e}' stream ${f} is closed:`,Ee):(ee||($t(Da,`Opening RPC '${e}' stream ${f} transport.`),K.open(),ee=!0),$t(Da,`RPC '${e}' stream ${f} sending:`,Ee),K.send(Ee))},Zo:()=>K.close()}),Ce=(Ee,Je,je)=>{Ee.listen(Je,(He=>{try{je(He)}catch(gt){setTimeout((()=>{throw gt}),0)}}))};return Ce(K,Tg.EventType.OPEN,(()=>{Y||($t(Da,`RPC '${e}' stream ${f} transport opened.`),ve.o_())})),Ce(K,Tg.EventType.CLOSE,(()=>{Y||(Y=!0,$t(Da,`RPC '${e}' stream ${f} transport closed`),ve.a_(),this.E_(K))})),Ce(K,Tg.EventType.ERROR,(Ee=>{Y||(Y=!0,Qp(Da,`RPC '${e}' stream ${f} transport errored. Name:`,Ee.name,"Message:",Ee.message),ve.a_(new Jt(vt.UNAVAILABLE,"The operation could not be completed")))})),Ce(K,Tg.EventType.MESSAGE,(Ee=>{if(!Y){const Je=Ee.data[0];Li(!!Je,16349);const je=Je,He=je?.error||je[0]?.error;if(He){$t(Da,`RPC '${e}' stream ${f} received error:`,He);const gt=He.status;let St=(function(pe){const ye=hs[pe];if(ye!==void 0)return qT(ye)})(gt),Pt=He.message;St===void 0&&(St=vt.INTERNAL,Pt="Unknown error status: "+gt+" with message "+He.message),Y=!0,ve.a_(new Jt(St,Pt)),K.close()}else $t(Da,`RPC '${e}' stream ${f} received:`,Je),ve.u_(Je)}})),Ce(h,cT.STAT_EVENT,(Ee=>{Ee.stat===b0.PROXY?$t(Da,`RPC '${e}' stream ${f} detected buffering proxy`):Ee.stat===b0.NOPROXY&&$t(Da,`RPC '${e}' stream ${f} detected no buffering proxy`)})),setTimeout((()=>{ve.__()}),0),ve}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((i=>i===e))}}function Jv(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gv(c){return new kR(c,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rS{constructor(e,i,l=1e3,f=1.5,v=6e4){this.Mi=e,this.timerId=i,this.d_=l,this.A_=f,this.R_=v,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const i=Math.floor(this.V_+this.y_()),l=Math.max(0,Date.now()-this.f_),f=Math.max(0,i-l);f>0&&$t("ExponentialBackoff",`Backing off for ${f} ms (base delay: ${this.V_} ms, delay with jitter: ${i} ms, last attempt: ${l} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,f,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mw="PersistentStream";class sS{constructor(e,i,l,f,v,y,h,M){this.Mi=e,this.S_=l,this.b_=f,this.connection=v,this.authCredentialsProvider=y,this.appCheckCredentialsProvider=h,this.listener=M,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new rS(e,i)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,i){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():i&&i.code===vt.RESOURCE_EXHAUSTED?(uh(i.toString()),uh("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):i&&i.code===vt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(i)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),i=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([l,f])=>{this.D_===i&&this.G_(l,f)}),(l=>{e((()=>{const f=new Jt(vt.UNKNOWN,"Fetching auth token failed: "+l.message);return this.z_(f)}))}))}G_(e,i){const l=this.W_(this.D_);this.stream=this.j_(e,i),this.stream.Xo((()=>{l((()=>this.listener.Xo()))})),this.stream.t_((()=>{l((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((f=>{l((()=>this.z_(f)))})),this.stream.onMessage((f=>{l((()=>++this.F_==1?this.J_(f):this.onNext(f)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return $t(mw,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return i=>{this.Mi.enqueueAndForget((()=>this.D_===e?i():($t(mw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class PM extends sS{constructor(e,i,l,f,v,y){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,l,f,y),this.serializer=v}j_(e,i){return this.connection.T_("Listen",e,i)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const i=zR(this.serializer,e),l=(function(v){if(!("targetChange"in v))return Rn.min();const y=v.targetChange;return y.targetIds&&y.targetIds.length?Rn.min():y.readTime?pu(y.readTime):Rn.min()})(e);return this.listener.H_(i,l)}Y_(e){const i={};i.database=R0(this.serializer),i.addTarget=(function(v,y){let h;const M=y.target;if(h=E0(M)?{documents:BR(v,M)}:{query:VR(v,M).ft},h.targetId=y.targetId,y.resumeToken.approximateByteSize()>0){h.resumeToken=ZT(v,y.resumeToken);const O=I0(v,y.expectedCount);O!==null&&(h.expectedCount=O)}else if(y.snapshotVersion.compareTo(Rn.min())>0){h.readTime=$y(v,y.snapshotVersion.toTimestamp());const O=I0(v,y.expectedCount);O!==null&&(h.expectedCount=O)}return h})(this.serializer,e);const l=UR(this.serializer,e);l&&(i.labels=l),this.q_(i)}Z_(e){const i={};i.database=R0(this.serializer),i.removeTarget=e,this.q_(i)}}class RM extends sS{constructor(e,i,l,f,v,y){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,l,f,y),this.serializer=v}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,i){return this.connection.T_("Write",e,i)}J_(e){return Li(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Li(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Li(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const i=NR(e.writeResults,e.commitTime),l=pu(e.commitTime);return this.listener.na(l,i)}ra(){const e={};e.database=R0(this.serializer),this.q_(e)}ea(e){const i={streamToken:this.lastStreamToken,writes:e.map((l=>LR(this.serializer,l)))};this.q_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MM{}class kM extends MM{constructor(e,i,l,f){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=l,this.serializer=f,this.ia=!1}sa(){if(this.ia)throw new Jt(vt.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,i,l,f){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([v,y])=>this.connection.Go(e,C0(i,l),f,v,y))).catch((v=>{throw v.name==="FirebaseError"?(v.code===vt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),v):new Jt(vt.UNKNOWN,v.toString())}))}Ho(e,i,l,f,v){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([y,h])=>this.connection.Ho(e,C0(i,l),f,y,h,v))).catch((y=>{throw y.name==="FirebaseError"?(y.code===vt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),y):new Jt(vt.UNKNOWN,y.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class DM{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(uh(i),this.aa=!1):$t("OnlineStateTracker",i)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jf="RemoteStore";class OM{constructor(e,i,l,f,v){this.localStore=e,this.datastore=i,this.asyncQueue=l,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=v,this.Aa.Oo((y=>{l.enqueueAndForget((async()=>{Gf(this)&&($t(jf,"Restarting streams for network reachability change."),await(async function(M){const O=Dn(M);O.Ea.add(4),await r_(O),O.Ra.set("Unknown"),O.Ea.delete(4),await _v(O)})(this))}))})),this.Ra=new DM(l,f)}}async function _v(c){if(Gf(c))for(const e of c.da)await e(!0)}async function r_(c){for(const e of c.da)await e(!1)}function aS(c,e){const i=Dn(c);i.Ia.has(e.targetId)||(i.Ia.set(e.targetId,e),Pb(i)?Cb(i):pm(i).O_()&&Ib(i,e))}function Ab(c,e){const i=Dn(c),l=pm(i);i.Ia.delete(e),l.O_()&&oS(i,e),i.Ia.size===0&&(l.O_()?l.L_():Gf(i)&&i.Ra.set("Unknown"))}function Ib(c,e){if(c.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Rn.min())>0){const i=c.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}pm(c).Y_(e)}function oS(c,e){c.Va.Ue(e),pm(c).Z_(e)}function Cb(c){c.Va=new CR({getRemoteKeysForTarget:e=>c.remoteSyncer.getRemoteKeysForTarget(e),At:e=>c.Ia.get(e)||null,ht:()=>c.datastore.serializer.databaseId}),pm(c).start(),c.Ra.ua()}function Pb(c){return Gf(c)&&!pm(c).x_()&&c.Ia.size>0}function Gf(c){return Dn(c).Ea.size===0}function lS(c){c.Va=void 0}async function zM(c){c.Ra.set("Online")}async function LM(c){c.Ia.forEach(((e,i)=>{Ib(c,e)}))}async function NM(c,e){lS(c),Pb(c)?(c.Ra.ha(e),Cb(c)):c.Ra.set("Unknown")}async function BM(c,e,i){if(c.Ra.set("Online"),e instanceof HT&&e.state===2&&e.cause)try{await(async function(f,v){const y=v.cause;for(const h of v.targetIds)f.Ia.has(h)&&(await f.remoteSyncer.rejectListen(h,y),f.Ia.delete(h),f.Va.removeTarget(h))})(c,e)}catch(l){$t(jf,"Failed to remove targets %s: %s ",e.targetIds.join(","),l),await Gy(c,l)}else if(e instanceof Iy?c.Va.Ze(e):e instanceof GT?c.Va.st(e):c.Va.tt(e),!i.isEqual(Rn.min()))try{const l=await iS(c.localStore);i.compareTo(l)>=0&&await(function(v,y){const h=v.Va.Tt(y);return h.targetChanges.forEach(((M,O)=>{if(M.resumeToken.approximateByteSize()>0){const V=v.Ia.get(O);V&&v.Ia.set(O,V.withResumeToken(M.resumeToken,y))}})),h.targetMismatches.forEach(((M,O)=>{const V=v.Ia.get(M);if(!V)return;v.Ia.set(M,V.withResumeToken(ba.EMPTY_BYTE_STRING,V.snapshotVersion)),oS(v,M);const K=new dd(V.target,M,O,V.sequenceNumber);Ib(v,K)})),v.remoteSyncer.applyRemoteEvent(h)})(c,i)}catch(l){$t(jf,"Failed to raise snapshot:",l),await Gy(c,l)}}async function Gy(c,e,i){if(!fm(e))throw e;c.Ea.add(1),await r_(c),c.Ra.set("Offline"),i||(i=()=>iS(c.localStore)),c.asyncQueue.enqueueRetryable((async()=>{$t(jf,"Retrying IndexedDB access"),await i(),c.Ea.delete(1),await _v(c)}))}function cS(c,e){return e().catch((i=>Gy(c,i,e)))}async function yv(c){const e=Dn(c),i=Td(e);let l=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:hb;for(;VM(e);)try{const f=await bM(e.localStore,l);if(f===null){e.Ta.length===0&&i.L_();break}l=f.batchId,jM(e,f)}catch(f){await Gy(e,f)}uS(e)&&hS(e)}function VM(c){return Gf(c)&&c.Ta.length<10}function jM(c,e){c.Ta.push(e);const i=Td(c);i.O_()&&i.X_&&i.ea(e.mutations)}function uS(c){return Gf(c)&&!Td(c).x_()&&c.Ta.length>0}function hS(c){Td(c).start()}async function UM(c){Td(c).ra()}async function FM(c){const e=Td(c);for(const i of c.Ta)e.ea(i.mutations)}async function $M(c,e,i){const l=c.Ta.shift(),f=vb.from(l,e,i);await cS(c,(()=>c.remoteSyncer.applySuccessfulWrite(f))),await yv(c)}async function qM(c,e){e&&Td(c).X_&&await(async function(l,f){if((function(y){return ER(y)&&y!==vt.ABORTED})(f.code)){const v=l.Ta.shift();Td(l).B_(),await cS(l,(()=>l.remoteSyncer.rejectFailedWrite(v.batchId,f))),await yv(l)}})(c,e),uS(c)&&hS(c)}async function gw(c,e){const i=Dn(c);i.asyncQueue.verifyOperationInProgress(),$t(jf,"RemoteStore received new credentials");const l=Gf(i);i.Ea.add(3),await r_(i),l&&i.Ra.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.Ea.delete(3),await _v(i)}async function GM(c,e){const i=Dn(c);e?(i.Ea.delete(2),await _v(i)):e||(i.Ea.add(2),await r_(i),i.Ra.set("Unknown"))}function pm(c){return c.ma||(c.ma=(function(i,l,f){const v=Dn(i);return v.sa(),new PM(l,v.connection,v.authCredentials,v.appCheckCredentials,v.serializer,f)})(c.datastore,c.asyncQueue,{Xo:zM.bind(null,c),t_:LM.bind(null,c),r_:NM.bind(null,c),H_:BM.bind(null,c)}),c.da.push((async e=>{e?(c.ma.B_(),Pb(c)?Cb(c):c.Ra.set("Unknown")):(await c.ma.stop(),lS(c))}))),c.ma}function Td(c){return c.fa||(c.fa=(function(i,l,f){const v=Dn(i);return v.sa(),new RM(l,v.connection,v.authCredentials,v.appCheckCredentials,v.serializer,f)})(c.datastore,c.asyncQueue,{Xo:()=>Promise.resolve(),t_:UM.bind(null,c),r_:qM.bind(null,c),ta:FM.bind(null,c),na:$M.bind(null,c)}),c.da.push((async e=>{e?(c.fa.B_(),await yv(c)):(await c.fa.stop(),c.Ta.length>0&&($t(jf,`Stopping write stream with ${c.Ta.length} pending writes`),c.Ta=[]))}))),c.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rb{constructor(e,i,l,f,v){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=l,this.op=f,this.removalCallback=v,this.deferred=new _d,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((y=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,i,l,f,v){const y=Date.now()+l,h=new Rb(e,i,y,f,v);return h.start(l),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Jt(vt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mb(c,e){if(uh("AsyncQueue",`${e}: ${c}`),fm(c))return new Jt(vt.UNAVAILABLE,`${e}: ${c}`);throw c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{static emptySet(e){return new Gp(e.comparator)}constructor(e){this.comparator=e?(i,l)=>e(i,l)||fn.comparator(i.key,l.key):(i,l)=>fn.comparator(i.key,l.key),this.keyedMap=Sg(),this.sortedSet=new Or(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((i,l)=>(e(i),!1)))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof Gp)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),l=e.sortedSet.getIterator();for(;i.hasNext();){const f=i.getNext().key,v=l.getNext().key;if(!f.isEqual(v))return!1}return!0}toString(){const e=[];return this.forEach((i=>{e.push(i.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const l=new Gp;return l.comparator=this.comparator,l.keyedMap=e,l.sortedSet=i,l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(){this.ga=new Or(fn.comparator)}track(e){const i=e.doc.key,l=this.ga.get(i);l?e.type!==0&&l.type===3?this.ga=this.ga.insert(i,e):e.type===3&&l.type!==1?this.ga=this.ga.insert(i,{type:l.type,doc:e.doc}):e.type===2&&l.type===2?this.ga=this.ga.insert(i,{type:2,doc:e.doc}):e.type===2&&l.type===0?this.ga=this.ga.insert(i,{type:0,doc:e.doc}):e.type===1&&l.type===0?this.ga=this.ga.remove(i):e.type===1&&l.type===2?this.ga=this.ga.insert(i,{type:1,doc:l.doc}):e.type===0&&l.type===1?this.ga=this.ga.insert(i,{type:2,doc:e.doc}):Sn(63341,{Rt:e,pa:l}):this.ga=this.ga.insert(i,e)}ya(){const e=[];return this.ga.inorderTraversal(((i,l)=>{e.push(l)})),e}}class im{constructor(e,i,l,f,v,y,h,M,O){this.query=e,this.docs=i,this.oldDocs=l,this.docChanges=f,this.mutatedKeys=v,this.fromCache=y,this.syncStateChanged=h,this.excludesMetadataChanges=M,this.hasCachedResults=O}static fromInitialDocuments(e,i,l,f,v){const y=[];return i.forEach((h=>{y.push({type:0,doc:h})})),new im(e,i,Gp.emptySet(i),y,l,f,!0,!1,v)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hv(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,l=e.docChanges;if(i.length!==l.length)return!1;for(let f=0;f<i.length;f++)if(i[f].type!==l[f].type||!i[f].doc.isEqual(l[f].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HM{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class ZM{constructor(){this.queries=yw(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(i,l){const f=Dn(i),v=f.queries;f.queries=yw(),v.forEach(((y,h)=>{for(const M of h.Sa)M.onError(l)}))})(this,new Jt(vt.ABORTED,"Firestore shutting down"))}}function yw(){return new qf((c=>kT(c)),hv)}async function dS(c,e){const i=Dn(c);let l=3;const f=e.query;let v=i.queries.get(f);v?!v.ba()&&e.Da()&&(l=2):(v=new HM,l=e.Da()?0:1);try{switch(l){case 0:v.wa=await i.onListen(f,!0);break;case 1:v.wa=await i.onListen(f,!1);break;case 2:await i.onFirstRemoteStoreListen(f)}}catch(y){const h=Mb(y,`Initialization of query '${Vp(e.query)}' failed`);return void e.onError(h)}i.queries.set(f,v),v.Sa.push(e),e.va(i.onlineState),v.wa&&e.Fa(v.wa)&&kb(i)}async function fS(c,e){const i=Dn(c),l=e.query;let f=3;const v=i.queries.get(l);if(v){const y=v.Sa.indexOf(e);y>=0&&(v.Sa.splice(y,1),v.Sa.length===0?f=e.Da()?0:1:!v.ba()&&e.Da()&&(f=2))}switch(f){case 0:return i.queries.delete(l),i.onUnlisten(l,!0);case 1:return i.queries.delete(l),i.onUnlisten(l,!1);case 2:return i.onLastRemoteStoreUnlisten(l);default:return}}function WM(c,e){const i=Dn(c);let l=!1;for(const f of e){const v=f.query,y=i.queries.get(v);if(y){for(const h of y.Sa)h.Fa(f)&&(l=!0);y.wa=f}}l&&kb(i)}function KM(c,e,i){const l=Dn(c),f=l.queries.get(e);if(f)for(const v of f.Sa)v.onError(i);l.queries.delete(e)}function kb(c){c.Ca.forEach((e=>{e.next()}))}var D0,vw;(vw=D0||(D0={})).Ma="default",vw.Cache="cache";class pS{constructor(e,i,l){this.query=e,this.xa=i,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=l||{}}Fa(e){if(!this.options.includeMetadataChanges){const l=[];for(const f of e.docChanges)f.type!==3&&l.push(f);e=new im(e.query,e.docs,e.oldDocs,l,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),i=!0):this.La(e,this.onlineState)&&(this.ka(e),i=!0),this.Na=e,i}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let i=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),i=!0),i}La(e,i){if(!e.fromCache||!this.Da())return!0;const l=i!=="Offline";return(!this.options.qa||!l)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const i=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}ka(e){e=im.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==D0.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS{constructor(e){this.key=e}}class gS{constructor(e){this.key=e}}class XM{constructor(e,i){this.query=e,this.Ya=i,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Xn(),this.mutatedKeys=Xn(),this.eu=DT(e),this.tu=new Gp(this.eu)}get nu(){return this.Ya}ru(e,i){const l=i?i.iu:new _w,f=i?i.tu:this.tu;let v=i?i.mutatedKeys:this.mutatedKeys,y=f,h=!1;const M=this.query.limitType==="F"&&f.size===this.query.limit?f.last():null,O=this.query.limitType==="L"&&f.size===this.query.limit?f.first():null;if(e.inorderTraversal(((V,K)=>{const ee=f.get(V),Y=dv(this.query,K)?K:null,ve=!!ee&&this.mutatedKeys.has(ee.key),Ce=!!Y&&(Y.hasLocalMutations||this.mutatedKeys.has(Y.key)&&Y.hasCommittedMutations);let Ee=!1;ee&&Y?ee.data.isEqual(Y.data)?ve!==Ce&&(l.track({type:3,doc:Y}),Ee=!0):this.su(ee,Y)||(l.track({type:2,doc:Y}),Ee=!0,(M&&this.eu(Y,M)>0||O&&this.eu(Y,O)<0)&&(h=!0)):!ee&&Y?(l.track({type:0,doc:Y}),Ee=!0):ee&&!Y&&(l.track({type:1,doc:ee}),Ee=!0,(M||O)&&(h=!0)),Ee&&(Y?(y=y.add(Y),v=Ce?v.add(V):v.delete(V)):(y=y.delete(V),v=v.delete(V)))})),this.query.limit!==null)for(;y.size>this.query.limit;){const V=this.query.limitType==="F"?y.last():y.first();y=y.delete(V.key),v=v.delete(V.key),l.track({type:1,doc:V})}return{tu:y,iu:l,Cs:h,mutatedKeys:v}}su(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,l,f){const v=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const y=e.iu.ya();y.sort(((V,K)=>(function(Y,ve){const Ce=Ee=>{switch(Ee){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Sn(20277,{Rt:Ee})}};return Ce(Y)-Ce(ve)})(V.type,K.type)||this.eu(V.doc,K.doc))),this.ou(l),f=f??!1;const h=i&&!f?this._u():[],M=this.Xa.size===0&&this.current&&!f?1:0,O=M!==this.Za;return this.Za=M,y.length!==0||O?{snapshot:new im(this.query,e.tu,v,y,e.mutatedKeys,M===0,O,!1,!!l&&l.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new _w,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((i=>this.Ya=this.Ya.add(i))),e.modifiedDocuments.forEach((i=>{})),e.removedDocuments.forEach((i=>this.Ya=this.Ya.delete(i))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Xn(),this.tu.forEach((l=>{this.uu(l.key)&&(this.Xa=this.Xa.add(l.key))}));const i=[];return e.forEach((l=>{this.Xa.has(l)||i.push(new gS(l))})),this.Xa.forEach((l=>{e.has(l)||i.push(new mS(l))})),i}cu(e){this.Ya=e.Qs,this.Xa=Xn();const i=this.ru(e.documents);return this.applyChanges(i,!0)}lu(){return im.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Db="SyncEngine";class YM{constructor(e,i,l){this.query=e,this.targetId=i,this.view=l}}class QM{constructor(e){this.key=e,this.hu=!1}}class JM{constructor(e,i,l,f,v,y){this.localStore=e,this.remoteStore=i,this.eventManager=l,this.sharedClientState=f,this.currentUser=v,this.maxConcurrentLimboResolutions=y,this.Pu={},this.Tu=new qf((h=>kT(h)),hv),this.Iu=new Map,this.Eu=new Set,this.du=new Or(fn.comparator),this.Au=new Map,this.Ru=new wb,this.Vu={},this.mu=new Map,this.fu=nm.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function ek(c,e,i=!0){const l=wS(c);let f;const v=l.Tu.get(e);return v?(l.sharedClientState.addLocalQueryTarget(v.targetId),f=v.view.lu()):f=await _S(l,e,i,!0),f}async function tk(c,e){const i=wS(c);await _S(i,e,!0,!1)}async function _S(c,e,i,l){const f=await xM(c.localStore,fu(e)),v=f.targetId,y=c.sharedClientState.addLocalQueryTarget(v,i);let h;return l&&(h=await nk(c,e,v,y==="current",f.resumeToken)),c.isPrimaryClient&&i&&aS(c.remoteStore,f),h}async function nk(c,e,i,l,f){c.pu=(K,ee,Y)=>(async function(Ce,Ee,Je,je){let He=Ee.view.ru(Je);He.Cs&&(He=await hw(Ce.localStore,Ee.query,!1).then((({documents:Se})=>Ee.view.ru(Se,He))));const gt=je&&je.targetChanges.get(Ee.targetId),St=je&&je.targetMismatches.get(Ee.targetId)!=null,Pt=Ee.view.applyChanges(He,Ce.isPrimaryClient,gt,St);return xw(Ce,Ee.targetId,Pt.au),Pt.snapshot})(c,K,ee,Y);const v=await hw(c.localStore,e,!0),y=new XM(e,v.Qs),h=y.ru(v.documents),M=i_.createSynthesizedTargetChangeForCurrentChange(i,l&&c.onlineState!=="Offline",f),O=y.applyChanges(h,c.isPrimaryClient,M);xw(c,i,O.au);const V=new YM(e,i,y);return c.Tu.set(e,V),c.Iu.has(i)?c.Iu.get(i).push(e):c.Iu.set(i,[e]),O.snapshot}async function ik(c,e,i){const l=Dn(c),f=l.Tu.get(e),v=l.Iu.get(f.targetId);if(v.length>1)return l.Iu.set(f.targetId,v.filter((y=>!hv(y,e)))),void l.Tu.delete(e);l.isPrimaryClient?(l.sharedClientState.removeLocalQueryTarget(f.targetId),l.sharedClientState.isActiveQueryTarget(f.targetId)||await M0(l.localStore,f.targetId,!1).then((()=>{l.sharedClientState.clearQueryState(f.targetId),i&&Ab(l.remoteStore,f.targetId),O0(l,f.targetId)})).catch(dm)):(O0(l,f.targetId),await M0(l.localStore,f.targetId,!0))}async function rk(c,e){const i=Dn(c),l=i.Tu.get(e),f=i.Iu.get(l.targetId);i.isPrimaryClient&&f.length===1&&(i.sharedClientState.removeLocalQueryTarget(l.targetId),Ab(i.remoteStore,l.targetId))}async function sk(c,e,i){const l=dk(c);try{const f=await(function(y,h){const M=Dn(y),O=vr.now(),V=h.reduce(((Y,ve)=>Y.add(ve.key)),Xn());let K,ee;return M.persistence.runTransaction("Locally write mutations","readwrite",(Y=>{let ve=hh(),Ce=Xn();return M.Ns.getEntries(Y,V).next((Ee=>{ve=Ee,ve.forEach(((Je,je)=>{je.isValidDocument()||(Ce=Ce.add(Je))}))})).next((()=>M.localDocuments.getOverlayedDocuments(Y,ve))).next((Ee=>{K=Ee;const Je=[];for(const je of h){const He=bR(je,K.get(je.key).overlayedDocument);He!=null&&Je.push(new Ad(je.key,He,ET(He.value.mapValue),dl.exists(!0)))}return M.mutationQueue.addMutationBatch(Y,O,Je,h)})).next((Ee=>{ee=Ee;const Je=Ee.applyToLocalDocumentSet(K,Ce);return M.documentOverlayCache.saveOverlays(Y,Ee.batchId,Je)}))})).then((()=>({batchId:ee.batchId,changes:zT(K)})))})(l.localStore,e);l.sharedClientState.addPendingMutation(f.batchId),(function(y,h,M){let O=y.Vu[y.currentUser.toKey()];O||(O=new Or(Kn)),O=O.insert(h,M),y.Vu[y.currentUser.toKey()]=O})(l,f.batchId,i),await s_(l,f.changes),await yv(l.remoteStore)}catch(f){const v=Mb(f,"Failed to persist write");i.reject(v)}}async function yS(c,e){const i=Dn(c);try{const l=await yM(i.localStore,e);e.targetChanges.forEach(((f,v)=>{const y=i.Au.get(v);y&&(Li(f.addedDocuments.size+f.modifiedDocuments.size+f.removedDocuments.size<=1,22616),f.addedDocuments.size>0?y.hu=!0:f.modifiedDocuments.size>0?Li(y.hu,14607):f.removedDocuments.size>0&&(Li(y.hu,42227),y.hu=!1))})),await s_(i,l,e)}catch(l){await dm(l)}}function bw(c,e,i){const l=Dn(c);if(l.isPrimaryClient&&i===0||!l.isPrimaryClient&&i===1){const f=[];l.Tu.forEach(((v,y)=>{const h=y.view.va(e);h.snapshot&&f.push(h.snapshot)})),(function(y,h){const M=Dn(y);M.onlineState=h;let O=!1;M.queries.forEach(((V,K)=>{for(const ee of K.Sa)ee.va(h)&&(O=!0)})),O&&kb(M)})(l.eventManager,e),f.length&&l.Pu.H_(f),l.onlineState=e,l.isPrimaryClient&&l.sharedClientState.setOnlineState(e)}}async function ak(c,e,i){const l=Dn(c);l.sharedClientState.updateQueryState(e,"rejected",i);const f=l.Au.get(e),v=f&&f.key;if(v){let y=new Or(fn.comparator);y=y.insert(v,za.newNoDocument(v,Rn.min()));const h=Xn().add(v),M=new mv(Rn.min(),new Map,new Or(Kn),y,h);await yS(l,M),l.du=l.du.remove(v),l.Au.delete(e),Ob(l)}else await M0(l.localStore,e,!1).then((()=>O0(l,e,i))).catch(dm)}async function ok(c,e){const i=Dn(c),l=e.batch.batchId;try{const f=await _M(i.localStore,e);bS(i,l,null),vS(i,l),i.sharedClientState.updateMutationState(l,"acknowledged"),await s_(i,f)}catch(f){await dm(f)}}async function lk(c,e,i){const l=Dn(c);try{const f=await(function(y,h){const M=Dn(y);return M.persistence.runTransaction("Reject batch","readwrite-primary",(O=>{let V;return M.mutationQueue.lookupMutationBatch(O,h).next((K=>(Li(K!==null,37113),V=K.keys(),M.mutationQueue.removeMutationBatch(O,K)))).next((()=>M.mutationQueue.performConsistencyCheck(O))).next((()=>M.documentOverlayCache.removeOverlaysForBatchId(O,V,h))).next((()=>M.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(O,V))).next((()=>M.localDocuments.getDocuments(O,V)))}))})(l.localStore,e);bS(l,e,i),vS(l,e),l.sharedClientState.updateMutationState(e,"rejected",i),await s_(l,f)}catch(f){await dm(f)}}function vS(c,e){(c.mu.get(e)||[]).forEach((i=>{i.resolve()})),c.mu.delete(e)}function bS(c,e,i){const l=Dn(c);let f=l.Vu[l.currentUser.toKey()];if(f){const v=f.get(e);v&&(i?v.reject(i):v.resolve(),f=f.remove(e)),l.Vu[l.currentUser.toKey()]=f}}function O0(c,e,i=null){c.sharedClientState.removeLocalQueryTarget(e);for(const l of c.Iu.get(e))c.Tu.delete(l),i&&c.Pu.yu(l,i);c.Iu.delete(e),c.isPrimaryClient&&c.Ru.jr(e).forEach((l=>{c.Ru.containsKey(l)||xS(c,l)}))}function xS(c,e){c.Eu.delete(e.path.canonicalString());const i=c.du.get(e);i!==null&&(Ab(c.remoteStore,i),c.du=c.du.remove(e),c.Au.delete(i),Ob(c))}function xw(c,e,i){for(const l of i)l instanceof mS?(c.Ru.addReference(l.key,e),ck(c,l)):l instanceof gS?($t(Db,"Document no longer in limbo: "+l.key),c.Ru.removeReference(l.key,e),c.Ru.containsKey(l.key)||xS(c,l.key)):Sn(19791,{wu:l})}function ck(c,e){const i=e.key,l=i.path.canonicalString();c.du.get(i)||c.Eu.has(l)||($t(Db,"New document in limbo: "+i),c.Eu.add(l),Ob(c))}function Ob(c){for(;c.Eu.size>0&&c.du.size<c.maxConcurrentLimboResolutions;){const e=c.Eu.values().next().value;c.Eu.delete(e);const i=new fn(yr.fromString(e)),l=c.fu.next();c.Au.set(l,new QM(i)),c.du=c.du.insert(i,l),aS(c.remoteStore,new dd(fu(gb(i.path)),l,"TargetPurposeLimboResolution",ov.ce))}}async function s_(c,e,i){const l=Dn(c),f=[],v=[],y=[];l.Tu.isEmpty()||(l.Tu.forEach(((h,M)=>{y.push(l.pu(M,e,i).then((O=>{if((O||i)&&l.isPrimaryClient){const V=O?!O.fromCache:i?.targetChanges.get(M.targetId)?.current;l.sharedClientState.updateQueryState(M.targetId,V?"current":"not-current")}if(O){f.push(O);const V=Sb.As(M.targetId,O);v.push(V)}})))})),await Promise.all(y),l.Pu.H_(f),await(async function(M,O){const V=Dn(M);try{await V.persistence.runTransaction("notifyLocalViewChanges","readwrite",(K=>_t.forEach(O,(ee=>_t.forEach(ee.Es,(Y=>V.persistence.referenceDelegate.addReference(K,ee.targetId,Y))).next((()=>_t.forEach(ee.ds,(Y=>V.persistence.referenceDelegate.removeReference(K,ee.targetId,Y)))))))))}catch(K){if(!fm(K))throw K;$t(Eb,"Failed to update sequence numbers: "+K)}for(const K of O){const ee=K.targetId;if(!K.fromCache){const Y=V.Ms.get(ee),ve=Y.snapshotVersion,Ce=Y.withLastLimboFreeSnapshotVersion(ve);V.Ms=V.Ms.insert(ee,Ce)}}})(l.localStore,v))}async function uk(c,e){const i=Dn(c);if(!i.currentUser.isEqual(e)){$t(Db,"User change. New user:",e.toKey());const l=await nS(i.localStore,e);i.currentUser=e,(function(v,y){v.mu.forEach((h=>{h.forEach((M=>{M.reject(new Jt(vt.CANCELLED,y))}))})),v.mu.clear()})(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,l.removedBatchIds,l.addedBatchIds),await s_(i,l.Ls)}}function hk(c,e){const i=Dn(c),l=i.Au.get(e);if(l&&l.hu)return Xn().add(l.key);{let f=Xn();const v=i.Iu.get(e);if(!v)return f;for(const y of v){const h=i.Tu.get(y);f=f.unionWith(h.view.nu)}return f}}function wS(c){const e=Dn(c);return e.remoteStore.remoteSyncer.applyRemoteEvent=yS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hk.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ak.bind(null,e),e.Pu.H_=WM.bind(null,e.eventManager),e.Pu.yu=KM.bind(null,e.eventManager),e}function dk(c){const e=Dn(c);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ok.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=lk.bind(null,e),e}class Hy{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=gv(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,i){return null}Mu(e,i){return null}vu(e){return gM(this.persistence,new fM,e.initialUser,this.serializer)}Cu(e){return new tS(Tb.mi,this.serializer)}Du(e){return new TM}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Hy.provider={build:()=>new Hy};class fk extends Hy{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,i){Li(this.persistence.referenceDelegate instanceof qy,46915);const l=this.persistence.referenceDelegate.garbageCollector;return new QR(l,e.asyncQueue,i)}Cu(e){const i=this.cacheSizeBytes!==void 0?Lo.withCacheSize(this.cacheSizeBytes):Lo.DEFAULT;return new tS((l=>qy.mi(l,i)),this.serializer)}}class z0{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=l=>bw(this.syncEngine,l,1),this.remoteStore.remoteSyncer.handleCredentialChange=uk.bind(null,this.syncEngine),await GM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new ZM})()}createDatastore(e){const i=gv(e.databaseInfo.databaseId),l=(function(v){return new CM(v)})(e.databaseInfo);return(function(v,y,h,M){return new kM(v,y,h,M)})(e.authCredentials,e.appCheckCredentials,l,i)}createRemoteStore(e){return(function(l,f,v,y,h){return new OM(l,f,v,y,h)})(this.localStore,this.datastore,e.asyncQueue,(i=>bw(this.syncEngine,i,0)),(function(){return pw.v()?new pw:new SM})())}createSyncEngine(e,i){return(function(f,v,y,h,M,O,V){const K=new JM(f,v,y,h,M,O);return V&&(K.gu=!0),K})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){await(async function(i){const l=Dn(i);$t(jf,"RemoteStore shutting down."),l.Ea.add(5),await r_(l),l.Aa.shutdown(),l.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}z0.provider={build:()=>new z0};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TS{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):uh("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,i){setTimeout((()=>{this.muted||e(i)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sd="FirestoreClient";class pk{constructor(e,i,l,f,v){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=l,this.databaseInfo=f,this.user=Oa.UNAUTHENTICATED,this.clientId=cb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=v,this.authCredentials.start(l,(async y=>{$t(Sd,"Received user=",y.uid),await this.authCredentialListener(y),this.user=y})),this.appCheckCredentials.start(l,(y=>($t(Sd,"Received new app check token=",y),this.appCheckCredentialListener(y,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new _d;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const l=Mb(i,"Failed to shutdown persistence");e.reject(l)}})),e.promise}}async function e0(c,e){c.asyncQueue.verifyOperationInProgress(),$t(Sd,"Initializing OfflineComponentProvider");const i=c.configuration;await e.initialize(i);let l=i.initialUser;c.setCredentialChangeListener((async f=>{l.isEqual(f)||(await nS(e.localStore,f),l=f)})),e.persistence.setDatabaseDeletedListener((()=>c.terminate())),c._offlineComponents=e}async function ww(c,e){c.asyncQueue.verifyOperationInProgress();const i=await mk(c);$t(Sd,"Initializing OnlineComponentProvider"),await e.initialize(i,c.configuration),c.setCredentialChangeListener((l=>gw(e.remoteStore,l))),c.setAppCheckTokenChangeListener(((l,f)=>gw(e.remoteStore,f))),c._onlineComponents=e}async function mk(c){if(!c._offlineComponents)if(c._uninitializedComponentsProvider){$t(Sd,"Using user provided OfflineComponentProvider");try{await e0(c,c._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!(function(f){return f.name==="FirebaseError"?f.code===vt.FAILED_PRECONDITION||f.code===vt.UNIMPLEMENTED:!(typeof DOMException<"u"&&f instanceof DOMException)||f.code===22||f.code===20||f.code===11})(i))throw i;Qp("Error using user provided cache. Falling back to memory cache: "+i),await e0(c,new Hy)}}else $t(Sd,"Using default OfflineComponentProvider"),await e0(c,new fk(void 0));return c._offlineComponents}async function SS(c){return c._onlineComponents||(c._uninitializedComponentsProvider?($t(Sd,"Using user provided OnlineComponentProvider"),await ww(c,c._uninitializedComponentsProvider._online)):($t(Sd,"Using default OnlineComponentProvider"),await ww(c,new z0))),c._onlineComponents}function gk(c){return SS(c).then((e=>e.syncEngine))}async function L0(c){const e=await SS(c),i=e.eventManager;return i.onListen=ek.bind(null,e.syncEngine),i.onUnlisten=ik.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=tk.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=rk.bind(null,e.syncEngine),i}function _k(c,e,i={}){const l=new _d;return c.asyncQueue.enqueueAndForget((async()=>(function(v,y,h,M,O){const V=new TS({next:ee=>{V.Nu(),y.enqueueAndForget((()=>fS(v,K))),ee.fromCache&&M.source==="server"?O.reject(new Jt(vt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):O.resolve(ee)},error:ee=>O.reject(ee)}),K=new pS(h,V,{includeMetadataChanges:!0,qa:!0});return dS(v,K)})(await L0(c),c.asyncQueue,e,i,l))),l.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ES(c){const e={};return c.timeoutSeconds!==void 0&&(e.timeoutSeconds=c.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tw=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AS="firestore.googleapis.com",Sw=!0;class Ew{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Jt(vt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=AS,this.ssl=Sw}else this.host=e.host,this.ssl=e.ssl??Sw;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=eS;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<XR)throw new Jt(vt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}kP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ES(e.experimentalLongPollingOptions??{}),(function(l){if(l.timeoutSeconds!==void 0){if(isNaN(l.timeoutSeconds))throw new Jt(vt.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (must not be NaN)`);if(l.timeoutSeconds<5)throw new Jt(vt.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (minimum allowed value is 5)`);if(l.timeoutSeconds>30)throw new Jt(vt.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(l,f){return l.timeoutSeconds===f.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class vv{constructor(e,i,l,f){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=l,this._app=f,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ew({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Jt(vt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Jt(vt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ew(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(l){if(!l)return new wP;switch(l.type){case"firstParty":return new AP(l.sessionIndex||"0",l.iamToken||null,l.authTokenFactory||null);case"provider":return l.client;default:throw new Jt(vt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(i){const l=Tw.get(i);l&&($t("ComponentProvider","Removing Datastore"),Tw.delete(i),l.terminate())})(this),Promise.resolve()}}function yk(c,e,i,l={}){c=Ac(c,vv);const f=cm(e),v=c._getSettings(),y={...v,emulatorOptions:c._getEmulatorOptions()},h=`${e}:${i}`;f&&(Q1(`https://${h}`),J1("Firestore",!0)),v.host!==AS&&v.host!==h&&Qp("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const M={...v,host:h,ssl:f,emulatorOptions:l};if(!Nf(M,y)&&(c._setSettings(M),l.mockUserToken)){let O,V;if(typeof l.mockUserToken=="string")O=l.mockUserToken,V=Oa.MOCK_USER;else{O=KI(l.mockUserToken,c._app?.options.projectId);const K=l.mockUserToken.sub||l.mockUserToken.user_id;if(!K)throw new Jt(vt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");V=new Oa(K)}c._authCredentials=new TP(new fT(O,V))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(e,i,l){this.converter=i,this._query=l,this.type="query",this.firestore=e}withConverter(e){return new a_(this.firestore,e,this._query)}}class ms{constructor(e,i,l){this.converter=i,this._key=l,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ms(this.firestore,e,this._key)}toJSON(){return{type:ms._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,i,l){if(t_(i,ms._jsonSchema))return new ms(e,l||null,new fn(yr.fromString(i.referencePath)))}}ms._jsonSchemaVersion="firestore/documentReference/1.0",ms._jsonSchema={type:ps("string",ms._jsonSchemaVersion),referencePath:ps("string")};class yd extends a_{constructor(e,i,l){super(e,i,gb(l)),this._path=l,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ms(this.firestore,null,new fn(e))}withConverter(e){return new yd(this.firestore,e,this._path)}}function IS(c,e,...i){if(c=va(c),pT("collection","path",e),c instanceof vv){const l=yr.fromString(e,...i);return Vx(l),new yd(c,null,l)}{if(!(c instanceof ms||c instanceof yd))throw new Jt(vt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const l=c._path.child(yr.fromString(e,...i));return Vx(l),new yd(c.firestore,null,l)}}function zb(c,e,...i){if(c=va(c),arguments.length===1&&(e=cb.newId()),pT("doc","path",e),c instanceof vv){const l=yr.fromString(e,...i);return Bx(l),new ms(c,null,new fn(l))}{if(!(c instanceof ms||c instanceof yd))throw new Jt(vt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const l=c._path.child(yr.fromString(e,...i));return Bx(l),new ms(c.firestore,c instanceof yd?c.converter:null,new fn(l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aw="AsyncQueue";class Iw{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new rS(this,"async_queue_retry"),this._c=()=>{const l=Jv();l&&$t(Aw,"Visibility state changed to "+l.visibilityState),this.M_.w_()},this.ac=e;const i=Jv();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const i=Jv();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const i=new _d;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(i.resolve,i.reject),i.promise))).then((()=>i.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!fm(e))throw e;$t(Aw,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const i=this.ac.then((()=>(this.rc=!0,e().catch((l=>{throw this.nc=l,this.rc=!1,uh("INTERNAL UNHANDLED ERROR: ",Cw(l)),l})).then((l=>(this.rc=!1,l))))));return this.ac=i,i}enqueueAfterDelay(e,i,l){this.uc(),this.oc.indexOf(e)>-1&&(i=0);const f=Rb.createAndSchedule(this,e,i,l,(v=>this.hc(v)));return this.tc.push(f),f}uc(){this.nc&&Sn(47125,{Pc:Cw(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const i of this.tc)if(i.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((i,l)=>i.targetTimeMs-l.targetTimeMs));for(const i of this.tc)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const i=this.tc.indexOf(e);this.tc.splice(i,1)}}function Cw(c){let e=c.message||"";return c.stack&&(e=c.stack.includes(c.message)?c.stack:c.message+`
`+c.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pw(c){return(function(i,l){if(typeof i!="object"||i===null)return!1;const f=i;for(const v of l)if(v in f&&typeof f[v]=="function")return!0;return!1})(c,["next","error","complete"])}class Uf extends vv{constructor(e,i,l,f){super(e,i,l,f),this.type="firestore",this._queue=new Iw,this._persistenceKey=f?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Iw(e),this._firestoreClient=void 0,await e}}}function vk(c,e){const i=typeof c=="object"?c:iT(),l=typeof c=="string"?c:By,f=ob(i,"firestore").getImmediate({identifier:l});if(!f._initialized){const v=ZI("firestore");v&&yk(f,...v)}return f}function bv(c){if(c._terminated)throw new Jt(vt.FAILED_PRECONDITION,"The client has already been terminated.");return c._firestoreClient||bk(c),c._firestoreClient}function bk(c){const e=c._freezeSettings(),i=(function(f,v,y,h){return new $P(f,v,y,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,ES(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(c._databaseId,c._app?.options.appId||"",c._persistenceKey,e);c._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(c._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),c._firestoreClient=new pk(c._authCredentials,c._appCheckCredentials,c._queue,i,c._componentsProvider&&(function(f){const v=f?._online.build();return{_offline:f?._offline.build(v),_online:v}})(c._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new jl(ba.fromBase64String(e))}catch(i){throw new Jt(vt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new jl(ba.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:jl._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(t_(e,jl._jsonSchema))return jl.fromBase64String(e.bytes)}}jl._jsonSchemaVersion="firestore/bytes/1.0",jl._jsonSchema={type:ps("string",jl._jsonSchemaVersion),bytes:ps("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o_{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new Jt(vt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ya(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Jt(vt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Jt(vt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Kn(this._lat,e._lat)||Kn(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ic._jsonSchemaVersion}}static fromJSON(e){if(t_(e,Ic._jsonSchema))return new Ic(e.latitude,e.longitude)}}Ic._jsonSchemaVersion="firestore/geoPoint/1.0",Ic._jsonSchema={type:ps("string",Ic._jsonSchemaVersion),latitude:ps("number"),longitude:ps("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu{constructor(e){this._values=(e||[]).map((i=>i))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(l,f){if(l.length!==f.length)return!1;for(let v=0;v<l.length;++v)if(l[v]!==f[v])return!1;return!0})(this._values,e._values)}toJSON(){return{type:mu._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(t_(e,mu._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((i=>typeof i=="number")))return new mu(e.vectorValues);throw new Jt(vt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}mu._jsonSchemaVersion="firestore/vectorValue/1.0",mu._jsonSchema={type:ps("string",mu._jsonSchemaVersion),vectorValues:ps("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xk=/^__.*__$/;class wk{constructor(e,i,l){this.data=e,this.fieldMask=i,this.fieldTransforms=l}toMutation(e,i){return this.fieldMask!==null?new Ad(e,this.data,this.fieldMask,i,this.fieldTransforms):new n_(e,this.data,i,this.fieldTransforms)}}class CS{constructor(e,i,l){this.data=e,this.fieldMask=i,this.fieldTransforms=l}toMutation(e,i){return new Ad(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function PS(c){switch(c){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Sn(40011,{Ac:c})}}class Lb{constructor(e,i,l,f,v,y){this.settings=e,this.databaseId=i,this.serializer=l,this.ignoreUndefinedProperties=f,v===void 0&&this.Rc(),this.fieldTransforms=v||[],this.fieldMask=y||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Lb({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const i=this.path?.child(e),l=this.Vc({path:i,fc:!1});return l.gc(e),l}yc(e){const i=this.path?.child(e),l=this.Vc({path:i,fc:!1});return l.Rc(),l}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Zy(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((i=>e.isPrefixOf(i)))!==void 0||this.fieldTransforms.find((i=>e.isPrefixOf(i.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(PS(this.Ac)&&xk.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Tk{constructor(e,i,l){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=l||gv(e)}Cc(e,i,l,f=!1){return new Lb({Ac:e,methodName:i,Dc:l,path:ya.emptyPath(),fc:!1,bc:f},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Nb(c){const e=c._freezeSettings(),i=gv(c._databaseId);return new Tk(c._databaseId,!!e.ignoreUndefinedProperties,i)}function RS(c,e,i,l,f,v={}){const y=c.Cc(v.merge||v.mergeFields?2:0,e,i,f);Vb("Data must be an object, but it was:",y,l);const h=DS(l,y);let M,O;if(v.merge)M=new hl(y.fieldMask),O=y.fieldTransforms;else if(v.mergeFields){const V=[];for(const K of v.mergeFields){const ee=N0(e,K,i);if(!y.contains(ee))throw new Jt(vt.INVALID_ARGUMENT,`Field '${ee}' is specified in your field mask but missing from your input data.`);zS(V,ee)||V.push(ee)}M=new hl(V),O=y.fieldTransforms.filter((K=>M.covers(K.field)))}else M=null,O=y.fieldTransforms;return new wk(new No(h),M,O)}class wv extends xv{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof wv}}class Bb extends xv{_toFieldTransform(e){return new gR(e.path,new qg)}isEqual(e){return e instanceof Bb}}function MS(c,e,i,l){const f=c.Cc(1,e,i);Vb("Data must be an object, but it was:",f,l);const v=[],y=No.empty();Ed(l,((M,O)=>{const V=jb(e,M,i);O=va(O);const K=f.yc(V);if(O instanceof wv)v.push(V);else{const ee=Tv(O,K);ee!=null&&(v.push(V),y.set(V,ee))}}));const h=new hl(v);return new CS(y,h,f.fieldTransforms)}function kS(c,e,i,l,f,v){const y=c.Cc(1,e,i),h=[N0(e,l,i)],M=[f];if(v.length%2!=0)throw new Jt(vt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let ee=0;ee<v.length;ee+=2)h.push(N0(e,v[ee])),M.push(v[ee+1]);const O=[],V=No.empty();for(let ee=h.length-1;ee>=0;--ee)if(!zS(O,h[ee])){const Y=h[ee];let ve=M[ee];ve=va(ve);const Ce=y.yc(Y);if(ve instanceof wv)O.push(Y);else{const Ee=Tv(ve,Ce);Ee!=null&&(O.push(Y),V.set(Y,Ee))}}const K=new hl(O);return new CS(V,K,y.fieldTransforms)}function Tv(c,e){if(OS(c=va(c)))return Vb("Unsupported field value:",e,c),DS(c,e);if(c instanceof xv)return(function(l,f){if(!PS(f.Ac))throw f.Sc(`${l._methodName}() can only be used with update() and set()`);if(!f.path)throw f.Sc(`${l._methodName}() is not currently supported inside arrays`);const v=l._toFieldTransform(f);v&&f.fieldTransforms.push(v)})(c,e),null;if(c===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),c instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(l,f){const v=[];let y=0;for(const h of l){let M=Tv(h,f.wc(y));M==null&&(M={nullValue:"NULL_VALUE"}),v.push(M),y++}return{arrayValue:{values:v}}})(c,e)}return(function(l,f){if((l=va(l))===null)return{nullValue:"NULL_VALUE"};if(typeof l=="number")return fR(f.serializer,l);if(typeof l=="boolean")return{booleanValue:l};if(typeof l=="string")return{stringValue:l};if(l instanceof Date){const v=vr.fromDate(l);return{timestampValue:$y(f.serializer,v)}}if(l instanceof vr){const v=new vr(l.seconds,1e3*Math.floor(l.nanoseconds/1e3));return{timestampValue:$y(f.serializer,v)}}if(l instanceof Ic)return{geoPointValue:{latitude:l.latitude,longitude:l.longitude}};if(l instanceof jl)return{bytesValue:ZT(f.serializer,l._byteString)};if(l instanceof ms){const v=f.databaseId,y=l.firestore._databaseId;if(!y.isEqual(v))throw f.Sc(`Document reference is for database ${y.projectId}/${y.database} but should be for database ${v.projectId}/${v.database}`);return{referenceValue:xb(l.firestore._databaseId||f.databaseId,l._key.path)}}if(l instanceof mu)return(function(y,h){return{mapValue:{fields:{[TT]:{stringValue:ST},[Vy]:{arrayValue:{values:y.toArray().map((O=>{if(typeof O!="number")throw h.Sc("VectorValues must only contain numeric values.");return _b(h.serializer,O)}))}}}}}})(l,f);throw f.Sc(`Unsupported field value: ${ub(l)}`)})(c,e)}function DS(c,e){const i={};return _T(c)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ed(c,((l,f)=>{const v=Tv(f,e.mc(l));v!=null&&(i[l]=v)})),{mapValue:{fields:i}}}function OS(c){return!(typeof c!="object"||c===null||c instanceof Array||c instanceof Date||c instanceof vr||c instanceof Ic||c instanceof jl||c instanceof ms||c instanceof xv||c instanceof mu)}function Vb(c,e,i){if(!OS(i)||!mT(i)){const l=ub(i);throw l==="an object"?e.Sc(c+" a custom object"):e.Sc(c+" "+l)}}function N0(c,e,i){if((e=va(e))instanceof o_)return e._internalPath;if(typeof e=="string")return jb(c,e);throw Zy("Field path arguments must be of type string or ",c,!1,void 0,i)}const Sk=new RegExp("[~\\*/\\[\\]]");function jb(c,e,i){if(e.search(Sk)>=0)throw Zy(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,c,!1,void 0,i);try{return new o_(...e.split("."))._internalPath}catch{throw Zy(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,c,!1,void 0,i)}}function Zy(c,e,i,l,f){const v=l&&!l.isEmpty(),y=f!==void 0;let h=`Function ${e}() called with invalid data`;i&&(h+=" (via `toFirestore()`)"),h+=". ";let M="";return(v||y)&&(M+=" (found",v&&(M+=` in field ${l}`),y&&(M+=` in document ${f}`),M+=")"),new Jt(vt.INVALID_ARGUMENT,h+c+M)}function zS(c,e){return c.some((i=>i.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS{constructor(e,i,l,f,v){this._firestore=e,this._userDataWriter=i,this._key=l,this._document=f,this._converter=v}get id(){return this._key.path.lastSegment()}get ref(){return new ms(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Ek(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(NS("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class Ek extends LS{data(){return super.data()}}function NS(c,e){return typeof e=="string"?jb(c,e):e instanceof o_?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BS(c){if(c.limitType==="L"&&c.explicitOrderBy.length===0)throw new Jt(vt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ak{convertValue(e,i="none"){switch(wd(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Xr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(xd(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Sn(62114,{value:e})}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const l={};return Ed(e,((f,v)=>{l[f]=this.convertValue(v,i)})),l}convertVectorValue(e){const i=e.fields?.[Vy].arrayValue?.values?.map((l=>Xr(l.doubleValue)));return new mu(i)}convertGeoPoint(e){return new Ic(Xr(e.latitude),Xr(e.longitude))}convertArray(e,i){return(e.values||[]).map((l=>this.convertValue(l,i)))}convertServerTimestamp(e,i){switch(i){case"previous":const l=cv(e);return l==null?null:this.convertValue(l,i);case"estimate":return this.convertTimestamp(Ug(e));default:return null}}convertTimestamp(e){const i=bd(e);return new vr(i.seconds,i.nanos)}convertDocumentKey(e,i){const l=yr.fromString(e);Li(JT(l),9688,{name:e});const f=new Fg(l.get(1),l.get(3)),v=new fn(l.popFirst(5));return f.isEqual(i)||uh(`Document ${v} contains a document reference within a different database (${f.projectId}/${f.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VS(c,e,i){let l;return l=c?i&&(i.merge||i.mergeFields)?c.toFirestore(e,i):c.toFirestore(e):e,l}class Ag{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Of extends LS{constructor(e,i,l,f,v,y){super(e,i,l,f,y),this._firestore=e,this._firestoreImpl=e,this.metadata=v}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new Cy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const l=this._document.data.field(NS("DocumentSnapshot.get",e));if(l!==null)return this._userDataWriter.convertValue(l,i.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Jt(vt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,i={};return i.type=Of._jsonSchemaVersion,i.bundle="",i.bundleSource="DocumentSnapshot",i.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?i:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),i.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),i)}}Of._jsonSchemaVersion="firestore/documentSnapshot/1.0",Of._jsonSchema={type:ps("string",Of._jsonSchemaVersion),bundleSource:ps("string","DocumentSnapshot"),bundleName:ps("string"),bundle:ps("string")};class Cy extends Of{data(e={}){return super.data(e)}}class zf{constructor(e,i,l,f){this._firestore=e,this._userDataWriter=i,this._snapshot=f,this.metadata=new Ag(f.hasPendingWrites,f.fromCache),this.query=l}get docs(){const e=[];return this.forEach((i=>e.push(i))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach((l=>{e.call(i,new Cy(this._firestore,this._userDataWriter,l.key,l,new Ag(this._snapshot.mutatedKeys.has(l.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Jt(vt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=(function(f,v){if(f._snapshot.oldDocs.isEmpty()){let y=0;return f._snapshot.docChanges.map((h=>{const M=new Cy(f._firestore,f._userDataWriter,h.doc.key,h.doc,new Ag(f._snapshot.mutatedKeys.has(h.doc.key),f._snapshot.fromCache),f.query.converter);return h.doc,{type:"added",doc:M,oldIndex:-1,newIndex:y++}}))}{let y=f._snapshot.oldDocs;return f._snapshot.docChanges.filter((h=>v||h.type!==3)).map((h=>{const M=new Cy(f._firestore,f._userDataWriter,h.doc.key,h.doc,new Ag(f._snapshot.mutatedKeys.has(h.doc.key),f._snapshot.fromCache),f.query.converter);let O=-1,V=-1;return h.type!==0&&(O=y.indexOf(h.doc.key),y=y.delete(h.doc.key)),h.type!==1&&(y=y.add(h.doc),V=y.indexOf(h.doc.key)),{type:Ik(h.type),doc:M,oldIndex:O,newIndex:V}}))}})(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Jt(vt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=zf._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=cb.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const i=[],l=[],f=[];return this.docs.forEach((v=>{v._document!==null&&(i.push(v._document),l.push(this._userDataWriter.convertObjectMap(v._document.data.value.mapValue.fields,"previous")),f.push(v.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Ik(c){switch(c){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Sn(61501,{type:c})}}zf._jsonSchemaVersion="firestore/querySnapshot/1.0",zf._jsonSchema={type:ps("string",zf._jsonSchemaVersion),bundleSource:ps("string","QuerySnapshot"),bundleName:ps("string"),bundle:ps("string")};class Ub extends Ak{constructor(e){super(),this.firestore=e}convertBytes(e){return new jl(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new ms(this.firestore,null,i)}}function Ck(c){c=Ac(c,a_);const e=Ac(c.firestore,Uf),i=bv(e),l=new Ub(e);return BS(c._query),_k(i,c._query).then((f=>new zf(e,l,c,f)))}function jS(c,e,i){c=Ac(c,ms);const l=Ac(c.firestore,Uf),f=VS(c.converter,e,i);return Fb(l,[RS(Nb(l),"setDoc",c._key,f,c.converter!==null,i).toMutation(c._key,dl.none())])}function Pk(c,e,i,...l){c=Ac(c,ms);const f=Ac(c.firestore,Uf),v=Nb(f);let y;return y=typeof(e=va(e))=="string"||e instanceof o_?kS(v,"updateDoc",c._key,e,i,l):MS(v,"updateDoc",c._key,e),Fb(f,[y.toMutation(c._key,dl.exists(!0))])}function Rk(c,...e){c=va(c);let i={includeMetadataChanges:!1,source:"default"},l=0;typeof e[l]!="object"||Pw(e[l])||(i=e[l++]);const f={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Pw(e[l])){const M=e[l];e[l]=M.next?.bind(M),e[l+1]=M.error?.bind(M),e[l+2]=M.complete?.bind(M)}let v,y,h;if(c instanceof ms)y=Ac(c.firestore,Uf),h=gb(c._key.path),v={next:M=>{e[l]&&e[l](Mk(y,c,M))},error:e[l+1],complete:e[l+2]};else{const M=Ac(c,a_);y=Ac(M.firestore,Uf),h=M._query;const O=new Ub(y);v={next:V=>{e[l]&&e[l](new zf(y,O,M,V))},error:e[l+1],complete:e[l+2]},BS(c._query)}return(function(O,V,K,ee){const Y=new TS(ee),ve=new pS(V,Y,K);return O.asyncQueue.enqueueAndForget((async()=>dS(await L0(O),ve))),()=>{Y.Nu(),O.asyncQueue.enqueueAndForget((async()=>fS(await L0(O),ve)))}})(bv(y),h,f,v)}function Fb(c,e){return(function(l,f){const v=new _d;return l.asyncQueue.enqueueAndForget((async()=>sk(await gk(l),f,v))),v.promise})(bv(c),e)}function Mk(c,e,i){const l=i.docs.get(e._key),f=new Ub(c);return new Of(c,f,e._key,l,new Ag(i.hasPendingWrites,i.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk{constructor(e,i){this._firestore=e,this._commitHandler=i,this._mutations=[],this._committed=!1,this._dataReader=Nb(e)}set(e,i,l){this._verifyNotCommitted();const f=t0(e,this._firestore),v=VS(f.converter,i,l),y=RS(this._dataReader,"WriteBatch.set",f._key,v,f.converter!==null,l);return this._mutations.push(y.toMutation(f._key,dl.none())),this}update(e,i,l,...f){this._verifyNotCommitted();const v=t0(e,this._firestore);let y;return y=typeof(i=va(i))=="string"||i instanceof o_?kS(this._dataReader,"WriteBatch.update",v._key,i,l,f):MS(this._dataReader,"WriteBatch.update",v._key,i),this._mutations.push(y.toMutation(v._key,dl.exists(!0))),this}delete(e){this._verifyNotCommitted();const i=t0(e,this._firestore);return this._mutations=this._mutations.concat(new yb(i._key,dl.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Jt(vt.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function t0(c,e){if((c=va(c)).firestore!==e)throw new Jt(vt.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return c}function Dk(){return new Bb("serverTimestamp")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ok(c){return bv(c=Ac(c,Uf)),new kk(c,(e=>Fb(c,e)))}(function(e,i=!0){(function(f){hm=f})(um),Yp(new Bf("firestore",((l,{instanceIdentifier:f,options:v})=>{const y=l.getProvider("app").getImmediate(),h=new Uf(new SP(l.getProvider("auth-internal")),new IP(y,l.getProvider("app-check-internal")),(function(O,V){if(!Object.prototype.hasOwnProperty.apply(O.options,["projectId"]))throw new Jt(vt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fg(O.options.projectId,V)})(y,f),y);return v={useFetchStreams:i,...v},h._setSettings(v),h}),"PUBLIC").setMultipleInstances(!0)),md(Ox,zx,e),md(Ox,zx,"esm2020")})();var zk="firebase",Lk="12.3.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */md(zk,Lk,"app");function US(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Nk=US,FS=new Jg("auth","Firebase",US());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy=new sb("@firebase/auth");function Bk(c,...e){Wy.logLevel<=Wn.WARN&&Wy.warn(`Auth (${um}): ${c}`,...e)}function Py(c,...e){Wy.logLevel<=Wn.ERROR&&Wy.error(`Auth (${um}): ${c}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dh(c,...e){throw $b(c,...e)}function gu(c,...e){return $b(c,...e)}function $S(c,e,i){const l={...Nk(),[e]:i};return new Jg("auth","Firebase",l).create(e,{appName:c.name})}function Lf(c){return $S(c,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function $b(c,...e){if(typeof c!="string"){const i=e[0],l=[...e.slice(1)];return l[0]&&(l[0].appName=c.name),c._errorFactory.create(i,...l)}return FS.create(c,...e)}function En(c,e,...i){if(!c)throw $b(e,...i)}function sh(c){const e="INTERNAL ASSERTION FAILED: "+c;throw Py(e),new Error(e)}function fh(c,e){c||sh(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B0(){return typeof self<"u"&&self.location?.href||""}function Vk(){return Rw()==="http:"||Rw()==="https:"}function Rw(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Vk()||tC()||"connection"in navigator)?navigator.onLine:!0}function Uk(){if(typeof navigator>"u")return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l_{constructor(e,i){this.shortDelay=e,this.longDelay=i,fh(i>e,"Short delay should be less than long delay!"),this.isMobile=QI()||nC()}get(){return jk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qb(c,e){fh(c.emulator,"Emulator should always be set here");const{url:i}=c.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qS{static initialize(e,i,l){this.fetchImpl=e,i&&(this.headersImpl=i),l&&(this.responseImpl=l)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;sh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;sh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;sh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $k=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],qk=new l_(3e4,6e4);function Gb(c,e){return c.tenantId&&!e.tenantId?{...e,tenantId:c.tenantId}:e}async function mm(c,e,i,l,f={}){return GS(c,f,async()=>{let v={},y={};l&&(e==="GET"?y=l:v={body:JSON.stringify(l)});const h=e_({key:c.config.apiKey,...y}).slice(1),M=await c._getAdditionalHeaders();M["Content-Type"]="application/json",c.languageCode&&(M["X-Firebase-Locale"]=c.languageCode);const O={method:e,headers:M,...v};return eC()||(O.referrerPolicy="no-referrer"),c.emulatorConfig&&cm(c.emulatorConfig.host)&&(O.credentials="include"),qS.fetch()(await HS(c,c.config.apiHost,i,h),O)})}async function GS(c,e,i){c._canInitEmulator=!1;const l={...Fk,...e};try{const f=new Hk(c),v=await Promise.race([i(),f.promise]);f.clearNetworkTimeout();const y=await v.json();if("needConfirmation"in y)throw py(c,"account-exists-with-different-credential",y);if(v.ok&&!("errorMessage"in y))return y;{const h=v.ok?y.errorMessage:y.error.message,[M,O]=h.split(" : ");if(M==="FEDERATED_USER_ID_ALREADY_LINKED")throw py(c,"credential-already-in-use",y);if(M==="EMAIL_EXISTS")throw py(c,"email-already-in-use",y);if(M==="USER_DISABLED")throw py(c,"user-disabled",y);const V=l[M]||M.toLowerCase().replace(/[_\s]+/g,"-");if(O)throw $S(c,V,O);dh(c,V)}}catch(f){if(f instanceof ph)throw f;dh(c,"network-request-failed",{message:String(f)})}}async function Gk(c,e,i,l,f={}){const v=await mm(c,e,i,l,f);return"mfaPendingCredential"in v&&dh(c,"multi-factor-auth-required",{_serverResponse:v}),v}async function HS(c,e,i,l){const f=`${e}${i}?${l}`,v=c,y=v.config.emulator?qb(c.config,f):`${c.config.apiScheme}://${f}`;return $k.includes(i)&&(await v._persistenceManagerAvailable,v._getPersistenceType()==="COOKIE")?v._getPersistence()._getFinalTarget(y).toString():y}class Hk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,l)=>{this.timer=setTimeout(()=>l(gu(this.auth,"network-request-failed")),qk.get())})}}function py(c,e,i){const l={appName:c.name};i.email&&(l.email=i.email),i.phoneNumber&&(l.phoneNumber=i.phoneNumber);const f=gu(c,e,l);return f.customData._tokenResponse=i,f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zk(c,e){return mm(c,"POST","/v1/accounts:delete",e)}async function Ky(c,e){return mm(c,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dg(c){if(c)try{const e=new Date(Number(c));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Wk(c,e=!1){const i=va(c),l=await i.getIdToken(e),f=Hb(l);En(f&&f.exp&&f.auth_time&&f.iat,i.auth,"internal-error");const v=typeof f.firebase=="object"?f.firebase:void 0,y=v?.sign_in_provider;return{claims:f,token:l,authTime:Dg(n0(f.auth_time)),issuedAtTime:Dg(n0(f.iat)),expirationTime:Dg(n0(f.exp)),signInProvider:y||null,signInSecondFactor:v?.sign_in_second_factor||null}}function n0(c){return Number(c)*1e3}function Hb(c){const[e,i,l]=c.split(".");if(e===void 0||i===void 0||l===void 0)return Py("JWT malformed, contained fewer than 3 sections"),null;try{const f=W1(i);return f?JSON.parse(f):(Py("Failed to decode base64 JWT payload"),null)}catch(f){return Py("Caught error parsing JWT payload as JSON",f?.toString()),null}}function Mw(c){const e=Hb(c);return En(e,"internal-error"),En(typeof e.exp<"u","internal-error"),En(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zg(c,e,i=!1){if(i)return e;try{return await e}catch(l){throw l instanceof ph&&Kk(l)&&c.auth.currentUser===c&&await c.auth.signOut(),l}}function Kk({code:c}){return c==="auth/user-disabled"||c==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const l=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V0{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=Dg(this.lastLoginAt),this.creationTime=Dg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xy(c){const e=c.auth,i=await c.getIdToken(),l=await Zg(c,Ky(e,{idToken:i}));En(l?.users.length,e,"internal-error");const f=l.users[0];c._notifyReloadListener(f);const v=f.providerUserInfo?.length?ZS(f.providerUserInfo):[],y=Qk(c.providerData,v),h=c.isAnonymous,M=!(c.email&&f.passwordHash)&&!y?.length,O=h?M:!1,V={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:y,metadata:new V0(f.createdAt,f.lastLoginAt),isAnonymous:O};Object.assign(c,V)}async function Yk(c){const e=va(c);await Xy(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Qk(c,e){return[...c.filter(l=>!e.some(f=>f.providerId===l.providerId)),...e]}function ZS(c){return c.map(({providerId:e,...i})=>({providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jk(c,e){const i=await GS(c,{},async()=>{const l=e_({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:f,apiKey:v}=c.config,y=await HS(c,f,"/v1/token",`key=${v}`),h=await c._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const M={method:"POST",headers:h,body:l};return c.emulatorConfig&&cm(c.emulatorConfig.host)&&(M.credentials="include"),qS.fetch()(y,M)});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function eD(c,e){return mm(c,"POST","/v2/accounts:revokeToken",Gb(c,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){En(e.idToken,"internal-error"),En(typeof e.idToken<"u","internal-error"),En(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Mw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){En(e.length!==0,"internal-error");const i=Mw(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(En(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:l,refreshToken:f,expiresIn:v}=await Jk(e,i);this.updateTokensAndExpiration(l,f,Number(v))}updateTokensAndExpiration(e,i,l){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+l*1e3}static fromJSON(e,i){const{refreshToken:l,accessToken:f,expirationTime:v}=i,y=new Hp;return l&&(En(typeof l=="string","internal-error",{appName:e}),y.refreshToken=l),f&&(En(typeof f=="string","internal-error",{appName:e}),y.accessToken=f),v&&(En(typeof v=="number","internal-error",{appName:e}),y.expirationTime=v),y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Hp,this.toJSON())}_performRefresh(){return sh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function id(c,e){En(typeof c=="string"||typeof c>"u","internal-error",{appName:e})}class Ec{constructor({uid:e,auth:i,stsTokenManager:l,...f}){this.providerId="firebase",this.proactiveRefresh=new Xk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=i,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new V0(f.createdAt||void 0,f.lastLoginAt||void 0)}async getIdToken(e){const i=await Zg(this,this.stsTokenManager.getToken(this.auth,e));return En(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return Wk(this,e)}reload(){return Yk(this)}_assign(e){this!==e&&(En(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>({...i})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new Ec({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return i.metadata._copy(this.metadata),i}_onReload(e){En(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let l=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),l=!0),i&&await Xy(this),await this.auth._persistUserIfCurrent(this),l&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(du(this.auth.app))return Promise.reject(Lf(this.auth));const e=await this.getIdToken();return await Zg(this,Zk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){const l=i.displayName??void 0,f=i.email??void 0,v=i.phoneNumber??void 0,y=i.photoURL??void 0,h=i.tenantId??void 0,M=i._redirectEventId??void 0,O=i.createdAt??void 0,V=i.lastLoginAt??void 0,{uid:K,emailVerified:ee,isAnonymous:Y,providerData:ve,stsTokenManager:Ce}=i;En(K&&Ce,e,"internal-error");const Ee=Hp.fromJSON(this.name,Ce);En(typeof K=="string",e,"internal-error"),id(l,e.name),id(f,e.name),En(typeof ee=="boolean",e,"internal-error"),En(typeof Y=="boolean",e,"internal-error"),id(v,e.name),id(y,e.name),id(h,e.name),id(M,e.name),id(O,e.name),id(V,e.name);const Je=new Ec({uid:K,auth:e,email:f,emailVerified:ee,displayName:l,isAnonymous:Y,photoURL:y,phoneNumber:v,tenantId:h,stsTokenManager:Ee,createdAt:O,lastLoginAt:V});return ve&&Array.isArray(ve)&&(Je.providerData=ve.map(je=>({...je}))),M&&(Je._redirectEventId=M),Je}static async _fromIdTokenResponse(e,i,l=!1){const f=new Hp;f.updateFromServerResponse(i);const v=new Ec({uid:i.localId,auth:e,stsTokenManager:f,isAnonymous:l});return await Xy(v),v}static async _fromGetAccountInfoResponse(e,i,l){const f=i.users[0];En(f.localId!==void 0,"internal-error");const v=f.providerUserInfo!==void 0?ZS(f.providerUserInfo):[],y=!(f.email&&f.passwordHash)&&!v?.length,h=new Hp;h.updateFromIdToken(l);const M=new Ec({uid:f.localId,auth:e,stsTokenManager:h,isAnonymous:y}),O={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:v,metadata:new V0(f.createdAt,f.lastLoginAt),isAnonymous:!(f.email&&f.passwordHash)&&!v?.length};return Object.assign(M,O),M}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kw=new Map;function ah(c){fh(c instanceof Function,"Expected a class definition");let e=kw.get(c);return e?(fh(e instanceof c,"Instance stored in cache mismatched with class"),e):(e=new c,kw.set(c,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WS{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}WS.type="NONE";const Dw=WS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ry(c,e,i){return`firebase:${c}:${e}:${i}`}class Zp{constructor(e,i,l){this.persistence=e,this.auth=i,this.userKey=l;const{config:f,name:v}=this.auth;this.fullUserKey=Ry(this.userKey,f.apiKey,v),this.fullPersistenceKey=Ry("persistence",f.apiKey,v),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const i=await Ky(this.auth,{idToken:e}).catch(()=>{});return i?Ec._fromGetAccountInfoResponse(this.auth,i,e):null}return Ec._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,l="authUser"){if(!i.length)return new Zp(ah(Dw),e,l);const f=(await Promise.all(i.map(async O=>{if(await O._isAvailable())return O}))).filter(O=>O);let v=f[0]||ah(Dw);const y=Ry(l,e.config.apiKey,e.name);let h=null;for(const O of i)try{const V=await O._get(y);if(V){let K;if(typeof V=="string"){const ee=await Ky(e,{idToken:V}).catch(()=>{});if(!ee)break;K=await Ec._fromGetAccountInfoResponse(e,ee,V)}else K=Ec._fromJSON(e,V);O!==v&&(h=K),v=O;break}}catch{}const M=f.filter(O=>O._shouldAllowMigration);return!v._shouldAllowMigration||!M.length?new Zp(v,e,l):(v=M[0],h&&await v._set(y,h.toJSON()),await Promise.all(i.map(async O=>{if(O!==v)try{await O._remove(y)}catch{}})),new Zp(v,e,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ow(c){const e=c.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(QS(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(KS(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(eE(e))return"Blackberry";if(tE(e))return"Webos";if(XS(e))return"Safari";if((e.includes("chrome/")||YS(e))&&!e.includes("edge/"))return"Chrome";if(JS(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,l=c.match(i);if(l?.length===2)return l[1]}return"Other"}function KS(c=La()){return/firefox\//i.test(c)}function XS(c=La()){const e=c.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function YS(c=La()){return/crios\//i.test(c)}function QS(c=La()){return/iemobile/i.test(c)}function JS(c=La()){return/android/i.test(c)}function eE(c=La()){return/blackberry/i.test(c)}function tE(c=La()){return/webos/i.test(c)}function Zb(c=La()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function tD(c=La()){return Zb(c)&&!!window.navigator?.standalone}function nD(){return iC()&&document.documentMode===10}function nE(c=La()){return Zb(c)||JS(c)||tE(c)||eE(c)||/windows phone/i.test(c)||QS(c)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iE(c,e=[]){let i;switch(c){case"Browser":i=Ow(La());break;case"Worker":i=`${Ow(La())}-${c}`;break;default:i=c}const l=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${um}/${l}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const l=v=>new Promise((y,h)=>{try{const M=e(v);y(M)}catch(M){h(M)}});l.onAbort=i,this.queue.push(l);const f=this.queue.length-1;return()=>{this.queue[f]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const l of this.queue)await l(e),l.onAbort&&i.push(l.onAbort)}catch(l){i.reverse();for(const f of i)try{f()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:l?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rD(c,e={}){return mm(c,"GET","/v2/passwordPolicy",Gb(c,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD=6;class aD{constructor(e){const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=i.minPasswordLength??sD,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),i.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),i.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),i.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),i.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const i={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,i),this.validatePasswordCharacterOptions(e,i),i.isValid&&(i.isValid=i.meetsMinPasswordLength??!0),i.isValid&&(i.isValid=i.meetsMaxPasswordLength??!0),i.isValid&&(i.isValid=i.containsLowercaseLetter??!0),i.isValid&&(i.isValid=i.containsUppercaseLetter??!0),i.isValid&&(i.isValid=i.containsNumericCharacter??!0),i.isValid&&(i.isValid=i.containsNonAlphanumericCharacter??!0),i}validatePasswordLengthOptions(e,i){const l=this.customStrengthOptions.minPasswordLength,f=this.customStrengthOptions.maxPasswordLength;l&&(i.meetsMinPasswordLength=e.length>=l),f&&(i.meetsMaxPasswordLength=e.length<=f)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let l;for(let f=0;f<e.length;f++)l=e.charAt(f),this.updatePasswordCharacterOptionsStatuses(i,l>="a"&&l<="z",l>="A"&&l<="Z",l>="0"&&l<="9",this.allowedNonAlphanumericCharacters.includes(l))}updatePasswordCharacterOptionsStatuses(e,i,l,f,v){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=l)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=f)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=v))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oD{constructor(e,i,l,f){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=l,this.config=f,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new zw(this),this.idTokenSubscription=new zw(this),this.beforeStateQueue=new iD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=FS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=f.sdkClientVersion,this._persistenceManagerAvailable=new Promise(v=>this._resolvePersistenceManagerAvailable=v)}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=ah(i)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Zp.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await Ky(this,{idToken:e}),l=await Ec._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(l)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(du(this.app)){const v=this.app.settings.authIdToken;return v?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(v).then(y,y))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let l=i,f=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const v=this.redirectUser?._redirectEventId,y=l?._redirectEventId,h=await this.tryRedirectSignIn(e);(!v||v===y)&&h?.user&&(l=h.user,f=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(f)try{await this.beforeStateQueue.runMiddleware(l)}catch(v){l=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(v))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return En(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await Xy(e)}catch(i){if(i?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Uk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(du(this.app))return Promise.reject(Lf(this));const i=e?va(e):null;return i&&En(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&En(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return du(this.app)?Promise.reject(Lf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return du(this.app)?Promise.reject(Lf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ah(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await rD(this),i=new aD(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Jg("auth","Firebase",e())}onAuthStateChanged(e,i,l){return this.registerStateListener(this.authStateSubscription,e,i,l)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,l){return this.registerStateListener(this.idTokenSubscription,e,i,l)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const l=this.onAuthStateChanged(()=>{l(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),l={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(l.tenantId=this.tenantId),await eD(this,l)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,i){const l=await this.getOrInitRedirectPersistenceManager(i);return e===null?l.removeCurrentUser():l.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&ah(e)||this._popupRedirectResolver;En(i,this,"argument-error"),this.redirectPersistenceManager=await Zp.create(this,[ah(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,l,f){if(this._deleted)return()=>{};const v=typeof i=="function"?i:i.next.bind(i);let y=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(En(h,this,"internal-error"),h.then(()=>{y||v(this.currentUser)}),typeof i=="function"){const M=e.addObserver(i,l,f);return()=>{y=!0,M()}}else{const M=e.addObserver(i);return()=>{y=!0,M()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return En(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=iE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const i=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();i&&(e["X-Firebase-Client"]=i);const l=await this._getAppCheckToken();return l&&(e["X-Firebase-AppCheck"]=l),e}async _getAppCheckToken(){if(du(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Bk(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Wb(c){return va(c)}class zw{constructor(e){this.auth=e,this.observer=null,this.addObserver=hC(i=>this.observer=i)}get next(){return En(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kb={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function lD(c){Kb=c}function cD(c){return Kb.loadJS(c)}function uD(){return Kb.gapiScript}function hD(c){return`__${c}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dD(c,e){const i=ob(c,"auth");if(i.isInitialized()){const f=i.getImmediate(),v=i.getOptions();if(Nf(v,e??{}))return f;dh(f,"already-initialized")}return i.initialize({options:e})}function fD(c,e){const i=e?.persistence||[],l=(Array.isArray(i)?i:[i]).map(ah);e?.errorMap&&c._updateErrorMap(e.errorMap),c._initializeWithPersistence(l,e?.popupRedirectResolver)}function pD(c,e,i){const l=Wb(c);En(/^https?:\/\//.test(e),l,"invalid-emulator-scheme");const f=!1,v=rE(e),{host:y,port:h}=mD(e),M=h===null?"":`:${h}`,O={url:`${v}//${y}${M}/`},V=Object.freeze({host:y,port:h,protocol:v.replace(":",""),options:Object.freeze({disableWarnings:f})});if(!l._canInitEmulator){En(l.config.emulator&&l.emulatorConfig,l,"emulator-config-failed"),En(Nf(O,l.config.emulator)&&Nf(V,l.emulatorConfig),l,"emulator-config-failed");return}l.config.emulator=O,l.emulatorConfig=V,l.settings.appVerificationDisabledForTesting=!0,cm(y)?(Q1(`${v}//${y}${M}`),J1("Auth",!0)):gD()}function rE(c){const e=c.indexOf(":");return e<0?"":c.substr(0,e+1)}function mD(c){const e=rE(c),i=/(\/\/)?([^?#/]+)/.exec(c.substr(e.length));if(!i)return{host:"",port:null};const l=i[2].split("@").pop()||"",f=/^(\[[^\]]+\])(:|$)/.exec(l);if(f){const v=f[1];return{host:v,port:Lw(l.substr(v.length+1))}}else{const[v,y]=l.split(":");return{host:v,port:Lw(y)}}}function Lw(c){if(!c)return null;const e=Number(c);return isNaN(e)?null:e}function gD(){function c(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",c):c())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return sh("not implemented")}_getIdTokenResponse(e){return sh("not implemented")}_linkToIdToken(e,i){return sh("not implemented")}_getReauthenticationResolver(e){return sh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wp(c,e){return Gk(c,"POST","/v1/accounts:signInWithIdp",Gb(c,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _D="http://localhost";class Ff extends sE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new Ff(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):dh("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:l,signInMethod:f,...v}=i;if(!l||!f)return null;const y=new Ff(l,f);return y.idToken=v.idToken||void 0,y.accessToken=v.accessToken||void 0,y.secret=v.secret,y.nonce=v.nonce,y.pendingToken=v.pendingToken||null,y}_getIdTokenResponse(e){const i=this.buildRequest();return Wp(e,i)}_linkToIdToken(e,i){const l=this.buildRequest();return l.idToken=i,Wp(e,l)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,Wp(e,i)}buildRequest(){const e={requestUri:_D,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=e_(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_ extends aE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class od extends c_{constructor(){super("facebook.com")}static credential(e){return Ff._fromParams({providerId:od.PROVIDER_ID,signInMethod:od.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return od.credentialFromTaggedObject(e)}static credentialFromError(e){return od.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return od.credential(e.oauthAccessToken)}catch{return null}}}od.FACEBOOK_SIGN_IN_METHOD="facebook.com";od.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld extends c_{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return Ff._fromParams({providerId:ld.PROVIDER_ID,signInMethod:ld.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return ld.credentialFromTaggedObject(e)}static credentialFromError(e){return ld.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:l}=e;if(!i&&!l)return null;try{return ld.credential(i,l)}catch{return null}}}ld.GOOGLE_SIGN_IN_METHOD="google.com";ld.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd extends c_{constructor(){super("github.com")}static credential(e){return Ff._fromParams({providerId:cd.PROVIDER_ID,signInMethod:cd.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cd.credentialFromTaggedObject(e)}static credentialFromError(e){return cd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return cd.credential(e.oauthAccessToken)}catch{return null}}}cd.GITHUB_SIGN_IN_METHOD="github.com";cd.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud extends c_{constructor(){super("twitter.com")}static credential(e,i){return Ff._fromParams({providerId:ud.PROVIDER_ID,signInMethod:ud.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return ud.credentialFromTaggedObject(e)}static credentialFromError(e){return ud.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:l}=e;if(!i||!l)return null;try{return ud.credential(i,l)}catch{return null}}}ud.TWITTER_SIGN_IN_METHOD="twitter.com";ud.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,l,f=!1){const v=await Ec._fromIdTokenResponse(e,l,f),y=Nw(l);return new rm({user:v,providerId:y,_tokenResponse:l,operationType:i})}static async _forOperation(e,i,l){await e._updateTokensIfNecessary(l,!0);const f=Nw(l);return new rm({user:e,providerId:f,_tokenResponse:l,operationType:i})}}function Nw(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy extends ph{constructor(e,i,l,f){super(i.code,i.message),this.operationType=l,this.user=f,Object.setPrototypeOf(this,Yy.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:i.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(e,i,l,f){return new Yy(e,i,l,f)}}function oE(c,e,i,l){return(e==="reauthenticate"?i._getReauthenticationResolver(c):i._getIdTokenResponse(c)).catch(v=>{throw v.code==="auth/multi-factor-auth-required"?Yy._fromErrorAndOperation(c,v,e,l):v})}async function yD(c,e,i=!1){const l=await Zg(c,e._linkToIdToken(c.auth,await c.getIdToken()),i);return rm._forOperation(c,"link",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vD(c,e,i=!1){const{auth:l}=c;if(du(l.app))return Promise.reject(Lf(l));const f="reauthenticate";try{const v=await Zg(c,oE(l,f,e,c),i);En(v.idToken,l,"internal-error");const y=Hb(v.idToken);En(y,l,"internal-error");const{sub:h}=y;return En(c.uid===h,l,"user-mismatch"),rm._forOperation(c,f,v)}catch(v){throw v?.code==="auth/user-not-found"&&dh(l,"user-mismatch"),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bD(c,e,i=!1){if(du(c.app))return Promise.reject(Lf(c));const l="signIn",f=await oE(c,l,e),v=await rm._fromIdTokenResponse(c,l,f);return i||await c._updateCurrentUser(v.user),v}function xD(c,e,i,l){return va(c).onIdTokenChanged(e,i,l)}function wD(c,e,i){return va(c).beforeAuthStateChanged(e,i)}const Qy="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lE{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(Qy,"1"),this.storage.removeItem(Qy),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TD=1e3,SD=10;class cE extends lE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const l=this.storage.getItem(i),f=this.localCache[i];l!==f&&e(i,f,l)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((y,h,M)=>{this.notifyListeners(y,M)});return}const l=e.key;i?this.detachListener():this.stopPolling();const f=()=>{const y=this.storage.getItem(l);!i&&this.localCache[l]===y||this.notifyListeners(l,y)},v=this.storage.getItem(l);nD()&&v!==e.newValue&&e.newValue!==e.oldValue?setTimeout(f,SD):f()}notifyListeners(e,i){this.localCache[e]=i;const l=this.listeners[e];if(l)for(const f of Array.from(l))f(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,l)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:l}),!0)})},TD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}cE.type="LOCAL";const ED=cE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uE extends lE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}uE.type="SESSION";const hE=uE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AD(c){return Promise.all(c.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(f=>f.isListeningto(e));if(i)return i;const l=new Sv(e);return this.receivers.push(l),l}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:l,eventType:f,data:v}=i.data,y=this.handlersMap[f];if(!y?.size)return;i.ports[0].postMessage({status:"ack",eventId:l,eventType:f});const h=Array.from(y).map(async O=>O(i.origin,v)),M=await AD(h);i.ports[0].postMessage({status:"done",eventId:l,eventType:f,response:M})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Sv.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xb(c="",e=10){let i="";for(let l=0;l<e;l++)i+=Math.floor(Math.random()*10);return c+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,l=50){const f=typeof MessageChannel<"u"?new MessageChannel:null;if(!f)throw new Error("connection_unavailable");let v,y;return new Promise((h,M)=>{const O=Xb("",20);f.port1.start();const V=setTimeout(()=>{M(new Error("unsupported_event"))},l);y={messageChannel:f,onMessage(K){const ee=K;if(ee.data.eventId===O)switch(ee.data.status){case"ack":clearTimeout(V),v=setTimeout(()=>{M(new Error("timeout"))},3e3);break;case"done":clearTimeout(v),h(ee.data.response);break;default:clearTimeout(V),clearTimeout(v),M(new Error("invalid_response"));break}}},this.handlers.add(y),f.port1.addEventListener("message",y.onMessage),this.target.postMessage({eventType:e,eventId:O,data:i},[f.port2])}).finally(()=>{y&&this.removeMessageHandler(y)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _u(){return window}function CD(c){_u().location.href=c}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dE(){return typeof _u().WorkerGlobalScope<"u"&&typeof _u().importScripts=="function"}async function PD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function RD(){return navigator?.serviceWorker?.controller||null}function MD(){return dE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fE="firebaseLocalStorageDb",kD=1,Jy="firebaseLocalStorage",pE="fbase_key";class u_{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function Ev(c,e){return c.transaction([Jy],e?"readwrite":"readonly").objectStore(Jy)}function DD(){const c=indexedDB.deleteDatabase(fE);return new u_(c).toPromise()}function j0(){const c=indexedDB.open(fE,kD);return new Promise((e,i)=>{c.addEventListener("error",()=>{i(c.error)}),c.addEventListener("upgradeneeded",()=>{const l=c.result;try{l.createObjectStore(Jy,{keyPath:pE})}catch(f){i(f)}}),c.addEventListener("success",async()=>{const l=c.result;l.objectStoreNames.contains(Jy)?e(l):(l.close(),await DD(),e(await j0()))})})}async function Bw(c,e,i){const l=Ev(c,!0).put({[pE]:e,value:i});return new u_(l).toPromise()}async function OD(c,e){const i=Ev(c,!1).get(e),l=await new u_(i).toPromise();return l===void 0?null:l.value}function Vw(c,e){const i=Ev(c,!0).delete(e);return new u_(i).toPromise()}const zD=800,LD=3;class mE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await j0(),this.db)}async _withRetries(e){let i=0;for(;;)try{const l=await this._openDb();return await e(l)}catch(l){if(i++>LD)throw l;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return dE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Sv._getInstance(MD()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await PD(),!this.activeServiceWorker)return;this.sender=new ID(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||RD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await j0();return await Bw(e,Qy,"1"),await Vw(e,Qy),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(l=>Bw(l,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(l=>OD(l,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>Vw(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(f=>{const v=Ev(f,!1).getAll();return new u_(v).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],l=new Set;if(e.length!==0)for(const{fbase_key:f,value:v}of e)l.add(f),JSON.stringify(this.localCache[f])!==JSON.stringify(v)&&(this.notifyListeners(f,v),i.push(f));for(const f of Object.keys(this.localCache))this.localCache[f]&&!l.has(f)&&(this.notifyListeners(f,null),i.push(f));return i}notifyListeners(e,i){this.localCache[e]=i;const l=this.listeners[e];if(l)for(const f of Array.from(l))f(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),zD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}mE.type="LOCAL";const ND=mE;new l_(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BD(c,e){return e?ah(e):(En(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb extends sE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Wp(e,this._buildIdpRequest())}_linkToIdToken(e,i){return Wp(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return Wp(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function VD(c){return bD(c.auth,new Yb(c),c.bypassAuthState)}function jD(c){const{auth:e,user:i}=c;return En(i,e,"internal-error"),vD(i,new Yb(c),c.bypassAuthState)}async function UD(c){const{auth:e,user:i}=c;return En(i,e,"internal-error"),yD(i,new Yb(c),c.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(e,i,l,f,v=!1){this.auth=e,this.resolver=l,this.user=f,this.bypassAuthState=v,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(l){this.reject(l)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:l,postBody:f,tenantId:v,error:y,type:h}=e;if(y){this.reject(y);return}const M={auth:this.auth,requestUri:i,sessionId:l,tenantId:v||void 0,postBody:f||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(M))}catch(O){this.reject(O)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return VD;case"linkViaPopup":case"linkViaRedirect":return UD;case"reauthViaPopup":case"reauthViaRedirect":return jD;default:dh(this.auth,"internal-error")}}resolve(e){fh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){fh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FD=new l_(2e3,1e4);class qp extends gE{constructor(e,i,l,f,v){super(e,i,f,v),this.provider=l,this.authWindow=null,this.pollId=null,qp.currentPopupAction&&qp.currentPopupAction.cancel(),qp.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return En(e,this.auth,"internal-error"),e}async onExecution(){fh(this.filter.length===1,"Popup operations only handle one event");const e=Xb();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(gu(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(gu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,qp.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(gu(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,FD.get())};e()}}qp.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $D="pendingRedirect",My=new Map;class qD extends gE{constructor(e,i,l=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,l),this.eventId=null}async execute(){let e=My.get(this.auth._key());if(!e){try{const l=await GD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(l)}catch(i){e=()=>Promise.reject(i)}My.set(this.auth._key(),e)}return this.bypassAuthState||My.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function GD(c,e){const i=WD(e),l=ZD(c);if(!await l._isAvailable())return!1;const f=await l._get(i)==="true";return await l._remove(i),f}function HD(c,e){My.set(c._key(),e)}function ZD(c){return ah(c._redirectPersistence)}function WD(c){return Ry($D,c.config.apiKey,c.name)}async function KD(c,e,i=!1){if(du(c.app))return Promise.reject(Lf(c));const l=Wb(c),f=BD(l,e),y=await new qD(l,f,i).execute();return y&&!i&&(delete y.user._redirectEventId,await l._persistUserIfCurrent(y.user),await l._setRedirectUser(null,e)),y}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XD=600*1e3;class YD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(e,l)&&(i=!0,this.sendToConsumer(e,l),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!QD(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){if(e.error&&!_E(e)){const l=e.error.code?.split("auth/")[1]||"internal-error";i.onError(gu(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const l=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&l}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=XD&&this.cachedEventUids.clear(),this.cachedEventUids.has(jw(e))}saveEventToCache(e){this.cachedEventUids.add(jw(e)),this.lastProcessedEventTime=Date.now()}}function jw(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(e=>e).join("-")}function _E({type:c,error:e}){return c==="unknown"&&e?.code==="auth/no-auth-event"}function QD(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _E(c);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JD(c,e={}){return mm(c,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tO=/^https?/;async function nO(c){if(c.config.emulator)return;const{authorizedDomains:e}=await JD(c);for(const i of e)try{if(iO(i))return}catch{}dh(c,"unauthorized-domain")}function iO(c){const e=B0(),{protocol:i,hostname:l}=new URL(e);if(c.startsWith("chrome-extension://")){const y=new URL(c);return y.hostname===""&&l===""?i==="chrome-extension:"&&c.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&y.hostname===l}if(!tO.test(i))return!1;if(eO.test(c))return l===c;const f=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+f+"|"+f+")$","i").test(l)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rO=new l_(3e4,6e4);function Uw(){const c=_u().___jsl;if(c?.H){for(const e of Object.keys(c.H))if(c.H[e].r=c.H[e].r||[],c.H[e].L=c.H[e].L||[],c.H[e].r=[...c.H[e].L],c.CP)for(let i=0;i<c.CP.length;i++)c.CP[i]=null}}function sO(c){return new Promise((e,i)=>{function l(){Uw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Uw(),i(gu(c,"network-request-failed"))},timeout:rO.get()})}if(_u().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(_u().gapi?.load)l();else{const f=hD("iframefcb");return _u()[f]=()=>{gapi.load?l():i(gu(c,"network-request-failed"))},cD(`${uD()}?onload=${f}`).catch(v=>i(v))}}).catch(e=>{throw ky=null,e})}let ky=null;function aO(c){return ky=ky||sO(c),ky}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oO=new l_(5e3,15e3),lO="__/auth/iframe",cO="emulator/auth/iframe",uO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},hO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function dO(c){const e=c.config;En(e.authDomain,c,"auth-domain-config-required");const i=e.emulator?qb(e,cO):`https://${c.config.authDomain}/${lO}`,l={apiKey:e.apiKey,appName:c.name,v:um},f=hO.get(c.config.apiHost);f&&(l.eid=f);const v=c._getFrameworks();return v.length&&(l.fw=v.join(",")),`${i}?${e_(l).slice(1)}`}async function fO(c){const e=await aO(c),i=_u().gapi;return En(i,c,"internal-error"),e.open({where:document.body,url:dO(c),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:uO,dontclear:!0},l=>new Promise(async(f,v)=>{await l.restyle({setHideOnLeave:!1});const y=gu(c,"network-request-failed"),h=_u().setTimeout(()=>{v(y)},oO.get());function M(){_u().clearTimeout(h),f(l)}l.ping(M).then(M,()=>{v(y)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},mO=500,gO=600,_O="_blank",yO="http://localhost";class Fw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function vO(c,e,i,l=mO,f=gO){const v=Math.max((window.screen.availHeight-f)/2,0).toString(),y=Math.max((window.screen.availWidth-l)/2,0).toString();let h="";const M={...pO,width:l.toString(),height:f.toString(),top:v,left:y},O=La().toLowerCase();i&&(h=YS(O)?_O:i),KS(O)&&(e=e||yO,M.scrollbars="yes");const V=Object.entries(M).reduce((ee,[Y,ve])=>`${ee}${Y}=${ve},`,"");if(tD(O)&&h!=="_self")return bO(e||"",h),new Fw(null);const K=window.open(e||"",h,V);En(K,c,"popup-blocked");try{K.focus()}catch{}return new Fw(K)}function bO(c,e){const i=document.createElement("a");i.href=c,i.target=e;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(l)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xO="__/auth/handler",wO="emulator/auth/handler",TO=encodeURIComponent("fac");async function $w(c,e,i,l,f,v){En(c.config.authDomain,c,"auth-domain-config-required"),En(c.config.apiKey,c,"invalid-api-key");const y={apiKey:c.config.apiKey,appName:c.name,authType:i,redirectUrl:l,v:um,eventId:f};if(e instanceof aE){e.setDefaultLanguage(c.languageCode),y.providerId=e.providerId||"",uC(e.getCustomParameters())||(y.customParameters=JSON.stringify(e.getCustomParameters()));for(const[V,K]of Object.entries({}))y[V]=K}if(e instanceof c_){const V=e.getScopes().filter(K=>K!=="");V.length>0&&(y.scopes=V.join(","))}c.tenantId&&(y.tid=c.tenantId);const h=y;for(const V of Object.keys(h))h[V]===void 0&&delete h[V];const M=await c._getAppCheckToken(),O=M?`#${TO}=${encodeURIComponent(M)}`:"";return`${SO(c)}?${e_(h).slice(1)}${O}`}function SO({config:c}){return c.emulator?qb(c,wO):`https://${c.authDomain}/${xO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i0="webStorageSupport";class EO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=hE,this._completeRedirectFn=KD,this._overrideRedirectResult=HD}async _openPopup(e,i,l,f){fh(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const v=await $w(e,i,l,B0(),f);return vO(e,v,Xb())}async _openRedirect(e,i,l,f){await this._originValidation(e);const v=await $w(e,i,l,B0(),f);return CD(v),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:f,promise:v}=this.eventManagers[i];return f?Promise.resolve(f):(fh(v,"If manager is not set, promise should be"),v)}const l=this.initAndGetManager(e);return this.eventManagers[i]={promise:l},l.catch(()=>{delete this.eventManagers[i]}),l}async initAndGetManager(e){const i=await fO(e),l=new YD(e);return i.register("authEvent",f=>(En(f?.authEvent,e,"invalid-auth-event"),{status:l.onEvent(f.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:l},this.iframes[e._key()]=i,l}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(i0,{type:i0},f=>{const v=f?.[0]?.[i0];v!==void 0&&i(!!v),dh(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=nO(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return nE()||XS()||Zb()}}const AO=EO;var qw="@firebase/auth",Gw="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(l=>{e(l?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){En(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CO(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function PO(c){Yp(new Bf("auth",(e,{options:i})=>{const l=e.getProvider("app").getImmediate(),f=e.getProvider("heartbeat"),v=e.getProvider("app-check-internal"),{apiKey:y,authDomain:h}=l.options;En(y&&!y.includes(":"),"invalid-api-key",{appName:l.name});const M={apiKey:y,authDomain:h,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:iE(c)},O=new oD(l,f,v,M);return fD(O,i),O},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,l)=>{e.getProvider("auth-internal").initialize()})),Yp(new Bf("auth-internal",e=>{const i=Wb(e.getProvider("auth").getImmediate());return(l=>new IO(l))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),md(qw,Gw,CO(c)),md(qw,Gw,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RO=300,MO=Y1("authIdTokenMaxAge")||RO;let Hw=null;const kO=c=>async e=>{const i=e&&await e.getIdTokenResult(),l=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(l&&l>MO)return;const f=i?.token;Hw!==f&&(Hw=f,await fetch(c,{method:f?"POST":"DELETE",headers:f?{Authorization:`Bearer ${f}`}:{}}))};function DO(c=iT()){const e=ob(c,"auth");if(e.isInitialized())return e.getImmediate();const i=dD(c,{popupRedirectResolver:AO,persistence:[ND,ED,hE]}),l=Y1("authTokenSyncURL");if(l&&typeof isSecureContext=="boolean"&&isSecureContext){const v=new URL(l,location.origin);if(location.origin===v.origin){const y=kO(v.toString());wD(i,y,()=>y(i.currentUser)),xD(i,h=>y(h))}}const f=K1("auth");return f&&pD(i,`http://${f}`),i}function OO(){return document.getElementsByTagName("head")?.[0]??document}lD({loadJS(c){return new Promise((e,i)=>{const l=document.createElement("script");l.setAttribute("src",c),l.onload=e,l.onerror=f=>{const v=gu("internal-error");v.customData=f,i(v)},l.type="text/javascript",l.charset="UTF-8",OO().appendChild(l)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});PO("Browser");const yE={apiKey:"AIzaSyBJ_5I-Uus95lZBtSfiZZugJ864xzuz76c",authDomain:"skame-parking.firebaseapp.com",projectId:"skame-parking",appId:"1:406637998063:web:dd0d7c73098384e4e9101a"},Zw=Object.entries(yE).filter(([,c])=>!c).map(([c])=>c);if(Zw.length)throw new Error(`Firebase config manquante: ${Zw.join(", ")}. Vrifie .env.production et rebuild.`);const vE=Px().length?Px()[0]:nT(yE),Kp=vk(vE);DO(vE);const zO=[{id:1,name:"Parking Novotel",capacity:50,occupation:75,coordinates:[[7.058096,43.61359],[7.058429,43.613751],[7.058788,43.614141],[7.059145,43.614246],[7.0594,43.614052],[7.059598,43.614133]],size:10,lastUpdated:Date.now(),open:!0},{id:2,name:"Parking CROUS",capacity:50,occupation:75,coordinates:[[7.057624,43.614007],[7.057694,43.614054],[7.057739,43.614126],[7.05775,43.61431],[7.057678,43.614755],[7.057552,43.615333]],size:10,lastUpdated:Date.now(),open:!0},{id:3,name:"Parking rue",capacity:50,occupation:75,coordinates:[[7.056079,43.614075],[7.056023,43.614064],[7.055942,43.61407],[7.055851,43.614058],[7.055776,43.614062],[7.055739,43.614062]],size:10,lastUpdated:Date.now(),open:!0},{id:4,name:"Parking arrt de bus",capacity:20,occupation:40,coordinates:[[7.055446,43.614003],[7.055645,43.613963]],size:10,lastUpdated:Date.now(),open:!0},{id:5,name:"Parking CDI",capacity:10,occupation:30,coordinates:[[7.055387,43.613483]],size:10,lastUpdated:Date.now(),open:!0},{id:6,name:"Parking isol",capacity:8,occupation:20,coordinates:[[7.05719,43.613699]],size:10,lastUpdated:Date.now(),open:!0},{id:7,name:"Parking du haut - zone 1",capacity:40,occupation:65,coordinates:[[7.055385,43.61366],[7.055358,43.613675],[7.055328,43.613685],[7.055258,43.613675],[7.055205,43.613644],[7.055167,43.613609],[7.05513,43.613578],[7.055103,43.613536],[7.055076,43.613505],[7.055044,43.613427],[7.055039,43.613349],[7.055055,43.613312],[7.055119,43.613295],[7.055216,43.613293]],size:10,lastUpdated:Date.now(),open:!0},{id:8,name:"Parking du haut - zone 2",capacity:40,occupation:55,coordinates:[[7.055012,43.613736],[7.054931,43.613734],[7.054888,43.613693],[7.054888,43.613637],[7.05487,43.613586],[7.054867,43.613532],[7.0548,43.613508],[7.054733,43.613501],[7.054668,43.613479],[7.054601,43.613454],[7.054574,43.613404]],size:10,lastUpdated:Date.now(),open:!0},{id:9,name:"Parking accueil",capacity:30,occupation:60,coordinates:[[7.055323,43.613075],[7.05535,43.613015],[7.055376,43.612975],[7.055414,43.612932],[7.0555,43.612908],[7.055532,43.612899],[7.055629,43.612819],[7.055666,43.612798]],size:10,lastUpdated:Date.now(),open:!0},{id:10,name:"Parking du bas - virage",capacity:50,occupation:80,coordinates:[[7.055886,43.61267],[7.055999,43.612608],[7.056082,43.612559],[7.056337,43.612489],[7.05657,43.612489],[7.056795,43.612547],[7.056951,43.612635]],size:10,lastUpdated:Date.now(),open:!0},{id:11,name:"Parking du bas - zone 1",capacity:60,occupation:70,coordinates:[[7.057136,43.612747],[7.057222,43.612811],[7.057313,43.612873],[7.057404,43.612967],[7.057493,43.613056],[7.057549,43.613157],[7.057605,43.613271],[7.057648,43.613347],[7.057689,43.613469],[7.057702,43.613563]],size:10,lastUpdated:Date.now(),open:!0},{id:12,name:"Parking du bas - zone 2",capacity:60,occupation:70,coordinates:[[7.057243,43.612675],[7.057332,43.612695],[7.057493,43.612798],[7.057595,43.612889],[7.057662,43.612976],[7.057723,43.613069],[7.05775,43.613165],[7.057774,43.613254],[7.057785,43.613308],[7.057772,43.613456]],size:10,lastUpdated:Date.now(),open:!0}],LO="modulepreload",NO=function(c){return"/Skame-Parking/"+c},Ww={},h_=function(e,i,l){let f=Promise.resolve();if(i&&i.length>0){let O=function(V){return Promise.all(V.map(K=>Promise.resolve(K).then(ee=>({status:"fulfilled",value:ee}),ee=>({status:"rejected",reason:ee}))))};var y=O;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),M=h?.nonce||h?.getAttribute("nonce");f=O(i.map(V=>{if(V=NO(V),V in Ww)return;Ww[V]=!0;const K=V.endsWith(".css"),ee=K?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${V}"]${ee}`))return;const Y=document.createElement("link");if(Y.rel=K?"stylesheet":LO,K||(Y.as="script"),Y.crossOrigin="",Y.href=V,M&&Y.setAttribute("nonce",M),document.head.appendChild(Y),K)return new Promise((ve,Ce)=>{Y.addEventListener("load",ve),Y.addEventListener("error",()=>Ce(new Error(`Unable to preload CSS for ${V}`)))})}))}function v(h){const M=new Event("vite:preloadError",{cancelable:!0});if(M.payload=h,window.dispatchEvent(M),!M.defaultPrevented)throw h}return f.then(h=>{for(const M of h||[])M.status==="rejected"&&v(M.reason);return e().catch(v)})},BO=c=>{let e;return c?e=c:typeof fetch>"u"?e=(...i)=>h_(async()=>{const{default:l}=await Promise.resolve().then(()=>gm);return{default:l}},[]).then(({default:l})=>l(...i)):e=fetch,(...i)=>e(...i)};class Qb extends Error{constructor(e,i="FunctionsError",l){super(e),this.name=i,this.context=l}}class Kw extends Qb{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Xw extends Qb{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Yw extends Qb{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var U0;(function(c){c.Any="any",c.ApNortheast1="ap-northeast-1",c.ApNortheast2="ap-northeast-2",c.ApSouth1="ap-south-1",c.ApSoutheast1="ap-southeast-1",c.ApSoutheast2="ap-southeast-2",c.CaCentral1="ca-central-1",c.EuCentral1="eu-central-1",c.EuWest1="eu-west-1",c.EuWest2="eu-west-2",c.EuWest3="eu-west-3",c.SaEast1="sa-east-1",c.UsEast1="us-east-1",c.UsWest1="us-west-1",c.UsWest2="us-west-2"})(U0||(U0={}));var VO=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};class jO{constructor(e,{headers:i={},customFetch:l,region:f=U0.Any}={}){this.url=e,this.headers=i,this.region=f,this.fetch=BO(l)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return VO(this,arguments,void 0,function*(i,l={}){var f;try{const{headers:v,method:y,body:h,signal:M}=l;let O={},{region:V}=l;V||(V=this.region);const K=new URL(`${this.url}/${i}`);V&&V!=="any"&&(O["x-region"]=V,K.searchParams.set("forceFunctionRegion",V));let ee;h&&(v&&!Object.prototype.hasOwnProperty.call(v,"Content-Type")||!v)&&(typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(O["Content-Type"]="application/octet-stream",ee=h):typeof h=="string"?(O["Content-Type"]="text/plain",ee=h):typeof FormData<"u"&&h instanceof FormData?ee=h:(O["Content-Type"]="application/json",ee=JSON.stringify(h)));const Y=yield this.fetch(K.toString(),{method:y||"POST",headers:Object.assign(Object.assign(Object.assign({},O),this.headers),v),body:ee,signal:M}).catch(Je=>{throw Je.name==="AbortError"?Je:new Kw(Je)}),ve=Y.headers.get("x-relay-error");if(ve&&ve==="true")throw new Xw(Y);if(!Y.ok)throw new Yw(Y);let Ce=((f=Y.headers.get("Content-Type"))!==null&&f!==void 0?f:"text/plain").split(";")[0].trim(),Ee;return Ce==="application/json"?Ee=yield Y.json():Ce==="application/octet-stream"?Ee=yield Y.blob():Ce==="text/event-stream"?Ee=Y:Ce==="multipart/form-data"?Ee=yield Y.formData():Ee=yield Y.text(),{data:Ee,error:null,response:Y}}catch(v){return v instanceof Error&&v.name==="AbortError"?{data:null,error:new Kw(v)}:{data:null,error:v,response:v instanceof Yw||v instanceof Xw?v.context:void 0}}})}}var Ws={},Ap={},Ip={},Cp={},Pp={},Rp={},UO=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},sm=UO();const FO=sm.fetch,bE=sm.fetch.bind(sm),xE=sm.Headers,$O=sm.Request,qO=sm.Response,gm=Object.freeze(Object.defineProperty({__proto__:null,Headers:xE,Request:$O,Response:qO,default:bE,fetch:FO},Symbol.toStringTag,{value:"Module"})),GO=qE(gm);var my={},Qw;function wE(){if(Qw)return my;Qw=1,Object.defineProperty(my,"__esModule",{value:!0});class c extends Error{constructor(i){super(i.message),this.name="PostgrestError",this.details=i.details,this.hint=i.hint,this.code=i.code}}return my.default=c,my}var Jw;function TE(){if(Jw)return Rp;Jw=1;var c=Rp&&Rp.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(Rp,"__esModule",{value:!0});const e=c(GO),i=c(wE());class l{constructor(v){var y,h;this.shouldThrowOnError=!1,this.method=v.method,this.url=v.url,this.headers=new Headers(v.headers),this.schema=v.schema,this.body=v.body,this.shouldThrowOnError=(y=v.shouldThrowOnError)!==null&&y!==void 0?y:!1,this.signal=v.signal,this.isMaybeSingle=(h=v.isMaybeSingle)!==null&&h!==void 0?h:!1,v.fetch?this.fetch=v.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(v,y){return this.headers=new Headers(this.headers),this.headers.set(v,y),this}then(v,y){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let M=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async O=>{var V,K,ee,Y;let ve=null,Ce=null,Ee=null,Je=O.status,je=O.statusText;if(O.ok){if(this.method!=="HEAD"){const Pt=await O.text();Pt===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((V=this.headers.get("Accept"))===null||V===void 0)&&V.includes("application/vnd.pgrst.plan+text"))?Ce=Pt:Ce=JSON.parse(Pt))}const gt=(K=this.headers.get("Prefer"))===null||K===void 0?void 0:K.match(/count=(exact|planned|estimated)/),St=(ee=O.headers.get("content-range"))===null||ee===void 0?void 0:ee.split("/");gt&&St&&St.length>1&&(Ee=parseInt(St[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(Ce)&&(Ce.length>1?(ve={code:"PGRST116",details:`Results contain ${Ce.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},Ce=null,Ee=null,Je=406,je="Not Acceptable"):Ce.length===1?Ce=Ce[0]:Ce=null)}else{const gt=await O.text();try{ve=JSON.parse(gt),Array.isArray(ve)&&O.status===404&&(Ce=[],ve=null,Je=200,je="OK")}catch{O.status===404&&gt===""?(Je=204,je="No Content"):ve={message:gt}}if(ve&&this.isMaybeSingle&&(!((Y=ve?.details)===null||Y===void 0)&&Y.includes("0 rows"))&&(ve=null,Je=200,je="OK"),ve&&this.shouldThrowOnError)throw new i.default(ve)}return{error:ve,data:Ce,count:Ee,status:Je,statusText:je}});return this.shouldThrowOnError||(M=M.catch(O=>{var V,K,ee;return{error:{message:`${(V=O?.name)!==null&&V!==void 0?V:"FetchError"}: ${O?.message}`,details:`${(K=O?.stack)!==null&&K!==void 0?K:""}`,hint:"",code:`${(ee=O?.code)!==null&&ee!==void 0?ee:""}`},data:null,count:null,status:0,statusText:""}})),M.then(v,y)}returns(){return this}overrideTypes(){return this}}return Rp.default=l,Rp}var e1;function SE(){if(e1)return Pp;e1=1;var c=Pp&&Pp.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(Pp,"__esModule",{value:!0});const e=c(TE());class i extends e.default{select(f){let v=!1;const y=(f??"*").split("").map(h=>/\s/.test(h)&&!v?"":(h==='"'&&(v=!v),h)).join("");return this.url.searchParams.set("select",y),this.headers.append("Prefer","return=representation"),this}order(f,{ascending:v=!0,nullsFirst:y,foreignTable:h,referencedTable:M=h}={}){const O=M?`${M}.order`:"order",V=this.url.searchParams.get(O);return this.url.searchParams.set(O,`${V?`${V},`:""}${f}.${v?"asc":"desc"}${y===void 0?"":y?".nullsfirst":".nullslast"}`),this}limit(f,{foreignTable:v,referencedTable:y=v}={}){const h=typeof y>"u"?"limit":`${y}.limit`;return this.url.searchParams.set(h,`${f}`),this}range(f,v,{foreignTable:y,referencedTable:h=y}={}){const M=typeof h>"u"?"offset":`${h}.offset`,O=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(M,`${f}`),this.url.searchParams.set(O,`${v-f+1}`),this}abortSignal(f){return this.signal=f,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:f=!1,verbose:v=!1,settings:y=!1,buffers:h=!1,wal:M=!1,format:O="text"}={}){var V;const K=[f?"analyze":null,v?"verbose":null,y?"settings":null,h?"buffers":null,M?"wal":null].filter(Boolean).join("|"),ee=(V=this.headers.get("Accept"))!==null&&V!==void 0?V:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${O}; for="${ee}"; options=${K};`),O==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(f){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${f}`),this}}return Pp.default=i,Pp}var t1;function Jb(){if(t1)return Cp;t1=1;var c=Cp&&Cp.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(Cp,"__esModule",{value:!0});const e=c(SE());class i extends e.default{eq(f,v){return this.url.searchParams.append(f,`eq.${v}`),this}neq(f,v){return this.url.searchParams.append(f,`neq.${v}`),this}gt(f,v){return this.url.searchParams.append(f,`gt.${v}`),this}gte(f,v){return this.url.searchParams.append(f,`gte.${v}`),this}lt(f,v){return this.url.searchParams.append(f,`lt.${v}`),this}lte(f,v){return this.url.searchParams.append(f,`lte.${v}`),this}like(f,v){return this.url.searchParams.append(f,`like.${v}`),this}likeAllOf(f,v){return this.url.searchParams.append(f,`like(all).{${v.join(",")}}`),this}likeAnyOf(f,v){return this.url.searchParams.append(f,`like(any).{${v.join(",")}}`),this}ilike(f,v){return this.url.searchParams.append(f,`ilike.${v}`),this}ilikeAllOf(f,v){return this.url.searchParams.append(f,`ilike(all).{${v.join(",")}}`),this}ilikeAnyOf(f,v){return this.url.searchParams.append(f,`ilike(any).{${v.join(",")}}`),this}is(f,v){return this.url.searchParams.append(f,`is.${v}`),this}in(f,v){const y=Array.from(new Set(v)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(f,`in.(${y})`),this}contains(f,v){return typeof v=="string"?this.url.searchParams.append(f,`cs.${v}`):Array.isArray(v)?this.url.searchParams.append(f,`cs.{${v.join(",")}}`):this.url.searchParams.append(f,`cs.${JSON.stringify(v)}`),this}containedBy(f,v){return typeof v=="string"?this.url.searchParams.append(f,`cd.${v}`):Array.isArray(v)?this.url.searchParams.append(f,`cd.{${v.join(",")}}`):this.url.searchParams.append(f,`cd.${JSON.stringify(v)}`),this}rangeGt(f,v){return this.url.searchParams.append(f,`sr.${v}`),this}rangeGte(f,v){return this.url.searchParams.append(f,`nxl.${v}`),this}rangeLt(f,v){return this.url.searchParams.append(f,`sl.${v}`),this}rangeLte(f,v){return this.url.searchParams.append(f,`nxr.${v}`),this}rangeAdjacent(f,v){return this.url.searchParams.append(f,`adj.${v}`),this}overlaps(f,v){return typeof v=="string"?this.url.searchParams.append(f,`ov.${v}`):this.url.searchParams.append(f,`ov.{${v.join(",")}}`),this}textSearch(f,v,{config:y,type:h}={}){let M="";h==="plain"?M="pl":h==="phrase"?M="ph":h==="websearch"&&(M="w");const O=y===void 0?"":`(${y})`;return this.url.searchParams.append(f,`${M}fts${O}.${v}`),this}match(f){return Object.entries(f).forEach(([v,y])=>{this.url.searchParams.append(v,`eq.${y}`)}),this}not(f,v,y){return this.url.searchParams.append(f,`not.${v}.${y}`),this}or(f,{foreignTable:v,referencedTable:y=v}={}){const h=y?`${y}.or`:"or";return this.url.searchParams.append(h,`(${f})`),this}filter(f,v,y){return this.url.searchParams.append(f,`${v}.${y}`),this}}return Cp.default=i,Cp}var n1;function EE(){if(n1)return Ip;n1=1;var c=Ip&&Ip.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(Ip,"__esModule",{value:!0});const e=c(Jb());class i{constructor(f,{headers:v={},schema:y,fetch:h}){this.url=f,this.headers=new Headers(v),this.schema=y,this.fetch=h}select(f,v){const{head:y=!1,count:h}=v??{},M=y?"HEAD":"GET";let O=!1;const V=(f??"*").split("").map(K=>/\s/.test(K)&&!O?"":(K==='"'&&(O=!O),K)).join("");return this.url.searchParams.set("select",V),h&&this.headers.append("Prefer",`count=${h}`),new e.default({method:M,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(f,{count:v,defaultToNull:y=!0}={}){var h;const M="POST";if(v&&this.headers.append("Prefer",`count=${v}`),y||this.headers.append("Prefer","missing=default"),Array.isArray(f)){const O=f.reduce((V,K)=>V.concat(Object.keys(K)),[]);if(O.length>0){const V=[...new Set(O)].map(K=>`"${K}"`);this.url.searchParams.set("columns",V.join(","))}}return new e.default({method:M,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(f,{onConflict:v,ignoreDuplicates:y=!1,count:h,defaultToNull:M=!0}={}){var O;const V="POST";if(this.headers.append("Prefer",`resolution=${y?"ignore":"merge"}-duplicates`),v!==void 0&&this.url.searchParams.set("on_conflict",v),h&&this.headers.append("Prefer",`count=${h}`),M||this.headers.append("Prefer","missing=default"),Array.isArray(f)){const K=f.reduce((ee,Y)=>ee.concat(Object.keys(Y)),[]);if(K.length>0){const ee=[...new Set(K)].map(Y=>`"${Y}"`);this.url.searchParams.set("columns",ee.join(","))}}return new e.default({method:V,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(O=this.fetch)!==null&&O!==void 0?O:fetch})}update(f,{count:v}={}){var y;const h="PATCH";return v&&this.headers.append("Prefer",`count=${v}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}delete({count:f}={}){var v;const y="DELETE";return f&&this.headers.append("Prefer",`count=${f}`),new e.default({method:y,url:this.url,headers:this.headers,schema:this.schema,fetch:(v=this.fetch)!==null&&v!==void 0?v:fetch})}}return Ip.default=i,Ip}var i1;function HO(){if(i1)return Ap;i1=1;var c=Ap&&Ap.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(Ap,"__esModule",{value:!0});const e=c(EE()),i=c(Jb());class l{constructor(v,{headers:y={},schema:h,fetch:M}={}){this.url=v,this.headers=new Headers(y),this.schemaName=h,this.fetch=M}from(v){const y=new URL(`${this.url}/${v}`);return new e.default(y,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(v){return new l(this.url,{headers:this.headers,schema:v,fetch:this.fetch})}rpc(v,y={},{head:h=!1,get:M=!1,count:O}={}){var V;let K;const ee=new URL(`${this.url}/rpc/${v}`);let Y;h||M?(K=h?"HEAD":"GET",Object.entries(y).filter(([Ce,Ee])=>Ee!==void 0).map(([Ce,Ee])=>[Ce,Array.isArray(Ee)?`{${Ee.join(",")}}`:`${Ee}`]).forEach(([Ce,Ee])=>{ee.searchParams.append(Ce,Ee)})):(K="POST",Y=y);const ve=new Headers(this.headers);return O&&ve.set("Prefer",`count=${O}`),new i.default({method:K,url:ee,headers:ve,schema:this.schemaName,body:Y,fetch:(V=this.fetch)!==null&&V!==void 0?V:fetch})}}return Ap.default=l,Ap}var r1;function ZO(){if(r1)return Ws;r1=1;var c=Ws&&Ws.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.PostgrestError=Ws.PostgrestBuilder=Ws.PostgrestTransformBuilder=Ws.PostgrestFilterBuilder=Ws.PostgrestQueryBuilder=Ws.PostgrestClient=void 0;const e=c(HO());Ws.PostgrestClient=e.default;const i=c(EE());Ws.PostgrestQueryBuilder=i.default;const l=c(Jb());Ws.PostgrestFilterBuilder=l.default;const f=c(SE());Ws.PostgrestTransformBuilder=f.default;const v=c(TE());Ws.PostgrestBuilder=v.default;const y=c(wE());return Ws.PostgrestError=y.default,Ws.default={PostgrestClient:e.default,PostgrestQueryBuilder:i.default,PostgrestFilterBuilder:l.default,PostgrestTransformBuilder:f.default,PostgrestBuilder:v.default,PostgrestError:y.default},Ws}var WO=ZO();const KO=Q0(WO),{PostgrestClient:XO,PostgrestQueryBuilder:hL,PostgrestFilterBuilder:dL,PostgrestTransformBuilder:fL,PostgrestBuilder:pL,PostgrestError:mL}=KO;class YO{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const i=process.versions;if(i&&i.node){const l=i.node,f=parseInt(l.replace(/^v/,"").split(".")[0]);return f>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${f} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${f} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let i=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(i+=`

Suggested solution: ${e.workaround}`),new Error(i)}static createWebSocket(e,i){const l=this.getWebSocketConstructor();return new l(e,i)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const QO="2.75.0",JO=`realtime-js/${QO}`,e3="1.0.0",F0=1e4,t3=1e3,n3=100;var Og;(function(c){c[c.connecting=0]="connecting",c[c.open=1]="open",c[c.closing=2]="closing",c[c.closed=3]="closed"})(Og||(Og={}));var Ds;(function(c){c.closed="closed",c.errored="errored",c.joined="joined",c.joining="joining",c.leaving="leaving"})(Ds||(Ds={}));var Sc;(function(c){c.close="phx_close",c.error="phx_error",c.join="phx_join",c.reply="phx_reply",c.leave="phx_leave",c.access_token="access_token"})(Sc||(Sc={}));var $0;(function(c){c.websocket="websocket"})($0||($0={}));var Pf;(function(c){c.Connecting="connecting",c.Open="open",c.Closing="closing",c.Closed="closed"})(Pf||(Pf={}));class i3{constructor(){this.HEADER_LENGTH=1}decode(e,i){return e.constructor===ArrayBuffer?i(this._binaryDecode(e)):i(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const i=new DataView(e),l=new TextDecoder;return this._decodeBroadcast(e,i,l)}_decodeBroadcast(e,i,l){const f=i.getUint8(1),v=i.getUint8(2);let y=this.HEADER_LENGTH+2;const h=l.decode(e.slice(y,y+f));y=y+f;const M=l.decode(e.slice(y,y+v));y=y+v;const O=JSON.parse(l.decode(e.slice(y,e.byteLength)));return{ref:null,topic:h,event:M,payload:O}}}class AE{constructor(e,i){this.callback=e,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var sr;(function(c){c.abstime="abstime",c.bool="bool",c.date="date",c.daterange="daterange",c.float4="float4",c.float8="float8",c.int2="int2",c.int4="int4",c.int4range="int4range",c.int8="int8",c.int8range="int8range",c.json="json",c.jsonb="jsonb",c.money="money",c.numeric="numeric",c.oid="oid",c.reltime="reltime",c.text="text",c.time="time",c.timestamp="timestamp",c.timestamptz="timestamptz",c.timetz="timetz",c.tsrange="tsrange",c.tstzrange="tstzrange"})(sr||(sr={}));const s1=(c,e,i={})=>{var l;const f=(l=i.skipTypes)!==null&&l!==void 0?l:[];return e?Object.keys(e).reduce((v,y)=>(v[y]=r3(y,c,e,f),v),{}):{}},r3=(c,e,i,l)=>{const f=e.find(h=>h.name===c),v=f?.type,y=i[c];return v&&!l.includes(v)?IE(v,y):q0(y)},IE=(c,e)=>{if(c.charAt(0)==="_"){const i=c.slice(1,c.length);return l3(e,i)}switch(c){case sr.bool:return s3(e);case sr.float4:case sr.float8:case sr.int2:case sr.int4:case sr.int8:case sr.numeric:case sr.oid:return a3(e);case sr.json:case sr.jsonb:return o3(e);case sr.timestamp:return c3(e);case sr.abstime:case sr.date:case sr.daterange:case sr.int4range:case sr.int8range:case sr.money:case sr.reltime:case sr.text:case sr.time:case sr.timestamptz:case sr.timetz:case sr.tsrange:case sr.tstzrange:return q0(e);default:return q0(e)}},q0=c=>c,s3=c=>{switch(c){case"t":return!0;case"f":return!1;default:return c}},a3=c=>{if(typeof c=="string"){const e=parseFloat(c);if(!Number.isNaN(e))return e}return c},o3=c=>{if(typeof c=="string")try{return JSON.parse(c)}catch(e){return console.log(`JSON parse error: ${e}`),c}return c},l3=(c,e)=>{if(typeof c!="string")return c;const i=c.length-1,l=c[i];if(c[0]==="{"&&l==="}"){let v;const y=c.slice(1,i);try{v=JSON.parse("["+y+"]")}catch{v=y?y.split(","):[]}return v.map(h=>IE(e,h))}return c},c3=c=>typeof c=="string"?c.replace(" ","T"):c,CE=c=>{let e=c;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class r0{constructor(e,i,l={},f=F0){this.channel=e,this.event=i,this.payload=l,this.timeout=f,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,i){var l;return this._hasReceived(e)&&i((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:e,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:i}){this.recHooks.filter(l=>l.status===e).forEach(l=>l.callback(i))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var a1;(function(c){c.SYNC="sync",c.JOIN="join",c.LEAVE="leave"})(a1||(a1={}));class zg{constructor(e,i){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=i?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},f=>{const{onJoin:v,onLeave:y,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=zg.syncState(this.state,f,v,y),this.pendingDiffs.forEach(M=>{this.state=zg.syncDiff(this.state,M,v,y)}),this.pendingDiffs=[],h()}),this.channel._on(l.diff,{},f=>{const{onJoin:v,onLeave:y,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(f):(this.state=zg.syncDiff(this.state,f,v,y),h())}),this.onJoin((f,v,y)=>{this.channel._trigger("presence",{event:"join",key:f,currentPresences:v,newPresences:y})}),this.onLeave((f,v,y)=>{this.channel._trigger("presence",{event:"leave",key:f,currentPresences:v,leftPresences:y})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,i,l,f){const v=this.cloneDeep(e),y=this.transformState(i),h={},M={};return this.map(v,(O,V)=>{y[O]||(M[O]=V)}),this.map(y,(O,V)=>{const K=v[O];if(K){const ee=V.map(Ee=>Ee.presence_ref),Y=K.map(Ee=>Ee.presence_ref),ve=V.filter(Ee=>Y.indexOf(Ee.presence_ref)<0),Ce=K.filter(Ee=>ee.indexOf(Ee.presence_ref)<0);ve.length>0&&(h[O]=ve),Ce.length>0&&(M[O]=Ce)}else h[O]=V}),this.syncDiff(v,{joins:h,leaves:M},l,f)}static syncDiff(e,i,l,f){const{joins:v,leaves:y}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return l||(l=()=>{}),f||(f=()=>{}),this.map(v,(h,M)=>{var O;const V=(O=e[h])!==null&&O!==void 0?O:[];if(e[h]=this.cloneDeep(M),V.length>0){const K=e[h].map(Y=>Y.presence_ref),ee=V.filter(Y=>K.indexOf(Y.presence_ref)<0);e[h].unshift(...ee)}l(h,V,M)}),this.map(y,(h,M)=>{let O=e[h];if(!O)return;const V=M.map(K=>K.presence_ref);O=O.filter(K=>V.indexOf(K.presence_ref)<0),e[h]=O,f(h,O,M),O.length===0&&delete e[h]}),e}static map(e,i){return Object.getOwnPropertyNames(e).map(l=>i(l,e[l]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((i,l)=>{const f=e[l];return"metas"in f?i[l]=f.metas.map(v=>(v.presence_ref=v.phx_ref,delete v.phx_ref,delete v.phx_ref_prev,v)):i[l]=f,i},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var o1;(function(c){c.ALL="*",c.INSERT="INSERT",c.UPDATE="UPDATE",c.DELETE="DELETE"})(o1||(o1={}));var Lg;(function(c){c.BROADCAST="broadcast",c.PRESENCE="presence",c.POSTGRES_CHANGES="postgres_changes",c.SYSTEM="system"})(Lg||(Lg={}));var rh;(function(c){c.SUBSCRIBED="SUBSCRIBED",c.TIMED_OUT="TIMED_OUT",c.CLOSED="CLOSED",c.CHANNEL_ERROR="CHANNEL_ERROR"})(rh||(rh={}));class ex{constructor(e,i={config:{}},l){var f,v;if(this.topic=e,this.params=i,this.socket=l,this.bindings={},this.state=Ds.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new r0(this,Sc.join,this.params,this.timeout),this.rejoinTimer=new AE(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ds.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(y=>y.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ds.closed,this.socket._remove(this)}),this._onError(y=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,y),this.state=Ds.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ds.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",y=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,y),this.state=Ds.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Sc.reply,{},(y,h)=>{this._trigger(this._replyEventName(h),y)}),this.presence=new zg(this),this.broadcastEndpointURL=CE(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((v=(f=this.params.config)===null||f===void 0?void 0:f.broadcast)===null||v===void 0)&&v.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,i=this.timeout){var l,f,v;if(this.socket.isConnected()||this.socket.connect(),this.state==Ds.closed){const{config:{broadcast:y,presence:h,private:M}}=this.params,O=(f=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(Y=>Y.filter))!==null&&f!==void 0?f:[],V=!!this.bindings[Lg.PRESENCE]&&this.bindings[Lg.PRESENCE].length>0||((v=this.params.config.presence)===null||v===void 0?void 0:v.enabled)===!0,K={},ee={broadcast:y,presence:Object.assign(Object.assign({},h),{enabled:V}),postgres_changes:O,private:M};this.socket.accessTokenValue&&(K.access_token=this.socket.accessTokenValue),this._onError(Y=>e?.(rh.CHANNEL_ERROR,Y)),this._onClose(()=>e?.(rh.CLOSED)),this.updateJoinPayload(Object.assign({config:ee},K)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:Y})=>{var ve;if(this.socket.setAuth(),Y===void 0){e?.(rh.SUBSCRIBED);return}else{const Ce=this.bindings.postgres_changes,Ee=(ve=Ce?.length)!==null&&ve!==void 0?ve:0,Je=[];for(let je=0;je<Ee;je++){const He=Ce[je],{filter:{event:gt,schema:St,table:Pt,filter:Se}}=He,pe=Y&&Y[je];if(pe&&pe.event===gt&&pe.schema===St&&pe.table===Pt&&pe.filter===Se)Je.push(Object.assign(Object.assign({},He),{id:pe.id}));else{this.unsubscribe(),this.state=Ds.errored,e?.(rh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=Je,e&&e(rh.SUBSCRIBED);return}}).receive("error",Y=>{this.state=Ds.errored,e?.(rh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(Y).join(", ")||"error")))}).receive("timeout",()=>{e?.(rh.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,i={}){return await this.send({type:"presence",event:"track",payload:e},i.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,i,l){return this.state===Ds.joined&&e===Lg.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,i,l)}async send(e,i={}){var l,f;if(!this._canPush()&&e.type==="broadcast"){const{event:v,payload:y}=e,M={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:v,payload:y,private:this.private}]})};try{const O=await this._fetchWithTimeout(this.broadcastEndpointURL,M,(l=i.timeout)!==null&&l!==void 0?l:this.timeout);return await((f=O.body)===null||f===void 0?void 0:f.cancel()),O.ok?"ok":"error"}catch(O){return O.name==="AbortError"?"timed out":"error"}}else return new Promise(v=>{var y,h,M;const O=this._push(e.type,e,i.timeout||this.timeout);e.type==="broadcast"&&!(!((M=(h=(y=this.params)===null||y===void 0?void 0:y.config)===null||h===void 0?void 0:h.broadcast)===null||M===void 0)&&M.ack)&&v("ok"),O.receive("ok",()=>v("ok")),O.receive("error",()=>v("error")),O.receive("timeout",()=>v("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ds.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Sc.close,"leave",this._joinRef())};this.joinPush.destroy();let l=null;return new Promise(f=>{l=new r0(this,Sc.leave,{},e),l.receive("ok",()=>{i(),f("ok")}).receive("timeout",()=>{i(),f("timed out")}).receive("error",()=>{f("error")}),l.send(),this._canPush()||l.trigger("ok",{})}).finally(()=>{l?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ds.closed,this.bindings={}}async _fetchWithTimeout(e,i,l){const f=new AbortController,v=setTimeout(()=>f.abort(),l),y=await this.socket.fetch(e,Object.assign(Object.assign({},i),{signal:f.signal}));return clearTimeout(v),y}_push(e,i,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let f=new r0(this,e,i,l);return this._canPush()?f.send():this._addToPushBuffer(f),f}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>n3){const i=this.pushBuffer.shift();i&&(i.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${i.event}`,i.payload))}}_onMessage(e,i,l){return i}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,i,l){var f,v;const y=e.toLocaleLowerCase(),{close:h,error:M,leave:O,join:V}=Sc;if(l&&[h,M,O,V].indexOf(y)>=0&&l!==this._joinRef())return;let ee=this._onMessage(y,i,l);if(i&&!ee)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(y)?(f=this.bindings.postgres_changes)===null||f===void 0||f.filter(Y=>{var ve,Ce,Ee;return((ve=Y.filter)===null||ve===void 0?void 0:ve.event)==="*"||((Ee=(Ce=Y.filter)===null||Ce===void 0?void 0:Ce.event)===null||Ee===void 0?void 0:Ee.toLocaleLowerCase())===y}).map(Y=>Y.callback(ee,l)):(v=this.bindings[y])===null||v===void 0||v.filter(Y=>{var ve,Ce,Ee,Je,je,He;if(["broadcast","presence","postgres_changes"].includes(y))if("id"in Y){const gt=Y.id,St=(ve=Y.filter)===null||ve===void 0?void 0:ve.event;return gt&&((Ce=i.ids)===null||Ce===void 0?void 0:Ce.includes(gt))&&(St==="*"||St?.toLocaleLowerCase()===((Ee=i.data)===null||Ee===void 0?void 0:Ee.type.toLocaleLowerCase()))}else{const gt=(je=(Je=Y?.filter)===null||Je===void 0?void 0:Je.event)===null||je===void 0?void 0:je.toLocaleLowerCase();return gt==="*"||gt===((He=i?.event)===null||He===void 0?void 0:He.toLocaleLowerCase())}else return Y.type.toLocaleLowerCase()===y}).map(Y=>{if(typeof ee=="object"&&"ids"in ee){const ve=ee.data,{schema:Ce,table:Ee,commit_timestamp:Je,type:je,errors:He}=ve;ee=Object.assign(Object.assign({},{schema:Ce,table:Ee,commit_timestamp:Je,eventType:je,new:{},old:{},errors:He}),this._getPayloadRecords(ve))}Y.callback(ee,l)})}_isClosed(){return this.state===Ds.closed}_isJoined(){return this.state===Ds.joined}_isJoining(){return this.state===Ds.joining}_isLeaving(){return this.state===Ds.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,i,l){const f=e.toLocaleLowerCase(),v={type:f,filter:i,callback:l};return this.bindings[f]?this.bindings[f].push(v):this.bindings[f]=[v],this}_off(e,i){const l=e.toLocaleLowerCase();return this.bindings[l]&&(this.bindings[l]=this.bindings[l].filter(f=>{var v;return!(((v=f.type)===null||v===void 0?void 0:v.toLocaleLowerCase())===l&&ex.isEqual(f.filter,i))})),this}static isEqual(e,i){if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const l in e)if(e[l]!==i[l])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Sc.close,{},e)}_onError(e){this._on(Sc.error,{},i=>e(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ds.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const i={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(i.new=s1(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(i.old=s1(e.columns,e.old_record)),i}}const s0=()=>{},gy={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},u3=[1e3,2e3,5e3,1e4],h3=1e4,d3=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class f3{constructor(e,i){var l;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=F0,this.transport=null,this.heartbeatIntervalMs=gy.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=s0,this.ref=0,this.reconnectTimer=null,this.logger=s0,this.conn=null,this.sendBuffer=[],this.serializer=new i3,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=f=>{let v;return f?v=f:typeof fetch>"u"?v=(...y)=>h_(async()=>{const{default:h}=await Promise.resolve().then(()=>gm);return{default:h}},void 0).then(({default:h})=>h(...y)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):v=fetch,(...y)=>v(...y)},!(!((l=i?.params)===null||l===void 0)&&l.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=i.params.apikey,this.endPoint=`${e}/${$0.websocket}`,this.httpEndpoint=CE(e),this._initializeOptions(i),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(i?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=YO.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const i=e.message;throw i.includes("Node.js")?new Error(`${i}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${i}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:e3}))}disconnect(e,i){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const l=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(l),this._setConnectionState("disconnected")},e?this.conn.close(e,i??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const i=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const e=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,i,l){this.logger(e,i,l)}connectionState(){switch(this.conn&&this.conn.readyState){case Og.connecting:return Pf.Connecting;case Og.open:return Pf.Open;case Og.closing:return Pf.Closing;default:return Pf.Closed}}isConnected(){return this.connectionState()===Pf.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,i={config:{}}){const l=`realtime:${e}`,f=this.getChannels().find(v=>v.topic===l);if(f)return f;{const v=new ex(`realtime:${e}`,i,this);return this.channels.push(v),v}}push(e){const{topic:i,event:l,payload:f,ref:v}=e,y=()=>{this.encode(e,h=>{var M;(M=this.conn)===null||M===void 0||M.send(h)})};this.log("push",`${i} ${l} (${v})`,f),this.isConnected()?y():this.sendBuffer.push(y)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(i){this.log("error","error in heartbeat callback",i)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(i){this.log("error","error in heartbeat callback",i)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(t3,"heartbeat timeout"),setTimeout(()=>{var i;this.isConnected()||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout()},gy.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(i){this.log("error","error in heartbeat callback",i)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let i=this.channels.find(l=>l.topic===e&&(l._isJoined()||l._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${e}"`),i.unsubscribe())}_remove(e){this.channels=this.channels.filter(i=>i.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,i=>{if(i.topic==="phoenix"&&i.event==="phx_reply")try{this.heartbeatCallback(i.payload.status==="ok"?"ok":"error")}catch(O){this.log("error","error in heartbeat callback",O)}i.ref&&i.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:l,event:f,payload:v,ref:y}=i,h=y?`(${y})`:"",M=v.status||"";this.log("receive",`${M} ${l} ${f} ${h}`.trim(),v),this.channels.filter(O=>O._isMember(l)).forEach(O=>O._trigger(f,v,y)),this._triggerStateCallbacks("message",i)})}_clearTimer(e){var i;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((i=this.reconnectTimer)===null||i===void 0||i.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this.workerRef.terminate()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var i;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Sc.error))}_appendParams(e,i){if(Object.keys(i).length===0)return e;const l=e.match(/\?/)?"&":"?",f=new URLSearchParams(i);return`${e}${l}${f}`}_workerObjectUrl(e){let i;if(e)i=e;else{const l=new Blob([d3],{type:"application/javascript"});i=URL.createObjectURL(l)}return i}_setConnectionState(e,i=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=i)}async _performAuth(e=null){let i;e?i=e:this.accessToken?i=await this.accessToken():i=this.accessTokenValue,this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(l=>{const f={access_token:i,version:JO};i&&l.updateJoinPayload(f),l.joinedOnce&&l._isJoined()&&l._push(Sc.access_token,{access_token:i})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(i=>{this.log("error",`error setting auth in ${e}`,i)})}_triggerStateCallbacks(e,i){try{this.stateChangeCallbacks[e].forEach(l=>{try{l(i)}catch(f){this.log("error",`error in ${e} callback`,f)}})}catch(l){this.log("error",`error triggering ${e} callbacks`,l)}}_setupReconnectionTimer(){this.reconnectTimer=new AE(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},gy.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var i,l,f,v,y,h,M,O,V;if(this.transport=(i=e?.transport)!==null&&i!==void 0?i:null,this.timeout=(l=e?.timeout)!==null&&l!==void 0?l:F0,this.heartbeatIntervalMs=(f=e?.heartbeatIntervalMs)!==null&&f!==void 0?f:gy.HEARTBEAT_INTERVAL,this.worker=(v=e?.worker)!==null&&v!==void 0?v:!1,this.accessToken=(y=e?.accessToken)!==null&&y!==void 0?y:null,this.heartbeatCallback=(h=e?.heartbeatCallback)!==null&&h!==void 0?h:s0,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(M=e?.reconnectAfterMs)!==null&&M!==void 0?M:(K=>u3[K-1]||h3),this.encode=(O=e?.encode)!==null&&O!==void 0?O:((K,ee)=>ee(JSON.stringify(K))),this.decode=(V=e?.decode)!==null&&V!==void 0?V:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class tx extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function fs(c){return typeof c=="object"&&c!==null&&"__isStorageError"in c}class p3 extends tx{constructor(e,i,l){super(e),this.name="StorageApiError",this.status=i,this.statusCode=l}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class G0 extends tx{constructor(e,i){super(e),this.name="StorageUnknownError",this.originalError=i}}var m3=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};const PE=c=>{let e;return c?e=c:typeof fetch>"u"?e=(...i)=>h_(async()=>{const{default:l}=await Promise.resolve().then(()=>gm);return{default:l}},void 0).then(({default:l})=>l(...i)):e=fetch,(...i)=>e(...i)},g3=()=>m3(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield h_(()=>Promise.resolve().then(()=>gm),void 0)).Response:Response}),H0=c=>{if(Array.isArray(c))return c.map(i=>H0(i));if(typeof c=="function"||c!==Object(c))return c;const e={};return Object.entries(c).forEach(([i,l])=>{const f=i.replace(/([-_][a-z])/gi,v=>v.toUpperCase().replace(/[-_]/g,""));e[f]=H0(l)}),e},_3=c=>{if(typeof c!="object"||c===null)return!1;const e=Object.getPrototypeOf(c);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in c)&&!(Symbol.iterator in c)};var Hf=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};const a0=c=>c.msg||c.message||c.error_description||c.error||JSON.stringify(c),y3=(c,e,i)=>Hf(void 0,void 0,void 0,function*(){const l=yield g3();c instanceof l&&!i?.noResolveJson?c.json().then(f=>{const v=c.status||500,y=f?.statusCode||v+"";e(new p3(a0(f),v,y))}).catch(f=>{e(new G0(a0(f),f))}):e(new G0(a0(c),c))}),v3=(c,e,i,l)=>{const f={method:c,headers:e?.headers||{}};return c==="GET"||!l?f:(_3(l)?(f.headers=Object.assign({"Content-Type":"application/json"},e?.headers),f.body=JSON.stringify(l)):f.body=l,e?.duplex&&(f.duplex=e.duplex),Object.assign(Object.assign({},f),i))};function d_(c,e,i,l,f,v){return Hf(this,void 0,void 0,function*(){return new Promise((y,h)=>{c(i,v3(e,l,f,v)).then(M=>{if(!M.ok)throw M;return l?.noResolveJson?M:M.json()}).then(M=>y(M)).catch(M=>y3(M,h,l))})})}function ev(c,e,i,l){return Hf(this,void 0,void 0,function*(){return d_(c,"GET",e,i,l)})}function uu(c,e,i,l,f){return Hf(this,void 0,void 0,function*(){return d_(c,"POST",e,l,f,i)})}function Z0(c,e,i,l,f){return Hf(this,void 0,void 0,function*(){return d_(c,"PUT",e,l,f,i)})}function b3(c,e,i,l){return Hf(this,void 0,void 0,function*(){return d_(c,"HEAD",e,Object.assign(Object.assign({},i),{noResolveJson:!0}),l)})}function RE(c,e,i,l,f){return Hf(this,void 0,void 0,function*(){return d_(c,"DELETE",e,l,f,i)})}var x3=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};class w3{constructor(e,i){this.downloadFn=e,this.shouldThrowOnError=i}then(e,i){return this.execute().then(e,i)}execute(){return x3(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(fs(e))return{data:null,error:e};throw e}})}}var T3=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};class S3{constructor(e,i){this.downloadFn=e,this.shouldThrowOnError=i}asStream(){return new w3(this.downloadFn,this.shouldThrowOnError)}then(e,i){return this.execute().then(e,i)}execute(){return T3(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(fs(e))return{data:null,error:e};throw e}})}}var zo=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};const E3={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},l1={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class A3{constructor(e,i={},l,f){this.shouldThrowOnError=!1,this.url=e,this.headers=i,this.bucketId=l,this.fetch=PE(f)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,i,l,f){return zo(this,void 0,void 0,function*(){try{let v;const y=Object.assign(Object.assign({},l1),f);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(y.upsert)});const M=y.metadata;typeof Blob<"u"&&l instanceof Blob?(v=new FormData,v.append("cacheControl",y.cacheControl),M&&v.append("metadata",this.encodeMetadata(M)),v.append("",l)):typeof FormData<"u"&&l instanceof FormData?(v=l,v.append("cacheControl",y.cacheControl),M&&v.append("metadata",this.encodeMetadata(M))):(v=l,h["cache-control"]=`max-age=${y.cacheControl}`,h["content-type"]=y.contentType,M&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(M)))),f?.headers&&(h=Object.assign(Object.assign({},h),f.headers));const O=this._removeEmptyFolders(i),V=this._getFinalPath(O),K=yield(e=="PUT"?Z0:uu)(this.fetch,`${this.url}/object/${V}`,v,Object.assign({headers:h},y?.duplex?{duplex:y.duplex}:{}));return{data:{path:O,id:K.Id,fullPath:K.Key},error:null}}catch(v){if(this.shouldThrowOnError)throw v;if(fs(v))return{data:null,error:v};throw v}})}upload(e,i,l){return zo(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,i,l)})}uploadToSignedUrl(e,i,l,f){return zo(this,void 0,void 0,function*(){const v=this._removeEmptyFolders(e),y=this._getFinalPath(v),h=new URL(this.url+`/object/upload/sign/${y}`);h.searchParams.set("token",i);try{let M;const O=Object.assign({upsert:l1.upsert},f),V=Object.assign(Object.assign({},this.headers),{"x-upsert":String(O.upsert)});typeof Blob<"u"&&l instanceof Blob?(M=new FormData,M.append("cacheControl",O.cacheControl),M.append("",l)):typeof FormData<"u"&&l instanceof FormData?(M=l,M.append("cacheControl",O.cacheControl)):(M=l,V["cache-control"]=`max-age=${O.cacheControl}`,V["content-type"]=O.contentType);const K=yield Z0(this.fetch,h.toString(),M,{headers:V});return{data:{path:v,fullPath:K.Key},error:null}}catch(M){if(this.shouldThrowOnError)throw M;if(fs(M))return{data:null,error:M};throw M}})}createSignedUploadUrl(e,i){return zo(this,void 0,void 0,function*(){try{let l=this._getFinalPath(e);const f=Object.assign({},this.headers);i?.upsert&&(f["x-upsert"]="true");const v=yield uu(this.fetch,`${this.url}/object/upload/sign/${l}`,{},{headers:f}),y=new URL(this.url+v.url),h=y.searchParams.get("token");if(!h)throw new tx("No token returned by API");return{data:{signedUrl:y.toString(),path:e,token:h},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(fs(l))return{data:null,error:l};throw l}})}update(e,i,l){return zo(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,i,l)})}move(e,i,l){return zo(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:l?.destinationBucket},{headers:this.headers}),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(fs(f))return{data:null,error:f};throw f}})}copy(e,i,l){return zo(this,void 0,void 0,function*(){try{return{data:{path:(yield uu(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:l?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(fs(f))return{data:null,error:f};throw f}})}createSignedUrl(e,i,l){return zo(this,void 0,void 0,function*(){try{let f=this._getFinalPath(e),v=yield uu(this.fetch,`${this.url}/object/sign/${f}`,Object.assign({expiresIn:i},l?.transform?{transform:l.transform}:{}),{headers:this.headers});const y=l?.download?`&download=${l.download===!0?"":l.download}`:"";return v={signedUrl:encodeURI(`${this.url}${v.signedURL}${y}`)},{data:v,error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(fs(f))return{data:null,error:f};throw f}})}createSignedUrls(e,i,l){return zo(this,void 0,void 0,function*(){try{const f=yield uu(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:e},{headers:this.headers}),v=l?.download?`&download=${l.download===!0?"":l.download}`:"";return{data:f.map(y=>Object.assign(Object.assign({},y),{signedUrl:y.signedURL?encodeURI(`${this.url}${y.signedURL}${v}`):null})),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(fs(f))return{data:null,error:f};throw f}})}download(e,i){const f=typeof i?.transform<"u"?"render/image/authenticated":"object",v=this.transformOptsToQueryString(i?.transform||{}),y=v?`?${v}`:"",h=this._getFinalPath(e),M=()=>ev(this.fetch,`${this.url}/${f}/${h}${y}`,{headers:this.headers,noResolveJson:!0});return new S3(M,this.shouldThrowOnError)}info(e){return zo(this,void 0,void 0,function*(){const i=this._getFinalPath(e);try{const l=yield ev(this.fetch,`${this.url}/object/info/${i}`,{headers:this.headers});return{data:H0(l),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(fs(l))return{data:null,error:l};throw l}})}exists(e){return zo(this,void 0,void 0,function*(){const i=this._getFinalPath(e);try{return yield b3(this.fetch,`${this.url}/object/${i}`,{headers:this.headers}),{data:!0,error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(fs(l)&&l instanceof G0){const f=l.originalError;if([400,404].includes(f?.status))return{data:!1,error:l}}throw l}})}getPublicUrl(e,i){const l=this._getFinalPath(e),f=[],v=i?.download?`download=${i.download===!0?"":i.download}`:"";v!==""&&f.push(v);const h=typeof i?.transform<"u"?"render/image":"object",M=this.transformOptsToQueryString(i?.transform||{});M!==""&&f.push(M);let O=f.join("&");return O!==""&&(O=`?${O}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${l}${O}`)}}}remove(e){return zo(this,void 0,void 0,function*(){try{return{data:yield RE(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(fs(i))return{data:null,error:i};throw i}})}list(e,i,l){return zo(this,void 0,void 0,function*(){try{const f=Object.assign(Object.assign(Object.assign({},E3),i),{prefix:e||""});return{data:yield uu(this.fetch,`${this.url}/object/list/${this.bucketId}`,f,{headers:this.headers},l),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(fs(f))return{data:null,error:f};throw f}})}listV2(e,i){return zo(this,void 0,void 0,function*(){try{const l=Object.assign({},e);return{data:yield uu(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,l,{headers:this.headers},i),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(fs(l))return{data:null,error:l};throw l}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const i=[];return e.width&&i.push(`width=${e.width}`),e.height&&i.push(`height=${e.height}`),e.resize&&i.push(`resize=${e.resize}`),e.format&&i.push(`format=${e.format}`),e.quality&&i.push(`quality=${e.quality}`),i.join("&")}}const I3="2.75.0",C3={"X-Client-Info":`storage-js/${I3}`};var Mp=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};class P3{constructor(e,i={},l,f){this.shouldThrowOnError=!1;const v=new URL(e);f?.useNewHostname&&/supabase\.(co|in|red)$/.test(v.hostname)&&!v.hostname.includes("storage.supabase.")&&(v.hostname=v.hostname.replace("supabase.","storage.supabase.")),this.url=v.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},C3),i),this.fetch=PE(l)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Mp(this,void 0,void 0,function*(){try{return{data:yield ev(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(fs(e))return{data:null,error:e};throw e}})}getBucket(e){return Mp(this,void 0,void 0,function*(){try{return{data:yield ev(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(fs(i))return{data:null,error:i};throw i}})}createBucket(e){return Mp(this,arguments,void 0,function*(i,l={public:!1}){try{return{data:yield uu(this.fetch,`${this.url}/bucket`,{id:i,name:i,type:l.type,public:l.public,file_size_limit:l.fileSizeLimit,allowed_mime_types:l.allowedMimeTypes},{headers:this.headers}),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(fs(f))return{data:null,error:f};throw f}})}updateBucket(e,i){return Mp(this,void 0,void 0,function*(){try{return{data:yield Z0(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(fs(l))return{data:null,error:l};throw l}})}emptyBucket(e){return Mp(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(fs(i))return{data:null,error:i};throw i}})}deleteBucket(e){return Mp(this,void 0,void 0,function*(){try{return{data:yield RE(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(fs(i))return{data:null,error:i};throw i}})}}class R3 extends P3{constructor(e,i={},l,f){super(e,i,l,f)}from(e){return new A3(this.url,this.headers,e,this.fetch)}}const M3="2.75.0";let Ig="";typeof Deno<"u"?Ig="deno":typeof document<"u"?Ig="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ig="react-native":Ig="node";const k3={"X-Client-Info":`supabase-js-${Ig}/${M3}`},D3={headers:k3},O3={schema:"public"},z3={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},L3={};var N3=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};const B3=c=>{let e;return c?e=c:typeof fetch>"u"?e=bE:e=fetch,(...i)=>e(...i)},V3=()=>typeof Headers>"u"?xE:Headers,j3=(c,e,i)=>{const l=B3(i),f=V3();return(v,y)=>N3(void 0,void 0,void 0,function*(){var h;const M=(h=yield e())!==null&&h!==void 0?h:c;let O=new f(y?.headers);return O.has("apikey")||O.set("apikey",c),O.has("Authorization")||O.set("Authorization",`Bearer ${M}`),l(v,Object.assign(Object.assign({},y),{headers:O}))})};var U3=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};function F3(c){return c.endsWith("/")?c:c+"/"}function $3(c,e){var i,l;const{db:f,auth:v,realtime:y,global:h}=c,{db:M,auth:O,realtime:V,global:K}=e,ee={db:Object.assign(Object.assign({},M),f),auth:Object.assign(Object.assign({},O),v),realtime:Object.assign(Object.assign({},V),y),storage:{},global:Object.assign(Object.assign(Object.assign({},K),h),{headers:Object.assign(Object.assign({},(i=K?.headers)!==null&&i!==void 0?i:{}),(l=h?.headers)!==null&&l!==void 0?l:{})}),accessToken:()=>U3(this,void 0,void 0,function*(){return""})};return c.accessToken?ee.accessToken=c.accessToken:delete ee.accessToken,ee}function q3(c){const e=c?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(F3(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const ME="2.75.0",Fp=30*1e3,W0=3,o0=W0*Fp,G3="http://localhost:9999",H3="supabase.auth.token",Z3={"X-Client-Info":`gotrue-js/${ME}`},K0="X-Supabase-Api-Version",kE={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},W3=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,K3=600*1e3;class Wg extends Error{constructor(e,i,l){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=l}}function gn(c){return typeof c=="object"&&c!==null&&"__isAuthError"in c}class X3 extends Wg{constructor(e,i,l){super(e,i,l),this.name="AuthApiError",this.status=i,this.code=l}}function Y3(c){return gn(c)&&c.name==="AuthApiError"}class Rf extends Wg{constructor(e,i){super(e),this.name="AuthUnknownError",this.originalError=i}}class Id extends Wg{constructor(e,i,l,f){super(e,l,f),this.name=i,this.status=l}}class sd extends Id{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Q3(c){return gn(c)&&c.name==="AuthSessionMissingError"}class kp extends Id{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _y extends Id{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class yy extends Id{constructor(e,i=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function J3(c){return gn(c)&&c.name==="AuthImplicitGrantRedirectError"}class c1 extends Id{constructor(e,i=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class X0 extends Id{constructor(e,i){super(e,"AuthRetryableFetchError",i,void 0)}}function l0(c){return gn(c)&&c.name==="AuthRetryableFetchError"}class u1 extends Id{constructor(e,i,l){super(e,"AuthWeakPasswordError",i,"weak_password"),this.reasons=l}}class Y0 extends Id{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const tv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),h1=` 	
\r=`.split(""),ez=(()=>{const c=new Array(128);for(let e=0;e<c.length;e+=1)c[e]=-1;for(let e=0;e<h1.length;e+=1)c[h1[e].charCodeAt(0)]=-2;for(let e=0;e<tv.length;e+=1)c[tv[e].charCodeAt(0)]=e;return c})();function d1(c,e,i){if(c!==null)for(e.queue=e.queue<<8|c,e.queuedBits+=8;e.queuedBits>=6;){const l=e.queue>>e.queuedBits-6&63;i(tv[l]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const l=e.queue>>e.queuedBits-6&63;i(tv[l]),e.queuedBits-=6}}function DE(c,e,i){const l=ez[c];if(l>-1)for(e.queue=e.queue<<6|l,e.queuedBits+=6;e.queuedBits>=8;)i(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(l===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(c)}"`)}}function f1(c){const e=[],i=y=>{e.push(String.fromCodePoint(y))},l={utf8seq:0,codepoint:0},f={queue:0,queuedBits:0},v=y=>{iz(y,l,i)};for(let y=0;y<c.length;y+=1)DE(c.charCodeAt(y),f,v);return e.join("")}function tz(c,e){if(c<=127){e(c);return}else if(c<=2047){e(192|c>>6),e(128|c&63);return}else if(c<=65535){e(224|c>>12),e(128|c>>6&63),e(128|c&63);return}else if(c<=1114111){e(240|c>>18),e(128|c>>12&63),e(128|c>>6&63),e(128|c&63);return}throw new Error(`Unrecognized Unicode codepoint: ${c.toString(16)}`)}function nz(c,e){for(let i=0;i<c.length;i+=1){let l=c.charCodeAt(i);if(l>55295&&l<=56319){const f=(l-55296)*1024&65535;l=(c.charCodeAt(i+1)-56320&65535|f)+65536,i+=1}tz(l,e)}}function iz(c,e,i){if(e.utf8seq===0){if(c<=127){i(c);return}for(let l=1;l<6;l+=1)if((c>>7-l&1)===0){e.utf8seq=l;break}if(e.utf8seq===2)e.codepoint=c&31;else if(e.utf8seq===3)e.codepoint=c&15;else if(e.utf8seq===4)e.codepoint=c&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(c<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|c&63,e.utf8seq-=1,e.utf8seq===0&&i(e.codepoint)}}function Xp(c){const e=[],i={queue:0,queuedBits:0},l=f=>{e.push(f)};for(let f=0;f<c.length;f+=1)DE(c.charCodeAt(f),i,l);return new Uint8Array(e)}function rz(c){const e=[];return nz(c,i=>e.push(i)),new Uint8Array(e)}function kf(c){const e=[],i={queue:0,queuedBits:0},l=f=>{e.push(f)};return c.forEach(f=>d1(f,i,l)),d1(null,i,l),e.join("")}function sz(c){return Math.round(Date.now()/1e3)+c}function az(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){const e=Math.random()*16|0;return(c=="x"?e:e&3|8).toString(16)})}const ul=()=>typeof window<"u"&&typeof document<"u",Ef={tested:!1,writable:!1},OE=()=>{if(!ul())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ef.tested)return Ef.writable;const c=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(c,c),globalThis.localStorage.removeItem(c),Ef.tested=!0,Ef.writable=!0}catch{Ef.tested=!0,Ef.writable=!1}return Ef.writable};function oz(c){const e={},i=new URL(c);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((f,v)=>{e[v]=f})}catch{}return i.searchParams.forEach((l,f)=>{e[f]=l}),e}const zE=c=>{let e;return c?e=c:typeof fetch>"u"?e=(...i)=>h_(async()=>{const{default:l}=await Promise.resolve().then(()=>gm);return{default:l}},void 0).then(({default:l})=>l(...i)):e=fetch,(...i)=>e(...i)},lz=c=>typeof c=="object"&&c!==null&&"status"in c&&"ok"in c&&"json"in c&&typeof c.json=="function",$p=async(c,e,i)=>{await c.setItem(e,JSON.stringify(i))},Af=async(c,e)=>{const i=await c.getItem(e);if(!i)return null;try{return JSON.parse(i)}catch{return i}},rd=async(c,e)=>{await c.removeItem(e)};class Av{constructor(){this.promise=new Av.promiseConstructor((e,i)=>{this.resolve=e,this.reject=i})}}Av.promiseConstructor=Promise;function c0(c){const e=c.split(".");if(e.length!==3)throw new Y0("Invalid JWT structure");for(let l=0;l<e.length;l++)if(!W3.test(e[l]))throw new Y0("JWT not in base64url format");return{header:JSON.parse(f1(e[0])),payload:JSON.parse(f1(e[1])),signature:Xp(e[2]),raw:{header:e[0],payload:e[1]}}}async function cz(c){return await new Promise(e=>{setTimeout(()=>e(null),c)})}function uz(c,e){return new Promise((l,f)=>{(async()=>{for(let v=0;v<1/0;v++)try{const y=await c(v);if(!e(v,null,y)){l(y);return}}catch(y){if(!e(v,y)){f(y);return}}})()})}function hz(c){return("0"+c.toString(16)).substr(-2)}function dz(){const e=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=i.length;let f="";for(let v=0;v<56;v++)f+=i.charAt(Math.floor(Math.random()*l));return f}return crypto.getRandomValues(e),Array.from(e,hz).join("")}async function fz(c){const i=new TextEncoder().encode(c),l=await crypto.subtle.digest("SHA-256",i),f=new Uint8Array(l);return Array.from(f).map(v=>String.fromCharCode(v)).join("")}async function pz(c){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),c;const i=await fz(c);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Dp(c,e,i=!1){const l=dz();let f=l;i&&(f+="/PASSWORD_RECOVERY"),await $p(c,`${e}-code-verifier`,f);const v=await pz(l);return[v,l===v?"plain":"s256"]}const mz=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function gz(c){const e=c.headers.get(K0);if(!e||!e.match(mz))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function _z(c){if(!c)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(c<=e)throw new Error("JWT has expired")}function yz(c){switch(c){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const vz=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Op(c){if(!vz.test(c))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function u0(){const c={};return new Proxy(c,{get:(e,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const l=i.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function p1(c){return JSON.parse(JSON.stringify(c))}var bz=function(c,e){var i={};for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&e.indexOf(l)<0&&(i[l]=c[l]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,l=Object.getOwnPropertySymbols(c);f<l.length;f++)e.indexOf(l[f])<0&&Object.prototype.propertyIsEnumerable.call(c,l[f])&&(i[l[f]]=c[l[f]]);return i};const Cf=c=>c.msg||c.message||c.error_description||c.error||JSON.stringify(c),xz=[502,503,504];async function m1(c){var e;if(!lz(c))throw new X0(Cf(c),0);if(xz.includes(c.status))throw new X0(Cf(c),c.status);let i;try{i=await c.json()}catch(v){throw new Rf(Cf(v),v)}let l;const f=gz(c);if(f&&f.getTime()>=kE["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?l=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(l=i.error_code),l){if(l==="weak_password")throw new u1(Cf(i),c.status,((e=i.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(l==="session_not_found")throw new sd}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((v,y)=>v&&typeof y=="string",!0))throw new u1(Cf(i),c.status,i.weak_password.reasons);throw new X3(Cf(i),c.status||500,l)}const wz=(c,e,i,l)=>{const f={method:c,headers:e?.headers||{}};return c==="GET"?f:(f.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),f.body=JSON.stringify(l),Object.assign(Object.assign({},f),i))};async function kn(c,e,i,l){var f;const v=Object.assign({},l?.headers);v[K0]||(v[K0]=kE["2024-01-01"].name),l?.jwt&&(v.Authorization=`Bearer ${l.jwt}`);const y=(f=l?.query)!==null&&f!==void 0?f:{};l?.redirectTo&&(y.redirect_to=l.redirectTo);const h=Object.keys(y).length?"?"+new URLSearchParams(y).toString():"",M=await Tz(c,e,i+h,{headers:v,noResolveJson:l?.noResolveJson},{},l?.body);return l?.xform?l?.xform(M):{data:Object.assign({},M),error:null}}async function Tz(c,e,i,l,f,v){const y=wz(e,l,f,v);let h;try{h=await c(i,Object.assign({},y))}catch(M){throw console.error(M),new X0(Cf(M),0)}if(h.ok||await m1(h),l?.noResolveJson)return h;try{return await h.json()}catch(M){await m1(M)}}function Tc(c){var e;let i=null;Az(c)&&(i=Object.assign({},c),c.expires_at||(i.expires_at=sz(c.expires_in)));const l=(e=c.user)!==null&&e!==void 0?e:c;return{data:{session:i,user:l},error:null}}function g1(c){const e=Tc(c);return!e.error&&c.weak_password&&typeof c.weak_password=="object"&&Array.isArray(c.weak_password.reasons)&&c.weak_password.reasons.length&&c.weak_password.message&&typeof c.weak_password.message=="string"&&c.weak_password.reasons.reduce((i,l)=>i&&typeof l=="string",!0)&&(e.data.weak_password=c.weak_password),e}function hd(c){var e;return{data:{user:(e=c.user)!==null&&e!==void 0?e:c},error:null}}function Sz(c){return{data:c,error:null}}function Ez(c){const{action_link:e,email_otp:i,hashed_token:l,redirect_to:f,verification_type:v}=c,y=bz(c,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:i,hashed_token:l,redirect_to:f,verification_type:v},M=Object.assign({},y);return{data:{properties:h,user:M},error:null}}function _1(c){return c}function Az(c){return c.access_token&&c.refresh_token&&c.expires_in}const h0=["global","local","others"];var Iz=function(c,e){var i={};for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&e.indexOf(l)<0&&(i[l]=c[l]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,l=Object.getOwnPropertySymbols(c);f<l.length;f++)e.indexOf(l[f])<0&&Object.prototype.propertyIsEnumerable.call(c,l[f])&&(i[l[f]]=c[l[f]]);return i};class Cz{constructor({url:e="",headers:i={},fetch:l}){this.url=e,this.headers=i,this.fetch=zE(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,i=h0[0]){if(h0.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${h0.join(", ")}`);try{return await kn(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(l){if(gn(l))return{data:null,error:l};throw l}}async inviteUserByEmail(e,i={}){try{return await kn(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:hd})}catch(l){if(gn(l))return{data:{user:null},error:l};throw l}}async generateLink(e){try{const{options:i}=e,l=Iz(e,["options"]),f=Object.assign(Object.assign({},l),i);return"newEmail"in l&&(f.new_email=l?.newEmail,delete f.newEmail),await kn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:f,headers:this.headers,xform:Ez,redirectTo:i?.redirectTo})}catch(i){if(gn(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(e){try{return await kn(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:hd})}catch(i){if(gn(i))return{data:{user:null},error:i};throw i}}async listUsers(e){var i,l,f,v,y,h,M;try{const O={nextPage:null,lastPage:0,total:0},V=await kn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(i=e?.page)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:"",per_page:(v=(f=e?.perPage)===null||f===void 0?void 0:f.toString())!==null&&v!==void 0?v:""},xform:_1});if(V.error)throw V.error;const K=await V.json(),ee=(y=V.headers.get("x-total-count"))!==null&&y!==void 0?y:0,Y=(M=(h=V.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&M!==void 0?M:[];return Y.length>0&&(Y.forEach(ve=>{const Ce=parseInt(ve.split(";")[0].split("=")[1].substring(0,1)),Ee=JSON.parse(ve.split(";")[1].split("=")[1]);O[`${Ee}Page`]=Ce}),O.total=parseInt(ee)),{data:Object.assign(Object.assign({},K),O),error:null}}catch(O){if(gn(O))return{data:{users:[]},error:O};throw O}}async getUserById(e){Op(e);try{return await kn(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:hd})}catch(i){if(gn(i))return{data:{user:null},error:i};throw i}}async updateUserById(e,i){Op(e);try{return await kn(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:i,headers:this.headers,xform:hd})}catch(l){if(gn(l))return{data:{user:null},error:l};throw l}}async deleteUser(e,i=!1){Op(e);try{return await kn(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:i},xform:hd})}catch(l){if(gn(l))return{data:{user:null},error:l};throw l}}async _listFactors(e){Op(e.userId);try{const{data:i,error:l}=await kn(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:f=>({data:{factors:f},error:null})});return{data:i,error:l}}catch(i){if(gn(i))return{data:null,error:i};throw i}}async _deleteFactor(e){Op(e.userId),Op(e.id);try{return{data:await kn(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(i){if(gn(i))return{data:null,error:i};throw i}}async _listOAuthClients(e){var i,l,f,v,y,h,M;try{const O={nextPage:null,lastPage:0,total:0},V=await kn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(i=e?.page)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:"",per_page:(v=(f=e?.perPage)===null||f===void 0?void 0:f.toString())!==null&&v!==void 0?v:""},xform:_1});if(V.error)throw V.error;const K=await V.json(),ee=(y=V.headers.get("x-total-count"))!==null&&y!==void 0?y:0,Y=(M=(h=V.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&M!==void 0?M:[];return Y.length>0&&(Y.forEach(ve=>{const Ce=parseInt(ve.split(";")[0].split("=")[1].substring(0,1)),Ee=JSON.parse(ve.split(";")[1].split("=")[1]);O[`${Ee}Page`]=Ce}),O.total=parseInt(ee)),{data:Object.assign(Object.assign({},K),O),error:null}}catch(O){if(gn(O))return{data:{clients:[]},error:O};throw O}}async _createOAuthClient(e){try{return await kn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(gn(i))return{data:null,error:i};throw i}}async _getOAuthClient(e){try{return await kn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(gn(i))return{data:null,error:i};throw i}}async _deleteOAuthClient(e){try{return await kn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(gn(i))return{data:null,error:i};throw i}}async _regenerateOAuthClientSecret(e){try{return await kn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(gn(i))return{data:null,error:i};throw i}}}function y1(c={}){return{getItem:e=>c[e]||null,setItem:(e,i)=>{c[e]=i},removeItem:e=>{delete c[e]}}}const zp={debug:!!(globalThis&&OE()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class LE extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Pz extends LE{}async function Rz(c,e,i){zp.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",c,e);const l=new globalThis.AbortController;return e>0&&setTimeout(()=>{l.abort(),zp.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",c)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(c,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async f=>{if(f){zp.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",c,f.name);try{return await i()}finally{zp.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",c,f.name)}}else{if(e===0)throw zp.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",c),new Pz(`Acquiring an exclusive Navigator LockManager lock "${c}" immediately failed`);if(zp.debug)try{const v=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(v,null,"  "))}catch(v){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",v)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}function Mz(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function NE(c){if(!/^0x[a-fA-F0-9]{40}$/.test(c))throw new Error(`@supabase/auth-js: Address "${c}" is invalid.`);return c.toLowerCase()}function kz(c){return parseInt(c,16)}function Dz(c){const e=new TextEncoder().encode(c);return"0x"+Array.from(e,l=>l.toString(16).padStart(2,"0")).join("")}function Oz(c){var e;const{chainId:i,domain:l,expirationTime:f,issuedAt:v=new Date,nonce:y,notBefore:h,requestId:M,resources:O,scheme:V,uri:K,version:ee}=c;{if(!Number.isInteger(i))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${i}`);if(!l)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(y&&y.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${y}`);if(!K)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(ee!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${ee}`);if(!((e=c.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${c.statement}`)}const Y=NE(c.address),ve=V?`${V}://${l}`:l,Ce=c.statement?`${c.statement}
`:"",Ee=`${ve} wants you to sign in with your Ethereum account:
${Y}

${Ce}`;let Je=`URI: ${K}
Version: ${ee}
Chain ID: ${i}${y?`
Nonce: ${y}`:""}
Issued At: ${v.toISOString()}`;if(f&&(Je+=`
Expiration Time: ${f.toISOString()}`),h&&(Je+=`
Not Before: ${h.toISOString()}`),M&&(Je+=`
Request ID: ${M}`),O){let je=`
Resources:`;for(const He of O){if(!He||typeof He!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${He}`);je+=`
- ${He}`}Je+=je}return`${Ee}
${Je}`}class ds extends Error{constructor({message:e,code:i,cause:l,name:f}){var v;super(e,{cause:l}),this.__isWebAuthnError=!0,this.name=(v=f??(l instanceof Error?l.name:void 0))!==null&&v!==void 0?v:"Unknown Error",this.code=i}}class nv extends ds{constructor(e,i){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i,message:e}),this.name="WebAuthnUnknownError",this.originalError=i}}function zz({error:c,options:e}){var i,l,f;const{publicKey:v}=e;if(!v)throw Error("options was missing required publicKey property");if(c.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ds({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:c})}else if(c.name==="ConstraintError"){if(((i=v.authenticatorSelection)===null||i===void 0?void 0:i.requireResidentKey)===!0)return new ds({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:c});if(e.mediation==="conditional"&&((l=v.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new ds({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:c});if(((f=v.authenticatorSelection)===null||f===void 0?void 0:f.userVerification)==="required")return new ds({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:c})}else{if(c.name==="InvalidStateError")return new ds({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:c});if(c.name==="NotAllowedError")return new ds({message:c.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c});if(c.name==="NotSupportedError")return v.pubKeyCredParams.filter(h=>h.type==="public-key").length===0?new ds({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:c}):new ds({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:c});if(c.name==="SecurityError"){const y=window.location.hostname;if(VE(y)){if(v.rp.id!==y)return new ds({message:`The RP ID "${v.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:c})}else return new ds({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:c})}else if(c.name==="TypeError"){if(v.user.id.byteLength<1||v.user.id.byteLength>64)return new ds({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:c})}else if(c.name==="UnknownError")return new ds({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:c})}return new ds({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c})}function Lz({error:c,options:e}){const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(c.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ds({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:c})}else{if(c.name==="NotAllowedError")return new ds({message:c.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c});if(c.name==="SecurityError"){const l=window.location.hostname;if(VE(l)){if(i.rpId!==l)return new ds({message:`The RP ID "${i.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:c})}else return new ds({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:c})}else if(c.name==="UnknownError")return new ds({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:c})}return new ds({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c})}var BE=function(c,e){var i={};for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&e.indexOf(l)<0&&(i[l]=c[l]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,l=Object.getOwnPropertySymbols(c);f<l.length;f++)e.indexOf(l[f])<0&&Object.prototype.propertyIsEnumerable.call(c,l[f])&&(i[l[f]]=c[l[f]]);return i};class Nz{createNewAbortSignal(){if(this.controller){const i=new Error("Cancelling existing WebAuthn API call for new one");i.name="AbortError",this.controller.abort(i)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Bz=new Nz;function Vz(c){if(!c)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(c);const{challenge:e,user:i,excludeCredentials:l}=c,f=BE(c,["challenge","user","excludeCredentials"]),v=Xp(e).buffer,y=Object.assign(Object.assign({},i),{id:Xp(i.id).buffer}),h=Object.assign(Object.assign({},f),{challenge:v,user:y});if(l&&l.length>0){h.excludeCredentials=new Array(l.length);for(let M=0;M<l.length;M++){const O=l[M];h.excludeCredentials[M]=Object.assign(Object.assign({},O),{id:Xp(O.id).buffer,type:O.type||"public-key",transports:O.transports})}}return h}function jz(c){if(!c)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(c);const{challenge:e,allowCredentials:i}=c,l=BE(c,["challenge","allowCredentials"]),f=Xp(e).buffer,v=Object.assign(Object.assign({},l),{challenge:f});if(i&&i.length>0){v.allowCredentials=new Array(i.length);for(let y=0;y<i.length;y++){const h=i[y];v.allowCredentials[y]=Object.assign(Object.assign({},h),{id:Xp(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return v}function Uz(c){var e;if("toJSON"in c&&typeof c.toJSON=="function")return c.toJSON();const i=c;return{id:c.id,rawId:c.id,response:{attestationObject:kf(new Uint8Array(c.response.attestationObject)),clientDataJSON:kf(new Uint8Array(c.response.clientDataJSON))},type:"public-key",clientExtensionResults:c.getClientExtensionResults(),authenticatorAttachment:(e=i.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Fz(c){var e;if("toJSON"in c&&typeof c.toJSON=="function")return c.toJSON();const i=c,l=c.getClientExtensionResults(),f=c.response;return{id:c.id,rawId:c.id,response:{authenticatorData:kf(new Uint8Array(f.authenticatorData)),clientDataJSON:kf(new Uint8Array(f.clientDataJSON)),signature:kf(new Uint8Array(f.signature)),userHandle:f.userHandle?kf(new Uint8Array(f.userHandle)):void 0},type:"public-key",clientExtensionResults:l,authenticatorAttachment:(e=i.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function VE(c){return c==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(c)}function v1(){var c,e;return!!(ul()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((c=navigator?.credentials)===null||c===void 0?void 0:c.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function $z(c){try{const e=await navigator.credentials.create(c);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new nv("Browser returned unexpected credential type",e)}:{data:null,error:new nv("Empty credential response",e)}}catch(e){return{data:null,error:zz({error:e,options:c})}}}async function qz(c){try{const e=await navigator.credentials.get(c);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new nv("Browser returned unexpected credential type",e)}:{data:null,error:new nv("Empty credential response",e)}}catch(e){return{data:null,error:Lz({error:e,options:c})}}}const Gz={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},Hz={userVerification:"preferred",hints:["security-key"]};function iv(...c){const e=f=>f!==null&&typeof f=="object"&&!Array.isArray(f),i=f=>f instanceof ArrayBuffer||ArrayBuffer.isView(f),l={};for(const f of c)if(f)for(const v in f){const y=f[v];if(y!==void 0)if(Array.isArray(y))l[v]=y;else if(i(y))l[v]=y;else if(e(y)){const h=l[v];e(h)?l[v]=iv(h,y):l[v]=iv(y)}else l[v]=y}return l}function Zz(c,e){return iv(Gz,c,e||{})}function Wz(c,e){return iv(Hz,c,e||{})}class Kz{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:i,friendlyName:l,signal:f},v){try{const{data:y,error:h}=await this.client.mfa.challenge({factorId:e,webauthn:i});if(!y)return{data:null,error:h};const M=f??Bz.createNewAbortSignal();if(y.webauthn.type==="create"){const{user:O}=y.webauthn.credential_options.publicKey;O.name||(O.name=`${O.id}:${l}`),O.displayName||(O.displayName=O.name)}switch(y.webauthn.type){case"create":{const O=Zz(y.webauthn.credential_options.publicKey,v?.create),{data:V,error:K}=await $z({publicKey:O,signal:M});return V?{data:{factorId:e,challengeId:y.id,webauthn:{type:y.webauthn.type,credential_response:V}},error:null}:{data:null,error:K}}case"request":{const O=Wz(y.webauthn.credential_options.publicKey,v?.request),{data:V,error:K}=await qz(Object.assign(Object.assign({},y.webauthn.credential_options),{publicKey:O,signal:M}));return V?{data:{factorId:e,challengeId:y.id,webauthn:{type:y.webauthn.type,credential_response:V}},error:null}:{data:null,error:K}}}}catch(y){return gn(y)?{data:null,error:y}:{data:null,error:new Rf("Unexpected error in challenge",y)}}}async _verify({challengeId:e,factorId:i,webauthn:l}){return this.client.mfa.verify({factorId:i,challengeId:e,webauthn:l})}async _authenticate({factorId:e,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:f}},v){if(!i)return{data:null,error:new Wg("rpId is required for WebAuthn authentication")};try{if(!v1())return{data:null,error:new Rf("Browser does not support WebAuthn",null)};const{data:y,error:h}=await this.challenge({factorId:e,webauthn:{rpId:i,rpOrigins:l},signal:f},{request:v});if(!y)return{data:null,error:h};const{webauthn:M}=y;return this._verify({factorId:e,challengeId:y.challengeId,webauthn:{type:M.type,rpId:i,rpOrigins:l,credential_response:M.credential_response}})}catch(y){return gn(y)?{data:null,error:y}:{data:null,error:new Rf("Unexpected error in authenticate",y)}}}async _register({friendlyName:e,rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:f},v){if(!i)return{data:null,error:new Wg("rpId is required for WebAuthn registration")};try{if(!v1())return{data:null,error:new Rf("Browser does not support WebAuthn",null)};const{data:y,error:h}=await this._enroll({friendlyName:e});if(!y)return await this.client.mfa.listFactors().then(V=>{var K;return(K=V.data)===null||K===void 0?void 0:K.all.find(ee=>ee.factor_type==="webauthn"&&ee.friendly_name===e&&ee.status!=="unverified")}).then(V=>V?this.client.mfa.unenroll({factorId:V?.id}):void 0),{data:null,error:h};const{data:M,error:O}=await this._challenge({factorId:y.id,friendlyName:y.friendly_name,webauthn:{rpId:i,rpOrigins:l},signal:f},{create:v});return M?this._verify({factorId:y.id,challengeId:M.challengeId,webauthn:{rpId:i,rpOrigins:l,type:M.webauthn.type,credential_response:M.webauthn.credential_response}}):{data:null,error:O}}catch(y){return gn(y)?{data:null,error:y}:{data:null,error:new Rf("Unexpected error in register",y)}}}}Mz();const Xz={url:G3,storageKey:H3,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Z3,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function b1(c,e,i){return await i()}const Lp={};class Kg{get jwks(){var e,i;return(i=(e=Lp[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(e){Lp[this.storageKey]=Object.assign(Object.assign({},Lp[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,i;return(i=(e=Lp[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Lp[this.storageKey]=Object.assign(Object.assign({},Lp[this.storageKey]),{cachedAt:e})}constructor(e){var i,l;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Kg.nextInstanceID,Kg.nextInstanceID+=1,this.instanceID>0&&ul()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const f=Object.assign(Object.assign({},Xz),e);if(this.logDebugMessages=!!f.debug,typeof f.debug=="function"&&(this.logger=f.debug),this.persistSession=f.persistSession,this.storageKey=f.storageKey,this.autoRefreshToken=f.autoRefreshToken,this.admin=new Cz({url:f.url,headers:f.headers,fetch:f.fetch}),this.url=f.url,this.headers=f.headers,this.fetch=zE(f.fetch),this.lock=f.lock||b1,this.detectSessionInUrl=f.detectSessionInUrl,this.flowType=f.flowType,this.hasCustomAuthorizationHeader=f.hasCustomAuthorizationHeader,f.lock?this.lock=f.lock:ul()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=Rz:this.lock=b1,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Kz(this)},this.persistSession?(f.storage?this.storage=f.storage:OE()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=y1(this.memoryStorage)),f.userStorage&&(this.userStorage=f.userStorage)):(this.memoryStorage={},this.storage=y1(this.memoryStorage)),ul()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(v){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",v)}(l=this.broadcastChannel)===null||l===void 0||l.addEventListener("message",async v=>{this._debug("received broadcast notification from other tab or client",v),await this._notifyAllSubscribers(v.data.event,v.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ME}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const i=oz(window.location.href);let l="none";if(this._isImplicitGrantCallback(i)?l="implicit":await this._isPKCECallback(i)&&(l="pkce"),ul()&&this.detectSessionInUrl&&l!=="none"){const{data:f,error:v}=await this._getSessionFromURL(i,l);if(v){if(this._debug("#_initialize()","error detecting session from URL",v),J3(v)){const M=(e=v.details)===null||e===void 0?void 0:e.code;if(M==="identity_already_exists"||M==="identity_not_found"||M==="single_identity_not_deletable")return{error:v}}return await this._removeSession(),{error:v}}const{session:y,redirectType:h}=f;return this._debug("#_initialize()","detected session in URL",y,"redirect type",h),await this._saveSession(y),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",y):await this._notifyAllSubscribers("SIGNED_IN",y)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return gn(i)?{error:i}:{error:new Rf("Unexpected error during initialization",i)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var i,l,f;try{const v=await kn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(i=e?.options)===null||i===void 0?void 0:i.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(f=e?.options)===null||f===void 0?void 0:f.captchaToken}},xform:Tc}),{data:y,error:h}=v;if(h||!y)return{data:{user:null,session:null},error:h};const M=y.session,O=y.user;return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",M)),{data:{user:O,session:M},error:null}}catch(v){if(gn(v))return{data:{user:null,session:null},error:v};throw v}}async signUp(e){var i,l,f;try{let v;if("email"in e){const{email:V,password:K,options:ee}=e;let Y=null,ve=null;this.flowType==="pkce"&&([Y,ve]=await Dp(this.storage,this.storageKey)),v=await kn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:ee?.emailRedirectTo,body:{email:V,password:K,data:(i=ee?.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:ee?.captchaToken},code_challenge:Y,code_challenge_method:ve},xform:Tc})}else if("phone"in e){const{phone:V,password:K,options:ee}=e;v=await kn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:V,password:K,data:(l=ee?.data)!==null&&l!==void 0?l:{},channel:(f=ee?.channel)!==null&&f!==void 0?f:"sms",gotrue_meta_security:{captcha_token:ee?.captchaToken}},xform:Tc})}else throw new _y("You must provide either an email or phone number and a password");const{data:y,error:h}=v;if(h||!y)return{data:{user:null,session:null},error:h};const M=y.session,O=y.user;return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",M)),{data:{user:O,session:M},error:null}}catch(v){if(gn(v))return{data:{user:null,session:null},error:v};throw v}}async signInWithPassword(e){try{let i;if("email"in e){const{email:v,password:y,options:h}=e;i=await kn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:v,password:y,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:g1})}else if("phone"in e){const{phone:v,password:y,options:h}=e;i=await kn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:v,password:y,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:g1})}else throw new _y("You must provide either an email or phone number and a password");const{data:l,error:f}=i;return f?{data:{user:null,session:null},error:f}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new kp}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:f})}catch(i){if(gn(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOAuth(e){var i,l,f,v;return await this._handleProviderSignIn(e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:(v=e.options)===null||v===void 0?void 0:v.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:i}=e;switch(i){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}}async signInWithEthereum(e){var i,l,f,v,y,h,M,O,V,K,ee;let Y,ve;if("message"in e)Y=e.message,ve=e.signature;else{const{chain:Ce,wallet:Ee,statement:Je,options:je}=e;let He;if(ul())if(typeof Ee=="object")He=Ee;else{const ye=window;if("ethereum"in ye&&typeof ye.ethereum=="object"&&"request"in ye.ethereum&&typeof ye.ethereum.request=="function")He=ye.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof Ee!="object"||!je?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");He=Ee}const gt=new URL((i=je?.url)!==null&&i!==void 0?i:window.location.href),St=await He.request({method:"eth_requestAccounts"}).then(ye=>ye).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!St||St.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Pt=NE(St[0]);let Se=(l=je?.signInWithEthereum)===null||l===void 0?void 0:l.chainId;if(!Se){const ye=await He.request({method:"eth_chainId"});Se=kz(ye)}const pe={domain:gt.host,address:Pt,statement:Je,uri:gt.href,version:"1",chainId:Se,nonce:(f=je?.signInWithEthereum)===null||f===void 0?void 0:f.nonce,issuedAt:(y=(v=je?.signInWithEthereum)===null||v===void 0?void 0:v.issuedAt)!==null&&y!==void 0?y:new Date,expirationTime:(h=je?.signInWithEthereum)===null||h===void 0?void 0:h.expirationTime,notBefore:(M=je?.signInWithEthereum)===null||M===void 0?void 0:M.notBefore,requestId:(O=je?.signInWithEthereum)===null||O===void 0?void 0:O.requestId,resources:(V=je?.signInWithEthereum)===null||V===void 0?void 0:V.resources};Y=Oz(pe),ve=await He.request({method:"personal_sign",params:[Dz(Y),Pt]})}try{const{data:Ce,error:Ee}=await kn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:Y,signature:ve},!((K=e.options)===null||K===void 0)&&K.captchaToken?{gotrue_meta_security:{captcha_token:(ee=e.options)===null||ee===void 0?void 0:ee.captchaToken}}:null),xform:Tc});if(Ee)throw Ee;return!Ce||!Ce.session||!Ce.user?{data:{user:null,session:null},error:new kp}:(Ce.session&&(await this._saveSession(Ce.session),await this._notifyAllSubscribers("SIGNED_IN",Ce.session)),{data:Object.assign({},Ce),error:Ee})}catch(Ce){if(gn(Ce))return{data:{user:null,session:null},error:Ce};throw Ce}}async signInWithSolana(e){var i,l,f,v,y,h,M,O,V,K,ee,Y;let ve,Ce;if("message"in e)ve=e.message,Ce=e.signature;else{const{chain:Ee,wallet:Je,statement:je,options:He}=e;let gt;if(ul())if(typeof Je=="object")gt=Je;else{const Pt=window;if("solana"in Pt&&typeof Pt.solana=="object"&&("signIn"in Pt.solana&&typeof Pt.solana.signIn=="function"||"signMessage"in Pt.solana&&typeof Pt.solana.signMessage=="function"))gt=Pt.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof Je!="object"||!He?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");gt=Je}const St=new URL((i=He?.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in gt&&gt.signIn){const Pt=await gt.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},He?.signInWithSolana),{version:"1",domain:St.host,uri:St.href}),je?{statement:je}:null));let Se;if(Array.isArray(Pt)&&Pt[0]&&typeof Pt[0]=="object")Se=Pt[0];else if(Pt&&typeof Pt=="object"&&"signedMessage"in Pt&&"signature"in Pt)Se=Pt;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Se&&"signature"in Se&&(typeof Se.signedMessage=="string"||Se.signedMessage instanceof Uint8Array)&&Se.signature instanceof Uint8Array)ve=typeof Se.signedMessage=="string"?Se.signedMessage:new TextDecoder().decode(Se.signedMessage),Ce=Se.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in gt)||typeof gt.signMessage!="function"||!("publicKey"in gt)||typeof gt!="object"||!gt.publicKey||!("toBase58"in gt.publicKey)||typeof gt.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");ve=[`${St.host} wants you to sign in with your Solana account:`,gt.publicKey.toBase58(),...je?["",je,""]:[""],"Version: 1",`URI: ${St.href}`,`Issued At: ${(f=(l=He?.signInWithSolana)===null||l===void 0?void 0:l.issuedAt)!==null&&f!==void 0?f:new Date().toISOString()}`,...!((v=He?.signInWithSolana)===null||v===void 0)&&v.notBefore?[`Not Before: ${He.signInWithSolana.notBefore}`]:[],...!((y=He?.signInWithSolana)===null||y===void 0)&&y.expirationTime?[`Expiration Time: ${He.signInWithSolana.expirationTime}`]:[],...!((h=He?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${He.signInWithSolana.chainId}`]:[],...!((M=He?.signInWithSolana)===null||M===void 0)&&M.nonce?[`Nonce: ${He.signInWithSolana.nonce}`]:[],...!((O=He?.signInWithSolana)===null||O===void 0)&&O.requestId?[`Request ID: ${He.signInWithSolana.requestId}`]:[],...!((K=(V=He?.signInWithSolana)===null||V===void 0?void 0:V.resources)===null||K===void 0)&&K.length?["Resources",...He.signInWithSolana.resources.map(Se=>`- ${Se}`)]:[]].join(`
`);const Pt=await gt.signMessage(new TextEncoder().encode(ve),"utf8");if(!Pt||!(Pt instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");Ce=Pt}}try{const{data:Ee,error:Je}=await kn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:ve,signature:kf(Ce)},!((ee=e.options)===null||ee===void 0)&&ee.captchaToken?{gotrue_meta_security:{captcha_token:(Y=e.options)===null||Y===void 0?void 0:Y.captchaToken}}:null),xform:Tc});if(Je)throw Je;return!Ee||!Ee.session||!Ee.user?{data:{user:null,session:null},error:new kp}:(Ee.session&&(await this._saveSession(Ee.session),await this._notifyAllSubscribers("SIGNED_IN",Ee.session)),{data:Object.assign({},Ee),error:Je})}catch(Ee){if(gn(Ee))return{data:{user:null,session:null},error:Ee};throw Ee}}async _exchangeCodeForSession(e){const i=await Af(this.storage,`${this.storageKey}-code-verifier`),[l,f]=(i??"").split("/");try{const{data:v,error:y}=await kn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:l},xform:Tc});if(await rd(this.storage,`${this.storageKey}-code-verifier`),y)throw y;return!v||!v.session||!v.user?{data:{user:null,session:null,redirectType:null},error:new kp}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign(Object.assign({},v),{redirectType:f??null}),error:y})}catch(v){if(gn(v))return{data:{user:null,session:null,redirectType:null},error:v};throw v}}async signInWithIdToken(e){try{const{options:i,provider:l,token:f,access_token:v,nonce:y}=e,h=await kn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:f,access_token:v,nonce:y,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:Tc}),{data:M,error:O}=h;return O?{data:{user:null,session:null},error:O}:!M||!M.session||!M.user?{data:{user:null,session:null},error:new kp}:(M.session&&(await this._saveSession(M.session),await this._notifyAllSubscribers("SIGNED_IN",M.session)),{data:M,error:O})}catch(i){if(gn(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOtp(e){var i,l,f,v,y;try{if("email"in e){const{email:h,options:M}=e;let O=null,V=null;this.flowType==="pkce"&&([O,V]=await Dp(this.storage,this.storageKey));const{error:K}=await kn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(i=M?.data)!==null&&i!==void 0?i:{},create_user:(l=M?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:M?.captchaToken},code_challenge:O,code_challenge_method:V},redirectTo:M?.emailRedirectTo});return{data:{user:null,session:null},error:K}}if("phone"in e){const{phone:h,options:M}=e,{data:O,error:V}=await kn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(f=M?.data)!==null&&f!==void 0?f:{},create_user:(v=M?.shouldCreateUser)!==null&&v!==void 0?v:!0,gotrue_meta_security:{captcha_token:M?.captchaToken},channel:(y=M?.channel)!==null&&y!==void 0?y:"sms"}});return{data:{user:null,session:null,messageId:O?.message_id},error:V}}throw new _y("You must provide either an email or phone number.")}catch(h){if(gn(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var i,l;try{let f,v;"options"in e&&(f=(i=e.options)===null||i===void 0?void 0:i.redirectTo,v=(l=e.options)===null||l===void 0?void 0:l.captchaToken);const{data:y,error:h}=await kn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:v}}),redirectTo:f,xform:Tc});if(h)throw h;if(!y)throw new Error("An error occurred on token verification.");const M=y.session,O=y.user;return M?.access_token&&(await this._saveSession(M),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",M)),{data:{user:O,session:M},error:null}}catch(f){if(gn(f))return{data:{user:null,session:null},error:f};throw f}}async signInWithSSO(e){var i,l,f;try{let v=null,y=null;return this.flowType==="pkce"&&([v,y]=await Dp(this.storage,this.storageKey)),await kn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(l=(i=e.options)===null||i===void 0?void 0:i.redirectTo)!==null&&l!==void 0?l:void 0}),!((f=e?.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:v,code_challenge_method:y}),headers:this.headers,xform:Sz})}catch(v){if(gn(v))return{data:null,error:v};throw v}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:i},error:l}=e;if(l)throw l;if(!i)throw new sd;const{error:f}=await kn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:f}})}catch(e){if(gn(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const i=`${this.url}/resend`;if("email"in e){const{email:l,type:f,options:v}=e,{error:y}=await kn(this.fetch,"POST",i,{headers:this.headers,body:{email:l,type:f,gotrue_meta_security:{captcha_token:v?.captchaToken}},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:y}}else if("phone"in e){const{phone:l,type:f,options:v}=e,{data:y,error:h}=await kn(this.fetch,"POST",i,{headers:this.headers,body:{phone:l,type:f,gotrue_meta_security:{captcha_token:v?.captchaToken}}});return{data:{user:null,session:null,messageId:y?.message_id},error:h}}throw new _y("You must provide either an email or phone number and a type")}catch(i){if(gn(i))return{data:{user:null,session:null},error:i};throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(e,i){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),f=(async()=>(await l,await i()))();return this.pendingInLock.push((async()=>{try{await f}catch{}})()),f}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=i();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const f=[...this.pendingInLock];await Promise.all(f),this.pendingInLock.splice(0,f.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await e(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const i=await Af(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const l=e.expires_at?e.expires_at*1e3-Date.now()<o0:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",e.expires_at),!l){if(this.userStorage){const y=await Af(this.userStorage,this.storageKey+"-user");y?.user?e.user=y.user:e.user=u0()}if(this.storage.isServer&&e.user){let y=this.suppressGetSessionWarning;e=new Proxy(e,{get:(M,O,V)=>(!y&&O==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),y=!0,this.suppressGetSessionWarning=!0),Reflect.get(M,O,V))})}return{data:{session:e},error:null}}const{data:f,error:v}=await this._callRefreshToken(e.refresh_token);return v?{data:{session:null},error:v}:{data:{session:f},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await kn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:hd}):await this._useSession(async i=>{var l,f,v;const{data:y,error:h}=i;if(h)throw h;return!(!((l=y.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new sd}:await kn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(v=(f=y.session)===null||f===void 0?void 0:f.access_token)!==null&&v!==void 0?v:void 0,xform:hd})})}catch(i){if(gn(i))return Q3(i)&&(await this._removeSession(),await rd(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:i};throw i}}async updateUser(e,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,i))}async _updateUser(e,i={}){try{return await this._useSession(async l=>{const{data:f,error:v}=l;if(v)throw v;if(!f.session)throw new sd;const y=f.session;let h=null,M=null;this.flowType==="pkce"&&e.email!=null&&([h,M]=await Dp(this.storage,this.storageKey));const{data:O,error:V}=await kn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:M}),jwt:y.access_token,xform:hd});if(V)throw V;return y.user=O.user,await this._saveSession(y),await this._notifyAllSubscribers("USER_UPDATED",y),{data:{user:y.user},error:null}})}catch(l){if(gn(l))return{data:{user:null},error:l};throw l}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new sd;const i=Date.now()/1e3;let l=i,f=!0,v=null;const{payload:y}=c0(e.access_token);if(y.exp&&(l=y.exp,f=l<=i),f){const{data:h,error:M}=await this._callRefreshToken(e.refresh_token);if(M)return{data:{user:null,session:null},error:M};if(!h)return{data:{user:null,session:null},error:null};v=h}else{const{data:h,error:M}=await this._getUser(e.access_token);if(M)throw M;v={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:l-i,expires_at:l},await this._saveSession(v),await this._notifyAllSubscribers("SIGNED_IN",v)}return{data:{user:v.user,session:v},error:null}}catch(i){if(gn(i))return{data:{session:null,user:null},error:i};throw i}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async i=>{var l;if(!e){const{data:y,error:h}=i;if(h)throw h;e=(l=y.session)!==null&&l!==void 0?l:void 0}if(!e?.refresh_token)throw new sd;const{data:f,error:v}=await this._callRefreshToken(e.refresh_token);return v?{data:{user:null,session:null},error:v}:f?{data:{user:f.user,session:f},error:null}:{data:{user:null,session:null},error:null}})}catch(i){if(gn(i))return{data:{user:null,session:null},error:i};throw i}}async _getSessionFromURL(e,i){try{if(!ul())throw new yy("No browser detected.");if(e.error||e.error_description||e.error_code)throw new yy(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new c1("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new yy("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new c1("No code detected.");const{data:je,error:He}=await this._exchangeCodeForSession(e.code);if(He)throw He;const gt=new URL(window.location.href);return gt.searchParams.delete("code"),window.history.replaceState(window.history.state,"",gt.toString()),{data:{session:je.session,redirectType:null},error:null}}const{provider_token:l,provider_refresh_token:f,access_token:v,refresh_token:y,expires_in:h,expires_at:M,token_type:O}=e;if(!v||!h||!y||!O)throw new yy("No session defined in URL");const V=Math.round(Date.now()/1e3),K=parseInt(h);let ee=V+K;M&&(ee=parseInt(M));const Y=ee-V;Y*1e3<=Fp&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${Y}s, should have been closer to ${K}s`);const ve=ee-K;V-ve>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",ve,ee,V):V-ve<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",ve,ee,V);const{data:Ce,error:Ee}=await this._getUser(v);if(Ee)throw Ee;const Je={provider_token:l,provider_refresh_token:f,access_token:v,expires_in:K,expires_at:ee,refresh_token:y,token_type:O,user:Ce.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:Je,redirectType:e.type},error:null}}catch(l){if(gn(l))return{data:{session:null,redirectType:null},error:l};throw l}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const i=await Af(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&i)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async i=>{var l;const{data:f,error:v}=i;if(v)return{error:v};const y=(l=f.session)===null||l===void 0?void 0:l.access_token;if(y){const{error:h}=await this.admin.signOut(y,e);if(h&&!(Y3(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await rd(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const i=az(),l={id:i,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:l}}}async _emitInitialSession(e){return await this._useSession(async i=>{var l,f;try{const{data:{session:v},error:y}=i;if(y)throw y;await((l=this.stateChangeEmitters.get(e))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",v)),this._debug("INITIAL_SESSION","callback id",e,"session",v)}catch(v){await((f=this.stateChangeEmitters.get(e))===null||f===void 0?void 0:f.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",v),console.error(v)}})}async resetPasswordForEmail(e,i={}){let l=null,f=null;this.flowType==="pkce"&&([l,f]=await Dp(this.storage,this.storageKey,!0));try{return await kn(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:l,code_challenge_method:f,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(v){if(gn(v))return{data:null,error:v};throw v}}async getUserIdentities(){var e;try{const{data:i,error:l}=await this.getUser();if(l)throw l;return{data:{identities:(e=i.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(i){if(gn(i))return{data:null,error:i};throw i}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var i;try{const{data:l,error:f}=await this._useSession(async v=>{var y,h,M,O,V;const{data:K,error:ee}=v;if(ee)throw ee;const Y=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(y=e.options)===null||y===void 0?void 0:y.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(M=e.options)===null||M===void 0?void 0:M.queryParams,skipBrowserRedirect:!0});return await kn(this.fetch,"GET",Y,{headers:this.headers,jwt:(V=(O=K.session)===null||O===void 0?void 0:O.access_token)!==null&&V!==void 0?V:void 0})});if(f)throw f;return ul()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(l?.url),{data:{provider:e.provider,url:l?.url},error:null}}catch(l){if(gn(l))return{data:{provider:e.provider,url:null},error:l};throw l}}async linkIdentityIdToken(e){return await this._useSession(async i=>{var l;try{const{error:f,data:{session:v}}=i;if(f)throw f;const{options:y,provider:h,token:M,access_token:O,nonce:V}=e,K=await kn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(l=v?.access_token)!==null&&l!==void 0?l:void 0,body:{provider:h,id_token:M,access_token:O,nonce:V,link_identity:!0,gotrue_meta_security:{captcha_token:y?.captchaToken}},xform:Tc}),{data:ee,error:Y}=K;return Y?{data:{user:null,session:null},error:Y}:!ee||!ee.session||!ee.user?{data:{user:null,session:null},error:new kp}:(ee.session&&(await this._saveSession(ee.session),await this._notifyAllSubscribers("USER_UPDATED",ee.session)),{data:ee,error:Y})}catch(f){if(gn(f))return{data:{user:null,session:null},error:f};throw f}})}async unlinkIdentity(e){try{return await this._useSession(async i=>{var l,f;const{data:v,error:y}=i;if(y)throw y;return await kn(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(f=(l=v.session)===null||l===void 0?void 0:l.access_token)!==null&&f!==void 0?f:void 0})})}catch(i){if(gn(i))return{data:null,error:i};throw i}}async _refreshAccessToken(e){const i=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{const l=Date.now();return await uz(async f=>(f>0&&await cz(200*Math.pow(2,f-1)),this._debug(i,"refreshing attempt",f),await kn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Tc})),(f,v)=>{const y=200*Math.pow(2,f);return v&&l0(v)&&Date.now()+y-l<Fp})}catch(l){if(this._debug(i,"error",l),gn(l))return{data:{session:null,user:null},error:l};throw l}finally{this._debug(i,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,i){const l=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",i,"url",l),ul()&&!i.skipBrowserRedirect&&window.location.assign(l),{data:{provider:e,url:l},error:null}}async _recoverAndRefresh(){var e,i;const l="#_recoverAndRefresh()";this._debug(l,"begin");try{const f=await Af(this.storage,this.storageKey);if(f&&this.userStorage){let y=await Af(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!y&&(y={user:f.user},await $p(this.userStorage,this.storageKey+"-user",y)),f.user=(e=y?.user)!==null&&e!==void 0?e:u0()}else if(f&&!f.user&&!f.user){const y=await Af(this.storage,this.storageKey+"-user");y&&y?.user?(f.user=y.user,await rd(this.storage,this.storageKey+"-user"),await $p(this.storage,this.storageKey,f)):f.user=u0()}if(this._debug(l,"session from storage",f),!this._isValidSession(f)){this._debug(l,"session is not valid"),f!==null&&await this._removeSession();return}const v=((i=f.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<o0;if(this._debug(l,`session has${v?"":" not"} expired with margin of ${o0}s`),v){if(this.autoRefreshToken&&f.refresh_token){const{error:y}=await this._callRefreshToken(f.refresh_token);y&&(console.error(y),l0(y)||(this._debug(l,"refresh failed with a non-retryable error, removing the session",y),await this._removeSession()))}}else if(f.user&&f.user.__isUserNotAvailableProxy===!0)try{const{data:y,error:h}=await this._getUser(f.access_token);!h&&y?.user?(f.user=y.user,await this._saveSession(f),await this._notifyAllSubscribers("SIGNED_IN",f)):this._debug(l,"could not get user data, skipping SIGNED_IN notification")}catch(y){console.error("Error getting user data:",y),this._debug(l,"error getting user data, skipping SIGNED_IN notification",y)}else await this._notifyAllSubscribers("SIGNED_IN",f)}catch(f){this._debug(l,"error",f),console.error(f);return}finally{this._debug(l,"end")}}async _callRefreshToken(e){var i,l;if(!e)throw new sd;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const f=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(f,"begin");try{this.refreshingDeferred=new Av;const{data:v,error:y}=await this._refreshAccessToken(e);if(y)throw y;if(!v.session)throw new sd;await this._saveSession(v.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",v.session);const h={data:v.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(v){if(this._debug(f,"error",v),gn(v)){const y={data:null,error:v};return l0(v)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(y),y}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(v),v}finally{this.refreshingDeferred=null,this._debug(f,"end")}}async _notifyAllSubscribers(e,i,l=!0){const f=`#_notifyAllSubscribers(${e})`;this._debug(f,"begin",i,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:e,session:i});const v=[],y=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,i)}catch(M){v.push(M)}});if(await Promise.all(y),v.length>0){for(let h=0;h<v.length;h+=1)console.error(v[h]);throw v[0]}}finally{this._debug(f,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const i=Object.assign({},e),l=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!l&&i.user&&await $p(this.userStorage,this.storageKey+"-user",{user:i.user});const f=Object.assign({},i);delete f.user;const v=p1(f);await $p(this.storage,this.storageKey,v)}else{const f=p1(i);await $p(this.storage,this.storageKey,f)}}async _removeSession(){this._debug("#_removeSession()"),await rd(this.storage,this.storageKey),await rd(this.storage,this.storageKey+"-code-verifier"),await rd(this.storage,this.storageKey+"-user"),this.userStorage&&await rd(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ul()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Fp);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async i=>{const{data:{session:l}}=i;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const f=Math.floor((l.expires_at*1e3-e)/Fp);this._debug("#_autoRefreshTokenTick()",`access token expires in ${f} ticks, a tick lasts ${Fp}ms, refresh threshold is ${W0} ticks`),f<=W0&&await this._callRefreshToken(l.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof LE)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ul()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const i=`#_onVisibilityChanged(${e})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,i,l){const f=[`provider=${encodeURIComponent(i)}`];if(l?.redirectTo&&f.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l?.scopes&&f.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[v,y]=await Dp(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(v)}`,code_challenge_method:`${encodeURIComponent(y)}`});f.push(h.toString())}if(l?.queryParams){const v=new URLSearchParams(l.queryParams);f.push(v.toString())}return l?.skipBrowserRedirect&&f.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${e}?${f.join("&")}`}async _unenroll(e){try{return await this._useSession(async i=>{var l;const{data:f,error:v}=i;return v?{data:null,error:v}:await kn(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(l=f?.session)===null||l===void 0?void 0:l.access_token})})}catch(i){if(gn(i))return{data:null,error:i};throw i}}async _enroll(e){try{return await this._useSession(async i=>{var l,f;const{data:v,error:y}=i;if(y)return{data:null,error:y};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:M,error:O}=await kn(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(l=v?.session)===null||l===void 0?void 0:l.access_token});return O?{data:null,error:O}:(e.factorType==="totp"&&M.type==="totp"&&(!((f=M?.totp)===null||f===void 0)&&f.qr_code)&&(M.totp.qr_code=`data:image/svg+xml;utf-8,${M.totp.qr_code}`),{data:M,error:null})})}catch(i){if(gn(i))return{data:null,error:i};throw i}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var l;const{data:f,error:v}=i;if(v)return{data:null,error:v};const y=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Uz(e.webauthn.credential_response):Fz(e.webauthn.credential_response)})}:{code:e.code}),{data:h,error:M}=await kn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:y,headers:this.headers,jwt:(l=f?.session)===null||l===void 0?void 0:l.access_token});return M?{data:null,error:M}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+h.expires_in},h)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",h),{data:h,error:M})})}catch(i){if(gn(i))return{data:null,error:i};throw i}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var l;const{data:f,error:v}=i;if(v)return{data:null,error:v};const y=await kn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(l=f?.session)===null||l===void 0?void 0:l.access_token});if(y.error)return y;const{data:h}=y;if(h.type!=="webauthn")return{data:h,error:null};switch(h.webauthn.type){case"create":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:Vz(h.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:jz(h.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(i){if(gn(i))return{data:null,error:i};throw i}})}async _challengeAndVerify(e){const{data:i,error:l}=await this._challenge({factorId:e.factorId});return l?{data:null,error:l}:await this._verify({factorId:e.factorId,challengeId:i.id,code:e.code})}async _listFactors(){var e;const{data:{user:i},error:l}=await this.getUser();if(l)return{data:null,error:l};const f={all:[],phone:[],totp:[],webauthn:[]};for(const v of(e=i?.factors)!==null&&e!==void 0?e:[])f.all.push(v),v.status==="verified"&&f[v.factor_type].push(v);return{data:f,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var i,l;const{data:{session:f},error:v}=e;if(v)return{data:null,error:v};if(!f)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:y}=c0(f.access_token);let h=null;y.aal&&(h=y.aal);let M=h;((l=(i=f.user.factors)===null||i===void 0?void 0:i.filter(K=>K.status==="verified"))!==null&&l!==void 0?l:[]).length>0&&(M="aal2");const V=y.amr||[];return{data:{currentLevel:h,nextLevel:M,currentAuthenticationMethods:V},error:null}}))}async fetchJwk(e,i={keys:[]}){let l=i.keys.find(h=>h.kid===e);if(l)return l;const f=Date.now();if(l=this.jwks.keys.find(h=>h.kid===e),l&&this.jwks_cached_at+K3>f)return l;const{data:v,error:y}=await kn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(y)throw y;return!v.keys||v.keys.length===0||(this.jwks=v,this.jwks_cached_at=f,l=v.keys.find(h=>h.kid===e),!l)?null:l}async getClaims(e,i={}){try{let l=e;if(!l){const{data:Y,error:ve}=await this.getSession();if(ve||!Y.session)return{data:null,error:ve};l=Y.session.access_token}const{header:f,payload:v,signature:y,raw:{header:h,payload:M}}=c0(l);i?.allowExpired||_z(v.exp);const O=!f.alg||f.alg.startsWith("HS")||!f.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(f.kid,i?.keys?{keys:i.keys}:i?.jwks);if(!O){const{error:Y}=await this.getUser(l);if(Y)throw Y;return{data:{claims:v,header:f,signature:y},error:null}}const V=yz(f.alg),K=await crypto.subtle.importKey("jwk",O,V,!0,["verify"]);if(!await crypto.subtle.verify(V,K,y,rz(`${h}.${M}`)))throw new Y0("Invalid JWT signature");return{data:{claims:v,header:f,signature:y},error:null}}catch(l){if(gn(l))return{data:null,error:l};throw l}}}Kg.nextInstanceID=0;const Yz=Kg;class Qz extends Yz{constructor(e){super(e)}}var Jz=function(c,e,i,l){function f(v){return v instanceof i?v:new i(function(y){y(v)})}return new(i||(i=Promise))(function(v,y){function h(V){try{O(l.next(V))}catch(K){y(K)}}function M(V){try{O(l.throw(V))}catch(K){y(K)}}function O(V){V.done?v(V.value):f(V.value).then(h,M)}O((l=l.apply(c,e||[])).next())})};class eL{constructor(e,i,l){var f,v,y;this.supabaseUrl=e,this.supabaseKey=i;const h=q3(e);if(!i)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",h),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",h),this.storageUrl=new URL("storage/v1",h),this.functionsUrl=new URL("functions/v1",h);const M=`sb-${h.hostname.split(".")[0]}-auth-token`,O={db:O3,realtime:L3,auth:Object.assign(Object.assign({},z3),{storageKey:M}),global:D3},V=$3(l??{},O);this.storageKey=(f=V.auth.storageKey)!==null&&f!==void 0?f:"",this.headers=(v=V.global.headers)!==null&&v!==void 0?v:{},V.accessToken?(this.accessToken=V.accessToken,this.auth=new Proxy({},{get:(K,ee)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(ee)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((y=V.auth)!==null&&y!==void 0?y:{},this.headers,V.global.fetch),this.fetch=j3(i,this._getAccessToken.bind(this),V.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},V.realtime)),this.rest=new XO(new URL("rest/v1",h).href,{headers:this.headers,schema:V.db.schema,fetch:this.fetch}),this.storage=new R3(this.storageUrl.href,this.headers,this.fetch,l?.storage),V.accessToken||this._listenForAuthEvents()}get functions(){return new jO(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,i={},l={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,i,l)}channel(e,i={config:{}}){return this.realtime.channel(e,i)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return Jz(this,void 0,void 0,function*(){var e,i;if(this.accessToken)return yield this.accessToken();const{data:l}=yield this.auth.getSession();return(i=(e=l.session)===null||e===void 0?void 0:e.access_token)!==null&&i!==void 0?i:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:i,detectSessionInUrl:l,storage:f,userStorage:v,storageKey:y,flowType:h,lock:M,debug:O},V,K){const ee={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Qz({url:this.authUrl.href,headers:Object.assign(Object.assign({},ee),V),storageKey:y,autoRefreshToken:e,persistSession:i,detectSessionInUrl:l,storage:f,userStorage:v,flowType:h,lock:M,debug:O,fetch:K,hasCustomAuthorizationHeader:Object.keys(this.headers).some(Y=>Y.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new f3(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,l)=>{this._handleTokenChanged(i,"CLIENT",l?.access_token)})}_handleTokenChanged(e,i,l){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==l?(this.changedAccessToken=l,this.realtime.setAuth(l)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const tL=(c,e,i)=>new eL(c,e,i);function nL(){if(typeof window<"u"||typeof process>"u")return!1;const c=process.version;if(c==null)return!1;const e=c.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}nL()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const x1=tL("https://nmaockvcpppjsrlsfthl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5tYW9ja3ZjcHBwanNybHNmdGhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1NTI0NjcsImV4cCI6MjA3NjEyODQ2N30.2yITTPPUMTpT-BCmHaJri8PrbgwjqVFtOk52cUcKJ6g"),iL=30,w1="https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",T1="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json";async function rL(c,e){if(!e.type.startsWith("image/"))throw new Error("Fichier non image.");if(e.size>5*1024*1024)throw new Error("Image trop lourde (>5 Mo)");const i=`${c}/photo.jpg`,{error:l}=await x1.storage.from("parkings").upload(i,e,{upsert:!0,contentType:e.type,cacheControl:"3600"});if(l)throw l;const{data:f}=x1.storage.from("parkings").getPublicUrl(i);return f.publicUrl}async function sL(){if(!(await Ck(IS(Kp,"parkings"))).empty)return;const e=Ok(Kp);for(const i of zO){const l=String(i.id),f=i.coordinates.map(([v,y])=>new Ic(y,v));e.set(zb(Kp,"parkings",l),{...i,coordinates:f,createdAt:Dk()})}await e.commit()}function aL({parking:c,onClose:e,onApply:i,cooldownKey:l}){const f=dn=>dn?typeof dn.photo=="string"?dn.photo:dn.photo?.url:void 0,[v,y]=rt.useState(!1),[h,M]=rt.useState(c.occupation),[O,V]=rt.useState(0),[K,ee]=rt.useState(!1),[Y,ve]=rt.useState(!1),Ce=rt.useRef(null),[Ee,Je]=rt.useState(()=>f(c)),[je,He]=rt.useState(null),[gt,St]=rt.useState(void 0);rt.useEffect(()=>{const dn=f(c),In=c?.photoUpdatedAt?`${dn}?v=${c.photoUpdatedAt}`:dn;Je(In),gt&&URL.revokeObjectURL(gt),He(null),St(void 0),y(!1),M(c.occupation)},[c]),rt.useEffect(()=>{const{remainingMs:dn}=wy(l);if(V(dn),dn>0){const In=setInterval(()=>{const{remainingMs:st}=wy(l);V(st),st<=0&&clearInterval(In)},500);return()=>clearInterval(In)}},[l]);const Pt=()=>{v&&Ce.current?.click()},Se=dn=>{const In=dn.target.files?.[0];if(In){ve(!0);try{gt&&URL.revokeObjectURL(gt),He(In),St(URL.createObjectURL(In))}finally{ve(!1),dn.target.value=""}}},pe=async()=>{if(!v){y(!0);return}const{allowed:dn,remainingMs:In}=wy(l);if(!dn){alert(`Trop rapide ! Ressaie dans ${p0(In)}.`);return}try{if(ee(!0),je){const kt=await rL(c.id,je),Zt=Date.now();await jS(zb(Kp,"parkings",String(c.id)),{photo:kt,photoUpdatedAt:Zt},{merge:!0}),Je(`${kt}?v=${Zt}`)}const st=i(h);st&&typeof st.then=="function"&&await st,e()}catch(st){alert(st?.message||"Erreur lors de lenregistrement")}finally{ee(!1)}},ye=()=>{gt&&URL.revokeObjectURL(gt),He(null),St(void 0),ve(!1),ee(!1),M(c.occupation),e()},Oe=Ee,Me=gt,Ve=v?K?"Enregistrement...":O>0?p0(O):"Appliquer":"Modifier",Te=v?"Annuler":"Fermer";return ht.jsxs("div",{className:Yt.popup,onClick:dn=>dn.stopPropagation(),children:[ht.jsx("div",{className:Yt.popupTitle,children:c.name}),ht.jsxs("div",{style:{display:"grid",gap:8,marginBottom:10},children:[ht.jsx("label",{className:Yt.sliderLabel,children:"Photo du parking"}),ht.jsxs("div",{...v?{role:"button",tabIndex:0,onClick:Pt,onKeyDown:dn=>dn.key==="Enter"||dn.key===" "?Pt():null,title:"Choisir une photo","aria-label":"Choisir une photo du parking"}:{},style:{width:"100%",maxHeight:150,borderRadius:8,overflow:"hidden",border:(v?Me:Oe)?"none":"1px dashed #ccc",position:"relative",aspectRatio:"16 / 9",background:"#f8f8f8",cursor:v?"pointer":"default",display:"grid",placeItems:"center"},children:[v?Me?ht.jsx("img",{src:Me,alt:`${c.name} - photo`,style:{width:"100%",height:"100%",objectFit:"cover"}}):ht.jsx("div",{style:{textAlign:"center",color:"#666",fontSize:13,userSelect:"none"},children:"Cliquer pour ajouter une photo"}):Oe?ht.jsx("img",{src:Oe,alt:`${c.name} - photo`,style:{width:"100%",height:"100%",objectFit:"cover"}}):ht.jsx("div",{style:{width:"100%",height:"100%"}}),v&&je&&ht.jsx("div",{style:{position:"absolute",bottom:8,right:8,padding:"4px 8px",borderRadius:999,background:"rgba(0,0,0,0.6)",color:"white",fontSize:12},children:"Modif non enregistre"})]}),ht.jsx("input",{ref:Ce,type:"file",accept:"image/*",capture:"environment",onChange:Se,disabled:!v||Y||K,style:{display:"none"}}),v&&Y&&ht.jsx("div",{style:{fontSize:12,color:"#666"},children:"Prparation de laperu"})]}),ht.jsxs("label",{htmlFor:"occupation-slider",className:Yt.sliderLabel,children:["Occupation : ",ht.jsxs("strong",{children:[h,"%"]})]}),ht.jsx("input",{id:"occupation-slider",className:Yt.slider,type:"range",min:0,max:100,value:h,onChange:dn=>M(Number(dn.target.value)),style:{"--thumb":Np(h),pointerEvents:v?"auto":"none"},disabled:!v||K}),ht.jsxs("div",{className:Yt.popupSince,children:["Dernire mise  jour il y a ",zI(c.lastUpdated)]}),ht.jsxs("div",{className:Yt.popupFooter,children:[ht.jsx("button",{onClick:ye,className:`${Yt.btn} ${Yt.btnGhost}`,disabled:K,children:Te}),ht.jsx("button",{onClick:pe,className:`${Yt.btn} ${Yt.btnPrimary}`,"aria-live":"polite","aria-busy":K||void 0,disabled:v?O>0||K:!1,children:Ve})]})]})}function oL({nightmode:c}){const e=rt.useRef(null),i=rt.useRef(null),[l,f]=rt.useState(null),v=rt.useRef(null),[y,h]=rt.useState([]),M=rt.useRef(y);rt.useEffect(()=>{M.current=y},[y]);const O=7.056407,V=43.612551,K=.005;rt.useEffect(()=>{(async()=>{await sL();const ve=Rk(IS(Kp,"parkings"),Ce=>{const Ee=Ce.docs.map(Je=>{const je=Je.data(),He=(je.coordinates??[]).map(gt=>[gt._long,gt._lat]);return{...je,coordinates:He}});h(Ee)});return()=>ve()})()},[]),rt.useEffect(()=>{if(!e.current||i.current)return;const ve=new OI.Map({container:e.current,style:c?T1:w1,center:[O,V],zoom:16,minZoom:15,maxZoom:19,maxBounds:[[O-K,V-K],[O+K,V+K]]});i.current=ve;const Ce=Ee=>{if(!v.current)return;const Je=M.current.map(He=>`parking-${He.id}`);ve.queryRenderedFeatures(Ee.point,{layers:Je}).length===0&&f(null)};return ve.on("click",Ce),()=>{ve.off("click",Ce),ve.remove(),i.current=null}},[c]);const ee=rt.useCallback(ve=>{y.forEach(Ce=>{const Ee=`parking-${Ce.id}`,Je=`parking-${Ce.id}`,je=Ce.coordinates.length===1,He=je?{type:"Point",coordinates:Ce.coordinates[0]}:{type:"LineString",coordinates:Ce.coordinates},gt={type:"Feature",properties:{id:Ce.id,size:Ce.size},geometry:He},St=ve.getSource(Ee);if(St)St.setData(gt),ve.getLayer(Je)&&(je?(ve.setPaintProperty(Je,"circle-color",Np(Ce.occupation??0)),ve.setPaintProperty(Je,"circle-radius",Ce.size)):(ve.setPaintProperty(Je,"line-color",Np(Ce.occupation??0)),ve.setPaintProperty(Je,"line-width",Ce.size)));else{ve.addSource(Ee,{type:"geojson",data:gt}),je?ve.addLayer({id:Je,type:"circle",source:Ee,paint:{"circle-radius":Ce.size,"circle-color":Np(Ce.occupation??0),"circle-opacity":.8}}):ve.addLayer({id:Je,type:"line",source:Ee,layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":Ce.size,"line-color":Np(Ce.occupation??0),"line-opacity":.8}}),ve.on("mouseenter",Je,()=>ve.getCanvas().style.cursor="pointer"),ve.on("mouseleave",Je,()=>ve.getCanvas().style.cursor="");const Pt=Se=>{const pe=Se.features?.[0],ye=Number(pe?.properties?.id??Ce.id),Oe=M.current.find(Me=>Me.id===ye)??Ce;v.current=Oe,f(Oe)};ve.on("click",Je,Pt),ve.on("touchstart",Je,Pt)}})},[y]);rt.useEffect(()=>{const ve=i.current;if(ve){if(!ve.isStyleLoaded()){const Ce=()=>ee(ve);return ve.on("load",Ce),()=>{ve.off("load",Ce)}}ee(ve)}},[y,ee]),rt.useEffect(()=>{const ve=i.current;if(!ve)return;const Ce=c?T1:w1;ve.setStyle(Ce);const Ee=()=>{ve.isStyleLoaded()&&(ve.off("idle",Ee),ee(ve))};return ve.on("idle",Ee),()=>{ve.off("idle",Ee)}},[c,ee]);const Y=async ve=>{if(!l)return;const Ce=`edit:${l.id}`,{allowed:Ee,remainingMs:Je}=wy(Ce);if(!Ee){alert(`Trop rapide ! Ressaie dans ${p0(Je)}.`);return}const je=Np(ve);h(Pt=>Pt.map(Se=>Se.id===l.id?{...Se,occupation:ve,lastUpdated:Date.now()}:Se)),f(Pt=>Pt&&{...Pt,occupation:ve,lastUpdated:Date.now()});const He=zb(Kp,"parkings",String(l.id));await Pk(He,{occupation:ve,lastUpdated:Date.now()}).catch(async()=>{await jS(He,{...l,occupation:ve,lastUpdated:Date.now()})});const gt=i.current,St=`parking-${l.id}`;gt&&gt.getLayer(St)&&(gt.setPaintProperty(St,"line-color",je),gt.setPaintProperty(St,"circle-color",je)),BI(Ce,iL)};return ht.jsxs("div",{className:Yt.mapSectionRoot,children:[ht.jsx("div",{ref:e,className:Yt.mapCanvas}),l&&ht.jsx("div",{onClick:()=>f(null),className:Yt.modalOverlay}),l&&ht.jsx("div",{className:Yt.modalWrapper,children:ht.jsx(aL,{parking:l,onClose:()=>f(null),onApply:Y,cooldownKey:`edit:${l.id}`})})]})}function S1(){const{nightmode:c}=M2(),[e,i]=rt.useState(!1);rt.useEffect(()=>{document.documentElement.setAttribute("data-theme",c?"dark":"light")},[c]),rt.useEffect(()=>{const f=()=>{const v=document.documentElement,y=Math.max(v.scrollHeight,document.body.scrollHeight)||v.scrollHeight,h=window.scrollY||window.pageYOffset,M=window.innerHeight;i(M+h>=y-120)};return f(),window.addEventListener("scroll",f,{passive:!0}),window.addEventListener("resize",f),()=>{window.removeEventListener("scroll",f),window.removeEventListener("resize",f)}},[]);const l=()=>{const f=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);window.scrollTo({top:f,behavior:"smooth"})};return ht.jsxs("div",{className:Yt.page,children:[ht.jsxs("main",{className:Yt.main,children:[ht.jsx("section",{className:Yt.section,"aria-label":"Carte campus",children:ht.jsx(oL,{nightmode:c})}),ht.jsxs("section",{className:Yt.section,children:[ht.jsx("h1",{id:"mission",className:Yt.title,children:"Notre mission"}),ht.jsxs("div",{className:Yt.text,children:[ht.jsxs("p",{children:["Chaque anne, les tudiants de ",ht.jsx("strong",{children:"SKEMA"})," investissent des sommes importantes pour suivre une formation."]}),ht.jsxs("p",{children:["Pourtant, l'un des besoins les plus basiques "," ",ht.jsx("em",{children:"pouvoir accder aux cours"}),"  n'est pas assur : les places de stationnement sur le campus de ",ht.jsx("strong",{children:"Sophia Antipolis"})," sont trs insuffisantes."]}),ht.jsx("p",{children:"Le rsultat est simple : mme en arrivant tt, de nombreux tudiants ne trouvent pas de stationnement, doivent se garer sur des parkings privs voisins, et s'il n'y a toujours pas de place, renoncent  suivre leurs cours. Sans parler du risque d'abmer leur voiture d au surnombre sur un espace restreint."}),ht.jsx("p",{children:"Cette situation est inadmissible dans une cole prive de ce niveau."}),ht.jsx("p",{children:"Notre initiative a deux objectifs :"})]}),ht.jsxs("div",{className:Yt.text,children:[ht.jsx("h2",{className:Yt.objTitle,children:"1. Donner une information en temps rel sur l'occupation des parkings"}),ht.jsxs("ul",{className:Yt.list,children:[ht.jsx("li",{children:"Consulter l'tat d'occupation des diffrentes zones et signaler leur remplissage (vide, partiel, complet)."}),ht.jsx("li",{children:"Anticiper ses dplacements et viter le stress et la perte de temps."})]})]})]}),ht.jsx("section",{className:Yt.section,children:ht.jsxs("div",{className:Yt.text,children:[ht.jsx("h2",{className:Yt.objTitle,children:"2. Faire voluer l'organisation de SKEMA"}),ht.jsx("p",{children:"Nous demandons que l'cole prenne ses responsabilits et investisse dans de vritables solutions :"}),ht.jsxs("ul",{className:Yt.list,children:[ht.jsx("li",{children:"Cration ou extension rapide des espaces de stationnement."}),ht.jsx("li",{children:"Mise en place, dans l'attente, de cours en visio pour les sances qui attirent le plus d'tudiants (notamment en amphithtre)."})]})]})}),ht.jsx("section",{className:Yt.section,children:ht.jsxs("div",{className:Yt.text,children:[ht.jsx("p",{children:"Nous croyons qu'une cole qui demande un tel investissement financier doit offrir des conditions d'accs et d'organisation  la hauteur."}),ht.jsx("p",{children:"En signant la ptition intgre  l'application, vous contribuez  faire entendre votre voix et  changer les choses pour tous."}),ht.jsx("div",{className:Yt.petitionBox,id:"petition",children:ht.jsx("a",{href:"https://c.org/CwFHpvtnz2",className:Yt.petitionBtn,target:"_blank",rel:"noopener noreferrer",children:"Signer la ptition"})})]})})]}),!e&&ht.jsx("button",{className:Yt.mobileArrow,"aria-label":"Aller en bas de page",onClick:l,children:ht.jsx("svg",{viewBox:"0 0 24 24",className:Yt.mobileArrowIcon,"aria-hidden":"true",children:ht.jsx("path",{d:"M12 4v14m0 0l-6-6m6 6l6-6",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})}function lL(){return ht.jsx("div",{className:Yt.page,children:ht.jsxs("main",{className:Yt.main,children:[ht.jsxs("section",{className:Yt.section,children:[ht.jsx("h1",{className:Yt.title,children:"Contact"}),ht.jsxs("div",{className:Yt.text,children:[ht.jsx("p",{children:"Une question, un problme technique ou une suggestion concernant l'application ?"}),ht.jsx("p",{children:"Tu peux nous contacter  :"}),ht.jsx("p",{children:"skameparking@hotmail.com"})]})]}),ht.jsxs("section",{className:Yt.sectionBis,children:[ht.jsx("h1",{className:Yt.title,children:"Rseaux sociaux"}),ht.jsxs("div",{className:Yt.socials,children:[ht.jsx("a",{href:"https://www.linkedin.com/company/skame-parking/",target:"_blank",rel:"noopener noreferrer",children:ht.jsx(SI,{})}),ht.jsx("a",{href:"https://www.tiktok.com/@skameparking",target:"_blank",rel:"noopener noreferrer",children:ht.jsx(EI,{})}),ht.jsx("a",{href:"https://www.instagram.com/skameparking/",target:"_blank",rel:"noopener noreferrer",children:ht.jsx(TI,{})})]}),ht.jsx("div",{className:Yt.petitionBox,children:ht.jsx(ad,{to:"/",className:Yt.petitionBtn,children:"Retourner  la carte"})})]})]})})}e2.createRoot(document.getElementById("root")).render(ht.jsx(rt.StrictMode,{children:ht.jsx(_A,{basename:"/Skame-Parking/",children:ht.jsx(W2,{children:ht.jsxs(wg,{element:ht.jsx(RI,{}),children:[ht.jsx(wg,{index:!0,element:ht.jsx(S1,{})}),ht.jsx(wg,{path:"contact",element:ht.jsx(lL,{})}),ht.jsx(wg,{path:"*",element:ht.jsx(S1,{})})]})})})}));
